<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å´é”´çš„åšå®¢</title>
  
  <subtitle>Life? Don&#39;t talk to me about life!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.wukai.me/"/>
  <updated>2022-02-27T10:58:32.953Z</updated>
  <id>http://www.wukai.me/</id>
  
  <author>
    <name>noiron</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä½¿ç”¨ Nodejs éå†æ–‡ä»¶å¤¹</title>
    <link href="http://www.wukai.me/2022/02/27/nodejs-traverse-folder/"/>
    <id>http://www.wukai.me/2022/02/27/nodejs-traverse-folder/</id>
    <published>2022-02-27T10:41:52.000Z</published>
    <updated>2022-02-27T10:58:32.953Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å†™ä¸€ä¸ªç®¡ç† markdown æ–‡ä»¶çš„å·¥å…· <a href="https://github.com/noiron/knowledge-center">knowledge-center</a>ï¼Œéœ€è¦è¯»å–æŒ‡å®šæ–‡ä»¶å¤¹å†…æ‰€æœ‰ markdown æ–‡ä»¶ã€‚å› æ­¤éœ€è¦ç”¨ Node.js æ¥å®ç°éå†ä¸€ä¸ªæ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶çš„åŠŸèƒ½ã€‚</p><p>Node.js ä¸­æä¾›äº†è¿™äº›æœ‰ç”¨çš„ APIï¼š</p><ul><li><code>fs.readdir</code>ï¼šå¼‚æ­¥è¯»å–æ–‡ä»¶å¤¹</li><li><code>fs.readdirSync</code>ï¼šåŒæ­¥è¯»å–æ–‡ä»¶å¤¹</li><li><code>fs.statSync</code>ï¼šåŒæ­¥è·å–æ–‡ä»¶å±æ€§</li></ul><span id="more"></span><h2 id="è·å–çš„æ–‡ä»¶åˆ—è¡¨ä¸ºæ•°ç»„æ ¼å¼"><a href="#è·å–çš„æ–‡ä»¶åˆ—è¡¨ä¸ºæ•°ç»„æ ¼å¼" class="headerlink" title="è·å–çš„æ–‡ä»¶åˆ—è¡¨ä¸ºæ•°ç»„æ ¼å¼"></a>è·å–çš„æ–‡ä»¶åˆ—è¡¨ä¸ºæ•°ç»„æ ¼å¼</h2><p>å¯¹äºéå†çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æŒ‰åˆ—è¡¨æˆ–æ–‡ä»¶æ ‘æ¥å±•ç¤ºã€‚å…ˆä»æœ€ç®€å•çš„æƒ…å†µçœ‹èµ·ï¼Œç”¨åŒæ­¥æ–¹å¼å¤„ç†ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p><script src="https://gist.github.com/noiron/f6be6840739c7c0fc356659d64db96fc.js?file=traverseFolderList.js"></script><p>å…ˆä½¿ç”¨ <code>fs.readdirSync</code> è·å–æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åéå†æ–‡ä»¶åˆ—è¡¨ï¼Œä½¿ç”¨ <code>fs.statSync</code> è·å–åˆ—è¡¨ä¸­æ–‡ä»¶çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯æ–‡ä»¶ï¼Œåˆ™æ·»åŠ åˆ°æ–‡ä»¶åˆ—è¡¨ä¸­ï¼Œå¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œåˆ™é€’å½’è°ƒç”¨ <code>traverseFolderList</code> å‡½æ•°ï¼Œç›´åˆ°è·å–åˆ°æ‰€æœ‰æ–‡ä»¶ã€‚</p><h2 id="è·å–çš„æ–‡ä»¶åˆ—è¡¨ä¸ºå¯¹è±¡æ ¼å¼"><a href="#è·å–çš„æ–‡ä»¶åˆ—è¡¨ä¸ºå¯¹è±¡æ ¼å¼" class="headerlink" title="è·å–çš„æ–‡ä»¶åˆ—è¡¨ä¸ºå¯¹è±¡æ ¼å¼"></a>è·å–çš„æ–‡ä»¶åˆ—è¡¨ä¸ºå¯¹è±¡æ ¼å¼</h2><p>å¦‚æœæˆ‘ä»¬æƒ³å±•ç¤ºæ–‡ä»¶å¤¹ç›®å½•ç»“æ„ï¼Œé‚£ä¹ˆåˆ—è¡¨æ ¼å¼çš„å°±ä¸å¤ªæ–¹ä¾¿äº†ã€‚å‡è®¾æœ‰å¦‚ä¸‹çš„æ–‡ä»¶å¤¹ç»“æ„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./1</span><br><span class="line">â”œâ”€â”€ 2</span><br><span class="line">â”‚   â”œâ”€â”€ test2.txt</span><br><span class="line">â”‚   â””â”€â”€ test2_1.txt</span><br><span class="line">â””â”€â”€ 3</span><br><span class="line">    â”œâ”€â”€ 4</span><br><span class="line">    â”‚   â””â”€â”€ test4.txt</span><br><span class="line">    â””â”€â”€ test3.txt</span><br></pre></td></tr></table></figure><p>å¸Œæœ›è·å–åˆ°çš„å¯¹è±¡ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">root</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;./1&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>: [<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>],</span><br><span class="line">    <span class="attr">isRoot</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">2</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;folder&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>: [<span class="string">&#x27;2/test2.txt&#x27;</span>, <span class="string">&#x27;2/test2_1.txt&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">3</span>: &#123; <span class="attr">path</span>: <span class="string">&#x27;3&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;folder&#x27;</span>, <span class="attr">children</span>: [<span class="string">&#x27;3/4&#x27;</span>, <span class="string">&#x27;3/test3.txt&#x27;</span>] &#125;,</span><br><span class="line">  <span class="string">&#x27;2/test2.txt&#x27;</span>: &#123; <span class="attr">path</span>: <span class="string">&#x27;2/test2.txt&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> &#125;,</span><br><span class="line">  <span class="string">&#x27;2/test2_1.txt&#x27;</span>: &#123; <span class="attr">path</span>: <span class="string">&#x27;2/test2_1.txt&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> &#125;,</span><br><span class="line">  <span class="string">&#x27;3/4/test4.txt&#x27;</span>: &#123; <span class="attr">path</span>: <span class="string">&#x27;3/4/test4.txt&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;folder&#x27;</span>, <span class="attr">children</span>: [] &#125;,</span><br><span class="line">  <span class="string">&#x27;3/4&#x27;</span>: &#123; <span class="attr">path</span>: <span class="string">&#x27;3/4&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;folder&#x27;</span>, <span class="attr">children</span>: [<span class="string">&#x27;3/4/test4.txt&#x27;</span>] &#125;,</span><br><span class="line">  <span class="string">&#x27;3/test3.txt&#x27;</span>: &#123; <span class="attr">path</span>: <span class="string">&#x27;3/test3.txt&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;file&#x27;</span> &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¯¹è±¡ä»¥æ–‡ä»¶/æ–‡ä»¶å¤¹ç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ä¸º keyï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«äº†è¿™äº›å±æ€§ï¼š</p><ul><li><code>type</code>ï¼šç”¨äºåŒºåˆ†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ç±»å‹</li><li><code>path</code>ï¼šç›¸å¯¹è·¯å¾„</li><li><code>children</code>ï¼šå¦‚æœæ˜¯æ–‡ä»¶å¤¹ç±»å‹ï¼Œåˆ™å…¶ä¸­æ˜¯å­æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„</li></ul><script src="https://gist.github.com/noiron/f6be6840739c7c0fc356659d64db96fc.js?file=traverseFolderObj.js"></script><h2 id="å¼‚æ­¥æ–¹å¼"><a href="#å¼‚æ­¥æ–¹å¼" class="headerlink" title="å¼‚æ­¥æ–¹å¼"></a>å¼‚æ­¥æ–¹å¼</h2><p>åœ¨ä¸Šé¢çš„å®ç°ä¸­ï¼Œéƒ½æ˜¯ä½¿ç”¨äº†åŒæ­¥çš„æ–¹å¼æ¥å¤„ç†ï¼Œå³ <code>fs.readdirSync</code> æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥æ–¹å¼æ¥å¤„ç†å—ï¼Ÿ</p><p>å¯ä»¥é€‰æ‹© <code>fs.readdir</code> æ¥å¼‚æ­¥è¯»å–æ–‡ä»¶å¤¹, ä½†æ˜¯å›è°ƒå‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸å¤ªæ–¹ä¾¿ã€‚åœ¨ Node 10+ ä¸­å¯ä»¥ä» <code>fs.promises</code> ä¸­å¼•å…¥ <code>readdir</code> æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨æ–¹ä¾¿çš„ <code>async/await</code> è¯­æ³•æ¥è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼ŒåŒæ—¶é¿å…äº†  çš„å›è°ƒå‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; readdir &#125; = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).promises; </span><br></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„ <code>traverseFolderList</code> æ–¹æ³•é‡å†™ä¸ºå¼‚æ­¥æ ¼å¼ï¼š</p><script src="https://gist.github.com/noiron/f6be6840739c7c0fc356659d64db96fc.js?file=asyncTraverseFolderList.js"></script><h2 id="æ¯”è¾ƒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹æ¡ˆ"><a href="#æ¯”è¾ƒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹æ¡ˆ" class="headerlink" title="æ¯”è¾ƒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹æ¡ˆ"></a>æ¯”è¾ƒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹æ¡ˆ</h2><p><code>traverseFolderList</code> å’Œ <code>asyncTraverseFolderList</code> è¿”å›çš„ç»“æœéƒ½æ˜¯åˆ—è¡¨æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªæµ‹è¯•è„šæœ¬æ¥æ¯”è¾ƒä¸‹äºŒè€…çš„è¿è¡Œæ—¶é—´ï¼š</p><script src="https://gist.github.com/noiron/f6be6840739c7c0fc356659d64db96fc.js?file=index.js"></script><p>åˆ†åˆ«ç”¨ä¸¤ä¸ªå‡½æ•°éå†äº†åŒä¸€ä¸ªæ–‡ä»¶å¤¹åæ¬¡åï¼Œç»Ÿè®¡ç»“æœå¦‚ä¸‹ï¼Œå¼‚æ­¥æ–¹å¼æ¯”åŒæ­¥æ–¹å¼å¿«äº†çº¦18%ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŒæ­¥ - å¹³å‡è€—æ—¶ï¼š1217.1ms</span><br><span class="line">å¼‚æ­¥ - å¹³å‡è€—æ—¶ï¼š1025.7ms</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote><p><a href="https://stackoverflow.com/a/45130990">https://stackoverflow.com/a/45130990</a></p><p>fs.promises å’Œ promisify api<br><a href="https://nodejs.org/dist/latest-v10.x/docs/api/fs.html#fs_fs_promises_api">https://nodejs.org/dist/latest-v10.x/docs/api/fs.html#fs_fs_promises_api</a><br><a href="https://javascript.info/promisify">https://javascript.info/promisify</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨å†™ä¸€ä¸ªç®¡ç† markdown æ–‡ä»¶çš„å·¥å…· &lt;a href=&quot;https://github.com/noiron/knowledge-center&quot;&gt;knowledge-center&lt;/a&gt;ï¼Œéœ€è¦è¯»å–æŒ‡å®šæ–‡ä»¶å¤¹å†…æ‰€æœ‰ markdown æ–‡ä»¶ã€‚å› æ­¤éœ€è¦ç”¨ Node.js æ¥å®ç°éå†ä¸€ä¸ªæ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Node.js ä¸­æä¾›äº†è¿™äº›æœ‰ç”¨çš„ APIï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fs.readdir&lt;/code&gt;ï¼šå¼‚æ­¥è¯»å–æ–‡ä»¶å¤¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fs.readdirSync&lt;/code&gt;ï¼šåŒæ­¥è¯»å–æ–‡ä»¶å¤¹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fs.statSync&lt;/code&gt;ï¼šåŒæ­¥è·å–æ–‡ä»¶å±æ€§&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="nodejs" scheme="http://www.wukai.me/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•è§£æ•°ç‹¬</title>
    <link href="http://www.wukai.me/2022/02/16/sudoku/"/>
    <id>http://www.wukai.me/2022/02/16/sudoku/</id>
    <published>2022-02-15T16:00:00.000Z</published>
    <updated>2022-02-27T04:19:27.767Z</updated>
    
    <content type="html"><![CDATA[<p>æ•°ç‹¬æ¸¸æˆçš„è§„åˆ™å¾ˆç®€å•ï¼Œåœ¨9x9çš„çŸ©é˜µä¸­ï¼Œæ¯è¡Œã€æ¯åˆ—ã€æ¯ä¸ªä¹å®«æ ¼ä¸­éƒ½éœ€è¦å¡«å…¥1~9å…±ä¹ä¸ªæ•°å­—ï¼Œä¸”ä¸é‡å¤ã€‚</p><p>Peter Norvig çš„è¿™ç¯‡æ–‡ç«  <a href="https://norvig.com/sudoku.html">Solving Every Sudoku Puzzle</a> è¯¦ç»†ä»‹ç»äº†ä¸€ç§è§£æ•°ç‹¬çš„æ–¹æ³•ã€‚æ–‡ä¸­çš„ä»£ç åŸºäº Python2 å®ç°ï¼Œæˆ‘å°†å…¶æ”¹å†™æˆäº† JavaScript çš„ç‰ˆæœ¬ï¼Œé¡¹ç›®å¯è§ <a href="https://github.com/noiron/sudoku">noiron/sudoku</a>ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä¸­è®°å½•äº†æˆ‘çš„ç†è§£è€ŒéåŸæ–‡çš„ç¿»è¯‘ï¼Œå¦‚æœéœ€è¦æ›´è¯¦æƒ…çš„è§£é‡Šï¼Œå¯ä»¥æŸ¥çœ‹åŸæ–‡ã€‚</p><span id="more"></span><h2 id="æ•°æ®çš„è¡¨ç¤º"><a href="#æ•°æ®çš„è¡¨ç¤º" class="headerlink" title="æ•°æ®çš„è¡¨ç¤º"></a>æ•°æ®çš„è¡¨ç¤º</h2><p>é¦–å…ˆéœ€è¦è€ƒè™‘çš„æ˜¯å¦‚ä½•è¡¨ç¤ºæ•°æ®ï¼Œæ•°ç‹¬çš„è¡Œä½¿ç”¨ A-I çš„å­—æ¯è¡¨ç¤ºï¼Œåˆ—ä½¿ç”¨ 1-9 çš„æ•°å­—è¡¨ç¤ºã€‚ä»£ç ä¸­ç”¨åˆ°äº†ä»¥ä¸‹çš„æœ¯è¯­/å˜é‡ï¼š</p><ul><li><code>square</code> æ‰€æœ‰81ä¸ªæ ¼å­çš„æ ‡è®° <code>[&#39;A1&#39;, &#39;A2&#39;, &#39;A3&#39;, ... , &#39;I7&#39;, &#39;I8&#39;, &#39;I9&#39;]</code></li><li><code>unit</code> ä¸€ä¸ªæ ¼å­æ‰€åœ¨çš„è¡Œã€åˆ—æˆ–ä¹å®«æ ¼</li><li><code>unitList</code> åŒ…å«9è¡Œã€9åˆ—ã€9ä¸ªä¹å®«æ ¼ï¼Œå…±27ä¸ª unit</li><li><code>peers</code> æ ¼å­æ‰€åœ¨ä¸‰ä¸ª unit ä¸­çš„å…¶ä»–æ ¼å­ï¼Œå…±20ä¸ª</li><li><code>grid</code> ä½¿ç”¨æ–‡æœ¬æ ¼å¼æ¥è¡¨ç¤ºæ•°ç‹¬çš„åˆå§‹çŠ¶æ€ï¼Œ1~9 ä»£è¡¨æ•°å­—ï¼Œ0æˆ–.ä»£è¡¨æ­¤å¤„æœªå¡«å…¥</li><li><code>values</code> ä¸€ä¸ªä»¥ square ä¸º key çš„ mapï¼Œç»™å‡ºæ¯ä¸ªæ ¼å­çš„å¯èƒ½å€¼ï¼Œeg. <code>&#123;&#39;A1&#39;:&#39;12349&#39;, &#39;A2&#39;:&#39;8&#39;, ...&#125;</code></li></ul><p>å¯¹äºæ•°ç‹¬çš„åˆå§‹çŠ¶æ€ä½¿ç”¨æ–‡æœ¬æ ¼å¼æ¥è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„ä¸‰ç§æ ¼å¼ä»£è¡¨çš„æ˜¯åŒä¸€ä¸ªæ•°ç‹¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">4.....8.5.3..........7......2.....6.....8.4......1.......6.3.7.5..2.....1.4......</span><br><span class="line"></span><br><span class="line">400000805</span><br><span class="line">030000000</span><br><span class="line">000700000</span><br><span class="line">020000060</span><br><span class="line">000080400</span><br><span class="line">000010000</span><br><span class="line">000603070</span><br><span class="line">500200000</span><br><span class="line">104000000</span><br><span class="line"></span><br><span class="line">4 . . |. . . |8 . 5 </span><br><span class="line">. 3 . |. . . |. . . </span><br><span class="line">. . . |7 . . |. . . </span><br><span class="line">------+------+------</span><br><span class="line">. 2 . |. . . |. 6 . </span><br><span class="line">. . . |. 8 . |4 . . </span><br><span class="line">. . . |. 1 . |. . . </span><br><span class="line">------+------+------</span><br><span class="line">. . . |6 . 3 |. 7 . </span><br><span class="line">5 . . |2 . . |. . . </span><br><span class="line">1 . 4 |. . . |. . . </span><br></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†çš„ JS ä»£ç å®ç°å¯ä»¥çœ‹ä»£ç ï¼š<a href="https://github.com/noiron/sudoku/blob/master/base.js">data.js</a></p><p>å¼€å§‹æ—¶ï¼Œæ¯ä¸ªæ ¼å­éƒ½å¯ä»¥æ˜¯ 1~9 çš„ä»»ä½•æ•°å­—ï¼Œç„¶åä»åˆå§‹çŠ¶æ€å¼€å§‹ç»™æ¯ä¸ªæ ¼å­å¡«å…¥ç›¸åº”çš„æ•°å­—ã€‚è§£æ•°ç‹¬çš„è¿‡ç¨‹å°±æ˜¯åœ¨å‡å°‘æ¯ä¸ªæ ¼å­å¯ä»¥å¡«å…¥çš„æ•°å­—ï¼Œç›´åˆ°æ‰€æœ‰æ ¼å­éƒ½èƒ½ä¸”åªèƒ½å¡«å…¥1ä¸ªæ•°å­—ã€‚è¿™é‡Œéœ€è¦ç”¨åˆ°ä¸¤ç§æ–¹æ³•ï¼š<strong>çº¦æŸä¼ æ’­ï¼ˆConstraint Propagationï¼‰</strong>å’Œ<strong>æœç´¢ï¼ˆSearchï¼‰</strong>ã€‚</p><h2 id="çº¦æŸä¼ æ’­ï¼ˆConstraint-Propagationï¼‰"><a href="#çº¦æŸä¼ æ’­ï¼ˆConstraint-Propagationï¼‰" class="headerlink" title="çº¦æŸä¼ æ’­ï¼ˆConstraint Propagationï¼‰"></a>çº¦æŸä¼ æ’­ï¼ˆConstraint Propagationï¼‰</h2><p>åœ¨å¤„ç†æ•°ç‹¬çš„åˆå§‹çŠ¶æ€æ—¶ç”¨äº† <code>parseGrid()</code> å‡½æ•°ï¼Œå…¶ä¸­è°ƒç”¨äº† <code>assign(values, square, digit)</code> æ–¹æ³•ï¼Œå³å°† digit å¡«å…¥ squareã€‚</p><p>è§£æ•°ç‹¬æœ‰ä¸¤ä¸ªé‡è¦ç­–ç•¥ï¼š</p><ol><li>å¦‚æœä¸€ä¸ªæ ¼å­åªæœ‰å”¯ä¸€çš„å¯é€‰æ•°å­—ï¼Œåˆ™ä»å®ƒçš„ peers ä¸­åˆ é™¤è¿™ä¸ªæ•°å­—</li><li>å¦‚æœä¸€ä¸ª unit ä¸­åªæœ‰ä¸€ä¸ªæ ¼å­å¯ä»¥å¡«å…¥æŸä¸€ä¸ªæ•°å­—ï¼Œåˆ™å°†è¿™ä¸ªæ•°å­—å¡«å…¥è¿™ä¸ªæ ¼å­</li></ol><p>è¿™é‡Œéœ€è¦ä½¿ç”¨ <code>assign()</code> å’Œ <code>eliminate()</code> ä¸¤ä¸ªå‡½æ•°ï¼Œä»£ç è§ï¼š<a href="https://github.com/noiron/sudoku/blob/master/solve.js">solve.js</a></p><p>ç»è¿‡è¿™ä¸ªè¿‡ç¨‹åä¸€äº›ç®€å•çš„æ•°ç‹¬å°±å¯ä»¥å¾—å‡ºè§£äº†ï¼Œä½†å¯¹å¤æ‚çš„æ•°ç‹¬å¹¶éå¦‚æ­¤ã€‚æ‰€ä»¥éœ€è¦ä½¿ç”¨<strong>æœç´¢ï¼ˆSearchï¼‰</strong> æ¥è¿›ä¸€æ­¥å¤„ç†ã€‚</p><h2 id="æœç´¢ï¼ˆSearchï¼‰"><a href="#æœç´¢ï¼ˆSearchï¼‰" class="headerlink" title="æœç´¢ï¼ˆSearchï¼‰"></a>æœç´¢ï¼ˆSearchï¼‰</h2><p>è¿™é‡Œçš„æœç´¢æŒ‡çš„æ˜¯ç³»ç»Ÿåœ°å°è¯•æ‰€æœ‰çš„å¯èƒ½æ€§ï¼Œç›´åˆ°æ‰¾åˆ°è§£ã€‚å¯¹äºæ•°ç‹¬æ¥è¯´å°±æ˜¯å¯¹äºæ¯ä¸ªæœªç¡®å®šçš„æ ¼å­ï¼Œå°è¯•å¡«å…¥ä¸€ä¸ªå¯èƒ½çš„æ•°å­—ï¼Œç„¶åç»§ç»­æœç´¢ã€‚å¦‚æœå‡ºç°äº†çŸ›ç›¾ï¼Œå°±æ¢ä¸€ä¸ªæ•°å­—ã€‚è¿™æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œå³æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆdepth-first searchï¼‰ã€‚</p><p><code>search()</code> å‡½æ•°çš„å…·ä½“ä»£ç è§ï¼š<a href="https://github.com/noiron/sudoku/blob/master/solve.js">solve.js</a></p><h2 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h2><p>æ•´ä½“çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><pre class="mermaid" style="text-align: center;">            flowchart TB            %% init(åˆå§‹åŒ–)å¼€å§‹ --> gridValues("gridValues()\nå°†å­—ç¬¦ä¸²è¡¨ç¤ºè½¬æ¢ä¸ºmap");gridValues --> assign("assign()"\nç»™ç‰¹å®šæ ¼å­åˆ†é…ä¸€ä¸ªæ•°å­—);assign --> canAssign{åˆ†é…è¿‡ç¨‹\næ²¡æœ‰çŸ›ç›¾?};canAssign -- æ— æ³•åˆ†é… ----> æ— è§£canAssign-- å¯ä»¥åˆ†é… --> eliminate("eliminate()\nè¿›è¡Œçº¦æŸä¼ æ’­");eliminate --> onlyOne{å‘ç°æŸä¸ªæ ¼å­åªæœ‰\nå”¯ä¸€çš„å¯èƒ½æ€§}onlyOne -- æ˜¯çš„ --> assignonlyOne -- å¦ --> search("search()\nä¾æ¬¡å°è¯•å¯èƒ½çš„æ•°å­—\nDFSé€’å½’å¤„ç†");search --> found{æ¯ä¸ªæ ¼å­éƒ½èƒ½\nåˆ†é…å”¯ä¸€çš„æ•°å­—?}found -- ä¸è¡Œ --> æ— è§£ --> ç»“æŸfound -- å¯ä»¥ --> æ‰¾åˆ°ç­”æ¡ˆ --> ç»“æŸ          </pre><p>è‡³æ­¤å°±å®Œæˆäº†æ•°ç‹¬çš„è§£æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ•°ç‹¬æ¸¸æˆçš„è§„åˆ™å¾ˆç®€å•ï¼Œåœ¨9x9çš„çŸ©é˜µä¸­ï¼Œæ¯è¡Œã€æ¯åˆ—ã€æ¯ä¸ªä¹å®«æ ¼ä¸­éƒ½éœ€è¦å¡«å…¥1~9å…±ä¹ä¸ªæ•°å­—ï¼Œä¸”ä¸é‡å¤ã€‚&lt;/p&gt;
&lt;p&gt;Peter Norvig çš„è¿™ç¯‡æ–‡ç«  &lt;a href=&quot;https://norvig.com/sudoku.html&quot;&gt;Solving Every Sudoku Puzzle&lt;/a&gt; è¯¦ç»†ä»‹ç»äº†ä¸€ç§è§£æ•°ç‹¬çš„æ–¹æ³•ã€‚æ–‡ä¸­çš„ä»£ç åŸºäº Python2 å®ç°ï¼Œæˆ‘å°†å…¶æ”¹å†™æˆäº† JavaScript çš„ç‰ˆæœ¬ï¼Œé¡¹ç›®å¯è§ &lt;a href=&quot;https://github.com/noiron/sudoku&quot;&gt;noiron/sudoku&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸­è®°å½•äº†æˆ‘çš„ç†è§£è€ŒéåŸæ–‡çš„ç¿»è¯‘ï¼Œå¦‚æœéœ€è¦æ›´è¯¦æƒ…çš„è§£é‡Šï¼Œå¯ä»¥æŸ¥çœ‹åŸæ–‡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç®—æ³•" scheme="http://www.wukai.me/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="sudoku" scheme="http://www.wukai.me/tags/sudoku/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ª styled-components çš„é—®é¢˜ï¼ˆprops or css variablesï¼‰</title>
    <link href="http://www.wukai.me/2021/12/22/styled-components-props-or-css-variables/"/>
    <id>http://www.wukai.me/2021/12/22/styled-components-props-or-css-variables/</id>
    <published>2021-12-21T16:00:00.000Z</published>
    <updated>2022-02-16T13:57:16.005Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜çš„èµ·å› "><a href="#é—®é¢˜çš„èµ·å› " class="headerlink" title="é—®é¢˜çš„èµ·å› "></a>é—®é¢˜çš„èµ·å› </h2><p>æœ€è¿‘éœ€è¦å®ç°è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½ï¼Œé€šè¿‡æ‹–åŠ¨æ¥æ”¹å˜çª—å£å·¦ä¾§çš„æ–‡ä»¶åˆ—è¡¨æ çš„å®½åº¦ã€‚æˆ‘é€‰æ‹©äº†ç”¨ <code>styled-components</code> æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶å†™äº†å¦‚ä¸‹çš„æ ·å¼ç»„ä»¶ï¼Œå…¶ä¸­å°†è¾¹æ å½“å‰çš„å®½åº¦ <code>width</code> ä½œä¸ºå±æ€§ä¼ å…¥ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> StyledFileList = styled.div&lt;&#123; <span class="attr">width</span>: <span class="built_in">number</span> &#125;&gt;<span class="string">`</span></span><br><span class="line"><span class="string">  position: absolute;</span></span><br><span class="line"><span class="string">  top: 0;</span></span><br><span class="line"><span class="string">  left: 0;</span></span><br><span class="line"><span class="string">  width: <span class="subst">$&#123;props =&gt; props.width + <span class="string">&#x27;px&#x27;</span>&#125;</span>;</span></span><br><span class="line"><span class="string">  height: 100%;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å½“æˆ‘å¿«é€Ÿæ‹–åŠ¨è¾¹æ æ—¶ï¼Œ<code>width</code> å˜åŒ–å¾—éå¸¸é¢‘ç¹ï¼Œåœ¨æ§åˆ¶å°ä¸­å±•ç¤ºäº†å¦‚ä¸‹çš„ Warningã€‚</p><p><img src="/asset/images/2021-12-22-sc-console.png" alt="æ§åˆ¶å°warning"></p><span id="more"></span><p>å¤§æ„æ˜¯ä»…ä¸ºè¿™ä¸€ä¸ªç»„ä»¶å°±ç”Ÿæˆäº†è¶…è¿‡ 200 ä¸ª classã€‚åˆ©ç”¨å¼€å‘è€…å·¥å…·çš„æŸ¥æ‰¾å…ƒç´ ï¼Œæ”¹å˜ <code>width</code> æ—¶å¯ä»¥è§‚å¯Ÿåˆ°å…ƒç´ ä¸Šçš„ class åç§°ä¸€ç›´åœ¨å˜åŒ–ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">width</span>=<span class="string">&quot;270&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sc-bdvvtL ckAtiw&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">width</span>=<span class="string">&quot;271&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sc-bdvvtL bBcytR&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ç¡®å®š <code>styled-components</code> ç»™æ¯ä¸€ä¸ªä¸åŒçš„ <code>width</code> å±æ€§éƒ½ç”Ÿæˆäº†ä¸€ä¸ª classã€‚å¦‚æœåœ¨ html ä¸­æœç´¢ç›¸åº”çš„ class åç§°ï¼ˆå¦‚ä¸Šé¢çš„ä»£ç ä¸­æ˜¯ <code>ckAtiw</code> å’Œ <code>bBcytR</code>ï¼‰ï¼Œå¯ä»¥åœ¨ <code>&lt;head&gt;</code> çš„ <code>&lt;style&gt;</code> æ ‡ç­¾ä¸­æ‰¾åˆ°å®ƒä»¬å¯¹åº”çš„æ ·å¼å†…å®¹ï¼Œç¨åŠ æ¯”è¾ƒå°±å¯ä»¥å‘ç°é™¤äº† <code>width</code> ä»¥å¤–çš„éƒ¨åˆ†éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><p><code>styled-components</code>å¤„ç†æ ·å¼çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šå±æ€§æ”¹å˜ -&gt; é‡æ–°ç”Ÿæˆæ ·å¼ -&gt; æ’å…¥åˆ° <code>&lt;head&gt;</code> ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å¦‚æœé‡å¤å¾ˆå¤šæ¬¡ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„ CSS å†…å®¹å†—ä½™ï¼Œå¾ˆæœ‰å¯èƒ½é€ æˆæ€§èƒ½é—®é¢˜ã€‚è€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ CSS å˜é‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="ä½¿ç”¨-CSS-å˜é‡"><a href="#ä½¿ç”¨-CSS-å˜é‡" class="headerlink" title="ä½¿ç”¨ CSS å˜é‡"></a>ä½¿ç”¨ CSS å˜é‡</h2><p>æˆ‘æ˜¯åœ¨è¿™ç¯‡æ–‡ç«  <a href="https://www.joshwcomeau.com/css/styled-components/#css-variables"><em>The styled-components Happy Path</em></a> ä¸­å­¦åˆ°äº†åœ¨ <code>styled-components</code> ä¸­ä½¿ç”¨ CSS å˜é‡ï¼ˆCSS variableï¼‰çš„æŠ€å·§ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-CSS-å˜é‡"><a href="#ä»€ä¹ˆæ˜¯-CSS-å˜é‡" class="headerlink" title="ä»€ä¹ˆæ˜¯ CSS å˜é‡"></a>ä»€ä¹ˆæ˜¯ CSS å˜é‡</h3><p>CSS å˜é‡æ˜¯ä»¥ <code>--</code> å¼€å¤´çš„å±æ€§åç§°ï¼Œå®ƒä»¬çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å€¼ï¼Œä½¿ç”¨ <code>var(--your-variable-name)</code> æ¥åº”ç”¨æ ·å¼ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--your-awesome-<span class="attribute">color</span>: darkcyan;</span><br><span class="line"><span class="attribute">color</span>: <span class="built_in">var</span>(--your-awesome-color);</span><br><span class="line"></span><br><span class="line">--this-<span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line"><span class="attribute">padding-left</span>: <span class="built_in">var</span>(--this-padding);</span><br></pre></td></tr></table></figure><p style="  --your-awesome-color: darkcyan;  color: var(--your-awesome-color);  --this-padding: 20px;  padding-left: var(--this-padding);"><br>  è¿™ä¸€è¡Œæ–‡å­—å°±æ˜¯åº”ç”¨äº†ä¸Šé¢çš„ CSSï¼Œä½ å¯ä»¥åœ¨æ§åˆ¶å°ä¸­ä¿®æ”¹æ ·å¼å¹¶è§‚å¯Ÿå˜åŒ–ã€‚<br></p><h3 id="æ”¹å†™åŸä»£ç "><a href="#æ”¹å†™åŸä»£ç " class="headerlink" title="æ”¹å†™åŸä»£ç "></a>æ”¹å†™åŸä»£ç </h3><p>å¯¹äºä¹‹å‰çš„è¾¹æ ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸€ä¸ªå†™æ³•æ¥è§£å†³ï¼Œä¸å†ä½¿ç”¨ <code>props</code> æ¥ä¼ å…¥å®½åº¦ï¼Œè€Œæ˜¯ä½¿ç”¨ CSS å˜é‡ï¼Œç»„ä»¶ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;StyledFileList</span><br><span class="line">  <span class="comment">// è¿™é‡Œå®šä¹‰äº† --width è¿™ä¸ª CSS å˜é‡ï¼Œwidth æ˜¯ä¸€ä¸ª number</span></span><br><span class="line">  style=&#123;&#123; <span class="string">&#x27;--width&#x27;</span>: width + <span class="string">&#x27;px&#x27;</span>&#125; <span class="keyword">as</span> CSSProperties&#125;</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> StyledFileList = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  position: absolute;</span></span><br><span class="line"><span class="string">  top: 0;</span></span><br><span class="line"><span class="string">  left: 0;</span></span><br><span class="line"><span class="string">  // è¿™é‡Œåº”ç”¨äº† CSS å˜é‡</span></span><br><span class="line"><span class="string">  width: var(--width);</span></span><br><span class="line"><span class="string">  height: 100%;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å†æ”¹å˜å·¦ä¾§è¾¹æ çš„å®½åº¦ï¼Œå¯å‘ç°å…ƒç´ çš„ class åç§°æ˜¯å›ºå®šçš„ï¼Œåªæœ‰ style åœ¨å˜åŒ–ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sc-bdvvtL jGeOyv&quot;</span> <span class="attr">style</span>=<span class="string">&quot;--width:210px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sc-bdvvtL jGeOyv&quot;</span> <span class="attr">style</span>=<span class="string">&quot;--width:250px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/asset/images/2021-12-22-sc-style.png" alt="CSSå˜é‡æ ·å¼"></p><p>å¦‚æœæ£€æŸ¥ <code>&lt;head&gt;</code> ä¸­çš„å†…å®¹ï¼Œä¼šçœ‹åˆ°åœ¨ <code>&lt;style&gt;</code> æ ‡ç­¾ä¸­ç›¸åº”çš„æ ·å¼å†…å®¹ä¹Ÿåªå‡ºç°äº†ä¸€æ¬¡ï¼Œä»è€Œè§£å†³äº†æ ·å¼å†—ä½™çš„é—®é¢˜ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote><p><a href="https://www.joshwcomeau.com/css/styled-components/#css-variables">The styled-components Happy Path</a><br><a href="https://www.joshwcomeau.com/react/demystifying-styled-components/">Demystifying styled-components</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é—®é¢˜çš„èµ·å› &quot;&gt;&lt;a href=&quot;#é—®é¢˜çš„èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜çš„èµ·å› &quot;&gt;&lt;/a&gt;é—®é¢˜çš„èµ·å› &lt;/h2&gt;&lt;p&gt;æœ€è¿‘éœ€è¦å®ç°è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½ï¼Œé€šè¿‡æ‹–åŠ¨æ¥æ”¹å˜çª—å£å·¦ä¾§çš„æ–‡ä»¶åˆ—è¡¨æ çš„å®½åº¦ã€‚æˆ‘é€‰æ‹©äº†ç”¨ &lt;code&gt;styled-components&lt;/code&gt; æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶å†™äº†å¦‚ä¸‹çš„æ ·å¼ç»„ä»¶ï¼Œå…¶ä¸­å°†è¾¹æ å½“å‰çš„å®½åº¦ &lt;code&gt;width&lt;/code&gt; ä½œä¸ºå±æ€§ä¼ å…¥ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight typescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; StyledFileList = styled.div&amp;lt;&amp;#123; &lt;span class=&quot;attr&quot;&gt;width&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;number&lt;/span&gt; &amp;#125;&amp;gt;&lt;span class=&quot;string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  position: absolute;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  top: 0;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  left: 0;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  width: &lt;span class=&quot;subst&quot;&gt;$&amp;#123;props =&amp;gt; props.width + &lt;span class=&quot;string&quot;&gt;&amp;#x27;px&amp;#x27;&lt;/span&gt;&amp;#125;&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;  height: 100%;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;`&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½†æ˜¯å½“æˆ‘å¿«é€Ÿæ‹–åŠ¨è¾¹æ æ—¶ï¼Œ&lt;code&gt;width&lt;/code&gt; å˜åŒ–å¾—éå¸¸é¢‘ç¹ï¼Œåœ¨æ§åˆ¶å°ä¸­å±•ç¤ºäº†å¦‚ä¸‹çš„ Warningã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/asset/images/2021-12-22-sc-console.png&quot; alt=&quot;æ§åˆ¶å°warning&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="css" scheme="http://www.wukai.me/tags/css/"/>
    
      <category term="styled-components" scheme="http://www.wukai.me/tags/styled-components/"/>
    
      <category term="react" scheme="http://www.wukai.me/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>Puppeteer çš„ä½¿ç”¨è®°å½•</title>
    <link href="http://www.wukai.me/2021/05/22/puppeteer-notes/"/>
    <id>http://www.wukai.me/2021/05/22/puppeteer-notes/</id>
    <published>2021-05-21T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.547Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Headless Browser</strong> æŒ‡çš„æ˜¯æ²¡æœ‰å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰è€Œæ˜¯ç”±ç¨‹åºæ§åˆ¶çš„æµè§ˆå™¨ã€‚<strong>Puppeteer</strong> å°±æ˜¯ç”± Google æ¨å‡ºçš„ä¸€ç§ headless browserã€‚ä» <a href="https://github.com/puppeteer/puppeteer">Puppeteer çš„å®˜æ–¹æ–‡æ¡£</a>ä¸­å¯ä»¥çœ‹åˆ°å®ƒèƒ½åšçš„äº‹æœ‰å¾ˆå¤šï¼š</p><blockquote><ul><li>Generate screenshots and PDFs of pages.</li><li>Crawl a SPA (Single-Page Application) and generate pre-rendered content (i.e. â€œSSRâ€ (Server-Side Rendering)).</li><li>Automate form submission, UI testing, keyboard input, etc.<br>â€¦</li></ul></blockquote><p>å‡ ä¹æ‰€æœ‰èƒ½æ‰‹åŠ¨åœ¨ Chrome è¿›è¡Œçš„æ“ä½œç°åœ¨éƒ½å¯ä»¥ç”¨ Puppeteer æ¥å®Œæˆã€‚</p><p>æˆ‘ä¹‹å‰åœ¨å·¥ä½œä¸­å°±ç”¨åˆ°äº† Puppeteer åšäº†ä¸€äº›é¡µé¢çˆ¬å–çš„å·¥ä½œï¼Œè¿™é‡ŒæŠŠä½¿ç”¨åˆ°æˆ–è€…ç©è¿‡çš„ä¸€äº›åŠŸèƒ½åšäº†ä¸‹æ€»ç»“å’Œè®°å½•ã€‚è¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸€ä¸ªå…¨é¢çš„ Puppeteer çš„ä½¿ç”¨æ•™ç¨‹ï¼Œæ¯•ç«Ÿ Puppeteer çš„å¤§éƒ¨åˆ† API æˆ‘ä¹Ÿæ²¡æœ‰ä½¿ç”¨è¿‡ğŸ™‚ã€‚</p><span id="more"></span><h2 id="Puppeteer-çš„å®‰è£…"><a href="#Puppeteer-çš„å®‰è£…" class="headerlink" title="Puppeteer çš„å®‰è£…"></a>Puppeteer çš„å®‰è£…</h2><p>Puppeteer çš„ä½¿ç”¨å°±æ˜¯å¦‚åŒä¸€ä¸ªæ™®é€šçš„ npm package ä¸€æ ·ï¼Œä½¿ç”¨ <code>npm init</code> æ–°å»ºä¸€ä¸ªé¡¹ç›®åï¼Œä½¿ç”¨ <code>npm install puppeteer</code> å³å¯ã€‚å¦‚æœå®‰è£…è¿‡ç¨‹ä¸­å¡åœ¨äº†ä¸‹è½½ Chromium çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>puppeteer-core</code> æ¥ä»£æ›¿ï¼Œå…·ä½“å¯è§</p><p><a href="https://github.com/puppeteer/puppeteer/blob/main/docs/api.md#puppeteer-vs-puppeteer-core">puppeteer-vs-puppeteer-core</a></p><h2 id="æ‰“å¼€é¡µé¢"><a href="#æ‰“å¼€é¡µé¢" class="headerlink" title="æ‰“å¼€é¡µé¢"></a>æ‰“å¼€é¡µé¢</h2><p>å…ˆç”±æœ€åŸºç¡€çš„æ‰“å¼€é¡µé¢åŠŸèƒ½å¼€å§‹ï¼Œæ–°å»ºä¸€ä¸ª <code>index.js</code> æ–‡ä»¶ï¼Œå†™å…¥ä¸‹æ–¹çš„ä»£ç ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pageUrl = <span class="string">&#x27;https://github.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(pageUrl, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.close();</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¿è¡Œ <code>node index.js</code>ï¼Œå¦‚æœæˆåŠŸè¿è¡Œï¼Œä½ å°†ä¼šçœ‹åˆ°ä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”ŸğŸ˜•ã€‚è¿™æ˜¯å› ä¸ºï¼ŒPuppeteer é»˜è®¤æ˜¯åœ¨ <code>headless</code> æ¨¡å¼ä¸‹è¿è¡Œçš„ï¼Œä¸ºäº†èƒ½çœ‹åˆ°ç¡®å®æ‰“å¼€äº†é¡µé¢ï¼Œå¯ä»¥åœ¨æ‰“å¼€æµè§ˆå™¨æ—¶åŠ å…¥å‚æ•° <code>&#123; headless: false &#125;</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pageUrl = <span class="string">&#x27;https://github.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œå°† headless è®¾ç½®äº†ä¸º falseï¼Œè¡¨ç¤ºæ‰“å¼€å›¾å½¢ç•Œé¢</span></span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(pageUrl, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.close();</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå…¸å‹çš„æµç¨‹å¦‚ä¸‹ï¼šæ‰“å¼€æµè§ˆå™¨ -&gt; æ‰“å¼€æ–°é¡µé¢ -&gt; å»å¾€æŒ‡å®šé¡µé¢ -&gt; å…³é—­é¡µé¢ï¼ˆå¯çœç•¥ï¼‰ -&gt; å…³é—­æµè§ˆå™¨ã€‚</p><h3 id="Timeout-é—®é¢˜çš„è§£å†³"><a href="#Timeout-é—®é¢˜çš„è§£å†³" class="headerlink" title="Timeout é—®é¢˜çš„è§£å†³"></a>Timeout é—®é¢˜çš„è§£å†³</h3><p>è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œå¯èƒ½ä¼šå‡ºç° <code>TimeoutError</code> çš„å‡ºé”™æç¤ºï¼Œè¿™æ˜¯å› ä¸ºè®¿é—®æŒ‡å®šé¡µé¢çš„é€Ÿåº¦è¾ƒæ…¢å¯¼è‡´äº†è¶…æ—¶ã€‚ä½ å¯ä»¥å°† <code>pageUrl</code> æ¢æˆä»»æ„å›½å†…åœ°å€é‡è¯•ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ Puppeteer çš„è¶…æ—¶æ—¶é—´ä¸º 30sï¼Œå¦‚æœåœ¨ 30s ä¹‹å†…æ²¡èƒ½æ‰“å¼€é¡µé¢ï¼Œä¼šæœ‰ timeout çš„å‡ºé”™æç¤ºã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnhandledPromiseRejectionWarning: TimeoutError: Navigation timeout of 30000 ms exceeded</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥é€šè¿‡å¦‚ä¸‹è®¾ç½®è§£å†³ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line"><span class="comment">// å°†è¶…æ—¶æ—¶é—´æ”¹ä¸ºäº† 60sï¼Œå¦‚æœå‚æ•°ä¸º0ï¼Œåˆ™ä»£è¡¨ä¸åšé™åˆ¶</span></span><br><span class="line">page.setDefaultNavigationTimeout(<span class="number">60000</span>);</span><br><span class="line"><span class="keyword">await</span> page.goto(pageUrl, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure><h2 id="æ“ä½œé¡µé¢"><a href="#æ“ä½œé¡µé¢" class="headerlink" title="æ“ä½œé¡µé¢"></a>æ“ä½œé¡µé¢</h2><h3 id="æˆªå›¾"><a href="#æˆªå›¾" class="headerlink" title="æˆªå›¾"></a>æˆªå›¾</h3><p>Puppeteer æä¾›äº† <code>screenshot</code> APIï¼Œå¯ä»¥å°†é¡µé¢æˆªå›¾ä¿å­˜ä¸‹æ¥ã€‚è¿è¡Œä¸‹é¢çš„ä»£ç å°†ä¼šåœ¨ js æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ä¸‹ä¿å­˜ä¸€å¼ åä¸º <code>screenshot.png</code> çš„å›¾ç‰‡æ–‡ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåœ¨ä¹‹å‰çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰è®¾ç½®çª—å£çš„å¤§å°ï¼ŒPuppeteer é»˜è®¤æ‰“å¼€çš„æ˜¯ <code>800*600</code>å°ºå¯¸çš„çª—å£ï¼Œæˆªå›¾çš„å¤§å°ä¹Ÿä¸º <code>800*600</code>ï¼ˆå³ä½¿æ˜¯åœ¨ <code>headless</code> æ¨¡å¼ä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚å¯ä»¥é€šè¿‡ <code>setViewport</code> æ¥æ”¹å˜çª—å£çš„å¤§å°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pageUrl = <span class="string">&#x27;https://github.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(pageUrl, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;);</span><br><span class="line">  <span class="comment">// è®¾ç½®çª—å£çš„å¤§å°ï¼Œå¯ä»¥æ³¨é‡Šä¸‹æ–¹çš„ä¸€è¡ŒæŸ¥çœ‹æˆªå›¾çš„åŒºåˆ«</span></span><br><span class="line">  <span class="keyword">await</span> page.setViewport(&#123; <span class="attr">width</span>: <span class="number">1000</span>, <span class="attr">height</span>: <span class="number">500</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.screenshot(&#123;</span><br><span class="line">    <span class="attr">path</span>: path.join(__dirname, <span class="string">&#x27;screenshot.png&#x27;</span>),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.close();</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆ-PDF"><a href="#ç”Ÿæˆ-PDF" class="headerlink" title="ç”Ÿæˆ PDF"></a>ç”Ÿæˆ PDF</h3><p>åŒæ ·ä¹Ÿå¯ä»¥å°†é¡µé¢ä¿å­˜æˆä¸€ä¸ª PDF æ–‡ä»¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pageUrl = <span class="string">&#x27;https://github.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.goto(pageUrl, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.pdf(&#123; </span><br><span class="line">    <span class="attr">path</span>: path.join(__dirname, <span class="string">&#x27;page-pdf.pdf&#x27;</span>), </span><br><span class="line">    <span class="attr">format</span>: <span class="string">&#x27;A4&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.close();</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸€ç‚¹ï¼Œä¿å­˜ä¸º PDF çš„æ—¶å€™ï¼Œå¿…é¡»åœ¨ <code>headless</code> æ¨¡å¼ä¸‹è¿›è¡Œã€‚</p><h2 id="æ¨¡æ‹Ÿè®¾å¤‡"><a href="#æ¨¡æ‹Ÿè®¾å¤‡" class="headerlink" title="æ¨¡æ‹Ÿè®¾å¤‡"></a>æ¨¡æ‹Ÿè®¾å¤‡</h2><p>å¹³æ—¶æˆ‘ä»¬æµè§ˆçš„ç½‘ç«™å¯èƒ½é’ˆå¯¹ä¸åŒçš„è®¾å¤‡ä¼šæœ‰ä¸åŒçš„å±•ç¤ºæ•ˆæœï¼ŒåŒºåˆ†ç§»åŠ¨ç«¯å’ŒPCç«¯ã€Android æˆ– iOS ç­‰ã€‚Puppeteer å°±æä¾›äº†æ¨¡æ‹Ÿè®¾å¤‡çš„åŠŸèƒ½ã€‚</p><h3 id="ä½¿ç”¨å·²æœ‰çš„è®¾å¤‡åˆ—è¡¨"><a href="#ä½¿ç”¨å·²æœ‰çš„è®¾å¤‡åˆ—è¡¨" class="headerlink" title="ä½¿ç”¨å·²æœ‰çš„è®¾å¤‡åˆ—è¡¨"></a>ä½¿ç”¨å·²æœ‰çš„è®¾å¤‡åˆ—è¡¨</h3><p>å¯ä»¥ä½¿ç”¨ <code>page.emulate(options)</code> æ¥æ¨¡æ‹Ÿè®¾å¤‡ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­çœ‹åˆ°æ”¯æŒçš„è®¾å¤‡åˆ—è¡¨ï¼š<a href="https://github.com/puppeteer/puppeteer/blob/main/src/common/DeviceDescriptors.ts">puppeteer/DeviceDescriptors.ts at main Â· puppeteer/puppeteer Â· GitHub</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pageUrl = <span class="string">&#x27;https://github.com&#x27;</span>;</span><br><span class="line"><span class="comment">// è¿™é‡Œå°†æ¨¡æ‹Ÿä¸€å° iPhone XR è®¾å¤‡</span></span><br><span class="line"><span class="keyword">const</span> iPhone = puppeteer.devices[<span class="string">&#x27;iPhone XR&#x27;</span>];</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.emulate(iPhone);</span><br><span class="line">  <span class="keyword">await</span> page.goto(pageUrl, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ è‡ªå®šä¹‰çš„-UserAgent"><a href="#æ·»åŠ è‡ªå®šä¹‰çš„-UserAgent" class="headerlink" title="æ·»åŠ è‡ªå®šä¹‰çš„ UserAgent"></a>æ·»åŠ è‡ªå®šä¹‰çš„ UserAgent</h3><p>ä¹Ÿå¯ä»¥æ·»åŠ è‡ªå·±çš„ UserAgent çš„æ–¹å¼æ¥æ¨¡æ‹Ÿåˆ—è¡¨ä¸­æ²¡æœ‰çš„è®¾å¤‡ã€‚ä¸‹é¢çš„ä»£ç ä¸­ä»¥ iPad Pro ä¸ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•è®¾ç½® UserAgentï¼ˆå…¶å® iPad Pro æ˜¯å­˜åœ¨äºä¸Šé¢çš„è®¾å¤‡åˆ—è¡¨ä¸­çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸¾äº†ä¸ªä¾‹å­ï¼‰ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pageUrl = <span class="string">&#x27;https://github.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  <span class="keyword">await</span> page.setViewport(&#123; <span class="attr">width</span>: <span class="number">1024</span>, <span class="attr">height</span>: <span class="number">1366</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.setUserAgent(</span><br><span class="line">    <span class="string">&#x27;Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line">  <span class="keyword">await</span> page.goto(pageUrl, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h2 id="ç›‘å¬-response"><a href="#ç›‘å¬-response" class="headerlink" title="ç›‘å¬ response"></a>ç›‘å¬ response</h2><p>è€ƒè™‘ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼Œå¦‚ä½•è·å–åˆ°é¡µé¢ä¸Šçš„æ‰€æœ‰çš„å›¾ç‰‡ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°æ•´ä¸ªé¡µé¢ï¼Œç„¶åä½¿ç”¨ <code>document.querySelector()</code> ç­›é€‰å‡ºæ‰€æœ‰çš„ <code>img</code> æ ‡ç­¾ã€‚è¿™æ ·ä¼šæœ‰ä¸€ç‚¹å°é—®é¢˜ï¼Œå¦‚æœå›¾ç‰‡æ˜¯ä»¥ CSS  çš„ <code>background-image</code> å½¢å¼å¼•å…¥çš„ï¼ŒæŸ¥æ‰¾ <code>img</code> æ ‡ç­¾æ˜¯æ— æ³•æ‰¾åˆ°çš„ã€‚å¦‚æœå›¾ç‰‡åœ°å€æ˜¯ç”± js åŠ¨æ€æ”¹å˜çš„ï¼Œå¯èƒ½ä¹Ÿä¼šç¼ºå¤±éƒ¨åˆ†å›¾ç‰‡ã€‚</p><p>å¦ä¸€ç§å¯é€‰çš„æ–¹å¼æ˜¯é€šè¿‡ç›‘å¬ <code>response</code> çš„æ–¹å¼æ¥å¤„ç†ã€‚å¯ä»¥è®¤ä¸ºåœ¨ Chrome å¼€å‘å·¥å…·çš„ Network Tab ä¸‹èƒ½çœ‹åˆ°çš„æ¯ä¸€ä¸ª response éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‹¿åˆ°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> pageUrl = <span class="string">&#x27;https://github.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123; <span class="attr">headless</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line"></span><br><span class="line">  page.on(<span class="string">&#x27;response&#x27;</span>, <span class="keyword">async</span> (response) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> request = response.request();</span><br><span class="line">    <span class="keyword">const</span> resourceType = request.resourceType();</span><br><span class="line">    <span class="keyword">const</span> contentType = response.headers()[<span class="string">&#x27;content-type&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (resourceType === <span class="string">&#x27;image&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> url = response.url();</span><br><span class="line">      <span class="built_in">console</span>.log(contentType, url);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> page.goto(pageUrl, &#123; <span class="attr">waitUntil</span>: <span class="string">&#x27;networkidle0&#x27;</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.close();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>response.headers</code> å¯ä»¥è·å–å“åº”çš„ header ä¿¡æ¯ã€‚å¦‚æœæœ‰éœ€è¦ä¹Ÿå¯å°†å“åº”ä¿å­˜æˆæœ¬åœ°çš„æ–‡ä»¶ã€‚</p><hr><p>æœªå®Œå¾…ç»­</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;Headless Browser&lt;/strong&gt; æŒ‡çš„æ˜¯æ²¡æœ‰å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰è€Œæ˜¯ç”±ç¨‹åºæ§åˆ¶çš„æµè§ˆå™¨ã€‚&lt;strong&gt;Puppeteer&lt;/strong&gt; å°±æ˜¯ç”± Google æ¨å‡ºçš„ä¸€ç§ headless browserã€‚ä» &lt;a href=&quot;https://github.com/puppeteer/puppeteer&quot;&gt;Puppeteer çš„å®˜æ–¹æ–‡æ¡£&lt;/a&gt;ä¸­å¯ä»¥çœ‹åˆ°å®ƒèƒ½åšçš„äº‹æœ‰å¾ˆå¤šï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Generate screenshots and PDFs of pages.&lt;/li&gt;
&lt;li&gt;Crawl a SPA (Single-Page Application) and generate pre-rendered content (i.e. â€œSSRâ€ (Server-Side Rendering)).&lt;/li&gt;
&lt;li&gt;Automate form submission, UI testing, keyboard input, etc.&lt;br&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‡ ä¹æ‰€æœ‰èƒ½æ‰‹åŠ¨åœ¨ Chrome è¿›è¡Œçš„æ“ä½œç°åœ¨éƒ½å¯ä»¥ç”¨ Puppeteer æ¥å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä¹‹å‰åœ¨å·¥ä½œä¸­å°±ç”¨åˆ°äº† Puppeteer åšäº†ä¸€äº›é¡µé¢çˆ¬å–çš„å·¥ä½œï¼Œè¿™é‡ŒæŠŠä½¿ç”¨åˆ°æˆ–è€…ç©è¿‡çš„ä¸€äº›åŠŸèƒ½åšäº†ä¸‹æ€»ç»“å’Œè®°å½•ã€‚è¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸€ä¸ªå…¨é¢çš„ Puppeteer çš„ä½¿ç”¨æ•™ç¨‹ï¼Œæ¯•ç«Ÿ Puppeteer çš„å¤§éƒ¨åˆ† API æˆ‘ä¹Ÿæ²¡æœ‰ä½¿ç”¨è¿‡ğŸ™‚ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="çˆ¬è™«" scheme="http://www.wukai.me/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="node.js" scheme="http://www.wukai.me/tags/node-js/"/>
    
      <category term="puppeteer" scheme="http://www.wukai.me/tags/puppeteer/"/>
    
  </entry>
  
  <entry>
    <title>2019å¹´æ€»ç»“</title>
    <link href="http://www.wukai.me/2020/01/24/2019-annual-summary/"/>
    <id>http://www.wukai.me/2020/01/24/2019-annual-summary/</id>
    <published>2020-01-23T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.546Z</updated>
    
    <content type="html"><![CDATA[<p>å¾ˆå¤šå¹´å‰åœ¨å­¦æ ¡çš„æ—¶å€™ï¼Œä¸­äºŒæœŸçš„æˆ‘å’Œæœ‹å‹è®¨è®ºè¿‡å¦‚æœç©¿è¶Šåˆ°å¤ä»£æƒ³å»å“ªä¸ªæœä»£ã€‚æˆ‘è¯´å»ä¸‰å›½å§ï¼Œå’Œåˆ˜å…³å¼ ç»“ä¹‰ï¼Œä¸€ç»Ÿå¤©ä¸‹ï¼Œå²‚ä¸ç¾å“‰ã€‚æœ‹å‹æŒ‡å‡ºï¼Œè¿™ä¸‰äººéƒ½æ¯”ä½ å¹´çºªå¤§ï¼Œä½ å»äº†åªèƒ½åšå°å¼Ÿã€‚é¢ï¼Œè¿™ç‚¹å€’æ²¡æƒ³åˆ°ï¼Œäºæ˜¯ç©¿è¶Šè®¡åˆ’æ— ç–¾è€Œç»ˆã€‚å»å¹´åˆç¿»äº†ä¸‹ã€Šä¸‰å›½æ¼”ä¹‰ã€‹ï¼Œåœ¨ç¬¬ä¸€ç« æ¡ƒå›­ä¸‰ç»“ä¹‰ä¸­çœ‹åˆ°äº†è¿™å¥â€œåŠåˆ˜ç„‰å‘æ¦œæ‹›å†›æ—¶ï¼Œç„å¾·å¹´å·²äºŒåå…«å²çŸ£â€ï¼Œå“¦ï¼Œçœ‹æ¥æˆ‘å†ä¹Ÿä¸ç”¨æ‹…å¿ƒç©¿è¶Šåˆ°ä¸‰å›½æ—¶æœŸçš„å¹´é¾„é—®é¢˜äº†ã€‚åˆ˜å¤‡äºŒåå…«å²æ—¶å°±å·²ç»å¼€å§‹åŒ¡æ‰¶æ±‰å®¤äº†ï¼Œè€Œæˆ‘äºŒåå…«å²æ—¶è¿˜åœ¨å†™ä»£ç  â•®(â•¯_â•°)â•­ã€‚</p><span id="more"></span><h2 id="çœ‹è¿‡çš„ä¹¦"><a href="#çœ‹è¿‡çš„ä¹¦" class="headerlink" title="çœ‹è¿‡çš„ä¹¦"></a>çœ‹è¿‡çš„ä¹¦</h2><p>19å¹´ä»ç„¶çœ‹äº†å¤§çº¦äºŒåæœ¬çš„æ–°ä¹¦ï¼Œæ•°é‡ä¸Šå’Œä»¥å‰å·®ä¸å¤šã€‚</p><p>å°è¯´ç±»ï¼š</p><ul><li>Flowers for Algernon</li><li>é‘é¼äººæ²™æ¼ </li><li>ä¸Šå¸çš„å›¾ä¹¦é¦†</li><li>æ—¥æœ¬åˆä¼—å›½</li><li>äº†ä¸èµ·çš„ç›–èŒ¨æ¯”</li><li>æŒªå¨çš„æ£®æ—</li><li>ç¯ç•Œï¼ˆ1-4)</li></ul><p>éè™šæ„ç±»ï¼š</p><ul><li>ç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“</li><li>é»‘å®¢ä¸ç”»å®¶</li><li>å½±å“åŠ›</li><li>æœªæ¥ç®€å²</li><li>ç»åº¦ </li><li>é˜…è¯»æ˜¯ä¸€åº§éšèº«æºå¸¦çš„é¿éš¾æ‰€</li><li>é‚£äº›ç§‘å­¦å®¶ä»¬å½»å¤œå¿§è™‘çš„é—®é¢˜</li><li>é‡å­ç‰©ç†å²è¯</li><li>æ€ªè¯è¡Œä¸ºå­¦1ï¼šå¯é¢„æµ‹çš„éç†æ€§</li></ul><h2 id="ç©è¿‡çš„æ¸¸æˆ"><a href="#ç©è¿‡çš„æ¸¸æˆ" class="headerlink" title="ç©è¿‡çš„æ¸¸æˆ"></a>ç©è¿‡çš„æ¸¸æˆ</h2><p>19å¹´åˆä¹°äº†ä»»å¤©å ‚çš„ Switchï¼Œäºæ˜¯ä» Steam é‚£é‡Œçœä¸‹çš„é‡‘é’±å’Œæ—¶é—´åˆèŠ±åœ¨äº† Switch çš„æ¸¸æˆä¸Šã€‚ä¸‹é¢æ¯ä¸ªæ¸¸æˆéƒ½èŠ±äº†åå‡ å°æ—¶åˆ°ä¸Šç™¾å°æ—¶ä¸ç­‰ã€‚</p><ul><li>å¡å°”è¾¾ä¼ è¯´</li><li>ç¥ç•Œï¼šåŸç½ª2</li><li>æš—é»‘ç ´åç¥3</li><li>Guns Gore and Cannoli 2</li><li>Dead Cells</li><li>Bastion</li><li>â€¦</li></ul><h2 id="æ–°æŠ€èƒ½"><a href="#æ–°æŠ€èƒ½" class="headerlink" title="æ–°æŠ€èƒ½"></a>æ–°æŠ€èƒ½</h2><p>ä¸‹åŠå¹´ä¹°äº†ã€Šä¸‰åå¤©å­¦ä¼šç»˜ç”»ã€‹ï¼Œæ²¡èƒ½åƒä¹¦åé‡Œå†™çš„é‚£æ ·åœ¨ä¸‰åå¤©é‡Œçœ‹å®Œï¼Œç”¨äº†å¤§çº¦åŠå¹´ç»ˆäºåœ¨12æœˆçœ‹å®Œäº†è¿™æœ¬ä¹¦ã€‚æŒ‰ç…§ä¹¦é‡Œçš„æ•™ç¨‹ç”»äº†ä¸€éä¹‹åï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿˜æ²¡æœ‰å­¦ä¼šç»˜ç”»ã€‚äºæ˜¯åˆä¹°äº†æœ¬ã€Šç´ æçš„è¯€çªã€‹ï¼Œå‡†å¤‡åœ¨2020å¹´ç»§ç»­ç”»ä¸‹å»ã€‚</p><hr><p>è™½ç„¶æˆ‘çŸ¥é“è‡ªå·±å®šäº†æ–°å¹´è®¡åˆ’ï¼Œä¹Ÿæ˜¯ä¸ä¼šå»å®Œæˆçš„ã€‚ä½†å¸Œæœ›è‡ªå·±åœ¨2020å¹´å¤šçœ‹ç‚¹è®¡ç®—æœºç±»çš„ä¹¦ç±ï¼Œå¤šå†™ç‚¹åšå®¢åšç‚¹è®°å½•ã€‚2019å¹´çš„å¹´åº¦æ€»ç»“æ²¡èµ¶ä¸Šå…ƒæ—¦å®Œæˆï¼Œä»Šå¤©å°±ç¥æ‰€æœ‰äººæ˜¥èŠ‚å¹³å®‰å¿«ä¹å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¾ˆå¤šå¹´å‰åœ¨å­¦æ ¡çš„æ—¶å€™ï¼Œä¸­äºŒæœŸçš„æˆ‘å’Œæœ‹å‹è®¨è®ºè¿‡å¦‚æœç©¿è¶Šåˆ°å¤ä»£æƒ³å»å“ªä¸ªæœä»£ã€‚æˆ‘è¯´å»ä¸‰å›½å§ï¼Œå’Œåˆ˜å…³å¼ ç»“ä¹‰ï¼Œä¸€ç»Ÿå¤©ä¸‹ï¼Œå²‚ä¸ç¾å“‰ã€‚æœ‹å‹æŒ‡å‡ºï¼Œè¿™ä¸‰äººéƒ½æ¯”ä½ å¹´çºªå¤§ï¼Œä½ å»äº†åªèƒ½åšå°å¼Ÿã€‚é¢ï¼Œè¿™ç‚¹å€’æ²¡æƒ³åˆ°ï¼Œäºæ˜¯ç©¿è¶Šè®¡åˆ’æ— ç–¾è€Œç»ˆã€‚å»å¹´åˆç¿»äº†ä¸‹ã€Šä¸‰å›½æ¼”ä¹‰ã€‹ï¼Œåœ¨ç¬¬ä¸€ç« æ¡ƒå›­ä¸‰ç»“ä¹‰ä¸­çœ‹åˆ°äº†è¿™å¥â€œåŠåˆ˜ç„‰å‘æ¦œæ‹›å†›æ—¶ï¼Œç„å¾·å¹´å·²äºŒåå…«å²çŸ£â€ï¼Œå“¦ï¼Œçœ‹æ¥æˆ‘å†ä¹Ÿä¸ç”¨æ‹…å¿ƒç©¿è¶Šåˆ°ä¸‰å›½æ—¶æœŸçš„å¹´é¾„é—®é¢˜äº†ã€‚åˆ˜å¤‡äºŒåå…«å²æ—¶å°±å·²ç»å¼€å§‹åŒ¡æ‰¶æ±‰å®¤äº†ï¼Œè€Œæˆ‘äºŒåå…«å²æ—¶è¿˜åœ¨å†™ä»£ç  â•®(â•¯_â•°)â•­ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¹´åº¦æ€»ç»“" scheme="http://www.wukai.me/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä»æ’å…¥å›¾ç‰‡åŠŸèƒ½çš„å®ç°æ¥ä»‹ç» Draft.js å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</title>
    <link href="http://www.wukai.me/2019/07/21/draftjs-editor-tutorial-1/"/>
    <id>http://www.wukai.me/2019/07/21/draftjs-editor-tutorial-1/</id>
    <published>2019-07-20T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.546Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å‰æ®µæ—¶é—´çš„å·¥ä½œä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªåœ¨æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯è¿›è¡Œå›¾æ–‡æ··æ’ç¼–è¾‘çš„éœ€æ±‚ã€‚è™½ç„¶å¦‚æœåªéœ€è¦ç¼–è¾‘çº¯æ–‡æœ¬å’Œå›¾ç‰‡ï¼Œä¸ä¸€å®šè¦ä½¿ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ¥å®ç°ã€‚ä½†æ˜¯ä¸ºäº†ä»¥åæ–¹ä¾¿æ‰©å±•ï¼Œæ¯”å¦‚æ–‡æœ¬ä¼šæœ‰æ ·å¼è¦æ±‚ï¼Œæˆ‘è¿˜æ˜¯ç”¨ Draft.js å®ç°äº†ä¸€ä¸ªåŠŸèƒ½è¾ƒåŸºç¡€çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p><p>æˆ‘å°†ä»£ç å¼€æºåœ¨äº†<a href="https://github.com/noiron/draft-editor">è¿™ä¸ªé¡¹ç›® draft-editor</a> ä¸­ï¼Œä¹Ÿå¯ä»¥<a href="http://www.wukai.me/draft-editor/">åœ¨è¿™é‡Œåœ¨çº¿é¢„è§ˆ</a>ã€‚æœ¬æ–‡ä¸­æˆ‘å°†ä»‹ç»ä¸€ä¸‹ä¸€äº›å…³äº Draft.js çš„åŸºç¡€çŸ¥è¯†ï¼Œå¹¶ç”±æ­¤æ‰©å±•åˆ°å¦‚ä½•åœ¨ Draft.js ç¼–è¾‘å™¨ä¸­æ’å…¥å›¾ç‰‡åŠŸèƒ½çš„å®ç°ã€‚</p><span id="more"></span><h2 id="ä»ä¸€ä¸ªåŸºæœ¬çš„ç¼–è¾‘å™¨å¼€å§‹"><a href="#ä»ä¸€ä¸ªåŸºæœ¬çš„ç¼–è¾‘å™¨å¼€å§‹" class="headerlink" title="ä»ä¸€ä¸ªåŸºæœ¬çš„ç¼–è¾‘å™¨å¼€å§‹"></a>ä»ä¸€ä¸ªåŸºæœ¬çš„ç¼–è¾‘å™¨å¼€å§‹</h2><p>Draft.js æ˜¯ Facebook æ¨å‡ºçš„ç”¨äº React çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ¡†æ¶ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæœ€åŸºæœ¬çš„ Draft.js çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> â€˜reactâ€™;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> â€˜react-domâ€™;</span><br><span class="line"><span class="keyword">import</span> &#123;Editor, EditorState&#125; <span class="keyword">from</span> â€˜draft-jsâ€™;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyEditor</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;<span class="attr">editorState</span>: EditorState.createEmpty()&#125;;</span><br><span class="line">    <span class="built_in">this</span>.onChange = <span class="function">(<span class="params">editorState</span>) =&gt;</span> <span class="built_in">this</span>.setState(&#123;editorState&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Editor</span> <span class="attr">editorState</span>=<span class="string">&#123;this.state.editorState&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.onChange&#125;</span> /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥<a href="https://codesandbox.io/s/basic-draft-editor-gzver">åœ¨è¿™é‡ŒæŸ¥çœ‹</a>ã€‚è¿™é‡Œç»™ <code>Editor</code> ä¼ å…¥ä¸€ä¸ª <code>editorState</code> å±æ€§ï¼Œå¹¶ç»‘å®šä¸€ä¸ª <code>onChange</code>äº‹ä»¶ï¼Œå½“å‘ç”Ÿç¼–è¾‘æ“ä½œæ—¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ <code>editorState</code>ã€‚è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªå¯ä»¥è¿›è¡ŒåŸºæœ¬çš„æ–‡æœ¬æ“ä½œçš„ç¼–è¾‘å™¨äº†ã€‚</p><h2 id="Immutable-js-æ•°æ®ç»“æ„"><a href="#Immutable-js-æ•°æ®ç»“æ„" class="headerlink" title="Immutable.js æ•°æ®ç»“æ„"></a>Immutable.js æ•°æ®ç»“æ„</h2><p>åœ¨è¯´æ˜ä»€ä¹ˆæ˜¯ <code>EditorState</code> åŠ Draft.js å¯¹äºæ•°æ®çš„å­˜å‚¨æ–¹å¼ä¹‹å‰ï¼Œéœ€è¦ç®€ç•¥ä»‹ç»ä¸€ä¸‹ <strong>Immutables.js</strong>ã€‚</p><p>Draft.js æ˜¯åˆ©ç”¨ <a href="https://github.com/immutable-js/immutable-js">Immutable.js</a>æ¥ä¿å­˜æ•°æ®çš„ï¼Œæ­£å¦‚å…¶åï¼Œè¿™æ˜¯ä¸€ç§ä¸å¯å˜çš„æ•°æ®ç»“æ„ã€‚å¯¹äºä¸€ä¸ª Immutable çš„å¯¹è±¡ï¼Œä½ æ— æ³•ä¿®æ”¹å®ƒæœ¬èº«ï¼Œè‹¥æƒ³ä¿®æ”¹å…¶å€¼ï¼Œåªä¼šè¿”å›ä¸€ä¸ªæ–°çš„ä¿®æ”¹åçš„å¯¹è±¡ã€‚å°†è¿™ä¸€ç‚¹åº”ç”¨åœ¨ç¼–è¾‘å™¨ä¸Šï¼Œç”¨æˆ·çš„æ¯ä¸€æ¬¡ä¿®æ”¹éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæœ€æ–°çš„çŠ¶æ€å¿«ç…§ï¼Œå°±å¾ˆå®¹æ˜“å®ç°æ’¤é”€åŠŸèƒ½äº†ã€‚</p><p>åœ¨ Draft.js çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸‹é¢è¿™äº›æ•°æ®ç»“æ„ã€‚</p><p><strong><code>Map</code></strong> ç±»ä¼¼äº js ä¸­çš„å¯¹è±¡ï¼Œç”¨ <code>.set()</code> å’Œ <code>.get()</code> æ–¹æ³•è¿›è¡Œå†™å’Œè¯»ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const Immutable = require(â€˜immutableâ€™);</span><br><span class="line">const framework = Immutable.Map(&#123; name: &#x27;React&#x27;, age: 6 &#125;);</span><br><span class="line">const newFramework = client.set(&#x27;name&#x27;, &#x27;Vue&#x27;);</span><br><span class="line">console.log(framework.get(&#x27;name&#x27;));</span><br></pre></td></tr></table></figure><p><strong><code>OrderedMap</code></strong> æ··åˆäº† <code>object</code> å’Œ <code>array</code> çš„ç‰¹ç‚¹ã€‚é€šè¿‡ä½¿ç”¨ <code>orderedMap.get(â€˜keyâ€™)</code> å’Œ<br><code>orderedMap.set(â€˜keyâ€™, newValue)</code> è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å°†å®ƒå½“æˆä¸€ä¸ªæ™®é€šçš„ <code>object</code> æ¥ä½¿ç”¨ã€‚ä½†å’Œ <code>Map</code> çš„ä¸åŒç‚¹åœ¨äºå…¶ä¸­çš„ key æ˜¯æŒ‰ç…§è¢«åŠ å…¥æ—¶çš„é¡ºåºæ’åºçš„ã€‚</p><p><strong><code>Record</code></strong> ä¹Ÿç±»ä¼¼äº <code>Map</code>ï¼Œä½†æœ‰ä¸€äº›ä¸åŒä¹‹å¤„ã€‚</p><ul><li>ä¸€ä¸ª <code>record</code> ä¸€æ—¦è¢«åˆå§‹åŒ–ï¼Œå°±ä¸èƒ½å†æ·»åŠ æ–°çš„ key äº†</li><li>ä½ å¯ä»¥ç»™ä¸€ä¸ª <code>record</code> å®ä¾‹æ·»åŠ é»˜è®¤å€¼</li></ul><p>è¿˜æœ‰ä¸€ç‚¹ï¼Œimmutable çš„å¯¹è±¡ï¼Œæä¾›äº† <code>toJS()</code>æ–¹æ³•ï¼Œå¯å°†å…¶è½¬æˆæ™®é€šçš„ js å¯¹è±¡ï¼Œè¿™ä¸€æ–¹æ³•åœ¨æƒ³æŸ¥çœ‹å…¶å†…éƒ¨å†…å®¹æ—¶éå¸¸æœ‰ç”¨ã€‚</p><blockquote><p>Immutable.js å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.jscrambler.com/immutable-data-immutable-js/">Immutable Data with Immutable.js | Jscrambler Blog</a></p></blockquote><h2 id="Draft-æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„"><a href="#Draft-æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„" class="headerlink" title="Draft æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„"></a>Draft æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„</h2><h3 id="ä»€ä¹ˆæ˜¯-EditorState"><a href="#ä»€ä¹ˆæ˜¯-EditorState" class="headerlink" title="ä»€ä¹ˆæ˜¯ EditorState"></a>ä»€ä¹ˆæ˜¯ EditorState</h3><p>åœ¨åˆ›å»ºåŸºæœ¬çš„ç¼–è¾‘å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨åˆ°äº† <code>EditorState</code>ã€‚  <code>EditorState</code> æ˜¯ç¼–è¾‘å™¨æœ€é¡¶å±‚çš„çŠ¶æ€å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ª Immutable Record  å¯¹è±¡ï¼Œä¿å­˜äº†ç¼–è¾‘å™¨ä¸­å…¨éƒ¨çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡æœ¬çŠ¶æ€ã€é€‰ä¸­çŠ¶æ€ç­‰ã€‚</p><p>è°ƒç”¨  <code>editorState.toJS()</code> å¯å°† immutable record è½¬æ¢æˆä¸€ä¸ªæ™®é€šçš„ objectï¼Œæ‰“å°å‡ºæ¥å¦‚ä¸‹ï¼š<br><img src="/asset/images/2019-07-21-draft-editor-01.png" alt=""></p><p>ç®€å•åœ°æ¥çœ‹ä¸‹å…¶ä¸­çš„éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li><code>currentContent</code> æ˜¯ä¸€ä¸ª <code>ContentState</code> å¯¹è±¡ï¼Œå­˜æ”¾çš„æ˜¯å½“å‰ç¼–è¾‘å™¨ä¸­çš„å†…å®¹</li><li><code>selection</code> ä¸­æ˜¯å½“å‰é€‰ä¸­çš„çŠ¶æ€</li><li><code>redoStack</code> å’Œ <code>undoStack</code> å°±æ˜¯æ’¤é”€/é‡åšæ ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾çš„æ˜¯ <code>ContentState</code> ç±»å‹çš„ç¼–è¾‘å™¨çŠ¶æ€</li><li><code>decorator</code> ä¼šå¯»æ‰¾ç‰¹å®šçš„æ¨¡å¼ï¼Œå¹¶ç”¨ç‰¹å®šçš„ç»„ä»¶æ¸²æŸ“å‡ºæ¥</li></ul><h3 id="ä»€ä¹ˆæ˜¯-ContentState"><a href="#ä»€ä¹ˆæ˜¯-ContentState" class="headerlink" title="ä»€ä¹ˆæ˜¯ ContentState"></a>ä»€ä¹ˆæ˜¯ ContentState</h3><p>æ—¢ç„¶ç¼–è¾‘å™¨ä¸­çš„å†…å®¹æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ª <code>ContentState</code> å¯¹è±¡ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ª <code>ContentState</code> åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><p><code>ContentState</code> ä¹Ÿæ˜¯ä¸€ä¸ª Immutable Record å¯¹è±¡ï¼Œå…¶ä¸­ä¿å­˜äº†ç¼–è¾‘å™¨é‡Œçš„å…¨éƒ¨å†…å®¹å’Œæ¸²æŸ“å‰åçš„ä¸¤ä¸ªé€‰ä¸­çŠ¶æ€ã€‚å¯ä»¥é€šè¿‡ <code>EditorState.getCurrentContent()</code> æ¥è·å–å½“å‰çš„ <code>ContentState</code>ï¼ŒåŒæ ·è°ƒç”¨ <code>.toJS()</code> åå°†å®ƒæ‰“å°å‡ºæ¥çœ‹ä¸‹ï¼š<br><img src="/asset/images/2019-07-21-draft-editor-02.png" alt=""></p><p><code>blockMap</code> å’Œ <code>entityMap</code> é‡Œæ”¾ç½®çš„å°±æ˜¯ç¼–è¾‘å™¨ä¸­çš„ <code>block</code> å’Œ <code>entity</code>ï¼Œå®ƒä»¬æ˜¯æ„å»º Draft ç¼–è¾‘å™¨çš„ç –ç“¦ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-ContentBlock-å’Œ-Entity"><a href="#ä»€ä¹ˆæ˜¯-ContentBlock-å’Œ-Entity" class="headerlink" title="ä»€ä¹ˆæ˜¯ ContentBlock å’Œ Entity"></a>ä»€ä¹ˆæ˜¯ ContentBlock å’Œ Entity</h3><p>ä¸€ä¸ª <code>ContentBlock</code> è¡¨ç¤ºä¸€ä¸ªç¼–è¾‘å™¨å†…å®¹ä¸­çš„ä¸€ä¸ªç‹¬ç«‹çš„ blockï¼Œå³è§†è§‰ä¸Šç‹¬ç«‹çš„ä¸€å—ã€‚ </p><p>ä»¥ä¸‹å›¾çš„ç¼–è¾‘å™¨ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œå›¾ä¸­çš„å››ä¸ªçº¢æ¡†æ ‡å‡ºçš„éƒ¨åˆ†éƒ½æ˜¯ blockã€‚åœ¨å¹³æ—¶é˜…è¯»æ–‡ç« æ—¶ï¼Œå†…å®¹æ˜¯ä»¥æ®µè½ä¸ºå•ä½çš„ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­æ¯ä¸ªæ®µè½å°±æ˜¯ä¸€ä¸ª blockï¼Œå¦‚ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªçº¢æ¡†ä¸­çš„æ–‡å­—å†…å®¹ã€‚ç¬¬äºŒä¸ªçº¢æ¡†ä¸­æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª blockï¼Œä½†æ˜¾ç¤ºæ–¹å¼ä¸åŒäºæ™®é€šçš„ blockï¼Œä¸ºäº†è‡ªå®šä¹‰å®ƒçš„æ˜¾ç¤ºæ–¹å¼è¿˜éœ€è¦é¢å¤–åšä¸€äº›å·¥ä½œï¼Œåé¢ä¼šåŠ ä»¥è¯¦ç»†è¯´æ˜ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦ç¨ä½œè¯´æ˜ï¼Œç¬¬ä¸‰ä¸ªçº¢æ¡†ä¸­è™½ç„¶æ˜¯ç©ºç™½ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ª blockï¼Œåªä¸è¿‡å…¶ä¸­çš„æ–‡æœ¬ä¸ºç©ºè€Œå·²ã€‚<br><img src="/asset/images/2019-07-21-draft-editor-03.png" alt=""></p><p>æ­¤æ—¶ï¼Œè¾“å‡ºä¸€ä¸‹ <code>convertToRaw(currentContent)</code> ï¼Œçœ‹çœ‹å…¶ä¸­çš„å†…å®¹ã€‚æ³¨æ„è¿™é‡Œçš„è¾“å‡ºç»“æ„ä¸ä¸Šé¢çš„ <code>currentContent.toJS()</code> ç•¥æœ‰æ‰€åŒºåˆ«ï¼Œè¿™é‡Œåªæœ‰ <code>blocks</code> å’Œ <code>entityMap</code> è¿™ä¸¤é¡¹ã€‚<br><img src="/asset/images/2019-07-21-draft-editor-04.png" alt=""><br>å¯ä»¥çœ‹åˆ° <code>blocks</code> è¿™ä¸ªæ•°ç»„ä¸­ä¾æ¬¡å­˜æ”¾äº†å„ä¸ª <code>block</code> çš„ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ª <code>block</code> éƒ½æ˜¯ä¸€ä¸ª <code>contentBlock</code> å¯¹è±¡ã€‚</p><p>æ¯ä¸ª <code>contentBlock</code> éƒ½æœ‰å¦‚ä¸‹çš„å‡ ä¸ªå±æ€§å€¼ï¼š</p><ul><li><code>key</code>: æ ‡è¯†å‡ºè¿™æ˜¯å“ªä¸€ä¸ª block</li><li><code>type</code>: è¿™æ˜¯ä½•ç§ç±»å‹çš„ block</li><li><code>text</code>: å…¶ä¸­çš„æ–‡å­—</li><li>â€¦â€¦</li></ul><p>Draft.js ä¸­  <code>block</code> çš„ <code>type</code> æœ‰ unstyledï¼Œparagraphï¼Œheader-oneï¼Œatomic â€¦â€¦ ç­‰å€¼ï¼Œåœ¨ Draft.js çš„æ–‡æ¡£ä¸­ <code>atomic</code> ç±»å‹å¯¹åº”çš„æ˜¯ <code>&lt;figure /&gt;</code> å…ƒç´ ï¼Œæˆ‘ä»¬ä¹Ÿé€‰å–äº†å®ƒæ¥å®ç°æ’å…¥å›¾ç‰‡çš„åŠŸèƒ½ã€‚</p><p> å›¾ä¸­çš„è¿™äº› block çš„é™¤äº†ç¬¬ä¸‰ä¸ª key = â€œ1u22qâ€ çš„ block çš„ type å€¼æ˜¯ <code>atomic</code> å¤–ï¼Œå…¶ä½™çš„å€¼éƒ½æ˜¯ <code>â€œunstyledâ€</code>ã€‚å†ä»”ç»†çœ‹ä¸‹è¿™ä¸ª <code>atomic</code> ç±»å‹çš„ blockï¼š<br><img src="/asset/images/2019-07-21-draft-editor-05.png" alt=""></p><p>é™¤äº† <code>key</code>ï¼Œ<code>text</code>ï¼Œ<code>type</code> ç­‰å€¼ä¹‹å¤–ï¼Œåœ¨ <code>entityRanges</code> è¿™ä¸€é¡¹ä¸­ä¿å­˜å®ƒä¿å­˜äº†ä½¿ç”¨åˆ°çš„ <code>entity</code> çš„ä¿¡æ¯ï¼šoffset å’Œ length ç¡®å®šäº† <code>entity</code> åœ¨ block ä¸­çš„èŒƒå›´ï¼Œè€Œ key åˆ™èƒ½è®©æˆ‘ä»¬å»å–å‡ºå¯¹åº”çš„ <code>entity</code>ã€‚</p><p>å›åˆ°ä¸Šé¢çš„æ‰“å°å‡ºçš„ <code>contentState</code>çš„å†…å®¹ï¼Œé™¤äº†  <code>blocks</code> æ•°ç»„å¤–è¿˜æœ‰ä¸€ä¸ª <code>entityMap</code>å¯¹è±¡ã€‚å®ƒæ˜¯ä»¥ <code>entity</code> çš„ <code>key</code> ä½œä¸ºé”®å€¼çš„å¯¹è±¡ï¼Œé‡Œé¢ä¿å­˜äº†å›¾ç‰‡ã€é“¾æ¥ç­‰ç§ç±»çš„ <code>entity</code> ä¿¡æ¯ï¼Œä»ä¸­å°±å¯è·å¾— <code>blocks</code> æ‰€éœ€è¦çš„ <code>entity</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">entityMap: &#123;</span><br><span class="line"><span class="number">0</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;image&quot;</span>, <span class="attr">mutability</span>: <span class="string">&quot;IMUTABLE&quot;</span>, <span class="attr">data</span>: &#123;&#125; &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»‹ç»äº† Draft.js æ˜¯å¦‚ä½•å¯¹ç¼–è¾‘å™¨ä¸­çš„æ•°æ®è¿›è¡Œå­˜å‚¨çš„ï¼Œæ¥ä¸‹æ¥ä¼šä»ä»£ç å®ç°çš„è§’åº¦æ¥è¯´æ˜æ’å…¥å›¾ç‰‡æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h2 id="æ’å…¥å›¾ç‰‡çš„å®ç°"><a href="#æ’å…¥å›¾ç‰‡çš„å®ç°" class="headerlink" title="æ’å…¥å›¾ç‰‡çš„å®ç°"></a>æ’å…¥å›¾ç‰‡çš„å®ç°</h2><h3 id="å¦‚ä½•æ’å…¥å›¾ç‰‡"><a href="#å¦‚ä½•æ’å…¥å›¾ç‰‡" class="headerlink" title="å¦‚ä½•æ’å…¥å›¾ç‰‡"></a>å¦‚ä½•æ’å…¥å›¾ç‰‡</h3><p>æ’å…¥å›¾ç‰‡æœ‰ç€è¿™æ ·çš„æµç¨‹ï¼šé¦–å…ˆä¸ºå›¾ç‰‡åˆ›å»ºä¸€ä¸ª <code>entity</code>ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå¸¦æœ‰è¿™ä¸ª <code>entity</code> çš„æ–° <code>EditorState</code>ï¼Œç„¶åæ›´æ–°å³å¯ã€‚ä»¥ä¸‹æ˜¯å…³é”®éƒ¨åˆ†çš„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; AtomicBlockUtils &#125; <span class="keyword">from</span> <span class="string">&#x27;draft.js&#x27;</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> editorState = <span class="built_in">this</span>.state.editorState;</span><br><span class="line"><span class="keyword">const</span> contentState = editorState.getCurrentContent();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ `contentState.createEntity` åˆ›å»ºä¸€ä¸ª `entity`ï¼ŒæŒ‡å®šå…¶ `type` ä¸º `image`</span></span><br><span class="line"><span class="keyword">const</span> contentStateWithEntity = contentState.createEntity(</span><br><span class="line">  â€˜imageâ€™,</span><br><span class="line">  â€˜IMMUTABLEâ€™,</span><br><span class="line">  &#123; src &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ–°åˆ›å»ºçš„ `entity` çš„ key</span></span><br><span class="line"><span class="keyword">const</span> entityKey = contentStateWithEntity.getLastCreatedEntityKey();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨ `EditorState.set()`  æ¥å»ºç«‹ä¸€ä¸ªå¸¦æœ‰è¿™ä¸ª `entity` çš„æ–°çš„ EditorState </span></span><br><span class="line"><span class="keyword">const</span> newEditorState = EditorState.set(</span><br><span class="line">  editorState,</span><br><span class="line">  &#123; <span class="attr">currentContent</span>: contentStateWithEntity &#125;,</span><br><span class="line">  â€˜create-entityâ€™</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ©ç”¨`AtomicBlockUtils.insertAtomicBlock` æ¥æ’å…¥ä¸€ä¸ªæ–°çš„ `block`</span></span><br><span class="line"><span class="built_in">this</span>.setState(&#123;</span><br><span class="line">  <span class="attr">editorState</span>: AtomicBlockUtils.insertAtomicBlock(newEditorState, entityKey, â€˜ â€˜)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•ä½¿ç”¨-blockRendererFn-æ¥æ¸²æŸ“å›¾ç‰‡"><a href="#å¦‚ä½•ä½¿ç”¨-blockRendererFn-æ¥æ¸²æŸ“å›¾ç‰‡" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ blockRendererFn æ¥æ¸²æŸ“å›¾ç‰‡"></a>å¦‚ä½•ä½¿ç”¨ blockRendererFn æ¥æ¸²æŸ“å›¾ç‰‡</h3><p>ä¸Šé¢æˆ‘ä»¬å·²ç»è§åˆ°äº†ï¼Œä¸€å¼ å›¾ç‰‡æ˜¯ä½œä¸ºä¸€ä¸ª <code>atomic</code> ç±»å‹çš„ block æ’å…¥çš„ã€‚Draft.js æä¾›äº†<code>blockRendererFn</code> è®©æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ <code>ContentBlock</code> çš„æ¸²æŸ“æ–¹å¼ï¼Œç»™å®ƒä¼ å…¥ä¸€ä¸ªå‡½æ•°åï¼Œç”±è¯¥å‡½æ•°æ¥åˆ¤æ–­è¿™ä¸ª block çš„ <code>type</code> æ˜¯ä»€ä¹ˆï¼Œç„¶åå†³å®šå¦‚ä½•æ¸²æŸ“ã€‚</p><p>ä»¥ä¸‹çš„è¿™æ®µä»£ç æ¥è‡ª <a href="https://draftjs.org/docs/advanced-topics-block-components">Draft.js çš„å®˜æ–¹æ–‡æ¡£</a>ï¼Œå±•ç¤ºäº†å¦‚ä½•å¤„ç†ä¸€ä¸ª  type ä¸º <code>atomic</code> çš„ <code>ContentBlock</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myBlockRenderer</span>(<span class="params">contentBlock</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> type = contentBlock.getType();</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">&#x27;atomic&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">component</span>: MediaComponent,</span><br><span class="line">      <span class="attr">editable</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Then...</span></span><br><span class="line"><span class="keyword">import</span> &#123;Editor&#125; <span class="keyword">from</span> <span class="string">&#x27;draft-js&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EditorWithMedia</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Editor</span> <span class="attr">...</span> <span class="attr">blockRendererFn</span>=<span class="string">&#123;myBlockRenderer&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼ é€’äº†ä¸€ä¸ª <code>props</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">component: MediaComponent,</span><br><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line"><span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>ç»“æœç­‰åŒäº <code>&lt;MediaComponent foo=&#39;bar&#39; /&gt;</code>ï¼Œå¯ä»¥åˆ©ç”¨è¿™é‡Œçš„ <code>props</code> ä¼ å…¥æ‰€éœ€è¦çš„å…¶ä»–æ•°æ®ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ <code>MediaComponent</code> æ¥å†³å®šå±•ç°æ–¹å¼ã€‚å› ä¸ºä¸ç®¡æ˜¯å›¾ç‰‡è¿˜æ˜¯è§†é¢‘ç­‰å…¶å®ƒçš„åª’ä½“ç±»å‹ï¼Œå®ƒä»¬çš„ <code>type</code> éƒ½æ˜¯ <code>atomic</code>ã€‚åœ¨ <code>MediaComponent</code> é‡Œå°±éœ€è¦é€šè¿‡ <code>entity</code> çš„ <code>type</code> æ¥ç¡®å®šå…¶ç§ç±»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> entity = props.contentState.getEntity(props.block.getEntityAt(<span class="number">0</span>));</span><br><span class="line"><span class="keyword">const</span> &#123; src &#125; = entity.getData();<span class="comment">// å–å‡ºå›¾ç‰‡çš„åœ°å€</span></span><br><span class="line"><span class="keyword">const</span> type = entity.getType();  <span class="comment">// åˆ¤æ–­ entity çš„ type çš„</span></span><br></pre></td></tr></table></figure><p>å½“ <code>entity</code> çš„ <code>type</code> æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ <code>image</code> æ—¶å°±å¯ä»¥è¿”å› <code>&lt;Image /&gt;</code> ç»„ä»¶äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Image src=&#123;src&#125; /&gt; <span class="comment">// è‡ªå®šä¹‰çš„å›¾ç‰‡ç»„ä»¶ &lt;Image /&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/noiron/draft-editor/blob/master/src/components/entities/mediaBlockRenderer.js">å®Œæ•´ä»£ç å¯è§æ­¤æ–‡ä»¶</a></p><h3 id="å¦‚ä½•åˆ é™¤ä¸€å¼ å›¾ç‰‡"><a href="#å¦‚ä½•åˆ é™¤ä¸€å¼ å›¾ç‰‡" class="headerlink" title="å¦‚ä½•åˆ é™¤ä¸€å¼ å›¾ç‰‡"></a>å¦‚ä½•åˆ é™¤ä¸€å¼ å›¾ç‰‡</h3><p>æ—¢ç„¶å·²ç»æ’å…¥äº†å›¾ç‰‡ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ é™¤å®ƒå‘¢ï¼Ÿå½“ç„¶æˆ‘ä»¬å¯ä»¥æŒ‰é”®ç›˜ä¸Šçš„ Backspace é”®æ¥åˆ é™¤ã€‚ä¹Ÿå¯ä»¥åœ¨å›¾ç‰‡çš„å³ä¸Šè§’åŠ å…¥ä¸€ä¸ª â€œXâ€ çš„å›¾æ ‡ï¼Œç‚¹å‡»ååˆ é™¤è¯¥å›¾ç‰‡ï¼Œå®ç°æ–¹å¼å¦‚ä¸‹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">deleteImage = <span class="function">(<span class="params">block</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> editorState = <span class="built_in">this</span>.state.editorState;</span><br><span class="line">  <span class="keyword">const</span> contentState = editorState.getCurrentContent();</span><br><span class="line">  <span class="keyword">const</span> key = block.getKey();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> selection = editorState.getSelection();</span><br><span class="line">  <span class="keyword">const</span> selectionOfAtomicBlock = selection.merge(&#123;</span><br><span class="line">    <span class="attr">anchorKey</span>: key,</span><br><span class="line">    <span class="attr">anchorOffset</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">focusKey</span>: key,</span><br><span class="line">    <span class="attr">focusOffset</span>: block.getLength(),</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡å†™ entity æ•°æ®ï¼Œå°†å…¶ä» block ä¸­ç§»é™¤ï¼Œé˜²æ­¢è¿™ä¸ª entity è¿˜è¢«å…¶å®ƒçš„ block å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">const</span> contentStateWithoutEntity = Modifier.applyEntity(contentState, selectionOfAtomicBlock, <span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> editorStateWithoutEntity = EditorState.push(editorState, contentStateWithoutEntity, â€˜apply-entityâ€™);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç§»é™¤ block</span></span><br><span class="line">  <span class="keyword">const</span> contentStateWithoutBlock = Modifier.removeRange(contentStateWithoutEntity, selectionOfAtomicBlock, â€˜backwardâ€™);</span><br><span class="line">  <span class="keyword">const</span> newEditorState =  EditorState.push(editorStateWithoutEntity, contentStateWithoutBlock, â€˜remove-rangeâ€™,);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.onChange(newEditorState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå¯¹å›¾ç‰‡çš„ç›¸å…³æ“ä½œå°±å®Œæˆäº†ã€‚</p><h2 id="æ€»ç»“ä¸å…¶ä»–"><a href="#æ€»ç»“ä¸å…¶ä»–" class="headerlink" title="æ€»ç»“ä¸å…¶ä»–"></a>æ€»ç»“ä¸å…¶ä»–</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œä»‹ç»äº† Draft.js çš„åŸºæœ¬åŠŸèƒ½ï¼Œå®ƒæ˜¯å¦‚ä½•è¿›è¡Œæ•°æ®çš„å­˜å‚¨çš„ï¼ŒåŠ <code>EditorState</code>ã€<code>ContentState</code>ã€<code>ContentBlock</code>ã€<code>Entity</code> ç­‰å¯¹è±¡é—´çš„å…³ç³»ã€‚å¹¶ä»¥æ­¤ä¸ºåŸºç¡€è¯´æ˜äº†å¦‚ä½•åœ¨ç¼–è¾‘å™¨ä¸­å¯¹å›¾ç‰‡è¿›è¡Œæ“ä½œã€‚</p><p>å½“ç„¶å…³äº Draft.js è¿˜æœ‰å¾ˆå¤šå†…å®¹æ²¡æœ‰åœ¨æœ¬æ–‡ä¸­æåŠï¼Œå¦‚ä¿®æ”¹è¡Œå†…æ–‡æœ¬çš„æ ·å¼ï¼Œåˆ©ç”¨ <code>decorators</code> æ¥æ’å…¥ä¸æ¸²æŸ“é“¾æ¥ç­‰ç­‰ã€‚è¿™äº›å°±éœ€è¦è¯»è€…æ¢ç´¢ä¸‹ Draft.js çš„å®˜æ–¹æ–‡æ¡£å’Œå…¶ä»–äººçš„åˆ†äº«å¹¶äº²è‡ªå°è¯•ä¸‹äº†ã€‚</p><h2 id="å‚è€ƒæ–‡ç« åŠèµ„æº"><a href="#å‚è€ƒæ–‡ç« åŠèµ„æº" class="headerlink" title="å‚è€ƒæ–‡ç« åŠèµ„æº"></a>å‚è€ƒæ–‡ç« åŠèµ„æº</h2><blockquote><p><a href="https://github.com/noiron/draft-editor">æœ¬æ–‡æ‰€åŸºäºçš„ç¼–è¾‘å™¨é¡¹ç›®ï¼šdraft-editor</a></p></blockquote><blockquote><p><a href="https://medium.com/@rajaraodv/how-draft-js-represents-rich-text-data-eeabb5f25cf2#.q7vpkxmog">How Draft.js Represents Rich Text Data</a><br><a href="https://medium.com/@siobhanpmahoney/building-a-rich-text-editor-with-react-and-draft-js-part-2-4-persisting-data-to-server-cd68e81c820">Building a Rich Text Editor with React and Draft.js, Part 2.4: Embedding Images</a><br><a href="https://zhuanlan.zhihu.com/p/24951621">Draft.js åœ¨çŸ¥ä¹çš„å®è·µ</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨å‰æ®µæ—¶é—´çš„å·¥ä½œä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªåœ¨æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯è¿›è¡Œå›¾æ–‡æ··æ’ç¼–è¾‘çš„éœ€æ±‚ã€‚è™½ç„¶å¦‚æœåªéœ€è¦ç¼–è¾‘çº¯æ–‡æœ¬å’Œå›¾ç‰‡ï¼Œä¸ä¸€å®šè¦ä½¿ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ¥å®ç°ã€‚ä½†æ˜¯ä¸ºäº†ä»¥åæ–¹ä¾¿æ‰©å±•ï¼Œæ¯”å¦‚æ–‡æœ¬ä¼šæœ‰æ ·å¼è¦æ±‚ï¼Œæˆ‘è¿˜æ˜¯ç”¨ Draft.js å®ç°äº†ä¸€ä¸ªåŠŸèƒ½è¾ƒåŸºç¡€çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†ä»£ç å¼€æºåœ¨äº†&lt;a href=&quot;https://github.com/noiron/draft-editor&quot;&gt;è¿™ä¸ªé¡¹ç›® draft-editor&lt;/a&gt; ä¸­ï¼Œä¹Ÿå¯ä»¥&lt;a href=&quot;http://www.wukai.me/draft-editor/&quot;&gt;åœ¨è¿™é‡Œåœ¨çº¿é¢„è§ˆ&lt;/a&gt;ã€‚æœ¬æ–‡ä¸­æˆ‘å°†ä»‹ç»ä¸€ä¸‹ä¸€äº›å…³äº Draft.js çš„åŸºç¡€çŸ¥è¯†ï¼Œå¹¶ç”±æ­¤æ‰©å±•åˆ°å¦‚ä½•åœ¨ Draft.js ç¼–è¾‘å™¨ä¸­æ’å…¥å›¾ç‰‡åŠŸèƒ½çš„å®ç°ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç¼–è¾‘å™¨" scheme="http://www.wukai.me/tags/%E7%BC%96%E8%BE%91%E5%99%A8/"/>
    
      <category term="draft.js" scheme="http://www.wukai.me/tags/draft-js/"/>
    
  </entry>
  
  <entry>
    <title>2018å¹´æ€»ç»“</title>
    <link href="http://www.wukai.me/2019/01/01/2018-annual-summary/"/>
    <id>http://www.wukai.me/2019/01/01/2018-annual-summary/</id>
    <published>2018-12-31T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.546Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ°äº†2018å¹´å¿«è¦ç»“æŸçš„æ—¶å€™ï¼Œæ‰å‘ç°è¿™ä¸€å¹´ä»€ä¹ˆä¹Ÿæ²¡åšå•ŠğŸ˜‚ï¼Œä¸Šä¸€ç¯‡åšå®¢è¿˜æ˜¯3æœˆä»½å†™çš„ã€‚æ„Ÿè§‰åšè¿™ä¸ªæ€»ç»“å°±æ˜¯åœ¨æé†’è‡ªå·±è’åºŸäº†ä¸€å¹´ï¼Œè™½ç„¶ä¸æƒ³è¿™ä¹ˆåšï¼Œä½†è¿˜æ˜¯æ¥å†™ç‚¹ä»€ä¹ˆå§ã€‚</p><span id="more"></span><p>ä»Šå¹´åšçš„æœ€é‡è¦çš„äº‹åº”è¯¥æ˜¯æ¢äº†ä»½å·¥ä½œå§ï¼Œä¹Ÿæ¢äº†åº§åŸå¸‚ï¼Œ4æœˆä»½ä»å—äº¬æ¥åˆ°äº†ä¸Šæµ·ã€‚</p><p>æ¥åˆ°äº†æ›´å¤§çš„å…¬å¸ï¼Œè§è¯†äº†ä¸åŒçš„å·¥ä½œæµç¨‹ï¼Œæ¯”èµ·ä»¥å‰åªæœ‰å‡ ä¸ªå¼€å‘çš„å°å…¬å¸æ­£è§„äº†ä¸å°‘ã€‚å·¥ä½œæ¯”ä»¥å‰æ›´å¿™äº†äº›ï¼Œä¹Ÿå°è¯•äº†ä¸€äº›æ–°çš„æŠ€æœ¯ï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯æµ…å°è¾„æ­¢ã€‚</p><h2 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h2><p>ä»Šå¹´åœ¨ä¸€ä¸ªå·¥ä½œé¡¹ç›®ä¸­ç¬¬ä¸€æ¬¡ä½¿ç”¨äº† React Native å¼€å‘ï¼Œäº†è§£äº†RNçš„ä¸€ç‚¹çš®æ¯›ï¼Œä½“ä¼šäº†ä¸‹å¤šç«¯èåˆå¼€å‘ã€‚</p><p>ä»Šå¹´çš„å¼€å‘ä¸­ç¢°åˆ°äº†ä¸å°‘ç§»åŠ¨ç«¯çš„å…¼å®¹æ€§é—®é¢˜ï¼Œè¦è€ƒè™‘é¡µé¢åœ¨å„ç§æ‰‹æœºã€APPã€å„ç§ç‰ˆæœ¬çš„ webview ä¸­æ‰“å¼€çš„æƒ…å†µï¼Œæœ‰äº†ä¸€äº›é›¶æ•£çš„ç»éªŒã€‚</p><p>ä¼¼ä¹æ²¡æœ‰æ­£ç»åœ°çœ‹ä»€ä¹ˆæŠ€æœ¯ä¹¦ç±ã€‚</p><h2 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h2><p>çœ‹çš„æ–°ä¹¦æ²¡æœ‰å¤šå°‘ï¼Œå€’æ˜¯åœ¨ç©ºé—²æ—¶åˆç¿»äº†ç¿»ä»¥å‰çœ‹è¿‡çš„ä¹¦ä½œä¸ºæ¶ˆé£ã€‚</p><h3 id="å°è¯´ç±»"><a href="#å°è¯´ç±»" class="headerlink" title="å°è¯´ç±»"></a>å°è¯´ç±»</h3><ul><li>æå‡»ä¿±ä¹éƒ¨</li><li>åŸºç£å±±ä¼¯çˆµï¼ˆå°å­¦æ—¶çœ‹è¿‡ç®€å†™æœ¬ï¼Œä»Šå¹´æ‰çœ‹å®Œå…¨æœ¬ï¼‰</li><li>å æ˜Ÿæœ¯æ€äººé­”æ³•</li><li>å“ˆåˆ©çš„åäº”æ¬¡äººç”Ÿ </li><li>å®ƒ</li><li>æ­»äº†ä¸ƒæ¬¡çš„ç”·äºº</li><li>å°„é›•è‹±é›„ä¼ ï¼ˆå›½åº†èŠ‚å‡æœŸæ—¶é‡æ¸©äº†ä¸€éï¼Œæ²¡æƒ³åˆ°æ²¡å¤šä¹…é‡‘åº¸å°±å»ä¸–äº†ï¼‰</li></ul><h3 id="è‡ªç„¶ç§‘å­¦ç±»"><a href="#è‡ªç„¶ç§‘å­¦ç±»" class="headerlink" title="è‡ªç„¶ç§‘å­¦ç±»"></a>è‡ªç„¶ç§‘å­¦ç±»</h3><p>çœ‹äº†ä¸¤æœ¬ç§‘æ™®çš„å°å†Œå­ï¼Œè¿˜æœ‰ã€Šè´¹æ›¼ç‰©ç†å­¦è®²ä¹‰ã€‹åªçœ‹äº†åç« </p><ul><li>ä¸ƒå ‚æç®€ç‰©ç†è¯¾</li><li>å®‡å®™çš„æœ€åä¸‰åˆ†é’Ÿ</li></ul><h3 id="äººæ–‡ç±»"><a href="#äººæ–‡ç±»" class="headerlink" title="äººæ–‡ç±»"></a>äººæ–‡ç±»</h3><ul><li>ä»–æ”¹å˜äº†ä¸­å›½ï¼ˆæ›°_æ›°ï¼‰</li><li>å—æ˜å² ä¸Š</li></ul><h3 id="è‹±è¯­åŸè‘—ç±»"><a href="#è‹±è¯­åŸè‘—ç±»" class="headerlink" title="è‹±è¯­åŸè‘—ç±»"></a>è‹±è¯­åŸè‘—ç±»</h3><ul><li>Harry Potter and the Order of the Phoenixï¼ˆæŠŠ17å¹´å‰©çš„åŠæœ¬çœ‹å®Œäº†ï¼‰</li><li>The Old Man and the Sea</li></ul><p>å“¦ï¼Œè¿˜æœ‰æŠŠ45å·çš„ã€Šå“†å•¦Aæ¢¦ã€‹æ¼«ç”»ä½œä¸ºç¡å‰è¯»ç‰©çœ‹å®Œäº†ï¼ˆä¸Šä¸€æ¬¡çœ‹å“†å•¦Aæ¢¦æ¼«ç”»çš„æ—¶å€™æ˜¯åå‡ å¹´å‰åå­—è¿˜å«åšæœºå™¨çŒ«å°å®å½“ï¼‰ã€‚</p><h2 id="è¿åŠ¨"><a href="#è¿åŠ¨" class="headerlink" title="è¿åŠ¨"></a>è¿åŠ¨</h2><p>ä»Šå¹´å¯ä»¥ç®—æ˜¯æ²¡æ€ä¹ˆè¿åŠ¨è¿‡å§ï¼Œä¸€å…±è·‘äº†20æ¬¡ï¼Œ102.5å…¬é‡Œã€‚å¦‚æœç»™è‡ªå·±æ‰¾ä¸ªå€Ÿå£ï¼Œå°±æ˜¯å‘¨å›´çš„ç¯å¢ƒå¤ªå·®ï¼Œæ²¡æœ‰è·‘æ­¥çš„æƒ³æ³•ã€‚è¿˜æ˜¯æ‰¿è®¤è‡ªå·±å¤ªæ‡’ç®—äº†ã€‚</p><h2 id="ç”µå½±"><a href="#ç”µå½±" class="headerlink" title="ç”µå½±"></a>ç”µå½±</h2><p>å»ç”µå½±é™¢çœ‹äº†10éƒ¨ç”µå½±ï¼Œ4éƒ¨å›½äº§ï¼Œ6éƒ¨å›½å¤–ã€‚ä»ç„¶çœ‹äº†å¾ˆå¤šè¿åå­—ä¹Ÿè®°ä¸èµ·çš„å½±è§†å‰§ã€‚</p><hr><p>åæ€2018å¹´ï¼Œåº”è¯¥æ˜¯èŠ±äº†å¤ªå¤šçš„æ—¶é—´åœ¨ç½‘ä¸Šçœ‹å„ç§æ®µå­å’Œæ— èŠå›¾å§ï¼Œå¯¼è‡´è„‘å­é‡Œè£…æ»¡äº†å„ç§çƒ‚æ¢—ï¼ŒæŒ¤å äº†ç•™ç»™æŠ€æœ¯çš„åœ°æ–¹â•®(â•¯_â•°)â•­ã€‚</p><p>2019å¹´åº”è¯¥å¤šèŠ±ç‚¹æ—¶é—´åœ¨çœ‹ä¹¦ä¸Šï¼ŒåŒ…æ‹¬æŠ€æœ¯ä¹¦å’Œå…¶ä»–ç±»å‹çš„ä¹¦ã€‚</p><p>å†è§ï¼Œ2018ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆ°äº†2018å¹´å¿«è¦ç»“æŸçš„æ—¶å€™ï¼Œæ‰å‘ç°è¿™ä¸€å¹´ä»€ä¹ˆä¹Ÿæ²¡åšå•ŠğŸ˜‚ï¼Œä¸Šä¸€ç¯‡åšå®¢è¿˜æ˜¯3æœˆä»½å†™çš„ã€‚æ„Ÿè§‰åšè¿™ä¸ªæ€»ç»“å°±æ˜¯åœ¨æé†’è‡ªå·±è’åºŸäº†ä¸€å¹´ï¼Œè™½ç„¶ä¸æƒ³è¿™ä¹ˆåšï¼Œä½†è¿˜æ˜¯æ¥å†™ç‚¹ä»€ä¹ˆå§ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¹´åº¦æ€»ç»“" scheme="http://www.wukai.me/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>Minimax å’Œ Alpha-beta å‰ªæç®—æ³•ç®€ä»‹ï¼ŒåŠä»¥æ­¤å®ç°çš„äº•å­—æ£‹æ¸¸æˆï¼ˆTic-tac-toeï¼‰</title>
    <link href="http://www.wukai.me/2018/03/04/minimax-alpha-beta-pruning-and-tic-tac-toe/"/>
    <id>http://www.wukai.me/2018/03/04/minimax-alpha-beta-pruning-and-tic-tac-toe/</id>
    <published>2018-03-03T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.546Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´ç”¨ React å†™äº†ä¸ª<a href="https://github.com/noiron/react-2048">2048 æ¸¸æˆ</a>æ¥ç»ƒç»ƒæ‰‹ï¼Œå‡†å¤‡ç”¨æ¥å›é¡¾ä¸‹ React ç›¸å…³çš„å„ç§æŠ€æœ¯ï¼Œä»¥åŠè¯•éªŒä¸€ä¸‹æ–°æŠ€æœ¯ã€‚åœ¨å†™è¿™ä¸ª2048çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è€ƒè™‘æ˜¯å¦å¯ä»¥åœ¨å…¶ä¸­åŠ å…¥ä¸€ä¸ª AI ç®—æ³•æ¥è‡ªåŠ¨è¿›è¡Œæ¸¸æˆï¼Œäºæ˜¯æˆ‘æ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼š<a href="http://blog.codinglabs.org/articles/2048-ai-analysis.html">2048-AIç¨‹åºç®—æ³•åˆ†æ</a>ï¼Œæ–‡ä¸­ä»‹ç»äº† minimax ç®—æ³•å’Œ alpha-beta å‰ªæç®—æ³•ã€‚äºæ˜¯æˆ‘å†³å®šå…ˆå­¦ä¹ ä¸‹è¿™ä¸¤ç§ç®—æ³•ï¼Œå¹¶ä»¥æ­¤å†™äº†è¿™ä¸ª tic-tac-toe æ¸¸æˆï¼š<a href="https://tic-tac-toe-js-app.herokuapp.com/">tic-tac-toe-js</a>ï¼ˆ<a href="https://github.com/noiron/tic-tac-toe-js">ä»£ç è§æ­¤å¤„</a>ï¼‰ã€‚æœ¬æ–‡å°†è¯´æ˜å¦‚ä½•ç”¨ JavaScript æ¥ç®€å•åœ°å®ç°ç®—æ³•ï¼Œå¹¶å°†å…¶è¿ç”¨åˆ° tic-tac-toe æ¸¸æˆä¸­ã€‚</p><span id="more"></span><h2 id="Minimax-ç®—æ³•ç®€ä»‹"><a href="#Minimax-ç®—æ³•ç®€ä»‹" class="headerlink" title="Minimax ç®—æ³•ç®€ä»‹"></a>Minimax ç®—æ³•ç®€ä»‹</h2><p>æˆ‘è§‰å¾—è¦è§£é‡Š minimax ç®—æ³•çš„åŸç†ï¼Œéœ€è¦ç”¨ç¤ºæ„å›¾æ¥è§£é‡Šæ›´æ¸…æ™°ï¼Œä»¥ä¸‹çš„å‡ ç¯‡æ–‡ç« éƒ½å¯¹åŸç†è¯´çš„è¶³å¤Ÿæ¸…æ¥šã€‚</p><blockquote><ol><li><a href="http://blog.codinglabs.org/articles/2048-ai-analysis.html">2048-AIç¨‹åºç®—æ³•åˆ†æ</a></li><li><a href="https://www.neverstopbuilding.com/blog/2013/12/13/tic-tac-toe-understanding-the-minimax-algorithm13/">Tic Tac Toe: Understanding the Minimax Algorithm</a></li><li><a href="http://www.flyingmachinestudios.com/programming/minimax/">An Exhaustive Explanation of Minimax, a Staple AI Algorithm</a></li></ol></blockquote><p>å…¶ä¸­åé¢çš„ä¸¤ç¯‡æ–‡ç« éƒ½æ˜¯ä»¥ tic-tac-toe æ¸¸æˆä¸ºä¾‹ï¼Œå¹¶ç”¨ Ruby å®ç°ã€‚</p><p>ä»¥æ£‹ç±»æ¸¸æˆä¸ºä¾‹æ¥è¯´æ˜ minimax ç®—æ³•ï¼Œæ¯ä¸€ä¸ªæ£‹ç›˜çš„çŠ¶æ€éƒ½ä¼šå¯¹åº”ä¸€ä¸ªåˆ†æ•°ã€‚åŒæ–¹å°†ä¼šè½®æµä¸‹æ£‹ã€‚è½®åˆ°æˆ‘æ–¹ä¸‹å­æ—¶ï¼Œæˆ‘ä¼šé€‰æ‹©åˆ†æ•°æœ€é«˜çš„çŠ¶æ€ï¼›è€Œå¯¹æ–¹ä¼šé€‰æ‹©å¯¹æˆ‘æœ€ä¸åˆ©çš„çŠ¶æ€ã€‚å¯ä»¥è¿™ä¹ˆè®¤ä¸ºï¼Œæ¯æ¬¡æˆ‘éƒ½éœ€è¦ä»å¯¹æ‰‹ç»™æˆ‘é€‰æ‹©çš„æœ€å·®ï¼ˆminï¼‰å±€é¢ä¸­é€‰å‡ºæœ€å¥½ï¼ˆmaxï¼‰çš„ä¸€ä¸ªï¼Œè¿™å°±æ˜¯è¿™ä¸ªç®—æ³•åç§° <strong>minimax</strong> çš„æ„ä¹‰ã€‚</p><p><img src="/asset/images/2018-03-04-data-tree.png" alt="minimax tree"><br>ï¼ˆå›¾ç‰‡æ¥è‡ªäº <a href="http://web.cs.ucla.edu/~rosen/161/notes/alphabeta.htmlï¼‰">http://web.cs.ucla.edu/~rosen/161/notes/alphabeta.htmlï¼‰</a></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥ä¼šè§£å†³è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ­£æ–¹å½¢çš„èŠ‚ç‚¹å¯¹åº”äºæˆ‘çš„å†³ç­–ï¼Œåœ†å½¢çš„èŠ‚ç‚¹æ˜¯å¯¹æ‰‹çš„å†³ç­–ã€‚åŒæ–¹è½®æµé€‰æ‹©ä¸€ä¸ªåˆ†æ”¯ï¼Œæˆ‘çš„ç›®æ ‡æ˜¯è®©æœ€åé€‰å‡ºçš„æ•°å­—å°½å¯èƒ½å¤§ï¼Œå¯¹æ–¹çš„ç›®æ ‡æ˜¯è®©è¿™ä¸ªæ•°å­—å°½å¯èƒ½å°ã€‚</p><h2 id="Minimax-ç®—æ³•çš„å®ç°"><a href="#Minimax-ç®—æ³•çš„å®ç°" class="headerlink" title="Minimax ç®—æ³•çš„å®ç°"></a>Minimax ç®—æ³•çš„å®ç°</h2><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œå¯¹äºè¿™ä¸ªç‰¹å®šçš„é—®é¢˜ï¼Œæˆ‘ç”¨äº†ä¸€ä¸ªåµŒå¥—çš„æ•°ç»„æ¥è¡¨ç¤ºçŠ¶æ€æ ‘ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dataTree = [</span><br><span class="line">    [</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">3</span>, <span class="number">17</span>], [<span class="number">2</span>, <span class="number">12</span>]</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">15</span>], [<span class="number">25</span>, <span class="number">0</span>]</span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">2</span>, <span class="number">5</span>], [<span class="number">3</span>]</span><br><span class="line">        ],</span><br><span class="line">        [</span><br><span class="line">            [<span class="number">2</span>, <span class="number">14</span>]</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>å›¾ä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p><ol><li><strong>Max èŠ‚ç‚¹</strong>ï¼šå›¾ä¸­çš„æ­£æ–¹å½¢èŠ‚ç‚¹ï¼Œå¯¹åº”äºæˆ‘çš„å›åˆï¼Œå®ƒä¼šé€‰å–æ‰€æœ‰å­èŠ‚ç‚¹ä¸­çš„æœ€å¤§å€¼ä½œä¸ºè‡ªèº«çš„å€¼</li><li><strong>Min èŠ‚ç‚¹</strong>ï¼šå›¾ä¸­çš„åœ†å½¢èŠ‚ç‚¹ï¼Œå¯¹åº”äºå¯¹æ‰‹çš„å›åˆï¼Œå®ƒä¼šé€‰å–æ‰€æœ‰å­èŠ‚ç‚¹ä¸­çš„æœ€å°å€¼ä½œä¸ºè‡ªèº«çš„å€¼</li></ol><p>å…ˆå®šä¹‰ä¸€ä¸ª <code>Node</code> ç±»ï¼Œ<code>constructor</code> å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">data, type, depth</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = data;</span><br><span class="line">    <span class="built_in">this</span>.type = type; <span class="comment">// åŒºåˆ†æ­¤èŠ‚ç‚¹çš„ç§ç±»æ˜¯ max æˆ– min</span></span><br><span class="line">    <span class="built_in">this</span>.depth = depth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹èŠ‚ç‚¹çš„ <code>depth</code> ä¸º0ï¼Œä»¥ä¸‹çš„æ¯ä¸€å±‚ <code>depth</code> ä¾æ¬¡åŠ ä¸€ã€‚æœ€åº•å±‚çš„èŠ‚ç‚¹ <code>depth</code> ä¸º4ï¼Œå…¶ <code>data</code> æ˜¯å†™åœ¨å›¾ä¸­çš„æ•°å­—ï¼Œå…¶å®ƒå±‚èŠ‚ç‚¹çš„ <code>data</code> å‡æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚</p><p>æ¥ä¸‹æ¥è€ƒè™‘å¦‚ä½•ç»™æ¯ä¸ªèŠ‚ç‚¹æ‰“åˆ†ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„å‡ ç§æƒ…å†µï¼š</p><ol><li>æœ€åº•å±‚çš„èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›æœ¬èº«çš„æ•°å­—</li><li>ä¸­é—´å±‚çš„ max èŠ‚ç‚¹ï¼Œè¿”å›å­èŠ‚ç‚¹ä¸­çš„æœ€å¤§åˆ†æ•°</li><li>ä¸­é—´å±‚çš„ min èŠ‚ç‚¹ï¼Œè¿”å›å­èŠ‚ç‚¹ä¸­çš„æœ€å°åˆ†æ•°</li></ol><p>ä¸ºæ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬æŒ‰ç…§ç”±ä¸Šåˆ°ä¸‹ã€ç”±å·¦åˆ°å³çš„é¡ºåºç»™å›¾ä¸­èŠ‚ç‚¹è¿›è¡Œæ ‡å·ã€‚èŠ‚ç‚¹1æ˜¯ max èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹2å’ŒèŠ‚ç‚¹3ä¸­é€‰æ‹©è¾ƒå¤§å€¼ï¼›è€Œå¯¹äºèŠ‚ç‚¹2æ¥è¯´ï¼Œéœ€è¦ä»èŠ‚ç‚¹4ï¼Œ5ä¸­é€‰å–è¾ƒå°å€¼ã€‚å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬è¿™é‡Œè¦ç”¨é€’å½’çš„æ–¹æ³•æ¥å®ç°ï¼Œå½“æœç´¢åˆ°æœ€åº•å±‚çš„èŠ‚ç‚¹æ—¶ï¼Œé€’å½’è¿‡ç¨‹å¼€å§‹è¿”å›ã€‚</p><p><img src="/asset/images/2018-03-04-data-tree-mark.png" alt="minimax tree mark"></p><p>ä»¥ä¸‹æ˜¯æ‰“åˆ†å‡½æ•° <code>score</code> çš„å…·ä½“ä»£ç ï¼š </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">score</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ°è¾¾äº†æœ€å¤§æ·±åº¦åï¼Œæ­¤æ—¶çš„ data æ˜¯æ•°ç»„æœ€å†…å±‚çš„æ•°å­—</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.depth &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹äº max èŠ‚ç‚¹ï¼Œè¿”å›çš„æ˜¯å­èŠ‚ç‚¹ä¸­çš„æœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.type === <span class="string">&#x27;max&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> maxScore = -<span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.data.length; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> d = <span class="built_in">this</span>.data[i];</span><br><span class="line">            <span class="comment">// ç”Ÿæˆæ–°çš„èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹çš„ type ä¼šå’Œçˆ¶èŠ‚ç‚¹ä¸åŒ</span></span><br><span class="line">            <span class="keyword">const</span> childNode = <span class="keyword">new</span> Node(d, changeType(<span class="built_in">this</span>.type), <span class="built_in">this</span>.depth + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// é€’å½’è·å–å…¶åˆ†æ•°</span></span><br><span class="line">            <span class="keyword">const</span> childScore = childNode.score();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (childScore &gt; maxScore) &#123;</span><br><span class="line">                maxScore = childScore;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> maxScore;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹äº min èŠ‚ç‚¹ï¼Œè¿”å›çš„æ˜¯å­èŠ‚ç‚¹ä¸­çš„æœ€å°å€¼</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.type === <span class="string">&#x27;min&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// ä¸ä¸Šæ–¹ä»£ç ç›¸ä¼¼ï¼Œçœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/noiron/tic-tac-toe-js/blob/master/algorithms/minimax.js">å®Œæ•´çš„ minimax ç®—æ³•ä»£ç </a> </p></blockquote><h2 id="Alpha-beta-å‰ªæç®—æ³•ç®€ä»‹"><a href="#Alpha-beta-å‰ªæç®—æ³•ç®€ä»‹" class="headerlink" title="Alpha-beta å‰ªæç®—æ³•ç®€ä»‹"></a>Alpha-beta å‰ªæç®—æ³•ç®€ä»‹</h2><p>Alpha-beta å‰ªæç®—æ³•å¯ä»¥è®¤ä¸ºæ˜¯ minimax ç®—æ³•çš„ä¸€ç§æ”¹è¿›ï¼Œåœ¨å®é™…çš„é—®é¢˜ä¸­ï¼Œéœ€è¦æœç´¢çš„çŠ¶æ€æ•°é‡å°†ä¼šéå¸¸åºå¤§ï¼Œåˆ©ç”¨ alpha-beta å‰ªæç®—æ³•å¯ä»¥å»é™¤ä¸€äº›ä¸å¿…è¦çš„æœç´¢ã€‚</p><p>å…³äº alpha-beta ç®—æ³•çš„å…·ä½“è§£é‡Šå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  <a href="http://web.cs.ucla.edu/~rosen/161/notes/alphabeta.html">Minimax with Alpha Beta Pruning</a>ã€‚æˆ‘ä»¬åœ¨å‰æ–‡ä¸­è€ƒè™‘çš„é‚£å¼ å›¾å°±æ¥è‡ªè¿™ç¯‡æ–‡ç« ï¼Œä¹‹åæˆ‘ä»¬ä¼šç”¨ alpha-beta å‰ªæç®—æ³•æ¥æ”¹è¿›ä¹‹å‰çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å‰ªæç®—æ³•ä¸­ä¸»è¦æœ‰è¿™ä¹ˆäº›æ¦‚å¿µï¼š</p><p>æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šç”± alpha å’Œ beta ä¸¤ä¸ªå€¼æ¥ç¡®å®šä¸€ä¸ªèŒƒå›´ [alpha, beta]ï¼Œalpha å€¼ä»£è¡¨çš„æ˜¯ä¸‹ç•Œï¼Œbeta ä»£è¡¨çš„æ˜¯ä¸Šç•Œã€‚æ¯æœç´¢ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œéƒ½ä¼šæŒ‰è§„åˆ™å¯¹èŒƒå›´è¿›è¡Œä¿®æ­£ã€‚</p><p>Max èŠ‚ç‚¹å¯ä»¥ä¿®æ”¹ alpha å€¼ï¼Œmin èŠ‚ç‚¹ä¿®æ”¹ beta å€¼ã€‚</p><p>å¦‚æœå‡ºç°äº† beta &lt;= alpha çš„æƒ…å†µï¼Œåˆ™ä¸ç”¨æœç´¢æ›´å¤šçš„å­æ ‘äº†ï¼Œæœªæœç´¢çš„è¿™éƒ¨åˆ†å­æ ‘å°†è¢«å¿½ç•¥ï¼Œè¿™ä¸ªæ“ä½œå°±è¢«ç§°ä½œ<strong>å‰ªæï¼ˆpruningï¼‰</strong>ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä¼šå°½é‡è¯´æ˜ä¸ºä»€ä¹ˆå‰ªæè¿™ä¸ªæ“ä½œæ˜¯åˆç†çš„ï¼Œçœç•¥äº†ä¸€éƒ¨åˆ†èŠ‚ç‚¹ä¸ºä»€ä¹ˆä¸ä¼šå¯¹ç»“æœäº§ç”Ÿå½±å“ã€‚ç”¨åŸå›¾ä¸­ä»¥4å·èŠ‚ç‚¹ï¼ˆç¬¬ä¸‰å±‚çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘æ¥ä¸¾ä¾‹ï¼Œæ–¹ä¾¿æè¿°è¿™é‡Œå°†ä»–ä»¬ç”¨ A - G çš„å­—æ¯æ¥é‡æ–°æ ‡è®°ã€‚</p><p><img src="/asset/images/2018-03-04-subtree.png" alt="å­æ ‘"></p><p>ä» B èŠ‚ç‚¹çœ‹èµ·ï¼ŒB æ˜¯ min èŠ‚ç‚¹ï¼Œéœ€è¦åœ¨ D å’Œ E ä¸­å¯»æ‰¾è¾ƒå°å€¼ï¼Œå› æ­¤ B å–å€¼ä¸º3ï¼ŒåŒæ—¶ B çš„ beta å€¼ä¹Ÿè®¾ç½®ä¸º 3ã€‚å‡è®¾ B è¿˜æœ‰æ›´å¤šå€¼å¤§äº3çš„å­èŠ‚ç‚¹ï¼Œä½†å› ä¸ºå·²ç»å‡ºç°äº† D è¿™ä¸ªæœ€å°å€¼ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ B äº§ç”Ÿå½±å“ï¼Œå³è¿™é‡Œçš„ beta = 3 ç¡®å®šäº†ä¸€ä¸ªä¸Šç•Œã€‚</p><p>A æ˜¯ max èŠ‚ç‚¹ï¼Œéœ€è¦åœ¨ B å’Œ C ä¸­æ‰¾åˆ°è¾ƒå¤§å€¼ï¼Œå› ä¸ºå­æ ‘ B å·²ç»æœç´¢å®Œæ¯•ï¼ŒB çš„å€¼ç¡®å®šä¸º 3ï¼Œæ‰€ä»¥ A çš„å€¼è‡³å°‘ä¸º 3ï¼Œè¿™æ ·ç¡®å®šäº† A çš„ä¸‹ç•Œ alpha = 3ã€‚åœ¨æœç´¢ C å­æ ‘ä¹‹å‰ï¼Œæˆ‘ä»¬<strong>å¸Œæœ› C çš„å€¼å¤§äº3</strong>ï¼Œè¿™æ ·æ‰ä¼šå¯¹ A çš„ä¸‹ç•Œ alpha äº§ç”Ÿå½±å“ã€‚äºæ˜¯ C ä» A è¿™é‡Œè·å¾—äº†ä¸‹ç•Œ alpha = 3 è¿™ä¸ªé™åˆ¶æ¡ä»¶ã€‚</p><p>C æ˜¯ min èŠ‚ç‚¹ï¼Œè¦ä» F å’Œ G é‡Œæ‰¾å‡ºè¾ƒå°å€¼ã€‚F çš„å€¼ä¸º2ï¼Œæ‰€ä»¥ C çš„å€¼ä¸€å®šå°äºç­‰äº 2ï¼Œæ›´æ–° C çš„ä¸Šç•Œ beta = 2ã€‚æ­¤æ—¶ C çš„ alpha = 3, beta = 2ï¼Œè¿™æ˜¯ä¸€ä¸ªç©ºåŒºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´å³ä½¿ç»§ç»­è€ƒè™‘ C çš„å…¶å®ƒå­èŠ‚ç‚¹ï¼Œ ä¹Ÿ<strong>ä¸å¯èƒ½è®© C çš„å€¼å¤§äº 3</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¿…å†è€ƒè™‘ G èŠ‚ç‚¹ã€‚G èŠ‚ç‚¹å°±æ˜¯è¢«å‰ªæçš„èŠ‚ç‚¹ã€‚</p><p>é‡å¤è¿™æ ·çš„è¿‡ç¨‹ï¼Œä¼šæœ‰æ›´å¤šçš„èŠ‚ç‚¹å› ä¸ºå‰ªææ“ä½œè¢«å¿½ç•¥ï¼Œä»è€Œå¯¹ minimax ç®—æ³•è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><h2 id="Alpha-beta-å‰ªæç®—æ³•çš„å®ç°"><a href="#Alpha-beta-å‰ªæç®—æ³•çš„å®ç°" class="headerlink" title="Alpha-beta å‰ªæç®—æ³•çš„å®ç°"></a>Alpha-beta å‰ªæç®—æ³•çš„å®ç°</h2><p>æ¥ä¸‹æ¥è®¨è®ºå¦‚ä½•ä¿®æ”¹å‰é¢å®ç°çš„ minimax ç®—æ³•ï¼Œä½¿å…¶å˜ä¸º alpha-beta å‰ªæç®—æ³•ã€‚</p><p>ç¬¬ä¸€æ­¥åœ¨ constructor ä¸­åŠ å…¥ä¸¤ä¸ªæ–°å±æ€§ï¼Œalphaã€betaã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">data, type, depth, alpha, beta</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = data;</span><br><span class="line">    <span class="built_in">this</span>.type = type; <span class="comment">// åŒºåˆ†æ­¤èŠ‚ç‚¹çš„ç§ç±»æ˜¯ max æˆ– min</span></span><br><span class="line">    <span class="built_in">this</span>.depth = depth;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.alpha = alpha || -<span class="literal">Infinity</span>;</span><br><span class="line">    <span class="built_in">this</span>.beta = beta || <span class="literal">Infinity</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ¯æ¬¡éƒ½æœç´¢ä¼šè§†æƒ…å†µæ›´æ–° alpha, beta çš„å€¼ï¼Œä»¥ä¸‹çš„ä»£ç ç‰‡æ®µæ¥è‡ªäºæœç´¢ max èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// alphabeta.js ä¸­çš„ score() å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.data.length; i++) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (childScore &gt; maxScore) &#123;</span><br><span class="line">        maxScore = childScore;</span><br><span class="line">        <span class="comment">// ç›¸å¯¹äº minimax ç®—æ³•ï¼Œalpha-beta å‰ªæç®—æ³•åœ¨è¿™é‡Œå¢åŠ äº†ä¸€ä¸ªæ›´æ–° alpha å€¼çš„æ“ä½œ</span></span><br><span class="line">        <span class="built_in">this</span>.alpha = maxScore;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ»¡è¶³äº†é€€å‡ºçš„æ¡ä»¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç»§ç»­æœç´¢æ›´å¤šçš„èŠ‚ç‚¹äº†ï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.alpha &gt;= <span class="built_in">this</span>.beta) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç›¸å¯¹åº”çš„æ˜¯åœ¨ min èŠ‚ç‚¹ä¸­ï¼Œæˆ‘ä»¬æ›´æ–°çš„å°†æ˜¯ beta å€¼ã€‚å¥½äº†ï¼Œåªéœ€è¦åšè¿™ä¹ˆäº›ç®€å•çš„æ”¹å˜ï¼Œå°±å°† minimax ç®—æ³•æ”¹å˜æˆäº† alpha-beta å‰ªæç®—æ³•äº†ã€‚</p><p>æœ€åçœ‹çœ‹å¦‚ä½•å°†ç®—æ³•åº”ç”¨åˆ° tic-tac-toe æ¸¸æˆä¸­ã€‚</p><blockquote><p><a href="https://github.com/noiron/tic-tac-toe-js/blob/master/algorithms/alphabeta.js">å®Œæ•´çš„ alpha-beta å‰ªæç®—æ³•ä»£ç </a> </p></blockquote><h2 id="Tic-tac-toe-æ¸¸æˆä¸­çš„åº”ç”¨"><a href="#Tic-tac-toe-æ¸¸æˆä¸­çš„åº”ç”¨" class="headerlink" title="Tic-tac-toe æ¸¸æˆä¸­çš„åº”ç”¨"></a>Tic-tac-toe æ¸¸æˆä¸­çš„åº”ç”¨</h2><p>Tic-tac-toeï¼Œå³äº•å­—æ£‹æ¸¸æˆï¼Œè§„åˆ™æ˜¯åœ¨åŒæ–¹è½®æµåœ¨ 3x3 çš„æ£‹ç›˜ä¸Šçš„ä»»æ„ä½ç½®ä¸‹å­ï¼Œç‡å…ˆå°†ä¸‰å­è¿æˆä¸€çº¿çš„ä¸€æ–¹è·èƒœã€‚</p><p>è¿™å°±æ˜¯ä¸€ä¸ªéå¸¸é€‚åˆç”¨ minimax æ¥è§£å†³çš„é—®é¢˜ï¼Œå³ä½¿åœ¨ä¸è€ƒè™‘å¯¹ç§°çš„æƒ…å†µï¼Œæ‰€æœ‰çš„æ¸¸æˆçŠ¶æ€ä¹Ÿåªæœ‰ 9! = 362880 ç§ï¼Œç›¸æ¯”äºå…¶å®ƒæ£‹ç±»æ¸¸æˆå¤©æ–‡æ•°å­—èˆ¬çš„çŠ¶æ€æ•°é‡å·²ç»å¾ˆå°‘äº†ï¼Œå› è€Œå¾ˆé€‚åˆä½œä¸ºç®—æ³•çš„ç¤ºä¾‹ã€‚</p><p>æˆ‘åœ¨ä»£ç ä¸­å°†æ£‹ç›˜çš„çŠ¶æ€ç”¨ä¸€ä¸ªé•¿åº¦ä¸º9çš„æ•°ç»„æ¥è¡¨ç¤ºï¼Œç„¶ååˆ©ç”¨ canvas ç»˜åˆ¶å‡ºä¸€ä¸ªç®€æ˜“çš„æ£‹ç›˜ï¼Œä¸‹å­çš„è¿‡ç¨‹å°±æ˜¯ä¿®æ”¹æ•°ç»„çš„å¯¹åº”ä½ç½®ç„¶åé‡ç»˜ç”»é¢ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ç°æˆçš„ minimax å’Œ alpha-beta å‰ªæç®—æ³•ï¼Œåªè¦åŠ ä¸Šä¸€ç‚¹å„¿ç»†èŠ‚å°±èƒ½å®Œæˆè¿™ä¸ªæ¸¸æˆäº†ğŸ˜€ã€‚</p><p>å…ˆæ¥å®šä¹‰ä¸€ä¸ª <code>GameState</code> ç±»ï¼Œå…¶ä¸­ä¿å­˜äº†æ¸¸æˆçš„çŠ¶æ€ï¼Œå¯¹åº”äºä¹‹å‰åˆ†æè¿‡ç¨‹ä¸­çš„èŠ‚ç‚¹ï¼Œå…¶ <code>constructor</code> å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params">board, player, depth, alpha, beta</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.board = board;</span><br><span class="line">    <span class="comment">// player æ˜¯ç”¨å­—ç¬¦ X å’Œ O æ¥æ ‡è®°å½“å‰ç”±è°ä¸‹å­ï¼Œä»¥æ­¤æ¥åˆ¤æ–­å½“å‰æ˜¯ max è¿˜æ˜¯ min èŠ‚ç‚¹</span></span><br><span class="line">    <span class="built_in">this</span>.playerTurn = player;</span><br><span class="line">    <span class="built_in">this</span>.depth = depth;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜åˆ†æ•°æœ€é«˜æˆ–æœ€ä½çš„çŠ¶æ€ï¼Œç”¨äºç¡®å®šä¸‹ä¸€æ­¥çš„æ£‹ç›˜çŠ¶æ€</span></span><br><span class="line">    <span class="built_in">this</span>.choosenState = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">this</span>.alpha = alpha || -<span class="literal">Infinity</span>;</span><br><span class="line">    <span class="built_in">this</span>.beta = beta || <span class="literal">Infinity</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºè¿›è¡Œæ¸¸æˆï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ª <code>checkFinish</code> å‡½æ•°ï¼Œæ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸï¼Œç»“æŸæ—¶è¿”å›èƒœåˆ©è€…ä¿¡æ¯ã€‚æœç´¢çš„è¿‡ç¨‹æ˜¯åœ¨ <code>getScore</code> å‡½æ•°ä¸­å®Œæˆçš„ï¼Œæ¯æ¬¡æœç´¢å…ˆæ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸï¼Œå¹³å±€è¿”å›é›¶åˆ†ï¼Œæˆ‘ä»¬çš„ç®—æ³•æ˜¯ç«™åœ¨ AI çš„è§’åº¦æ¥è€ƒè™‘çš„ï¼Œå› æ­¤ AI èƒœåˆ©æ—¶è¿”å›10åˆ†ï¼ŒAI å¤±åˆ©æ—¶è¿”å›-10åˆ†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// alphabeta.js ä¸­çš„ getScore() æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> winner = <span class="built_in">this</span>.checkFinish();</span><br><span class="line"><span class="keyword">if</span> (winner) &#123;</span><br><span class="line">    <span class="keyword">if</span> (winner === <span class="string">&#x27;draw&#x27;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (winner === aiToken) <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æ˜¯å¯¹ max å’Œ min èŠ‚ç‚¹çš„åˆ†ç±»å¤„ç†ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// alphabeta.js ä¸­çš„ getScore() æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å¾—æ‰€æœ‰å¯èƒ½çš„ä½ç½®ï¼Œåˆ©ç”¨ shuffle åŠ å…¥éšæœºæ€§</span></span><br><span class="line"><span class="keyword">const</span> availablePos = _.shuffle(<span class="built_in">this</span>.getAvailablePos());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹äº max èŠ‚ç‚¹ï¼Œè¿”å›çš„æ˜¯å­èŠ‚ç‚¹ä¸­çš„æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.playerTurn === aiToken) &#123;</span><br><span class="line">    <span class="keyword">let</span> maxScore = -<span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">let</span> maxIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; availablePos.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> pos = availablePos[i];</span><br><span class="line">        <span class="comment">// åœ¨ç»™å®šçš„ä½ç½®ä¸‹å­ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„æ£‹ç›˜</span></span><br><span class="line">        <span class="keyword">const</span> newBoard = <span class="built_in">this</span>.generateNewBoard(pos, <span class="built_in">this</span>.playerTurn);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”Ÿæˆä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">const</span> childState = <span class="keyword">new</span> GameState(newBoard, changeTurn(<span class="built_in">this</span>.playerTurn), <span class="built_in">this</span>.depth + <span class="number">1</span>, <span class="built_in">this</span>.alpha, <span class="built_in">this</span>.beta);</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¼€å§‹é€’å½’è°ƒç”¨ getScore() å‡½æ•°</span></span><br><span class="line">        <span class="keyword">const</span> childScore = childState.getScore();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (childScore &gt; maxScore) &#123;</span><br><span class="line">            maxScore = childScore;</span><br><span class="line">            maxIndex = i;</span><br><span class="line">            <span class="comment">// è¿™é‡Œä¿å­˜äº§ç”Ÿäº†æœ€å¤§çš„åˆ†æ•°çš„èŠ‚ç‚¹ï¼Œä¹‹åä¼šè¢«ç”¨äºè¿›è¡Œä¸‹ä¸€æ­¥</span></span><br><span class="line">            <span class="built_in">this</span>.choosenState = childState;</span><br><span class="line">            <span class="built_in">this</span>.alpha = maxScore;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.alpha &gt;= <span class="built_in">this</span>.beta) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> maxScore;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// min èŠ‚ç‚¹çš„å¤„ç†ä¸ä¸Šé¢ç±»ä¼¼</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç è§<a href="https://github.com/noiron/tic-tac-toe-js/blob/master/src/alphabeta.js">alphabeta.js</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ ·å°±ç®€å•åœ°ä»‹ç»äº† minimax ç®—æ³•å’Œ alpha-beta ç®—æ³•ï¼Œå¹¶åˆ†åˆ«ç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„å®ç°ï¼Œç„¶ååœ¨ tic-tac-toe æ¸¸æˆä¸­åº”ç”¨äº†ç®—æ³•ã€‚</p><p>æ–‡ç« ä¸­æ‰€æåˆ°çš„æ‰€æœ‰ä»£ç å¯è§æ­¤é¡¹ç›®ï¼š<a href="https://github.com/noiron/tic-tac-toe-js">Tic-tac-toe-js</a>ã€‚å…¶ä¸­çš„ <code>algorithms</code> æ–‡ä»¶å¤¹ä¸­æ˜¯ä¸¤ç§ç®—æ³•çš„ç®€å•å®ç°ï¼Œ<code>src</code> æ–‡ä»¶ä¸­æ˜¯æ¸¸æˆçš„ä»£ç ã€‚</p><p>æ–‡ç« å¼€å¤´è¯´åˆ°äº†è¿™ç¯‡æ–‡ç« èµ·æºäºå†™2048æ¸¸æˆé¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œä¹‹åæˆ‘å°† minimax ç®—æ³•åº”ç”¨åˆ°äº†2048æ¸¸æˆçš„ AI ä¸­ï¼Œä¸è¿‡å¯¹äºå±€é¢çš„è¯„ä¼°å‡½æ•°å°šä¸å®Œå–„ï¼Œç°åœ¨ AI åªèƒ½å‹‰å¼ºåˆæˆ1024ğŸ˜¢ï¼Œ è¿˜æœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ã€‚ </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰æ®µæ—¶é—´ç”¨ React å†™äº†ä¸ª&lt;a href=&quot;https://github.com/noiron/react-2048&quot;&gt;2048 æ¸¸æˆ&lt;/a&gt;æ¥ç»ƒç»ƒæ‰‹ï¼Œå‡†å¤‡ç”¨æ¥å›é¡¾ä¸‹ React ç›¸å…³çš„å„ç§æŠ€æœ¯ï¼Œä»¥åŠè¯•éªŒä¸€ä¸‹æ–°æŠ€æœ¯ã€‚åœ¨å†™è¿™ä¸ª2048çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è€ƒè™‘æ˜¯å¦å¯ä»¥åœ¨å…¶ä¸­åŠ å…¥ä¸€ä¸ª AI ç®—æ³•æ¥è‡ªåŠ¨è¿›è¡Œæ¸¸æˆï¼Œäºæ˜¯æˆ‘æ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;http://blog.codinglabs.org/articles/2048-ai-analysis.html&quot;&gt;2048-AIç¨‹åºç®—æ³•åˆ†æ&lt;/a&gt;ï¼Œæ–‡ä¸­ä»‹ç»äº† minimax ç®—æ³•å’Œ alpha-beta å‰ªæç®—æ³•ã€‚äºæ˜¯æˆ‘å†³å®šå…ˆå­¦ä¹ ä¸‹è¿™ä¸¤ç§ç®—æ³•ï¼Œå¹¶ä»¥æ­¤å†™äº†è¿™ä¸ª tic-tac-toe æ¸¸æˆï¼š&lt;a href=&quot;https://tic-tac-toe-js-app.herokuapp.com/&quot;&gt;tic-tac-toe-js&lt;/a&gt;ï¼ˆ&lt;a href=&quot;https://github.com/noiron/tic-tac-toe-js&quot;&gt;ä»£ç è§æ­¤å¤„&lt;/a&gt;ï¼‰ã€‚æœ¬æ–‡å°†è¯´æ˜å¦‚ä½•ç”¨ JavaScript æ¥ç®€å•åœ°å®ç°ç®—æ³•ï¼Œå¹¶å°†å…¶è¿ç”¨åˆ° tic-tac-toe æ¸¸æˆä¸­ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.wukai.me/tags/javascript/"/>
    
      <category term="minimax" scheme="http://www.wukai.me/tags/minimax/"/>
    
      <category term="alpha-beta pruning" scheme="http://www.wukai.me/tags/alpha-beta-pruning/"/>
    
      <category term="æ¸¸æˆ" scheme="http://www.wukai.me/tags/%E6%B8%B8%E6%88%8F/"/>
    
      <category term="ç®—æ³•" scheme="http://www.wukai.me/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>2017å¹´æ€»ç»“</title>
    <link href="http://www.wukai.me/2018/01/01/2017-annual-summary/"/>
    <id>http://www.wukai.me/2018/01/01/2017-annual-summary/</id>
    <published>2017-12-31T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.546Z</updated>
    
    <content type="html"><![CDATA[<p>æ´»äº†äºŒåå¤šå¹´ï¼Œä»æ¥æ²¡æœ‰åšè¿‡å¹´ç»ˆæ€»ç»“ï¼Œä½†å¹´å²æ¸é•¿ï¼Œæ€»è§‰å¾—æœ‰ç‚¹æ—¶é—´çš„å‹åŠ›ï¼Œåº”è¯¥è®°å½•ç‚¹ä»€ä¹ˆï¼Œå°±è®©2017å¹´çš„æ€»ç»“ä½œä¸ºç¬¬ä¸€æ¬¡ã€‚</p><span id="more"></span><h2 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h2><p>æŠ€æœ¯æ–¹é¢ï¼Œç»§ç»­å†™äº†ä¸€å¹´çš„ Reactï¼Œè¿˜è¯•ç€ç”¨äº†ä¸‹ Vueï¼Œå­¦äº†è®¸å¤šå‰ç«¯åº“ï¼Œä½†æ˜¯å´æ²¡æœ‰ä»€ä¹ˆå®Œæ•´çš„é¡¹ç›®ã€‚</p><p>å†™äº†ä¸€ä¸ªå¡”é˜²æ¸¸æˆï¼Œå¾…æ”¹çš„ Bug æ¯”å¾…å®ç°çš„ feature å¤šï¼Œç­‰ç€ 2018 ç»§ç»­å®Œå–„ã€‚</p><p>åœ¨ Coursera ä¸Šå¬äº†ç®—æ³•è¯¾ï¼Œæœ€åä¸€å‘¨çš„ä½œä¸šæ²¡äº¤ï¼Œæ‰€ä»¥è¯¾ç¨‹ä¹Ÿæ²¡å®Œæˆã€‚</p><p>éå‰ç«¯çš„æŠ€æœ¯æ–¹é¢ï¼Œçœ‹äº†æœ¬ã€ŠCç¨‹åºè®¾è®¡è¯­è¨€ã€‹ï¼Œã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹åªçœ‹åˆ°ç¬¬äºŒç« ï¼Œã€ŠAlgorithmsã€‹ä¹Ÿä¾æ—§æ²¡çœ‹å®Œã€‚é‡æ–°å¼€å§‹å­¦ä¹ çº¿æ€§ä»£æ•°äº†ã€‚</p><p>å‰ç«¯çš„ä¹¦ä¹Ÿæ²¡çœ‹å¤šå°‘ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½åœ¨ç½‘ä¸Šçœ‹èµ„æ–™ã€‚è®°å¾—çš„ä¹¦åªæœ‰ã€Šä½ ä¸çŸ¥é“çš„ JavaScriptï¼ˆä¸Šï¼‰ã€‹å’Œã€Šæ·±å…¥ç†è§£ ES6ã€‹ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒæŠ€æœ¯æ°´å¹³æ¯”èµ·2016å¹´æœ‰ä¸€ç‚¹é•¿è¿›ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé‡åŒ–çš„æŒ‡æ ‡ï¼Œåªæ˜¯ JavaScript å†™çš„æ›´ç†Ÿç»ƒäº†ã€‚å”¯ä¸€æœ‰æ‰€è®°å½•çš„æ˜¯2017å¹´åœ¨è¿™é‡Œå†™äº†7ç¯‡åšå®¢ï¼Œæ— è®ºè´¨é‡å¦‚ä½•ï¼ŒèŠèƒœäºæ— ã€‚</p><h2 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h2><p>è¯»ä¹¦æ–¹é¢ï¼Œå› ä¸ºä»æ¥ä¸ä¼šå»æ•°è‡ªå·±è¯»äº†å¤šå°‘æœ¬ã€‚åªèƒ½å»ç¿»ç¿»è®¢å•è®°å½•å’Œåœ¨è±†ç“£ä¸Šçš„æ ‡è®°ï¼Œé™¤å»æŠ€æœ¯ç±»çš„ä¹¦ç±å¤–ï¼Œçœ‹äº†ä»¥ä¸‹ä¹¦ç±ï¼š</p><ul><li>ç§‘å¹»ä¹¦ç±ï¼šã€Šç›²è§†ã€‹ã€Šè®©æ—¶é—´åœæ­¢çš„å¥³å­©ã€‹ã€ŠåŸºåœ°ç³»åˆ—ä¸ƒéƒ¨æ›²ã€‹ï¼ˆè¡¥ä¸Šäº†åé¢å‡ æœ¬ï¼‰</li><li>ä¸‰æœ¬æ‘ä¸Šæ˜¥æ ‘ï¼šã€Šæ²¡æœ‰è‰²å½©çš„å¤šå´ä½œå’Œä»–çš„å·¡ç¤¼ä¹‹å¹´ã€‹ã€Šå¥‡é¸Ÿå½¢çŠ¶å½•ã€‹ã€Šä¸œäº¬å¥‡è°­é›†ã€‹</li><li>ä¸‰æœ¬ä¼Šå‚å¹¸å¤ªéƒï¼šã€Šæ‘©ç™»æ—¶ä»£ã€‹ã€Šé­”ç‹ã€‹ã€Šæ­»ç¥çš„ç²¾ç¡®åº¦ã€‹</li><li>å¤é¾™çš„ã€Šå°æé£åˆ€ï¼šå¤šæƒ…å‰‘å®¢æ— æƒ…å‰‘ã€‹å’Œã€Šæ¬¢ä¹è‹±é›„ã€‹</li><li>è‹ç«¥çš„ã€Šæ­¦åˆ™å¤©ã€‹</li><li>è«è¨€çš„ã€Šæª€é¦™åˆ‘ã€‹</li><li>é©¬å°”å…‹æ–¯çš„ã€Šä¸€æ¡©äº‹å…ˆå¼ æ‰¬çš„å‡¶æ€æ¡ˆã€‹</li><li>ç‡•å’ç”Ÿçš„ã€Šå¤©è¡Œå¥ã€‹å…¨é›†</li><li>ç½—æ–¯Â·ç‰¹é‡Œå°”çš„ã€Šæ¯›æ³½ä¸œä¼ ã€‹</li><li>æ¨ç»›çš„ã€Šæˆ‘ä»¬ä»¨ã€‹</li><li>ã€Šäº®å‰‘ã€‹</li><li>ã€Šé˜¿åŸç²¾é€‰é›†ã€‹</li><li>ã€Šæ˜“ä¸­å¤©ä¸­åå²ã€‹éƒ¨åˆ†<br>å¤§æ¦‚å°±è¿™äº›ä¹¦äº†å§ï¼Œè¿˜æœ‰ä¸€æœ¬å“²å­¦ä¹¦ã€Šå¤§é—®é¢˜ã€‹å°šæœªç¿»å®Œã€‚</li></ul><p>æƒ³çœ‹è‹±è¯­åŸç‰ˆä¹¦æ¥ç€ï¼Œä¸è¿‡è¿˜æ²¡æ‰¾åˆ°ä»€ä¹ˆæ„Ÿå…´è¶£çš„ï¼Œäºæ˜¯åˆå»çœ‹å“ˆåˆ©æ³¢ç‰¹äº†ï¼š</p><ul><li>Holes</li><li>Hyperion ï¼ˆåŠæœ¬ï¼‰</li><li>Harry Potter and the Sorcererâ€™s Stone</li><li>Harry Potter and the Chamber of Secrets</li><li>Harry Potter and the Prisoner of Azkaban</li><li>Harry Potter and the Goblet of Fire ï¼ˆç›®å‰ä¸ºæ­¢çœ‹äº†46%ï¼‰</li></ul><h2 id="ç”µå½±"><a href="#ç”µå½±" class="headerlink" title="ç”µå½±"></a>ç”µå½±</h2><p>17å¹´å»ç”µå½±é™¢çœ‹äº†12éƒ¨ç”µå½±ï¼Œä»¥ã€Šé™ä¸´ã€‹ä¸ºå§‹ï¼Œä»¥ã€Šå¦–çŒ«ä¼ ã€‹ä¸ºç»ˆï¼Œå…¶å®ƒç”µå½±ä¸æä¹Ÿç½¢ã€‚è‡³äºå„ç§ä¹±ä¸ƒå…«ç³Ÿçš„ç¾å‰§ã€è‹±å‰§ã€æ—¥å‰§ï¼Œçœ‹äº†å°±å¿˜ï¼Œæ²¡æœ‰è®°å½•ã€‚</p><h2 id="é”»ç‚¼"><a href="#é”»ç‚¼" class="headerlink" title="é”»ç‚¼"></a>é”»ç‚¼</h2><p>17å¹´æ¯æ¬¡è·‘æ­¥å‡ ä¹éƒ½ç”¨æ‚¦è·‘åœˆåšäº†è®°å½•ï¼Œæ€»çš„æ¬¡æ•°æ˜¯43æ¬¡ï¼Œä¸€å…±377å…¬é‡Œï¼Œå·®ä¸å¤šä¸€å¤©ä¸€å…¬é‡Œã€‚</p><h2 id="å…¶å®ƒçš„æŠ€èƒ½"><a href="#å…¶å®ƒçš„æŠ€èƒ½" class="headerlink" title="å…¶å®ƒçš„æŠ€èƒ½"></a>å…¶å®ƒçš„æŠ€èƒ½</h2><p>ä¸ŠåŠå¹´ä¹°äº†æ—¥è¯­çš„æ•™æï¼Œåˆä¸€æ¬¡åœåœ¨äº†äº”åéŸ³å›¾ã€‚</p><p>ä¸‹åŠå¹´ä¹°äº†æŠŠå‰ä»–ï¼Œè¿˜åœ¨ç»ƒä¹ ä¸­ï¼Œä¹Ÿè®¸åº”è¯¥å¿«è¦å…¥é—¨äº†å§ã€‚</p><hr><p>2017å¹´å¤§æ¦‚å°±åšäº†è¿™äº›äº‹å§ã€‚æœ€åï¼Œæ–°çš„ä¸€å¹´å·²ç»æ¥äº†ï¼Œä¾æ—§æ˜¯å•èº«ç‹—ï¼Œæ²¡æœ‰å˜ç§ƒï¼Œä¹Ÿæ²¡æœ‰å˜å¼ºã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ´»äº†äºŒåå¤šå¹´ï¼Œä»æ¥æ²¡æœ‰åšè¿‡å¹´ç»ˆæ€»ç»“ï¼Œä½†å¹´å²æ¸é•¿ï¼Œæ€»è§‰å¾—æœ‰ç‚¹æ—¶é—´çš„å‹åŠ›ï¼Œåº”è¯¥è®°å½•ç‚¹ä»€ä¹ˆï¼Œå°±è®©2017å¹´çš„æ€»ç»“ä½œä¸ºç¬¬ä¸€æ¬¡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="å¹´åº¦æ€»ç»“" scheme="http://www.wukai.me/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä¸åˆ°200è¡Œ JavaScript ä»£ç å¦‚ä½•å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</title>
    <link href="http://www.wukai.me/2017/12/31/rich-text-editor-in-less-than-200-lines-javascript/"/>
    <id>http://www.wukai.me/2017/12/31/rich-text-editor-in-less-than-200-lines-javascript/</id>
    <published>2017-12-30T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.546Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´åœ¨å¯»æ‰¾ä¸€äº›å…³äºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„èµ„æ–™ï¼Œç„¶åå‘ç°äº†è¿™ä¸ªåä¸º <a href="https://github.com/jaredreich/pell">Pell</a> çš„é¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ‰€è§å³æ‰€å¾—ï¼ˆWYSIWYGï¼‰çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè™½ç„¶å®ƒçš„åŠŸèƒ½å¾ˆç®€å•ï¼Œä½†æ˜¯ä»¤äººåƒæƒŠçš„æ˜¯å®ƒåªæœ‰ 1kb å¤§å°ã€‚è€Œé¡¹ç›®æœ€æ ¸å¿ƒçš„æ–‡ä»¶ <a href="https://github.com/jaredreich/pell/blob/master/src/pell.js">pell.js</a> åªæœ‰130è¡Œï¼Œå³ä½¿åŠ ä¸Šå…¶å®ƒéƒ¨åˆ†ï¼Œæ€»çš„ js æ•°é‡ä¹Ÿä¸åˆ°200è¡Œã€‚è¿™å¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œå†³å®šçœ‹çœ‹å®ƒçš„æºç æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚</p><span id="more"></span><p>é¡¹ç›®çš„ä¸»è¦ä»£ç åœ¨ <code>pell.js</code> æ–‡ä»¶ä¸­ï¼Œå…¶ç»“æ„å¾ˆç®€å•ï¼Œä¸»è¦åŠŸèƒ½çš„å®ç°ä¾èµ–äºä»¥ä¸‹çš„å‡ ä¸ªéƒ¨åˆ†</p><ul><li><code>actions</code> å¯¹è±¡</li><li><code>exec()</code> å‡½æ•°</li><li><code>init()</code> å‡½æ•°</li></ul><h2 id="Document-execCommand"><a href="#Document-execCommand" class="headerlink" title="Document.execCommand()"></a>Document.execCommand()</h2><p>å…ˆä»æœ€ç®€å•çš„éƒ¨åˆ†çœ‹èµ·ï¼Œ <code>exec()</code> å‡½æ•°åªæœ‰ä¸‹é¢ä¸‰è¡Œï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> exec = <span class="function">(<span class="params">command, value = <span class="literal">null</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.execCommand(command, <span class="literal">false</span>, value);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®ƒå°† <code>document.execCommand()</code> è¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„åŒ…è£…ï¼Œ<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand">Document.execCommand()</a> å°±æ˜¯è¿™ä¸ªç¼–è¾‘å™¨çš„æ ¸å¿ƒï¼Œå…¶è¯­æ³•å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool = <span class="built_in">document</span>.execCommand(aCommandName, aShowDefaultUI, aValueArgument)</span><br></pre></td></tr></table></figure><ul><li><code>aCommandName</code> æ˜¯è¡¨ç¤ºæƒ³æ‰§è¡Œçš„å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼šåŠ ç²— â€˜boldâ€™ï¼Œåˆ›å»ºé“¾æ¥ â€˜createLinkâ€™ï¼Œæ”¹å˜å­—ä½“å¤§å° â€˜fontSizeâ€™ ç­‰ç­‰</li><li><code>aShowDefaultUI</code> æ˜¯å¦æ˜¾ç¤ºé»˜è®¤çš„ç”¨æˆ·ç•Œé¢</li><li><code>aValueArgument</code> æœ‰äº›å‘½ä»¤éœ€è¦é¢å¤–çš„è¾“å…¥ï¼Œå¦‚æ’å…¥å›¾ç‰‡ã€é“¾æ¥æ—¶éœ€è¦ç»™å‡ºåœ°å€</li></ul><p>æ³¨ï¼šç»è¿‡æˆ‘çš„è¯•éªŒï¼Œåœ¨ Chrome ä¸‹æ”¹å˜ aShowDefaultUI çš„å€¼å¹¶æœªå‘ç°å½±å“ï¼Œ<a href="https://stackoverflow.com/questions/38188015/what-is-the-the-default-user-interface-referred-to-by-the-ashowdefaultui-param">è¿™ä¸ª stackoverflow çš„é—®é¢˜</a>ä¸­æåˆ°è¿™æ˜¯ä¸€ä¸ªæ¥è‡ªäºæ—§ç‰ˆ IE çš„å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºé»˜è®¤çš„ false å³å¯ã€‚</p><h2 id="actions-å¯¹è±¡"><a href="#actions-å¯¹è±¡" class="headerlink" title="actions å¯¹è±¡"></a>actions å¯¹è±¡</h2><p>æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>actions</code> çš„å¯¹è±¡ï¼Œå¯¹åº”çš„æ˜¯ä¸‹å›¾å·¥å…·æ ä¸Šçš„è¿™ä¸€è¡ŒæŒ‰é’®ï¼Œ <code>actions</code> ä¸­çš„æ¯ä¸ªå­å¯¹è±¡éƒ½ä¿å­˜äº†ä¸€ä¸ªæŒ‰é’®çš„å±æ€§ã€‚</p><p><img src="/asset/images/2017-12-29-pell-editor-toobar.png" alt="2017-12-29-pell-editor-toobar.png"></p><p>éƒ¨åˆ†ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">    <span class="attr">bold</span>: &#123;</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;&lt;b&gt;B&lt;/b&gt;&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Bold&#x27;</span>,</span><br><span class="line">        <span class="attr">result</span>: <span class="function">() =&gt;</span> exec(<span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">italic</span>: &#123;</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;&lt;i&gt;I&lt;/i&gt;&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Italic&#x27;</span>,</span><br><span class="line">        <span class="attr">result</span>: <span class="function">() =&gt;</span> exec(<span class="string">&#x27;italic&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">underline</span>: &#123;</span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;&lt;u&gt;U&lt;/u&gt;&#x27;</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Underline&#x27;</span>,</span><br><span class="line">        <span class="attr">result</span>: <span class="function">() =&gt;</span> exec(<span class="string">&#x27;underline&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// â€¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­æ˜¾ç¤ºäº†åä¸º <code>bold</code>ï¼Œ<code>italic</code>ï¼Œ<code>underline</code> çš„ä¸‰ä¸ªå¯¹è±¡å±æ€§ï¼Œå¯¹åº”äºå·¥å…·æ ä¸­å‰æ–¹çš„<strong>åŠ ç²—</strong>ã€<em>æ–œä½“</em>ã€ä¸‹åˆ’çº¿æŒ‰é’®ï¼Œå¯ä»¥çœ‹å‡ºå®ƒä»¬çš„ç»“æ„æ˜¯ç›¸åŒçš„ï¼Œéƒ½æœ‰ä¸‹åˆ—ä¸‰ä¸ªå±æ€§ï¼š</p><ul><li><code>icon</code>: å¦‚ä½•åœ¨å·¥å…·æ ä¸­æ˜¾ç¤º</li><li><code>title</code>: å°±æ˜¯ title å•¦</li><li><code>result</code>: ä¸€ä¸ªå‡½æ•°ï¼Œä¼šèµ‹ç»™æŒ‰é’®ä½œä¸ºç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨ä¹‹å‰æ‰€æåˆ°çš„ <code>exec()</code> å‡½æ•°æ¥å¯¹æ–‡æœ¬è¿›è¡Œæ“ä½œ</li></ul><p>ç°åœ¨å·²æœ‰äº† <code>actions</code> å¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å®ƒå‘¢ï¼Ÿè¿™å°±è¦çœ‹çœ‹ <code>init()</code> å‡½æ•°äº†ï¼Œå®ƒä¼šæ ¹æ®ä¸€å®šçš„è§„åˆ™ä» <code>actions</code> å¯¹è±¡ä¸­é€‰å‡ºå…ƒç´ ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸€é¡¹éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæŒ‰é’®ã€‚ä¸‹é¢ä»£ç ä¸­çš„ <code>settings.actions</code> å³ä¸ºæ­¤æ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¯¹åº”ä¸€ä¸ªæ˜¾ç¤ºåœ¨å·¥å…·æ ä¸Šçš„æŒ‰é’®ã€‚<code>settings.actions</code> çš„ç”Ÿæˆè§„åˆ™ä¼šåœ¨åé¢è¿›è¡Œè§£é‡Šã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pell.js ä¸­çš„ init() å‡½æ•°</span></span><br><span class="line">settings.actions.forEach(<span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ–°å»ºä¸€ä¸ªæŒ‰é’®å…ƒç´ </span></span><br><span class="line">    <span class="keyword">const</span> button = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">    <span class="comment">// ç»™æŒ‰é’®åŠ ä¸Š css æ ·å¼</span></span><br><span class="line">    button.className = settings.classes.button</span><br><span class="line">    <span class="comment">// æŠŠ icon å±æ€§ä½œä¸ºå†…å®¹æ˜¾ç¤ºå‡ºæ¥</span></span><br><span class="line">    button.innerHTML = action.icon</span><br><span class="line">    button.title = action.title</span><br><span class="line">    <span class="comment">// æŠŠ result å±æ€§èµ‹ç»™æŒ‰é’®ä½œä¸ºç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">    button.onclick = action.result</span><br><span class="line">    <span class="comment">// å°†åˆ›å»ºçš„æŒ‰é’®æ·»åŠ åˆ°å·¥å…·æ ä¸Š</span></span><br><span class="line">    actionbar.appendChild(button)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å°±éƒ½ç”Ÿæˆäº†ä¸€ä¸ªå·¥å…·æ ä¸Šçš„æŒ‰é’®äº†ã€‚ </p><h2 id="init-åˆå§‹åŒ–å‡½æ•°"><a href="#init-åˆå§‹åŒ–å‡½æ•°" class="headerlink" title="init() åˆå§‹åŒ–å‡½æ•°"></a>init() åˆå§‹åŒ–å‡½æ•°</h2><p>æƒ³ä½¿ç”¨ pell ç¼–è¾‘å™¨æ—¶ï¼Œåªè¦è°ƒç”¨ <code>init()</code> å‡½æ•°æ¥åˆå§‹åŒ–ä¸€ä¸ªç¼–è¾‘å™¨å³å¯ã€‚å®ƒæ¥æ”¶ä¸€ä¸ª <code>setting</code> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­åŒ…å«è¿™æ ·çš„ä¸€äº›å±æ€§ï¼š</p><ul><li><code>element</code>: ç¼–è¾‘å™¨çš„ DOM å…ƒç´ </li><li><code>styleWithCSS</code>: è®¾ç½®ä¸º true æ—¶ï¼Œå°†ä¼šç”¨ <code>&lt;span style=&quot;font-weight: bold;&quot;&gt;&lt;/span&gt;</code> ä»£æ›¿ <code>&lt;b&gt;&lt;/b&gt;</code></li><li><code>actions</code></li><li><code>onChange</code></li></ul><p>å…¶ä¸­æœ€é‡è¦çš„æ˜¯ <code>actions</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†ä½ æƒ³åœ¨å·¥å…·æ æ˜¾ç¤ºçš„æŒ‰é’®åˆ—è¡¨ã€‚</p><p><code>actions</code> æ•°ç»„ä¸­å¯ä»¥æœ‰è¿™å‡ ç§å…ƒç´ ï¼š</p><ul><li>ä¸€ä¸ªå­—ç¬¦ä¸²</li><li>ä¸€ä¸ªæœ‰ <code>name</code> å±æ€§çš„å¯¹è±¡</li><li>ä¸€ä¸ªå¯¹è±¡ï¼Œæ²¡æœ‰ <code>name</code> å±æ€§ï¼Œä½†æœ‰ç”Ÿæˆä¸€ä¸ªæŒ‰é’®çš„å¿…éœ€å±æ€§ <code>icon</code>ï¼Œ<code>result</code> ç­‰</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">actions: [</span><br><span class="line">  <span class="string">&#x27;bold&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;underline&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;italic&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">    <span class="attr">result</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> url = <span class="built_in">window</span>.prompt(<span class="string">&#x27;Enter the image URL&#x27;</span>)</span><br><span class="line">      <span class="keyword">if</span> (url) <span class="built_in">window</span>.pell.exec(<span class="string">&#x27;insertImage&#x27;</span>, ensureHTTP(url))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>åœ¨ <code>init()</code> å‡½æ•°ä¸­ä¼šæŠŠè¿™ä¸ª <code>actions</code>å‚æ•° å’Œ pell.js ä¸­å®šä¹‰çš„ <code>actions</code>å¯¹è±¡ç»„åˆèµ·æ¥ï¼Œå¯ä»¥å°† <code>actions</code> å¯¹è±¡å½“ä½œä¸€ä¸ªé»˜è®¤è®¾ç½®ï¼Œçœ‹ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pell.js ä¸­çš„ init() å‡½æ•°</span></span><br><span class="line">settings.actions = settings.actions</span><br><span class="line">    ? settings.actions.map(<span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">&#x27;string&#x27;</span>) <span class="keyword">return</span> actions[action]</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå‚æ•°ä¸­ä¼ å…¥çš„ action å·²ç»åœ¨é»˜è®¤è®¾ç½®ä¸­å­˜åœ¨ï¼Œç”¨ä¼ å…¥çš„å‚æ•°è¦†ç›–é»˜è®¤è®¾ç½®</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (actions[action.name]) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123; ...actions[action.name], ...action &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line">    &#125;)</span><br><span class="line">    : <span class="built_in">Object</span>.keys(actions).map(<span class="function"><span class="params">action</span> =&gt;</span> actions[action])</span><br></pre></td></tr></table></figure><p>å¦‚æœå‚æ•°å¯¹è±¡ <code>setting</code> ä¸­ä¸åŒ…å« <code>actions</code> æ•°ç»„,  åˆ™ä¼šé»˜è®¤ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„ <code>actions</code> å¯¹è±¡æ¥åˆå§‹åŒ–ã€‚</p><p>init() å‡½æ•°é‡Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªå¯ç¼–è¾‘åŒºåŸŸï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª <code>div</code> å…ƒç´ ï¼Œå°†å…¶ <code>contentEditable</code> å±æ€§è®¾ä¸º <code>true</code>ï¼Œä»è€Œå¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ä¹‹å‰æåˆ°çš„ <code>document.execCommand()</code> å‘½ä»¤äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç¼–è¾‘åŒºåŸŸçš„å…ƒç´ </span></span><br><span class="line">settings.element.content = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="comment">// è®© div æˆä¸ºå¯ç¼–è¾‘çŠ¶æ€</span></span><br><span class="line">settings.element.content.contentEditable = <span class="literal">true</span></span><br><span class="line">settings.element.content.className = settings.classes.content</span><br><span class="line"><span class="comment">// å½“ç”¨æˆ·è¾“å…¥æ—¶ï¼Œæ›´æ–°é¡µé¢çš„ç›¸åº”éƒ¨åˆ†</span></span><br><span class="line">settings.element.content.oninput = <span class="function"><span class="params">event</span> =&gt;</span> </span><br><span class="line">    settings.onChange(event.target.innerHTML)</span><br><span class="line">settings.element.content.onkeydown = preventTab</span><br><span class="line">settings.element.appendChild(settings.element.content)</span><br></pre></td></tr></table></figure><h2 id="æµç¨‹æ•´ç†"><a href="#æµç¨‹æ•´ç†" class="headerlink" title="æµç¨‹æ•´ç†"></a>æµç¨‹æ•´ç†</h2><p>æœ€åä»¥â€œæ’å…¥é“¾æ¥â€ä¸ºä¾‹æ¥æ¢³ç†ä¸‹æ•´ä¸ªç¼–è¾‘å™¨çš„æµç¨‹ï¼š</p><p>ä¸€ã€åœ¨è°ƒç”¨ <code>init()</code> å‡½æ•°æ—¶ï¼Œåœ¨å‚æ•°å¯¹è±¡çš„ <code>action</code> æ•°ç»„ä¸­åŠ å…¥ä»¥ä¸‹ä¸€é¡¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;link&#x27;</span>,</span><br><span class="line">    <span class="attr">result</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="built_in">window</span>.prompt(<span class="string">&#x27;Enter the link URL&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (url) <span class="built_in">window</span>.pell.exec(<span class="string">&#x27;createLink&#x27;</span>, ensureHTTP(url))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒã€åœ¨ <code>init()</code> çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæ£€æŸ¥å·²å®šä¹‰çš„ <code>actions</code> å¯¹è±¡ä¸­æ˜¯å¦æœ‰ <code>link</code> è¿™ä¸ªå±æ€§ã€‚ç»æ£€æŸ¥å±æ€§ç¡®å®å­˜åœ¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">link: &#123;</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;&amp;#128279;&#x27;</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Link&#x27;</span>,</span><br><span class="line">    <span class="attr">result</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="built_in">window</span>.prompt(<span class="string">&#x27;Enter the link URL&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (url) exec(<span class="string">&#x27;createLink&#x27;</span>, url)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¼ å…¥çš„å‚æ•°ä¸­æœ‰ <code>result</code> è¿™ä¸€é¡¹ï¼Œæ‰€ä»¥ç”¨ä¼ å…¥çš„ <code>result</code> æ¥ä»£æ›¿ <code>link</code> å¯¹è±¡ä¸­çš„é»˜è®¤å€¼ï¼Œç„¶åå°†ä¿®æ”¹è¿‡çš„ <code>link</code> å¯¹è±¡æ”¾å…¥ <code>settings.actions</code> æ•°ç»„ä¸­ã€‚</p><p>ä¸‰ã€å¯¹ <code>settings.actions</code> æ•°ç»„è¿›è¡Œä¸€æ¬¡è¿­ä»£æ¥ç”Ÿæˆå·¥å…·æ ï¼Œ<code>link</code> å¯¹è±¡ä½œä¸ºå…¶ä¸­çš„ä¸€é¡¹ç”Ÿæˆäº†ä¸€ä¸ªâ€œæ’å…¥é“¾æ¥â€çš„æŒ‰é’®ã€‚<code>result</code> å±æ€§æˆä¸ºå…¶ç‚¹å‡»äº‹ä»¶ã€‚</p><p>å››ã€ç‚¹å‡»â€œæ’å…¥é“¾æ¥â€çš„æŒ‰é’®åï¼Œä¼šè®©ä½ è¾“å…¥ä¸€ä¸ª urlï¼Œç„¶åè°ƒç”¨ <code>exec(&#39;createLink&#39;, url)</code> åœ¨ç¼–è¾‘åŒºåŸŸæ’å…¥è¯¥é“¾æ¥ã€‚</p><p>ç¼–è¾‘å™¨å…¶å®ƒæŒ‰é’®çš„åŠŸèƒ½æµç¨‹ä¹Ÿç±»ä¼¼ã€‚</p><p>è¿™æ · Pell ç¼–è¾‘å™¨çš„å¤§éƒ¨åˆ†å†…å®¹å°±è®²è§£å®Œæ¯•äº†ï¼Œå‰©ä½™éƒ¨åˆ†è¿˜éœ€è¦è‡ªå·±å»çœ‹æºç ã€‚æ¯•ç«Ÿé¡¹ç›®çš„ä»£ç ä¸é•¿ï¼Œä»¥æ­¤ä½œä¸ºæ–‡æœ¬ç¼–è¾‘å™¨çš„å…¥é—¨å€’ä¸é”™ã€‚</p><hr><p>2017å¹´çš„æœ€åä¸€ç¯‡æ–‡ç« äº†ï¼Œå†è§ï¼Œ2017ã€‚</p><p><a href="http://www.wukai.me/2017/12/31/rich-text-editor-in-less-than-200-lines-javascript/">æœ¬æ–‡åŸåœ°å€</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰æ®µæ—¶é—´åœ¨å¯»æ‰¾ä¸€äº›å…³äºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„èµ„æ–™ï¼Œç„¶åå‘ç°äº†è¿™ä¸ªåä¸º &lt;a href=&quot;https://github.com/jaredreich/pell&quot;&gt;Pell&lt;/a&gt; çš„é¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ‰€è§å³æ‰€å¾—ï¼ˆWYSIWYGï¼‰çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè™½ç„¶å®ƒçš„åŠŸèƒ½å¾ˆç®€å•ï¼Œä½†æ˜¯ä»¤äººåƒæƒŠçš„æ˜¯å®ƒåªæœ‰ 1kb å¤§å°ã€‚è€Œé¡¹ç›®æœ€æ ¸å¿ƒçš„æ–‡ä»¶ &lt;a href=&quot;https://github.com/jaredreich/pell/blob/master/src/pell.js&quot;&gt;pell.js&lt;/a&gt; åªæœ‰130è¡Œï¼Œå³ä½¿åŠ ä¸Šå…¶å®ƒéƒ¨åˆ†ï¼Œæ€»çš„ js æ•°é‡ä¹Ÿä¸åˆ°200è¡Œã€‚è¿™å¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œå†³å®šçœ‹çœ‹å®ƒçš„æºç æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.wukai.me/tags/javascript/"/>
    
      <category term="ç¼–è¾‘å™¨" scheme="http://www.wukai.me/tags/%E7%BC%96%E8%BE%91%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ JavaScript ç”»å…‰ï¼šåŸºç¡€</title>
    <link href="http://www.wukai.me/2017/12/10/light-2d-javascript/"/>
    <id>http://www.wukai.me/2017/12/10/light-2d-javascript/</id>
    <published>2017-12-09T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.545Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Any application that <strong>can</strong> be written in JavaScript, <strong>will</strong> eventually be written in JavaScript.<br>â€“ Atwoodâ€™s Law</p></blockquote><p>æœ¬æ–‡æ¥æºäºæˆ‘åœ¨çœ‹äº† Milo Yip åœ¨çŸ¥ä¹ä¸“æ é‡Œçš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/30745861">ã€Šç”¨ C è¯­è¨€ç”»å…‰ï¼ˆä¸€ï¼‰ï¼šåŸºç¡€ã€‹</a>ä¹‹åçš„ä¸€ä¸ªæƒ³æ³•ï¼Œèƒ½ä¸èƒ½å°†åŸæ–‡ä¸­ C è¯­è¨€ç‰ˆæœ¬ç¨‹åºæ”¹æˆ JavaScript ç‰ˆæœ¬çš„ã€‚åŠ¨æ‰‹ä¹‹åå‘ç°å‡ºä¹æ„æ–™çš„é¡ºåˆ©ï¼Œæˆ‘åªéœ€è¦æŠŠ C è¯­è¨€ä¸­å˜é‡çš„ç±»å‹é€šé€šå»æ‰å°±å¯ä»¥äº†ğŸ˜€ï¼ŒAmazingï¼</p><span id="more"></span><p>æœ€ç»ˆç»“æœå¯è§æ­¤ CodePenï¼š<a href="https://codepen.io/noiron/pen/aVgYMB?editors=1010">https://codepen.io/noiron/pen/aVgYMB?editors=1010</a></p><p><p data-height="400" data-theme-id="0" data-slug-hash="aVgYMB" data-default-tab="result" data-user="noiron" data-embed-version="2" data-pen-title="aVgYMB" class="codepen">See the Pen <a href="https://codepen.io/noiron/pen/aVgYMB/">aVgYMB</a> by wu kai (<a href="https://codepen.io/noiron">@noiron</a>) on <a href="https://codepen.io">CodePen</a>.</p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¸»è¦è§£é‡Šä¸€ä¸‹ JavaScript å¦‚ä½•å°†å›¾åƒè¾“å‡ºï¼Œä»¥åŠæˆ‘å¯¹è¿™ä¸ªç”»å…‰ç¨‹åºçš„ä¸€ç‚¹ç†è§£ã€‚æ›´å¤šæœ‰å…³å›¾å½¢å­¦åŸç†éƒ¨åˆ†çš„å†…å®¹ï¼Œå»ºè®®è¿˜æ˜¯çœ‹ Milo Yip çš„åŸæ–‡ã€‚</p><h2 id="å¦‚ä½•è¾“å‡ºå›¾åƒ"><a href="#å¦‚ä½•è¾“å‡ºå›¾åƒ" class="headerlink" title="å¦‚ä½•è¾“å‡ºå›¾åƒ"></a>å¦‚ä½•è¾“å‡ºå›¾åƒ</h2><p>Milo Yip åœ¨ä»–çš„ç³»åˆ—æ–‡ç« ä¸­ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå·±å†™çš„ <a href="https://zhuanlan.zhihu.com/p/26525083">svpng()</a> å‡½æ•°ï¼Œèƒ½å¤Ÿæ ¹æ®å¾—åˆ°çš„å›¾å½¢æ•°æ®ç”Ÿæˆ <code>png</code> æ ¼å¼çš„å›¾ç‰‡ã€‚è€Œä½¿ç”¨ JavaScript å¯ä»¥æ–¹ä¾¿åœ°åœ¨ <code>canvas</code> å…ƒç´ ä¸Šç»˜åˆ¶å‡ºå›¾å½¢ã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿè®°å½•ä¸‹å›¾ç‰‡çš„ä¿¡æ¯ï¼Œéœ€è¦è®°å½•æ¯ä¸€ä¸ªåƒç´ ç‚¹çš„ <code>RGB</code> å€¼ï¼Œå¯¹äºä¸€å¼ å®½åº¦ä¸º Wï¼Œé«˜åº¦ä¸º H çš„å›¾ç‰‡ï¼Œå…¶åƒç´ ç‚¹æ•°é‡ä¸º <code>W * H</code>ï¼Œè€Œæ¯ä¸ªåƒç´ ç‚¹åˆ†åˆ«ç”¨ä¸‰ä¸ªæ•°æ¥è¡¨ç¤ºå…¶ Rã€Gã€B å€¼ï¼Œæ‰€ä»¥è®°å½•ä¸‹æ•´å¼ å›¾ç‰‡çš„æ•°æ®ï¼Œéœ€è¦ä¸€ä¸ªé•¿åº¦ä¸º <code>W * H * 3</code> çš„æ•°ç»„ã€‚å¦‚æœå›¾ç‰‡å¸¦æœ‰ alpha é€šé“ï¼Œéœ€è¦è®°å½• <code>RGBA</code> å€¼ï¼Œåˆ™æ•°ç»„é•¿åº¦ä¸º <code>W * H * 4</code>ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¯ä»¥ç®€åŒ–çš„åœ°æ–¹ï¼Œå› ä¸ºç»˜åˆ¶çš„æ˜¯ä¸€å¼ é»‘ç™½çš„å›¾ç‰‡ï¼Œå¯¹äºé»‘/ç™½/ç°è‰²æ¥è¯´ R = G = Bï¼Œæ‰€ä»¥ç”¨é•¿åº¦ <code>W * H</code> çš„æ•°ç»„å³å¯ã€‚</p><p>å‡è®¾æˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªè®°å½•å›¾ç‰‡ä¿¡æ¯çš„æ•°ç»„ <code>p</code>ï¼Œé‚£ä¹ˆå¦‚ä½•å°†å…¶æ˜¾ç¤ºå‡ºæ¥ï¼Ÿè¿™é‡Œéœ€è¦ç”¨åˆ° <code>getImageData</code>, <code>putImageData</code> æ–¹æ³•ã€‚</p><p>å¯ä»¥åˆ©ç”¨ <code>getImageData()</code> æ–¹æ³•æ¥è·å¾— ImageData å¯¹è±¡ï¼Œä»ä¸­å¾—åˆ°å›¾åƒçš„åƒç´ ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line"><span class="comment">// è·å– ImageData å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> imageData = ctx.getImageData(x, y, width, height)</span><br></pre></td></tr></table></figure><p><code>ImageData</code> å¯¹è±¡çš„ <code>data</code> å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æœ‰æ¯ä¸ªåƒç´ ç‚¹çš„ <code>RGBA</code>ï¼Œå…¶æ€»é•¿åº¦ä¸º <code>W * H * 4</code>ã€‚æ‰€ä»¥æˆ‘ä»¬å°†è®°å½•å›¾ç‰‡ä¿¡æ¯çš„æ•°ç»„ <code>p</code> ä¸­çš„å€¼ä¾åºèµ‹ç»™ <code>data</code>ï¼Œå†åˆ©ç”¨ <code>putImageData</code> æ–¹æ³•å³å¯å°†å›¾ç‰‡ç»˜åˆ¶åˆ° canvas ä¸Šäº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processImageData</span>(<span class="params">imageData, p</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = imageData.data;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = p[i / <span class="number">4</span>];</span><br><span class="line">        data[i] = value;</span><br><span class="line">        data[i + <span class="number">1</span>] = value;</span><br><span class="line">        data[i + <span class="number">2</span>] = value;</span><br><span class="line">        data[i + <span class="number">3</span>] = <span class="number">255</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">processImageData(imageData, p);</span><br><span class="line">ctx.putImageData(imageData, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•è·å¾—ä¸€ä¸ªç‚¹çš„å…‰ç…§å¼ºåº¦"><a href="#å¦‚ä½•è·å¾—ä¸€ä¸ªç‚¹çš„å…‰ç…§å¼ºåº¦" class="headerlink" title="å¦‚ä½•è·å¾—ä¸€ä¸ªç‚¹çš„å…‰ç…§å¼ºåº¦"></a>å¦‚ä½•è·å¾—ä¸€ä¸ªç‚¹çš„å…‰ç…§å¼ºåº¦</h2><p>ç°åœ¨æˆ‘ä»¬è€ƒè™‘çš„æ˜¯å•è‰²å…‰ï¼ŒRGB ä¸­çš„ä¸‰ä¸ªå€¼æ˜¯ç›¸ç­‰çš„ï¼Œå½“å…‰ç…§è¶Šå¼ºæ—¶ï¼ŒRGB å€¼è¶Šå¤§ï¼Œå›¾åƒçš„é¢œè‰²ä¹Ÿè¶Šç™½ã€‚</p><p>åæ ‡ä¸º (x, y) çš„ä¸€ä¸ªç‚¹ï¼Œå®ƒè·å¾—çš„å…‰æ¥è‡ªäºå„ä¸ªæ–¹å‘ä¸Šçš„å…‰çš„å åŠ ï¼Œå³æ˜¯ä¸€ä¸ªå¯¹è§’åº¦çš„ç§¯åˆ†ï¼š</p><p>$$F\left( x,y\right) =\int ^{2\pi }_{0}L\left( x,y,\theta \right) d\theta$$</p><p>å…¶ä¸­ $L\left( x,y,\theta \right)$ ä»£è¡¨åœ¨äºŒç»´åæ ‡ (x, y) åœ¨ $\theta$ æ–¹å‘æœ‰å¤šå°‘å…‰ç»è¿‡ã€‚</p><p>ç”±äºæ— æ³•ç›´æ¥è®¡ç®—å‡ºè¿™ä¸ªç§¯åˆ†çš„å€¼ï¼Œéœ€è¦ç”¨<strong>è’™ç‰¹å¡ç½—ç§¯åˆ†æ³•</strong>æ¥è¿›è¡Œé‡‡æ ·ã€‚åˆ©ç”¨ N ä¸ªæ–¹å‘çš„é‡‡æ ·å¹³å‡å€¼ä½œä¸ºè¿™ä¸€ç‚¹çš„å…‰å¼ºã€‚</p><p>é‚£ä¹ˆ (x, y) ç‚¹åœ¨ $\theta$ æ–¹å‘ä¸Šèƒ½è·å¾—å¤šå°‘å…‰ç…§ï¼Ÿæˆ‘ä»¬ç°åœ¨åªæœ‰ä¸€ä¸ªå¤„äºç”»é¢ä¸­å¤®çš„åœ†å½¢å…‰æºï¼Œå¯è€ƒè™‘ä» (x, y) ä¸ºèµ·ç‚¹çš„ä¸€æ¡çº¿æ®µï¼Œå¦‚æœå®ƒè¶³å¤Ÿé•¿ï¼Œé‚£åªæœ‰ä¸¤ç§å¯èƒ½æ€§ï¼š</p><ul><li>ç»ˆç»“äºå…‰æºçš„è¡¨é¢ï¼Œåˆ™ (x, y) ç‚¹åœ¨ $\theta$ æ–¹å‘èƒ½è·å¾—å…‰ç…§</li><li>ä¸å…‰æºæ— äº¤ç‚¹ï¼Œåˆ™æ­¤æ–¹å‘ä¸Šæ— å…‰ç…§</li></ul><p>ä½†æˆ‘ä»¬éœ€è¦å¯¹è¿™æ¡çº¿æ®µçš„é•¿åº¦åŠ ä»¥é™åˆ¶ï¼Œæ‰€ä»¥é€æ­¥åŠ é•¿çº¿æ®µçš„é•¿åº¦ï¼Œå¦‚æœçº¿æ®µç»ˆç‚¹åœ¨å…‰æºçš„è¡¨é¢æˆ–å†…éƒ¨ï¼Œåˆ™è·å¾—å…‰ç…§ã€‚å½“æ­¥æ•°è¾¾åˆ° <code>MAX_STEP</code> æˆ–è·ç¦»è¾¾åˆ° <code>MAX_DISTANCE</code>ï¼Œåœæ­¢è®¡ç®—ï¼Œåœ¨æ­¤æ–¹å‘ä¸Šè·å¾—çš„å…‰ç…§ä¸º0ã€‚</p><p>è¿™é‡Œéœ€è¦åˆ©ç”¨<strong>å¸¦ç¬¦å·è·ç¦»åœºï¼ˆsigned distance field, SDFï¼‰</strong>æ¥è¡¨ç¤ºå‡ºå½“å‰çš„ç‚¹ä¸åœºæ™¯çš„æœ€è¿‘è·ç¦»ï¼Œæ¯æ¬¡æ­¥è¿›æ­¤è·ç¦»èƒ½ä¿è¯ä¸ä¼šè¿›å…¥å…‰æºçš„å†…éƒ¨ã€‚å¦‚ä¸‹å›¾ä¸­ï¼Œæ¯ä¸ªåœ†çš„åŠå¾„å‡ä¸ºåœ†å¿ƒå’Œå›¾ä¸­å½¢çŠ¶çš„æœ€è¿‘è·ç¦»ï¼Œåˆ™æŒ‰ P0 -&gt; P1 -&gt; P2 -&gt; â€¦ çš„é¡ºåºå‰è¿›èƒ½ä¿è¯ä¸ä¼šå’Œå›¾ä¸­çš„å½¢çŠ¶ç›¸äº¤ã€‚ </p><p><img src="/asset/images/2017-12-10-sphere-tracing.jpg" alt="sphere-tracing"><br>ï¼ˆå›¾æºï¼š<a href="https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter08.htmlï¼‰">https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter08.htmlï¼‰</a></p><p>æ­¤å³åŸæ–‡ä¸­æåˆ°çš„<strong>å…‰çº¿æ­¥è¿›ï¼ˆray marchingï¼‰</strong>æ–¹æ³•ï¼ˆåˆç§°ä¸º<strong>çƒä½“è¿½è¸ªï¼sphere tracing</strong>ï¼‰ã€‚</p><h2 id="JavaScript-çš„å®ç°"><a href="#JavaScript-çš„å®ç°" class="headerlink" title="JavaScript çš„å®ç°"></a>JavaScript çš„å®ç°</h2><p>åˆ©ç”¨ <code>sample()</code> å‡½æ•°è®¡ç®—å¹¶ä¿å­˜æ‰€æœ‰åæ ‡ç‚¹çš„å…‰ç…§ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> y = <span class="number">0</span>, i = <span class="number">0</span>; y &lt; HEIGHT; y++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> x = <span class="number">0</span>; x &lt; WIDTH; x++) &#123;</span><br><span class="line">        <span class="comment">// x / W, y / H å…¶å€¼è¢«é™åˆ¶åœ¨ [0, 1] ä¹‹é—´</span></span><br><span class="line">        p[i++] = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.min(sample(x / WIDTH, y / HEIGHT) * <span class="number">255</span>, <span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è’™ç‰¹å¡ç½—ç§¯åˆ†æ³•è¿›è¡Œ N æ¬¡é‡‡æ ·å–å¹³å‡å€¼è·å¾— (x, y) å¤„çš„å…‰ç…§å¼ºåº¦ï¼Œå…¶ä¸­çš„ <code>trace()</code> å‡½æ•°ä»£è¡¨çš„æ˜¯ä» $\theta$ æ–¹å‘è·å–çš„å…‰å¼ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sample</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="comment">// ä»¥ä¸‹ä¸ºä¸‰ç§ä¸åŒçš„é‡‡æ ·æ–¹å¼</span></span><br><span class="line">        <span class="comment">// const theta = Math.PI * 2 * Math.random();           // éšæœºé‡‡æ ·</span></span><br><span class="line">        <span class="comment">// const theta = Math.PI * 2 * i / N;                   // åˆ†å±‚é‡‡æ ·ï¼ˆstratified samplingï¼‰</span></span><br><span class="line">        <span class="keyword">const</span> theta = <span class="built_in">Math</span>.PI * <span class="number">2</span> * (i + <span class="built_in">Math</span>.random()) / N;    <span class="comment">// æŠ–åŠ¨é‡‡æ ·ï¼ˆjittered samplingï¼‰</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// trace() æ‰€è¿”å›çš„å€¼æ˜¯ç‚¹ (x, y) ä» theta æ–¹å‘è·å–çš„å…‰</span></span><br><span class="line">        sum += trace(x, y, <span class="built_in">Math</span>.cos(theta), <span class="built_in">Math</span>.sin(theta));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum / N;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>circleSDF</code> ä¸ºå¸¦ç¬¦å·è·ç¦»åœºï¼ˆsigned distance field, SDFï¼‰ï¼Œå€¼ä¸ºè´Ÿæ—¶ï¼Œè¡¨ç¤ºåœ¨å…‰æºçš„å†…éƒ¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">circleSDF</span>(<span class="params">x, y, cx, cy, r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ux = x - cx;</span><br><span class="line">    <span class="keyword">const</span> uy = y - cy;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(ux * ux + uy * uy) - r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯ <code>trace()</code> æ–¹æ³•ï¼Œç”¨<strong>å…‰çº¿æ­¥è¿›</strong>æ¥è®¡ç®—å‡º (ox, oy) æ²¿å•ä½å‘é‡ (dx, dy) æ–¹å‘ä¸Šè·å¾—çš„å…‰ç…§ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trace</span>(<span class="params">ox, oy, dx, dy</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> MAX_STEP = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">const</span> MAX_DISTANCE = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> EPSILON = <span class="number">1e-6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> t = <span class="number">0.0</span>;    <span class="comment">// t ä¸ºæ­¥è¿›çš„è·ç¦»</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; MAX_STEP &amp;&amp; t &lt; MAX_DISTANCE; i++) &#123;</span><br><span class="line">        <span class="comment">// å…‰æºä¸­å¿ƒä¸º (sourceX, sourceY) </span></span><br><span class="line">        <span class="comment">// æ²¿å•ä½å‘é‡ (dx, dy) æ–¹å‘å‰è¿›ï¼Œt è¡¨ç¤ºå‰è¿›çš„è·ç¦»</span></span><br><span class="line">        <span class="keyword">const</span> sd = circleSDF(ox + dx * t, oy + dy * t, sourceX, sourceY, <span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­¤æ—¶å·²åˆ°è¾¾å‘å…‰çš„åœ†å½¢è¡¨é¢</span></span><br><span class="line">        <span class="keyword">if</span> (sd &lt; EPSILON) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»§ç»­å¢åŠ æ­¥è¿›çš„è·ç¦»</span></span><br><span class="line">        t += sd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘è¿˜åœ¨ä»£ç æ·»åŠ äº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œå¯ä»¥æ”¹å˜å…‰æºä½ç½®æ¥æŸ¥çœ‹ä¸åŒçš„æ•ˆæœã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://github.com/YIXUNFE/blog/issues/12">Canvas æ“ä½œå›¾åƒåƒç´ </a></p><hr><p>[<strong>2018-01-01 æ›´æ–°</strong>]<br>åœ¨ GitHub ä¸Šå»ºç«‹äº†ä¸€ä¸ªé¡¹ç›®ï¼Œå‡†å¤‡å°†ã€Šç”¨Cè¯­è¨€ç”»å…‰ã€‹ç³»åˆ—æ–‡ç« ä¸­çš„ä»£ç éƒ½ç§»æ¤åˆ° JavaScipt ä¸­æ¥ã€‚<br>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/noiron/light2d-javascript">light2d-javascript</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Any application that &lt;strong&gt;can&lt;/strong&gt; be written in JavaScript, &lt;strong&gt;will&lt;/strong&gt; eventually be written in JavaScript.&lt;br&gt;â€“ Atwoodâ€™s Law&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ¥æºäºæˆ‘åœ¨çœ‹äº† Milo Yip åœ¨çŸ¥ä¹ä¸“æ é‡Œçš„è¿™ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;https://zhuanlan.zhihu.com/p/30745861&quot;&gt;ã€Šç”¨ C è¯­è¨€ç”»å…‰ï¼ˆä¸€ï¼‰ï¼šåŸºç¡€ã€‹&lt;/a&gt;ä¹‹åçš„ä¸€ä¸ªæƒ³æ³•ï¼Œèƒ½ä¸èƒ½å°†åŸæ–‡ä¸­ C è¯­è¨€ç‰ˆæœ¬ç¨‹åºæ”¹æˆ JavaScript ç‰ˆæœ¬çš„ã€‚åŠ¨æ‰‹ä¹‹åå‘ç°å‡ºä¹æ„æ–™çš„é¡ºåˆ©ï¼Œæˆ‘åªéœ€è¦æŠŠ C è¯­è¨€ä¸­å˜é‡çš„ç±»å‹é€šé€šå»æ‰å°±å¯ä»¥äº†ğŸ˜€ï¼ŒAmazingï¼&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.wukai.me/tags/javascript/"/>
    
      <category term="è®¡ç®—æœºå›¾å½¢å­¦" scheme="http://www.wukai.me/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>å¡”é˜²æ¸¸æˆä¸­çš„æ•Œäººå¦‚ä½•æ²¿è·¯å¾„å‰è¿› (JavaScript å®ç°)</title>
    <link href="http://www.wukai.me/2017/12/09/boid-path-following/"/>
    <id>http://www.wukai.me/2017/12/09/boid-path-following/</id>
    <published>2017-12-08T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.545Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚æœå¼€å‘ä¸€ä¸ªå¡”é˜²æ¸¸æˆï¼Œå¾ˆè‡ªç„¶çš„ä¼šé‡ä¸Šè¿™ä¹ˆä¸¤ä¸ªåå­—å¾ˆåƒçš„é—®é¢˜ï¼š</p><ul><li><strong>Path-finding</strong>: å¦‚æœçŸ¥é“èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œå¦‚ä½•åœ¨å…¶é—´æ‰¾åˆ°ä¸€æ¡è·¯å¾„</li><li><strong>Path-following</strong>: å·²çŸ¥ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ï¼Œç‰©ä½“å¦‚ä½•æ‰èƒ½æ²¿ç€å®ƒè¡Œè¿›</li></ul><p>æœ¬æ–‡å°†è¦è®¨è®ºçš„æ˜¯ç¬¬äºŒä¸ªé—®é¢˜ <strong>path following</strong>ï¼Œç»™å®šä¸€æ¡è·¯å¾„ï¼Œçœ‹ç‰©ä½“å¦‚ä½•æ²¿ç€å®ƒä»èµ·ç‚¹è¿è¡Œè‡³ç»ˆç‚¹ã€‚ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæ¥ä¸‹æ¥çš„å†…å®¹ä¸­ï¼Œç”¨å•è¯ <a href="https://en.wikipedia.org/wiki/Boids">Boid</a> æ¥è¡¨ç¤ºè¡Œè¿›çš„ç‰©ä½“æˆ–å¡”é˜²ä¸­çš„æ•Œäººã€‚</p><p>æ¥ä¸‹æ¥ä¼šç”¨ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæœ€ç»ˆå®Œæˆçš„ä»£ç åº“å¯è§ GitHub: <a href="https://github.com/noiron/boid-path-following">boid-path-following</a>ï¼Œrepo çš„å¤šä¸ªåˆ†æ”¯å¯¹åº”äº†æ–‡ä¸­çš„ä¸åŒæ­¥éª¤ã€‚</p><span id="more"></span><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>å…ˆæ¥çœ‹çœ‹å¦‚ä½•æ ‡è¯†å‡ºç”»é¢ä¸­çš„ä½ç½®ï¼Œé¦–å…ˆç”»é¢è¢«ä¸€ç³»åˆ—çš„æ¨ªçºµçº¿åˆ†æˆäº†è®¸å¤šç½‘æ ¼ï¼Œå¯¹äºåœ°å›¾èŒƒå›´å†…çš„ä¸€ä¸ªç‚¹ï¼Œå®ƒä¼šæœ‰è‡ªå·±çš„åƒç´ åæ ‡ (x, y)ï¼ŒåŒæ—¶å®ƒæ‰€å¤„çš„æ ¼å­ä¹Ÿæœ‰è‡ªå·±çš„åæ ‡ (col, row) æˆ– (xIndex, yIndex)ï¼Œè¡¨ç¤ºæ‰€å¤„çš„åˆ—å’Œè¡Œã€‚</p><p><img src="/asset/images/2017-12-09-path-following-map.png" alt=""></p><p>ä¸ºäº†åŒºåˆ†ï¼Œä¸‹æ–‡ä¸­æåˆ°<strong>åƒç´ åæ ‡</strong>å³ä¸ºç”¨åƒç´ è¡¨ç¤ºçš„åæ ‡ï¼Œ<strong>ç½‘æ ¼åæ ‡</strong>è¡¨ç¤ºç‚¹åœ¨ç½‘æ ¼ä¸­çš„åˆ—å’Œè¡Œã€‚</p><p>åœ¨è¿™ç§è¡¨ç¤ºæ–¹æ³•ä¸‹ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå·¥å…·å‡½æ•° <code>index2Px(col, row)</code>ï¼Œç”¨äºè®¡ç®—æ ¼å­ä¸­å¿ƒçš„åƒç´ åæ ‡ã€‚</p><p>æ¥ä¸‹æ¥ç»™å‡ºè·¯å¾„çš„åæ ‡ï¼Œè·¯å¾„æ˜¯å¦‚ä¸‹çš„ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = [[<span class="number">0</span>, <span class="number">1</span>], [COLS - <span class="number">4</span>, <span class="number">1</span>], [COLS - <span class="number">4</span>, <span class="number">4</span>], [<span class="number">6</span>, <span class="number">4</span>], [<span class="number">6</span>, <span class="number">7</span>], <span class="comment">/* éƒ¨åˆ†çœç•¥ */</span>]</span><br></pre></td></tr></table></figure><p>æ¯ä¸€é¡¹éƒ½æ˜¯è·¯å¾„ä¸Šä¸€ä¸ªç‚¹çš„ç½‘æ ¼åæ ‡ï¼Œå°†è¿™äº›ç‚¹ç”¨ç›´çº¿è¿æ¥èµ·æ¥åå°±å¾—åˆ°äº† boid è¡Œè¿›çš„è·¯å¾„ã€‚æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯è¦è®© boid èƒ½å¤Ÿä»è·¯å¾„ç¬¬ä¸€ä¸ªåæ ‡ç§»åŠ¨è‡³æœ€åä¸€ä¸ªåæ ‡ã€‚</p><h2 id="Boid-å¦‚ä½•æ²¿ç›´çº¿å‰è¿›"><a href="#Boid-å¦‚ä½•æ²¿ç›´çº¿å‰è¿›" class="headerlink" title="Boid å¦‚ä½•æ²¿ç›´çº¿å‰è¿›"></a>Boid å¦‚ä½•æ²¿ç›´çº¿å‰è¿›</h2><p>å…ˆè€ƒè™‘æœ€ç®€å•çš„é—®é¢˜ï¼Œå¦‚ä½•è®© Boid æ²¿ç€ä¸€æ¡ç›´çº¿è¡Œè¿›ã€‚</p><p>ç‰©ä½“çš„ç§»åŠ¨éœ€è¦ä½ç½®å’Œé€Ÿåº¦ï¼Œä¸ºäº†è¡¨ç¤ºå…¶åƒç´ åæ ‡ï¼Œ<code>boid</code> éœ€è¦ <code>x</code>, <code>y</code> å±æ€§ï¼›å…¶é€Ÿåº¦éœ€è¦ <code>speed</code> å±æ€§ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¸€ä¸ª <code>angle</code>ï¼Œä»¥ä¾¿è®¡ç®—å‡ºé€Ÿåº¦åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šçš„åˆ†é‡ <code>vx</code>, <code>vy</code>ã€‚</p><p>åŠ¨ç”»æ•ˆæœçš„å®ç°éœ€è¦ç”¨ <code>requestAnimationFrame</code> å‡½æ•°ï¼Œæ¯ä¸€ç§’ä¸º60å¸§ï¼Œæ¯ä¸€å¸§ä¸­éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡å¾ªç¯ï¼Œåœ¨å…¶ä¸­æ”¹å˜ä½ç½®ï¼š</p><pre><code>ä¸‹ä¸€æ—¶åˆ»çš„ä½ç½® = å½“å‰æ—¶åˆ»çš„ä½ç½® + é€Ÿåº¦</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºæ„ä»£ç </span></span><br><span class="line"><span class="comment">// Boid ç±»çš„ step() æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="title">step</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> speed = <span class="built_in">this</span>.speed;</span><br><span class="line">    <span class="keyword">const</span> angle = <span class="built_in">Math</span>.PI / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.vx = <span class="built_in">Math</span>.cos(angle) * speed;</span><br><span class="line">    <span class="built_in">this</span>.vy = <span class="built_in">Math</span>.sin(angle) * speed;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœ vx, vy ä¸å˜åŒ–ï¼Œåˆ™ä¼šæ²¿ä¸€æ¡ç›´çº¿å‰è¿›</span></span><br><span class="line">    <span class="built_in">this</span>.x += <span class="built_in">this</span>.vx;</span><br><span class="line">    <span class="built_in">this</span>.y += <span class="built_in">this</span>.vy; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ¯ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œboid çš„ä½ç½®éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨æ–°çš„ä½ç½®ä¸Šå°†å…¶ç”»å‡ºå³å¯çœ‹åˆ° boid æ²¿ç›´çº¿è¿åŠ¨çš„æ•ˆæœã€‚</p><p>è¿™ä¸€éƒ¨åˆ†å¯åœ¨ç¤ºä¾‹ä»£ç åº“çš„ <code>demo01/go-straight</code> åˆ†æ”¯ä¸ŠæŸ¥çœ‹ï¼š</p><pre><code>git checkout demo01/go-straightnpm run demo01</code></pre><p>ç°åœ¨ boid å·²ç»åŠ¨èµ·æ¥äº†ï¼Œä½†æ˜¯å´æ²¡æ³•åœæ­¢ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p><h2 id="å¦‚ä½•è®©-boid-åœ¨ç›®æ ‡ç‚¹å¤„åœæ­¢"><a href="#å¦‚ä½•è®©-boid-åœ¨ç›®æ ‡ç‚¹å¤„åœæ­¢" class="headerlink" title="å¦‚ä½•è®© boid åœ¨ç›®æ ‡ç‚¹å¤„åœæ­¢"></a>å¦‚ä½•è®© boid åœ¨ç›®æ ‡ç‚¹å¤„åœæ­¢</h2><p>è¦è®© boid èƒ½å¤ŸçŸ¥é“è‡ªå·±åˆ°è¾¾äº†ç›®æ ‡ç‚¹ï¼Œåˆ™åœ¨æ¯ä¸€æ¬¡å¾ªç¯è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®¡ç®—å‡ºæ­¤åˆ»ç¦»ç›®æ ‡ç‚¹çš„è·ç¦»åˆ†é‡ <code>dx</code>ï¼Œ<code>dy</code>ï¼Œæ®æ­¤ç®—å‡ºè·ç¦» <code>dist</code>ï¼Œå°†å…¶ä¸é€Ÿåº¦ <code>speed</code> è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœ <code>dist &gt; speed</code>ï¼Œè¯´æ˜ç‰©ä½“ç¦»ç›®æ ‡ç‚¹è¿˜æŒºè¿œï¼Œç»§ç»­å°†é€Ÿåº¦åŠ åˆ°ä½ç½®ä¸Šå³å¯ã€‚åä¹‹åˆ™è¡¨æ˜ç‰©ä½“å°†è¦åˆ°è¾¾ç»ˆç‚¹ï¼Œæ­¤æ—¶è‹¥ç›´æ¥åŠ ä¸Šé€Ÿåº¦ï¼Œboid å¯èƒ½ä¼šè¶Šè¿‡ç›®æ ‡ç‚¹ï¼Œå› æ­¤éœ€è¦ä¸€ç‚¹ä¸åŒçš„å¤„ç†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºæ„ä»£ç </span></span><br><span class="line"><span class="function"><span class="title">step</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (reachDest) &#123;</span><br><span class="line">        <span class="comment">// å·²åˆ°è¾¾ç»ˆç‚¹ï¼Œå¯æ ¹æ®å®é™…éœ€è¦è¿›è¡Œæ“ä½œ            </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> speed = <span class="built_in">this</span>.speed;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ç›®æ ‡ç‚¹çš„è·ç¦»</span></span><br><span class="line">    <span class="built_in">this</span>.dx = target.x - <span class="built_in">this</span>.x;</span><br><span class="line">    <span class="built_in">this</span>.dy = target.y - <span class="built_in">this</span>.y;</span><br><span class="line">    <span class="built_in">this</span>.dist = <span class="built_in">Math</span>.sqrt(<span class="built_in">this</span>.dx * <span class="built_in">this</span>.dx + <span class="built_in">this</span>.dy * <span class="built_in">this</span>.dy);</span><br><span class="line">    <span class="built_in">this</span>.angle = <span class="built_in">Math</span>.atan2(<span class="built_in">this</span>.dy, <span class="built_in">this</span>.dx);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€Ÿåº¦åˆ†é‡</span></span><br><span class="line">    <span class="built_in">this</span>.vx = <span class="built_in">Math</span>.cos(<span class="built_in">this</span>.angle) * speed;</span><br><span class="line">    <span class="built_in">this</span>.vy = <span class="built_in">Math</span>.sin(<span class="built_in">this</span>.angle) * speed;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.dist &gt; speed) &#123;</span><br><span class="line">        <span class="built_in">this</span>.x += <span class="built_in">this</span>.vx;</span><br><span class="line">        <span class="built_in">this</span>.y += <span class="built_in">this</span>.vy; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å½“å‰æ—¶åˆ»çš„ä½ç½®åŠ ä¸Šé€Ÿåº¦åè¶…è¿‡äº†å½“å‰ç›®æ ‡ç‚¹</span></span><br><span class="line">        <span class="comment">// ç‰©ä½“ä¸‹ä¸€æ—¶åˆ»å°†å¤„äºå½“å‰ç›®æ ‡ç‚¹çš„ä½ç½®</span></span><br><span class="line">        <span class="built_in">this</span>.x = target.x;</span><br><span class="line">        <span class="built_in">this</span>.y = target.y;</span><br><span class="line">        <span class="built_in">this</span>.reachDest = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†å¯åœ¨ç¤ºä¾‹ä»£ç åº“çš„ <code>demo01/stop</code> åˆ†æ”¯ä¸ŠæŸ¥çœ‹ï¼š</p><pre><code>git checkout demo01/stopnpm run demo01</code></pre><p>æ­¤æ—¶ï¼Œåˆ°è¾¾äº†ç»ˆç‚¹çš„ boid è¢«æ¸…é™¤è€Œä¸å†æ˜¾ç¤ºã€‚</p><h2 id="å¦‚ä½•è®©-boid-èƒ½å¤Ÿè½¬å‘"><a href="#å¦‚ä½•è®©-boid-èƒ½å¤Ÿè½¬å‘" class="headerlink" title="å¦‚ä½•è®© boid èƒ½å¤Ÿè½¬å‘"></a>å¦‚ä½•è®© boid èƒ½å¤Ÿè½¬å‘</h2><p>å‰é¢å™è¿°ä¸­ä¸ºäº†ç®€åŒ–ï¼Œè·¯å¾„ä¸­åªæœ‰èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œæ‰€ä»¥ boid æ²¡æœ‰æœºä¼šè½¬å‘ï¼Œé‚£å½“è·¯å¾„å˜å¤æ‚äº†ä¹‹åï¼Œboid è¯¥å¦‚ä½•è¿åŠ¨ï¼Ÿ</p><p>å‰é¢å·²ç»æåˆ°è¿‡ï¼Œ<code>path</code> æ˜¯ä¸€ä¸ªè®°å½•äº†è·¯å¾„ç½‘æ ¼åæ ‡çš„æ•°ç»„ï¼Œboid ä¼šä»ä¸­å–ä¸€ä¸ªåæ ‡ä½œä¸ºè‡ªå·±çš„å½“å‰ç›®æ ‡ç‚¹ï¼Œç„¶åä¸€ç›´å‘å‰è¡Œè¿›ï¼Œåˆ°è¾¾äº†è¿™ä¸ªç›®æ ‡ç‚¹ä¹‹åï¼Œå®ƒä¼šä» <code>path</code> æ•°ç»„ä¸­å–å‡ºä¸‹ä¸€ä¸ªåæ ‡ï¼Œç»§ç»­ç§»åŠ¨è‡³è¯¥ä½ç½®ã€‚å¾ªç¯ä»¥ä¸Šè¿‡ç¨‹ï¼Œç›´åˆ° boid åˆ°è¾¾ <code>path</code> ä¸­çš„æœ€åä¸€ä¸ªåæ ‡ã€‚</p><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡ç‚¹ <code>target</code> å›ºå®šä¸º <code>path</code> çš„æœ€åä¸€ä¸ªåæ ‡ï¼Œè€Œç°åœ¨æ¯ä¸€æ¬¡è½¬å‘æ—¶ <code>target</code> éƒ½ä¼šå˜åŒ–ï¼Œæ‰€ä»¥åŠ å…¥è¿™æ ·çš„ä¸¤ä¸ªå˜é‡ï¼š</p><ul><li><code>waypoint</code> è¡¨ç¤º<strong>å½“å‰</strong>ç›®æ ‡ç‚¹çš„ç´¢å¼•</li><li><code>angleFlag</code> è®°å½•æ˜¯å¦éœ€è¦è½¬å‘ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Boid çš„ step() ä¸­çš„éƒ¨åˆ†ç¤ºæ„ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ¯æ¬¡è½¬å‘åç›®æ ‡ç‚¹éœ€è¦é‡æ–°è®¡ç®— */</span></span><br><span class="line"><span class="keyword">const</span> waypoint = path[<span class="built_in">this</span>.waypoint];   <span class="comment">// å½“å‰ç›®æ ‡ç‚¹çš„ç½‘æ ¼åæ ‡</span></span><br><span class="line"><span class="keyword">const</span> target = index2Px(...waypoint);   <span class="comment">// å½“å‰ç›®æ ‡ç‚¹çš„åƒç´ åæ ‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬å‘ï¼Œå¦‚æœéœ€è¦è½¬å‘ï¼Œåˆ™é‡æ–°è®¡ç®—è§’åº¦</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.angleFlag) &#123;</span><br><span class="line">    <span class="built_in">this</span>.angle = <span class="built_in">Math</span>.atan2(<span class="built_in">this</span>.dy, <span class="built_in">this</span>.dx);</span><br><span class="line">    <span class="built_in">this</span>.angleFlag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯æ¬¡åˆ°è¾¾ä¸€ä¸ªç›®æ ‡ç‚¹ä¹‹åï¼Œéƒ½è¦æ£€æŸ¥æ˜¯å¦ä¸ºç»ˆç‚¹</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.waypoint + <span class="number">1</span> &gt;= path.length) &#123;</span><br><span class="line">    <span class="comment">// åˆ°è¾¾ç»ˆç‚¹</span></span><br><span class="line">    <span class="built_in">this</span>.reachDest = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.waypoint++;</span><br><span class="line">    <span class="built_in">this</span>.angleFlag = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†å¯åœ¨ç¤ºä¾‹ä»£ç åº“çš„ <code>demo01/steering</code> åˆ†æ”¯ä¸ŠæŸ¥çœ‹ï¼š</p><pre><code>git checkout demo01/steeringnpm run demo01</code></pre><p>ç»“æœå¯è§ä¸‹å›¾ï¼š<br><img src="/asset/images/2017-12-09-path-following-1.png" alt=""></p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œè¿™ç§ boid æ²¿è·¯å¾„è¡Œè¿›çš„æ–¹æ³•å·²ç»è®²è§£å®Œæ¯•äº†ã€‚å»ºè®®è¯»è€…æŸ¥çœ‹ä¸€ä¸‹ repo ä¸­çš„ä»£ç ï¼Œè‡ªå·±ä¿®æ”¹éƒ¨åˆ†ä»£ç ï¼Œæ¯”å¦‚æ›´æ”¹è·¯å¾„ï¼Œçœ‹ç»“æœä¼šæœ‰ä½•ä¸åŒã€‚</p><h2 id="å…¶å®ƒçš„æ–¹æ³•"><a href="#å…¶å®ƒçš„æ–¹æ³•" class="headerlink" title="å…¶å®ƒçš„æ–¹æ³•"></a>å…¶å®ƒçš„æ–¹æ³•</h2><p>è¿™ä¸€ç§æ–¹æ³•ä¸­çš„ç¡®å®ç°äº†æ²¿è·¯å¾„ç§»åŠ¨çš„æ•ˆæœï¼Œä½†æ˜¯æœ‰ç‚¹å„¿å•è°ƒï¼Œboid åªèƒ½åœ¨è·¯å¾„çš„ä¸­è½´çº¿ä¸Šç§»åŠ¨ï¼Œè€Œä¸”å®ƒä»¬ä¹‹é—´ä¹Ÿæ²¡æœ‰äº¤äº’çš„æ•ˆæœã€‚<a href="http://natureofcode.com/book/">The Nature of Code</a> è¿™æœ¬ä¹¦çš„ç¬¬å…­ç«  <a href="http://natureofcode.com/book/chapter-6-autonomous-agents/">Autonomous Agents</a> ä¸­ä»‹ç»äº†å¦ä¸€ç§ç¨å¾®å¤æ‚çš„æ–¹æ³•æ¥å®ç° path followingã€‚</p><p>æˆ‘ä¹‹å‰å‚è€ƒä»–äººçš„ä»£ç å®ç°äº†<a href="http://www.wukai.me/html-demo/path-following/">è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªæ¼”ç¤ºç‰ˆæœ¬</a>ï¼Œå…¶ä»£ç åœ¨<a href="https://github.com/noiron/html-demo/tree/master/path-following">æ­¤å¤„</a>ã€‚</p><p>(ä¹Ÿè®¸ä¹‹åä¼šè¡¥ä¸€ç¯‡åšå®¢æ¥ä»‹ç» <em>The Nature of Code</em> ä¸­çš„å®ç°ï¼Œä½†è°çŸ¥é“ä¼šä¸ä¼šå†™å‘¢ğŸ¤”)</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æœ€åï¼Œ<a href="https://github.com/noiron/tower-defense-js">æˆ‘æœ€è¿‘åœ¨å†™çš„è¿™ä¸ªå¡”é˜²æ¸¸æˆ</a>ä¸­å°±ä½¿ç”¨äº†æœ¬æ–‡ä»‹ç»çš„ path following æ–¹æ³•ã€‚è™½ç„¶æ¸¸æˆè¿˜æ²¡å®Œæˆï¼Œä½†ç‚¹è¿›å»çœ‹çœ‹å†ç»™ä¸ª star åˆä¸è´¹ç”µğŸ˜€ã€‚</p><hr><p><a href="http://www.wukai.me/2017/12/09/boid-path-following/">æœ¬æ–‡åœ°å€ï¼šå¡”é˜²æ¸¸æˆä¸­çš„æ•Œäººå¦‚ä½•æ²¿è·¯å¾„å‰è¿› (JavaScript å®ç°)</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚æœå¼€å‘ä¸€ä¸ªå¡”é˜²æ¸¸æˆï¼Œå¾ˆè‡ªç„¶çš„ä¼šé‡ä¸Šè¿™ä¹ˆä¸¤ä¸ªåå­—å¾ˆåƒçš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Path-finding&lt;/strong&gt;: å¦‚æœçŸ¥é“èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œå¦‚ä½•åœ¨å…¶é—´æ‰¾åˆ°ä¸€æ¡è·¯å¾„&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Path-following&lt;/strong&gt;: å·²çŸ¥ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ï¼Œç‰©ä½“å¦‚ä½•æ‰èƒ½æ²¿ç€å®ƒè¡Œè¿›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡å°†è¦è®¨è®ºçš„æ˜¯ç¬¬äºŒä¸ªé—®é¢˜ &lt;strong&gt;path following&lt;/strong&gt;ï¼Œç»™å®šä¸€æ¡è·¯å¾„ï¼Œçœ‹ç‰©ä½“å¦‚ä½•æ²¿ç€å®ƒä»èµ·ç‚¹è¿è¡Œè‡³ç»ˆç‚¹ã€‚ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæ¥ä¸‹æ¥çš„å†…å®¹ä¸­ï¼Œç”¨å•è¯ &lt;a href=&quot;https://en.wikipedia.org/wiki/Boids&quot;&gt;Boid&lt;/a&gt; æ¥è¡¨ç¤ºè¡Œè¿›çš„ç‰©ä½“æˆ–å¡”é˜²ä¸­çš„æ•Œäººã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä¼šç”¨ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæœ€ç»ˆå®Œæˆçš„ä»£ç åº“å¯è§ GitHub: &lt;a href=&quot;https://github.com/noiron/boid-path-following&quot;&gt;boid-path-following&lt;/a&gt;ï¼Œrepo çš„å¤šä¸ªåˆ†æ”¯å¯¹åº”äº†æ–‡ä¸­çš„ä¸åŒæ­¥éª¤ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.wukai.me/tags/javascript/"/>
    
      <category term="æ¸¸æˆå¼€å‘" scheme="http://www.wukai.me/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>React Router v4 ä¹‹ä»£ç åˆ†å‰²ï¼šä»æ”¾å¼ƒåˆ°å…¥é—¨</title>
    <link href="http://www.wukai.me/2017/09/25/react-router-v4-code-splitting/"/>
    <id>http://www.wukai.me/2017/09/25/react-router-v4-code-splitting/</id>
    <published>2017-09-24T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.545Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><p>React Router v4 æ¨å‡ºå·²æœ‰å…­ä¸ªæœˆäº†ï¼Œç½‘ç»œä¸Šå› ç‰ˆæœ¬å‡çº§å¸¦æ¥çš„å“€åšä»¿ä½›å°±åœ¨åŠå¹´å‰ã€‚æˆ‘åœ¨ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„ React Router æ—¶ï¼Œä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚è¿™é‡Œæ‰€è¯´çš„ä»£ç åˆ†å‰²ï¼Œæ‰€ä»¥å†™äº†è¿™ç¯‡åšå®¢ä½œä¸ºæ€»ç»“ï¼Œå¸Œæœ›èƒ½å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆcode-splittingï¼‰"><a href="#ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆcode-splittingï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰"></a>ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰</h2><p>åœ¨ç”¨æˆ·æµè§ˆæˆ‘ä»¬çš„ç½‘ç«™æ—¶ï¼Œä¸€ç§æ–¹æ¡ˆæ˜¯ä¸€æ¬¡æ€§åœ°å°†æ‰€æœ‰çš„ JavaScript ä»£ç éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œä»£ç ä½“ç§¯ä¼šå¾ˆå¯è§‚ï¼ŒåŒæ—¶è¿™äº›ä»£ç ä¸­çš„ä¸€éƒ¨åˆ†å¯èƒ½æ˜¯ç”¨æˆ·æ­¤æ—¶å¹¶ä¸éœ€è¦çš„ã€‚å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æŒ‰éœ€åŠ è½½ï¼Œå°† JavaScript ä»£ç åˆ†æˆå¤šä¸ªå—ï¼ˆchunkï¼‰ï¼Œç”¨æˆ·åªéœ€ä¸‹è½½å½“å‰æµè§ˆæ‰€éœ€çš„ä»£ç å³å¯ï¼Œç”¨æˆ·è¿›å…¥åˆ°å…¶å®ƒé¡µé¢æˆ–éœ€è¦æ¸²æŸ“å…¶å®ƒéƒ¨åˆ†æ—¶ï¼Œæ‰åŠ è½½æ›´å¤šçš„ä»£ç ã€‚è¿™åä¸€ç§æ–¹æ¡ˆä¸­ç”¨åˆ°çš„å°±æ˜¯æ‰€è°“çš„<strong>ä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰</strong>äº†ã€‚</p><span id="more"></span><p>å½“ç„¶ä¸ºäº†å®ç°ä»£ç åˆ†å‰²ï¼Œä»ç„¶éœ€è¦å’Œ webpack æ­é…ä½¿ç”¨ï¼Œå…ˆæ¥çœ‹çœ‹ webpack çš„æ–‡æ¡£ä¸­æ˜¯å¦‚ä½•ä»‹ç»çš„ã€‚</p><p><a href="https://webpack.js.org/guides/code-splitting/">Webpack æ–‡æ¡£çš„ code splitting é¡µé¢</a>ä¸­ä»‹ç»äº†ä¸‰ç§æ–¹æ³•ï¼š</p><ol><li>åˆ©ç”¨ webpack ä¸­çš„ <code>entry</code> é…ç½®é¡¹æ¥è¿›è¡Œæ‰‹åŠ¨åˆ†å‰²</li><li>åˆ©ç”¨ <code>CommonsChunkPlugin</code> æ’ä»¶æ¥æå–é‡å¤ chunk</li><li>åŠ¨æ€å¼•å…¥ï¼ˆDynamic Importsï¼‰</li></ol><p>ä½ å¯ä»¥è¯»ä¸€ä¸‹æ­¤ç¯‡æ–‡æ¡£ï¼Œä»è€Œå¯¹ webpack æ˜¯å¦‚ä½•è¿›è¡Œä»£ç åˆ†å‰²çš„æœ‰ä¸ªåŸºæœ¬çš„è®¤è¯†ã€‚æœ¬æ–‡åé¢å°†æåˆ°çš„æ–¹æ¡ˆå°±æ˜¯åŸºäºä¸Šè¿°çš„ç¬¬ä¸‰ç§æ–¹æ³•ã€‚</p><h2 id="React-Router-ä¸­å¦‚ä½•è¿›è¡Œä»£ç åˆ†å‰²"><a href="#React-Router-ä¸­å¦‚ä½•è¿›è¡Œä»£ç åˆ†å‰²" class="headerlink" title="React Router ä¸­å¦‚ä½•è¿›è¡Œä»£ç åˆ†å‰²"></a>React Router ä¸­å¦‚ä½•è¿›è¡Œä»£ç åˆ†å‰²</h2><p>åœ¨ v4 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä¸€èˆ¬æ˜¯åˆ©ç”¨ <code>require.ensure()</code> æ¥å®ç°ä»£ç åˆ†å‰²çš„ï¼Œè€Œåœ¨ v4 ä¸­åˆæ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿ</p><h3 id="ä½¿ç”¨-bundle-loader-çš„æ–¹æ¡ˆ"><a href="#ä½¿ç”¨-bundle-loader-çš„æ–¹æ¡ˆ" class="headerlink" title="ä½¿ç”¨ bundle-loader çš„æ–¹æ¡ˆ"></a>ä½¿ç”¨ bundle-loader çš„æ–¹æ¡ˆ</h3><p>åœ¨ React Router v4 å®˜æ–¹ç»™å‡ºçš„<a href="https://reacttraining.com/react-router/web/guides/code-splitting">æ–‡æ¡£</a>ä¸­ï¼Œä½¿ç”¨äº†åä¸º <a href="https://github.com/webpack-contrib/bundle-loader"><code>bundle-loader</code></a> çš„å·¥å…·æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚</p><p>å…¶ä¸»è¦å®ç°æ€è·¯ä¸ºåˆ›å»ºä¸€ä¸ªåä¸º <code>&lt;Bundle&gt;</code> çš„ç»„ä»¶ï¼Œå½“åº”ç”¨åŒ¹é…åˆ°äº†å¯¹åº”çš„è·¯å¾„æ—¶ï¼Œè¯¥ç»„ä»¶ä¼šåŠ¨æ€åœ°å¼•å…¥æ‰€éœ€æ¨¡å—å¹¶å°†è‡ªèº«æ¸²æŸ“å‡ºæ¥ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loadSomething <span class="keyword">from</span> <span class="string">&#x27;bundle-loader?lazy!./Something&#x27;</span></span><br><span class="line"></span><br><span class="line">&lt;Bundle load=&#123;loadSomething&#125;&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">mod</span>) =&gt;</span> (</span><br><span class="line">    <span class="comment">// do something w/ the module</span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/Bundle&gt;</span><br></pre></td></tr></table></figure><p>æ›´å¤šå…³äº <code>&lt;Bundle&gt;</code> ç»„ä»¶çš„å®ç°å¯å‚è§ä¸Šé¢ç»™å‡ºçš„æ–‡æ¡£åœ°å€ã€‚</p><h3 id="ä½¿ç”¨-bundle-loader-æ–¹æ³•å­˜åœ¨çš„ä¸è¶³ä¹‹å¤„"><a href="#ä½¿ç”¨-bundle-loader-æ–¹æ³•å­˜åœ¨çš„ä¸è¶³ä¹‹å¤„" class="headerlink" title="ä½¿ç”¨ bundle-loader æ–¹æ³•å­˜åœ¨çš„ä¸è¶³ä¹‹å¤„"></a>ä½¿ç”¨ bundle-loader æ–¹æ³•å­˜åœ¨çš„ä¸è¶³ä¹‹å¤„</h3><p>è¿™é‡Œæåˆ°çš„ä¸¤ä¸ªç¼ºç‚¹æˆ‘ä»¬åœ¨å®é™…å¼€å‘å·¥ä½œä¸­é‡åˆ°çš„ï¼Œä¸æˆ‘ä»¬çš„é¡¹ç›®ç‰¹å®šç»“æ„ç›¸å…³ï¼Œæ‰€ä»¥ä½ å¯èƒ½å¹¶ä¸ä¼šé‡ä¸Šã€‚</p><p>ä¸€ã€ ä»£ç ä¸‘é™‹</p><p>ç”±äºæˆ‘ä»¬çš„é¡¹ç›®æ˜¯ä» React Router v2, v3 å‡çº§è¿‡æ¥çš„ï¼Œåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å¯¹äºå¼‚æ­¥åŠ è½½çš„å®ç°é‡‡ç”¨äº†é›†ä¸­é…ç½®çš„æ–¹æ¡ˆï¼Œå³é¡¹ç›®ä¸­å­˜åœ¨ä¸€ä¸ª <code>Routes.js</code> æ–‡ä»¶ï¼Œæ•´ä¸ªé¡¹ç›®çš„è·¯å¾„è®¾ç½®éƒ½æ”¾åœ¨äº†è¯¥æ–‡ä»¶ä¸­ï¼Œè¿™æ ·æ–¹ä¾¿é›†ä¸­ç®¡ç†ã€‚</p><p>ä½†æ˜¯åœ¨ React Router v4 ç‰ˆæœ¬ä¸­ï¼Œç”±äºä½¿ç”¨äº† <code>bundle-loader</code> æ¥å®ç°ä»£ç åˆ†å‰²ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹å†™æ³•æ¥å¼•å…¥ç»„ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loadSomething <span class="keyword">from</span> <span class="string">&#x27;bundle-loader?lazy!./Something&#x27;</span></span><br></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬çš„ <code>reducer</code> å’Œ <code>saga</code> æ–‡ä»¶ä¹Ÿéœ€è¦ä½¿ç”¨æ­¤ç§æ–¹æ³•å¼•å…¥ï¼Œå¯¼è‡´ <code>Routes.js</code> æ–‡ä»¶é¡¶ç«¯å°†ä¼šå‡ºç°ä¸€é•¿ä¸²åŠå…¶å†—é•¿çš„ç»„ä»¶å¼•å…¥ä»£ç ï¼Œä¸æ˜“ç»´æŠ¤ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/asset/images/2017-08-14-bundle-loader.png" alt=""></p><p>å½“ç”¨è¿™ç§æ–¹æ³•å¼•å…¥çš„æ¨¡å—æ•°é‡è¿‡å¤šæ—¶ï¼Œæ–‡ä»¶å°†ä¼šä¸å¿ç›´è§†ã€‚</p><p>äºŒã€ å­˜åœ¨è«åçš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸBug</p><p>åœ¨ä½¿ç”¨äº†è¿™ç§æ–¹æ¡ˆåï¼Œåœ¨æŸäº›é¡µé¢ä¸­ä¼šå‡ºç°è¿™æ ·çš„ä¸€ä¸ªBugï¼šåº”ç”¨ä¸­è¿›è¡Œé¡µé¢è·³è½¬æ—¶ï¼Œä¸Šä¸€ä¸ªé¡µé¢çš„ç»„ä»¶ä¼šåœ¨ <code>unmount</code> ä¹‹åé‡æ–°åˆ›å»ºä¸€æ¬¡ã€‚è¡¨ç°ä¸ºå·²ç»åˆ°äº†ä¸‹ä¸€é¡µé¢ï¼Œä½†æ˜¯ä¼šè°ƒç”¨å­˜åœ¨äºè·³è½¬å‰é¡µé¢ä¸­çš„ç»„ä»¶çš„ <code>componentDidMount</code> æ–¹æ³•ã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªBugåªä¸æˆ‘è‡ªå·±çš„ç‰¹å®šé¡¹ç›®æœ‰å…³ï¼Œé”™è¯¯åŸå› å¯èƒ½ä¸ <code>bundle-loader</code> å¹¶æ— å¤ªå¤§å…³è”ã€‚ä¸è¿‡å› ä¸ºä¸€ç›´æ— æ³•è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæ‰€ä»¥å†³å®šæ¢ä¸€ä¸ªæ–¹æ¡ˆæ¥ä»£æ›¿ <code>bundle-loader</code>ã€‚</p><h2 id="ä½¿ç”¨-import-çš„æ–°æ–¹æ¡ˆ"><a href="#ä½¿ç”¨-import-çš„æ–°æ–¹æ¡ˆ" class="headerlink" title="ä½¿ç”¨ import() çš„æ–°æ–¹æ¡ˆ"></a>ä½¿ç”¨ import() çš„æ–°æ–¹æ¡ˆ</h2><p>Dan Abramov åœ¨è¿™ä¸ª create-react-app çš„ issue ä¸­ç»™å‡ºäº† <code>bundle-loader</code> çš„æ›¿ä»£æ–¹æ¡ˆçš„é“¾æ¥ï¼š<a href="http://serverless-stack.com/chapters/code-splitting-in-create-react-app.html">Code Splitting in Create React App</a>ï¼Œå¯ä»¥å‚è€ƒè¯¥ç¯‡æ–‡ç« æ¥å®ç°æˆ‘ä»¬é¡¹ç›®ä¸­çš„ä»£ç åˆ†å‰²åŠŸèƒ½ã€‚</p><h3 id="ä»£ç åˆ†å‰²å’Œ-React-Router-v4"><a href="#ä»£ç åˆ†å‰²å’Œ-React-Router-v4" class="headerlink" title="ä»£ç åˆ†å‰²å’Œ React Router v4"></a>ä»£ç åˆ†å‰²å’Œ React Router v4</h3><p>ä¸€ä¸ªå¸¸è§„çš„ React Router é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç å‡ºå¤„ï¼š</span></span><br><span class="line"><span class="comment">// http://serverless-stack.com/chapters/code-splitting-in-create-react-app.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Import the components */</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;./containers/Home&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Posts <span class="keyword">from</span> <span class="string">&#x27;./containers/Posts&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> NotFound <span class="keyword">from</span> <span class="string">&#x27;./containers/NotFound&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Use components to define routes */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/posts/:id&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Posts&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">component</span>=<span class="string">&#123;NotFound&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ ¹æ®æˆ‘ä»¬çš„ route å¼•å…¥ç›¸åº”çš„ç»„ä»¶ï¼Œç„¶åå°†å…¶ç”¨äºå®šä¹‰ç›¸åº”çš„ <code>&lt;Route&gt;</code>ã€‚</p><p>ä½†æ˜¯ï¼Œä¸ç®¡åŒ¹é…åˆ°äº†å“ªä¸€ä¸ª routeï¼Œæˆ‘ä»¬è¿™é‡Œéƒ½ä¸€æ¬¡æ€§åœ°å¼•å…¥æ‰€æœ‰çš„ç»„ä»¶ã€‚è€Œæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯å½“åŒ¹é…äº†ä¸€ä¸ª routeï¼Œåˆ™åªå¼•å…¥ä¸å…¶å¯¹åº”çš„ç»„ä»¶ï¼Œè¿™å°±éœ€è¦å®ç°ä»£ç åˆ†å‰²äº†ã€‚</p><h3 id="åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼ˆAsync-Componentï¼‰"><a href="#åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼ˆAsync-Componentï¼‰" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼ˆAsync Componentï¼‰"></a>åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼ˆAsync Componentï¼‰</h3><p>å¼‚æ­¥ç»„ä»¶ï¼Œå³åªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šå¼•å…¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncComponent</span>(<span class="params">importComponent</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AsyncComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>(props);</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.state = &#123;</span><br><span class="line">        <span class="attr">component</span>: <span class="literal">null</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">default</span>: component &#125; = <span class="keyword">await</span> importComponent();</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        <span class="attr">component</span>: component</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> C = <span class="built_in">this</span>.state.component;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> C</span><br><span class="line">        ? <span class="xml"><span class="tag">&lt;<span class="name">C</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">        : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> AsyncComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>asyncComponent</code> æ¥æ”¶ä¸€ä¸ª <code>importComponent</code> å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œ<code>importComponent()</code> åœ¨è¢«è°ƒç”¨æ—¶ä¼šåŠ¨æ€å¼•å…¥ç»™å®šçš„ç»„ä»¶ã€‚</p><p>åœ¨ <code>componentDidMount()</code>ä¸­ï¼Œè°ƒç”¨ä¼ å…¥çš„ <code>importComponent()</code>ï¼Œå¹¶å°†åŠ¨æ€å¼•å…¥çš„ç»„ä»¶ä¿å­˜åœ¨ state ä¸­ã€‚</p><h3 id="ä½¿ç”¨å¼‚æ­¥ç»„ä»¶ï¼ˆAsync-Componentï¼‰"><a href="#ä½¿ç”¨å¼‚æ­¥ç»„ä»¶ï¼ˆAsync-Componentï¼‰" class="headerlink" title="ä½¿ç”¨å¼‚æ­¥ç»„ä»¶ï¼ˆAsync Componentï¼‰"></a>ä½¿ç”¨å¼‚æ­¥ç»„ä»¶ï¼ˆAsync Componentï¼‰</h3><p>ä¸å†ä½¿ç”¨å¦‚ä¸‹é™æ€å¼•å…¥ç»„ä»¶çš„æ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;./containers/Home&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è€Œæ˜¯ä½¿ç”¨ <code>asyncComponent</code> æ–¹æ³•æ¥åŠ¨æ€å¼•å…¥ç»„ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AsyncHome = asyncComponent(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./containers/Home&#x27;</span>));</span><br></pre></td></tr></table></figure><p>æ­¤å¤„çš„ <code>import()</code> æ¥è‡ªäºæ–°çš„ ES ææ¡ˆï¼Œå…¶ç»“æœæ˜¯ä¸€ä¸ª Promiseï¼Œè¿™æ˜¯ä¸€ç§åŠ¨æ€å¼•å…¥æ¨¡å—çš„æ–¹æ³•ï¼Œå³ä¸Šæ–‡ webpack æ–‡æ¡£ä¸­æåˆ°çš„ç¬¬ä¸‰ç§æ–¹æ³•ã€‚æ›´å¤šå…³äº <code>import()</code> çš„ä¿¡æ¯å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="http://2ality.com/2017/01/import-operator.html">ES proposal: import() â€“ dynamically importing ES modules</a>ã€‚</p><p>æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰è¿›è¡Œç»„ä»¶çš„å¼•å…¥ï¼Œè€Œæ˜¯ä¼ ç»™äº† <code>asyncComponent</code> ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†åœ¨ <code>AsyncHome</code> ç»„ä»¶è¢«åˆ›å»ºæ—¶è¿›è¡ŒåŠ¨æ€å¼•å…¥ã€‚åŒæ—¶ï¼Œè¿™ç§ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè€Œéç›´æ¥ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²çš„å†™æ³•èƒ½å¤Ÿè®© webpack æ„è¯†åˆ°æ­¤å¤„éœ€è¦è¿›è¡Œä»£ç åˆ†å‰²ã€‚</p><p>æœ€åå¦‚ä¸‹ä½¿ç”¨è¿™ä¸ª <code>AsyncHome</code> ç»„ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&quot;/&quot;</span> exact component=&#123;AsyncHome&#125; /&gt;</span><br></pre></td></tr></table></figure><h3 id="å¯¹äº-reducer-å’Œ-saga-æ–‡ä»¶çš„å¼‚æ­¥åŠ è½½"><a href="#å¯¹äº-reducer-å’Œ-saga-æ–‡ä»¶çš„å¼‚æ­¥åŠ è½½" class="headerlink" title="å¯¹äº reducer å’Œ saga æ–‡ä»¶çš„å¼‚æ­¥åŠ è½½"></a>å¯¹äº reducer å’Œ saga æ–‡ä»¶çš„å¼‚æ­¥åŠ è½½</h3><p>åœ¨ä¸Šé¢çš„è¿™ç¯‡æ–‡ç« ä¸­ï¼Œåªç»™å‡ºäº†å¯¹äºç»„ä»¶çš„å¼‚æ­¥å¼•å…¥çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­è¿˜å­˜åœ¨å°† <code>reducer</code> å’Œ <code>saga</code> æ–‡ä»¶å¼‚æ­¥å¼•å…¥çš„éœ€æ±‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">processReducer</span>(<span class="params">reducer</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(reducer)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.all(reducer.map(<span class="function"><span class="params">r</span> =&gt;</span> <span class="built_in">this</span>.processReducer(r)));</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> key = <span class="built_in">Object</span>.keys(reducer)[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">return</span> reducer[key]().then(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">            injectAsyncReducer(key, x.default);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†éœ€è¦å¼‚æ­¥å¼•å…¥çš„ reducer ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œåˆ©ç”¨ Promise æ¥å¯¹å…¶è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚åœ¨ <code>componentDidMount</code> æ–¹æ³•ä¸­ç­‰å¾… reducer å¤„ç†å®Œæ¯•ååœ¨å°†ç»„ä»¶ä¿å­˜åœ¨ state ä¸­ï¼Œå¯¹äº saga æ–‡ä»¶åŒç†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// componentDidMount ä¸­åšå¦‚ä¸‹ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">default</span>: component &#125; = <span class="keyword">await</span> importComponent();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Promise</span>.all([<span class="built_in">this</span>.processReducer(reducers),</span><br><span class="line">            <span class="built_in">this</span>.processSaga(sagas)]).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            component</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢å¯¹ <code>reducer</code> æ–‡ä»¶è¿›è¡Œå¤„ç†æ—¶ï¼Œä½¿ç”¨äº†è¿™æ ·çš„ä¸€è¡Œä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">injectAsyncReducer(key, x.default);</span><br></pre></td></tr></table></figure><p>å…¶ä½œç”¨æ˜¯åˆ©ç”¨ Redux ä¸­çš„ <code>replaceReducer()</code> æ–¹æ³•æ¥ä¿®æ”¹ reducerï¼Œå…·ä½“ä»£ç è§ä¸‹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reducerList æ˜¯ä½ å½“å‰çš„ reducer åˆ—è¡¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createReducer</span>(<span class="params">asyncReducers</span>) </span>&#123;</span><br><span class="line">    asyncReducers</span><br><span class="line">    &amp;&amp; !reducersList[<span class="built_in">Object</span>.keys(asyncReducers)[<span class="number">0</span>]]</span><br><span class="line">    &amp;&amp; (reducersList = <span class="built_in">Object</span>.assign(&#123;&#125;, reducersList, asyncReducers));</span><br><span class="line">    <span class="keyword">return</span> combineReducers(reducersList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">injectAsyncReducer</span>(<span class="params">name, asyncReducer</span>) </span>&#123;</span><br><span class="line">    store.replaceReducer(createReducer(&#123; [name]: asyncReducer &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ asyncComponent ä»£ç å¯è§ä»¥ä¸‹ gistï¼Œæ³¨æ„ä¸€ç‚¹ï¼Œä¸ºäº†èƒ½å¤Ÿçµæ´»åœ°ä½¿ç”¨ä¸åŒçš„ <code>injectAsyncReducer</code>, <code>injectAsyncSaga</code> å‡½æ•°ï¼Œä»£ç ä¸­ä½¿ç”¨äº†é«˜é˜¶ç»„ä»¶çš„å†™æ³•ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨å†…å±‚çš„ <code>asyncComponent</code> å‡½æ•°ã€‚</p><script src="https://gist.github.com/noiron/7f774dea55bcc52921e5bc5a50c2aa10.js"></script><h2 id="asyncComponent-æ–¹æ³•ä¸-React-Router-v4-çš„ç»“åˆä½¿ç”¨"><a href="#asyncComponent-æ–¹æ³•ä¸-React-Router-v4-çš„ç»“åˆä½¿ç”¨" class="headerlink" title="asyncComponent æ–¹æ³•ä¸ React Router v4 çš„ç»“åˆä½¿ç”¨"></a>asyncComponent æ–¹æ³•ä¸ React Router v4 çš„ç»“åˆä½¿ç”¨</h2><h3 id="ç»„ä»¶ã€reducerã€saga-çš„å¼‚æ­¥å¼•å…¥"><a href="#ç»„ä»¶ã€reducerã€saga-çš„å¼‚æ­¥å¼•å…¥" class="headerlink" title="ç»„ä»¶ã€reducerã€saga çš„å¼‚æ­¥å¼•å…¥"></a>ç»„ä»¶ã€reducerã€saga çš„å¼‚æ­¥å¼•å…¥</h3><p>è€ƒè™‘åˆ°ä»£ç å¯è¯»æ€§ï¼Œå¯åœ¨ä½ çš„ <code>route</code> ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <code>asyncImport.js</code> æ–‡ä»¶ï¼Œå°†éœ€è¦å¼‚æ­¥å¼•å…¥çš„æ¨¡å—å†™åœ¨è¯¥æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥å‰é¢æ‰€å†™çš„å¼‚æ­¥åŠ è½½å‡½æ•°</span></span><br><span class="line"><span class="keyword">import</span> asyncComponent <span class="keyword">from</span> <span class="string">&#x27;route/AsyncComponent&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåªéœ€è¦ç»„ä»¶</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> AsyncHomePage = asyncComponent(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./homepage/Homepage&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º component, reducer, saga</span></span><br><span class="line"><span class="comment">// æ³¨æ„è¿™é‡Œçš„ç¬¬äºŒä¸ªå‚æ•° reducer æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶é”®å€¼å¯¹åº”äºredux storeä¸­å­˜æ”¾çš„é”®å€¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> AsyncArticle = asyncComponent(</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./market/Common/js/Container&#x27;</span>),</span><br><span class="line">    &#123; <span class="attr">market</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./market/Common/js/reducer&#x27;</span>) &#125;,</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./market/Saga/watcher&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// reducer å’Œ saga å‚æ•°å¯ä»¥ä¼ å…¥æ•°ç»„</span></span><br><span class="line"><span class="comment">// å½“åªæœ‰ sagaï¼Œè€Œæ—  reducer å‚æ•°æ—¶ï¼Œç¬¬äºŒé¡¹å‚æ•°ä¼ å…¥ç©ºæ•°ç»„ []</span></span><br><span class="line"><span class="keyword">const</span> UserContainer = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./user/Common/js/Container&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> userReducer = &#123; <span class="attr">userInfo</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./user/Common/js/userInfoReducer&#x27;</span>) &#125;;</span><br><span class="line"><span class="keyword">const</span> userSaga = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./user/Saga/watcher&#x27;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> AsyncUserContainer = asyncComponent(</span><br><span class="line">    UserContainer,</span><br><span class="line">    [userReducer, createReducer],</span><br><span class="line">    [userSaga, createSaga]</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é¡¹ç›®çš„ <code>Router</code> ç»„ä»¶ä¸­å¼•ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// route/index.jsx</span></span><br><span class="line">&lt;Route path=<span class="string">&quot;/user&quot;</span> component=&#123;AsyncArticle&#125; /&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/user/:userId&quot;</span> <span class="attr">component</span>=<span class="string">&#123;AsyncUserContainer&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><p>æ ¹æ® React Router v4 çš„å“²å­¦ï¼ŒReact Router ä¸­çš„ä¸€åˆ‡çš†ä¸ºç»„ä»¶ï¼Œæ‰€ä»¥ä¸å¿…åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ç»Ÿä¸€é…ç½®æ‰€æœ‰çš„è·¯ç”±ä¿¡æ¯ã€‚å»ºè®®åœ¨ä½ æœ€å¤–å±‚çš„å®¹å™¨ç»„ä»¶ï¼Œæ¯”å¦‚æˆ‘çš„ <code>route/index.jsx</code> æ–‡ä»¶ä¸­åªå†™å…¥<strong>å¯¹åº”ä¸€ä¸ªå•ç‹¬é¡µé¢çš„å®¹å™¨ç»„ä»¶</strong>ï¼Œè€Œé¡µé¢ä¸­çš„å­ç»„ä»¶åœ¨è¯¥å®¹å™¨ç»„ä»¶ä¸­å¼‚æ­¥å¼•å…¥å¹¶ä½¿ç”¨ã€‚</p><p><del>åœ¨ React Router v5 å‘å¸ƒä¹‹å‰å®Œæˆäº†æœ¬æ–‡ï¼Œå¯å–œå¯è´ºğŸ‘</del></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote><p><a href="http://serverless-stack.com/chapters/code-splitting-in-create-react-app.html">Code Splitting in Create React App</a><br><a href="http://2ality.com/2017/01/import-operator.html">ES proposal: import() â€“ dynamically importing ES modules</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;èƒŒæ™¯ä»‹ç»&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯ä»‹ç»&quot;&gt;&lt;/a&gt;èƒŒæ™¯ä»‹ç»&lt;/h2&gt;&lt;p&gt;React Router v4 æ¨å‡ºå·²æœ‰å…­ä¸ªæœˆäº†ï¼Œç½‘ç»œä¸Šå› ç‰ˆæœ¬å‡çº§å¸¦æ¥çš„å“€åšä»¿ä½›å°±åœ¨åŠå¹´å‰ã€‚æˆ‘åœ¨ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„ React Router æ—¶ï¼Œä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚è¿™é‡Œæ‰€è¯´çš„ä»£ç åˆ†å‰²ï¼Œæ‰€ä»¥å†™äº†è¿™ç¯‡åšå®¢ä½œä¸ºæ€»ç»“ï¼Œå¸Œæœ›èƒ½å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆcode-splittingï¼‰&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆcode-splittingï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰&lt;/h2&gt;&lt;p&gt;åœ¨ç”¨æˆ·æµè§ˆæˆ‘ä»¬çš„ç½‘ç«™æ—¶ï¼Œä¸€ç§æ–¹æ¡ˆæ˜¯ä¸€æ¬¡æ€§åœ°å°†æ‰€æœ‰çš„ JavaScript ä»£ç éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œä»£ç ä½“ç§¯ä¼šå¾ˆå¯è§‚ï¼ŒåŒæ—¶è¿™äº›ä»£ç ä¸­çš„ä¸€éƒ¨åˆ†å¯èƒ½æ˜¯ç”¨æˆ·æ­¤æ—¶å¹¶ä¸éœ€è¦çš„ã€‚å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æŒ‰éœ€åŠ è½½ï¼Œå°† JavaScript ä»£ç åˆ†æˆå¤šä¸ªå—ï¼ˆchunkï¼‰ï¼Œç”¨æˆ·åªéœ€ä¸‹è½½å½“å‰æµè§ˆæ‰€éœ€çš„ä»£ç å³å¯ï¼Œç”¨æˆ·è¿›å…¥åˆ°å…¶å®ƒé¡µé¢æˆ–éœ€è¦æ¸²æŸ“å…¶å®ƒéƒ¨åˆ†æ—¶ï¼Œæ‰åŠ è½½æ›´å¤šçš„ä»£ç ã€‚è¿™åä¸€ç§æ–¹æ¡ˆä¸­ç”¨åˆ°çš„å°±æ˜¯æ‰€è°“çš„&lt;strong&gt;ä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰&lt;/strong&gt;äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="webpack" scheme="http://www.wukai.me/tags/webpack/"/>
    
      <category term="react-router" scheme="http://www.wukai.me/tags/react-router/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨ socket.io å®ç°æ¶ˆæ¯å®æ—¶æ¨é€</title>
    <link href="http://www.wukai.me/2017/08/27/push-message-with-socketio/"/>
    <id>http://www.wukai.me/2017/08/27/push-message-with-socketio/</id>
    <published>2017-08-26T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.545Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¡¹ç›®èƒŒæ™¯ä»‹ç»"><a href="#é¡¹ç›®èƒŒæ™¯ä»‹ç»" class="headerlink" title="é¡¹ç›®èƒŒæ™¯ä»‹ç»"></a>é¡¹ç›®èƒŒæ™¯ä»‹ç»</h2><p>æœ€è¿‘åœ¨å†™çš„é¡¹ç›®ä¸­å­˜åœ¨ç€ç¤¾äº¤æ¨¡å—ï¼Œéœ€è¦å®ç°è¿™æ ·çš„ä¸€ä¸ªåŠŸèƒ½ï¼šå½“å‘ç”Ÿäº†ç”¨æˆ·è¢«ç‚¹èµã€è¯„è®ºã€å…³æ³¨ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦ç”±æœåŠ¡å™¨å‘ç”¨æˆ·å®æ—¶åœ°æ¨é€ä¸€æ¡æ¶ˆæ¯ã€‚æœ€ç»ˆå®Œæˆçš„é¡¹ç›®åœ°å€ä¸ºï¼š<a href="https://github.com/noiron/socket-message-push">socket-message-push</a>ï¼Œè¿™é‡Œå°†ä»‹ç»ä¸€ä¸‹å®ç°çš„æ€è·¯åŠéƒ¨åˆ†ä»£ç ã€‚</p><p>é¡¹ç›®çš„æµç¨‹ä¸­å­˜åœ¨ç€è¿™æ ·çš„å‡ ä¸ªå¯¹è±¡ï¼š</p><ul><li>ç”¨ Java å®ç°çš„åç«¯æœåŠ¡å™¨</li><li>ç”¨ Node.js å®ç°çš„æ¶ˆæ¯æ¨é€æœåŠ¡å™¨</li><li>ç”¨æˆ·è¿›è¡Œæ“ä½œçš„å®¢æˆ·ç«¯</li></ul><p>äº‹ä»¶å¤„ç†çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·è¿›è¡Œç‚¹èµæ“ä½œæ—¶ï¼Œåç«¯æœåŠ¡å™¨ä¼šè¿›è¡Œå¤„ç†ï¼Œå¹¶å‘ Node.js æ¶ˆæ¯æ¨é€æœåŠ¡å™¨å‘é€ä¸€æ¡æ¶ˆæ¯</li><li>Node.js æ¶ˆæ¯æ¨é€æœåŠ¡å™¨æ¥æ”¶åˆ°åç«¯å‘é€çš„æ¶ˆæ¯åï¼Œå¤„ç†æ•°æ®ï¼Œå¹¶ç¡®å®šå‘å“ªä¸ªç”¨æˆ·è¿›è¡Œæ¨é€</li><li>ç”¨æˆ·çš„å®¢æˆ·ç«¯æ¥æ”¶åˆ°ç”± Node.js æœåŠ¡å™¨æ¨é€æ¥çš„æ¶ˆæ¯åï¼Œå³å¯è¿›è¡Œé€šçŸ¥çš„æ˜¾ç¤ºã€‚</li></ol><p>ä¸Šé¢çš„æµç¨‹ä¸­ï¼ŒJava åç«¯æœåŠ¡å™¨æ˜¯å¦‚ä½•å®ç°çš„ä¸åœ¨æ­¤ç¯‡æ–‡ç« çš„è®¨è®ºèŒƒå›´å†…ï¼Œæœ¬æ–‡å°†ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Node.js æ¥å®ç°è¿™ä¸ªæ¶ˆæ¯æ¨é€æœåŠ¡å™¨ã€‚</p><span id="more"></span><p>è€ƒè™‘æ¶ˆæ¯æ¨é€æœåŠ¡å™¨ä¸Šå¿…é¡»è®°å½•ä¸‹å½“å‰åœ¨çº¿ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè¿™æ ·æ‰èƒ½å‘ç‰¹å®šçš„ç”¨æˆ·æ¨é€æ¶ˆæ¯ã€‚æ‰€ä»¥å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œå¿…é¡»å°†è‡ªèº«çš„ç”¨æˆ·ä¿¡æ¯å‘åˆ° Node.js æœåŠ¡å™¨ä¸Šã€‚ä¸ºäº†è¾¾åˆ°è¿™ç§åŒå‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’ï¼Œå¾ˆæ˜æ˜¾åœ°è€ƒè™‘ç”¨ WebSocket æ¥å®ç°ã€‚æ—¢ç„¶æˆ‘ä»¬åœ¨æ¶ˆæ¯æ¨é€æœåŠ¡å™¨ä¸Šä½¿ç”¨äº† Node.jsï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„é€‰é¡¹ï¼šsocket.ioã€‚</p><h2 id="Socket-io-ä»‹ç»"><a href="#Socket-io-ä»‹ç»" class="headerlink" title="Socket.io ä»‹ç»"></a>Socket.io ä»‹ç»</h2><p><a href="https://socket.io">Socket.io</a>æ˜¯ä¸€ä¸ªç”¨ JavaScript å®ç°çš„å®æ—¶åŒå‘é€šä¿¡çš„åº“ï¼Œåˆ©ç”¨å®ƒæ¥å®ç°æˆ‘ä»¬çš„åŠŸèƒ½ä¼šå¾ˆç®€å•ã€‚</p><p><code>socket.io</code> åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>æœåŠ¡å™¨ç«¯ï¼ˆserverï¼‰ï¼šè¿è¡Œåœ¨ Node.js æœåŠ¡å™¨ä¸Š</li><li>å®¢æˆ·ç«¯ï¼ˆclientï¼‰ï¼šè¿è¡Œåœ¨æµè§ˆå™¨ä¸­</li></ul><p>å¯ä»¥çœ‹çœ‹å¦‚ä¸‹çš„ <code>socket.io</code> çš„ç¤ºä¾‹ä»£ç ï¼Œå®ƒç»™å‡ºäº† <code>socket.io</code> å‘å‡ºåŠç›‘å¬äº‹ä»¶çš„åŸºæœ¬ç”¨æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>)</span>&#123;</span><br><span class="line">  socket.emit(<span class="string">&#x27;request&#x27;</span>, <span class="comment">/* */</span>); <span class="comment">// emit an event to the socket</span></span><br><span class="line">  io.emit(<span class="string">&#x27;broadcast&#x27;</span>, <span class="comment">/* */</span>); <span class="comment">// emit an event to all connected sockets</span></span><br><span class="line">  socket.on(<span class="string">&#x27;reply&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* */</span> &#125;); <span class="comment">// listen to the event</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å…³äº Socket.io è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šSocke.io å¹¶ä¸å®Œå…¨æ˜¯ WebSocket çš„å®ç°ã€‚</p><blockquote><p>Note: Socket.IO is not a WebSocket implementation. Although Socket.IO indeed uses WebSocket as a transport when possible, it adds some metadata to each packet: the packet type, the namespace and the ack id when a message acknowledgement is needed.</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç”¨ Express.js æ¥å»ºç«‹ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç¨‹åºï¼Œå¹¶åœ¨å…¶ä¸­å¼•å…¥ Socket.ioã€‚</p><h2 id="Node-js-æœåŠ¡å™¨çš„æ­å»º"><a href="#Node-js-æœåŠ¡å™¨çš„æ­å»º" class="headerlink" title="Node.js æœåŠ¡å™¨çš„æ­å»º"></a>Node.js æœåŠ¡å™¨çš„æ­å»º</h2><h3 id="åˆ©ç”¨-Express-js-æ­å»ºåŸºç¡€æœåŠ¡å™¨"><a href="#åˆ©ç”¨-Express-js-æ­å»ºåŸºç¡€æœåŠ¡å™¨" class="headerlink" title="åˆ©ç”¨ Express.js æ­å»ºåŸºç¡€æœåŠ¡å™¨"></a>åˆ©ç”¨ Express.js æ­å»ºåŸºç¡€æœåŠ¡å™¨</h3><p>æˆ‘ä»¬ä½¿ç”¨äº† Express.js æ¥æ­å»º Node.js æ¶ˆæ¯æ¨é€æœåŠ¡å™¨ï¼Œå…ˆåˆ©ç”¨ä¸€ä¸ªç®€è¦çš„ä¾‹å­æ¥æµè§ˆå…¶åŠŸèƒ½ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).Server(app);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">4001</span>;</span><br><span class="line"></span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.sendFile(__dirname + <span class="string">&#x27;/public/index.html&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/api&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.listen(port, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`listening on port:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º <code>server.js</code>ï¼Œæ–°å»ºä¸€ä¸ª <code>public</code> æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ”¾å…¥ <code>index.html</code> æ–‡ä»¶ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><pre><code>node server.js</code></pre><p>ç°åœ¨å³å¯åœ¨ <code>localhost:4001</code> æŸ¥çœ‹æ•ˆæœäº†ã€‚</p><h3 id="å¼•å…¥-socket-io"><a href="#å¼•å…¥-socket-io" class="headerlink" title="å¼•å…¥ socket.io"></a>å¼•å…¥ socket.io</h3><p>ç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªåŸºç¡€çš„ Express æœåŠ¡å™¨ï¼Œæ¥ä¸‹æ¥éœ€è¦å°† Socket.io åŠ å…¥å…¶ä¸­ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io&#x27;</span>)(http);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;a user connected&#x27;</span>);</span><br><span class="line">    socket.broadcast.emit(<span class="string">&#x27;new_user&#x27;</span>, &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>io</code> ç›‘å¬ <code>connection</code> äº‹ä»¶ï¼Œå½“ <code>client</code> ä¸ <code>server</code> å»ºç«‹äº†è¿æ¥ä¹‹åï¼Œè¿™é‡Œçš„å›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼ˆ<code>client</code> ä¸­çš„ä»£ç å°†åœ¨ä¸‹ä¸€èŠ‚ä»‹ç»ï¼‰ã€‚</p><p>å‡½æ•°çš„å‚æ•° <code>socket</code> ä»£è¡¨çš„æ˜¯å½“å‰çš„ <code>client</code> å’Œ <code>server</code> é—´å»ºç«‹çš„è¿™ä¸ªè¿æ¥ã€‚å¯åœ¨ <code>client</code> ç¨‹åºä¸­å°†è¿™ä¸ªå»ºç«‹çš„ socket è¿æ¥æ‰“å°å‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/asset/images/2017-08-16-socket-attribute.png" alt=""></p><p>å…¶ä¸­çš„ <code>id</code> å±æ€§å¯ä»¥ç”¨äºæ ‡è¯†å‡ºè¿™ä¸€è¿æ¥ï¼Œä»è€Œ <code>server</code> å¯ä»¥å‘ç‰¹å®šçš„ç”¨æˆ·å‘é€æ¶ˆæ¯ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.broadcast.emit(<span class="string">&#x27;new_user&#x27;</span>, &#123;&#125;);</span><br></pre></td></tr></table></figure><p>è¿™ä¸€è¡Œä»£ç è¡¨ç¤º <code>socket</code> å°†å‘å½“å‰æ‰€æœ‰ä¸ <code>server</code> å»ºç«‹äº†è¿æ¥çš„ <code>client</code>ï¼ˆä¸åŒ…æ‹¬è‡ªå·±ï¼‰ å¹¿æ’­ä¸€æ¡åä¸º <code>new_user</code> çš„æ¶ˆæ¯ã€‚</p><h3 id="åç«¯æ¨é€æ¶ˆæ¯çš„å¤„ç†æµç¨‹"><a href="#åç«¯æ¨é€æ¶ˆæ¯çš„å¤„ç†æµç¨‹" class="headerlink" title="åç«¯æ¨é€æ¶ˆæ¯çš„å¤„ç†æµç¨‹"></a>åç«¯æ¨é€æ¶ˆæ¯çš„å¤„ç†æµç¨‹</h3><ol><li><p>åœ¨ Node æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯å’Œ socket id çš„æ˜ å°„è¡¨ï¼Œå› ä¸ºåŒä¸€ç”¨æˆ·å¯èƒ½æ‰“å¼€äº†å¤šä¸ªé¡µé¢ï¼Œæ‰€ä»¥ä»–çš„ socket id å¯èƒ½å­˜åœ¨å¤šä¸ªå€¼ã€‚å½“ç”¨æˆ·å»ºç«‹è¿æ¥æ—¶ï¼Œå¾€å…¶ä¸­æ·»åŠ å€¼ï¼›ç”¨æˆ·æ–­å¼€è¿æ¥åï¼Œåˆ é™¤ç›¸åº”å€¼ã€‚</p></li><li><p>å½“ Java åå°å­˜åœ¨éœ€è¦æ¨é€çš„æ¶ˆæ¯æ—¶ï¼Œä¼šå‘ Node æœåŠ¡å™¨çš„ <code>/api</code> è·¯å¾„ post ä¸€æ¡æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨äºæ ‡è¯†ç”¨æˆ·çš„ tokenId å’Œå…¶å®ƒæ•°æ®ã€‚</p></li><li><p>Node æœåŠ¡å™¨æ¥æ”¶åˆ° post è¯·æ±‚åï¼Œå¯¹è¯·æ±‚å†…å®¹è¿›è¡Œå¤„ç†ã€‚æ ¹æ® tokenId æ‰¾å‡ºä¸è¯¥ç”¨æˆ·å¯¹åº”çš„ socket idï¼Œsocket.io ä¼šæ ¹æ® id æ¥å‘ç”¨æˆ·æ¨é€æ¶ˆæ¯ã€‚</p></li></ol><h3 id="å¯¹ç”¨æˆ·ä¿¡æ¯çš„å¤„ç†"><a href="#å¯¹ç”¨æˆ·ä¿¡æ¯çš„å¤„ç†" class="headerlink" title="å¯¹ç”¨æˆ·ä¿¡æ¯çš„å¤„ç†"></a>å¯¹ç”¨æˆ·ä¿¡æ¯çš„å¤„ç†</h3><p>æ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œåªç”¨ä¸€ä¸ªæ•°ç»„ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå®é™…å·¥ä½œä¸­å¯ä»¥æ ¹æ®éœ€è¦æ”¾å…¥æ•°æ®åº“ä¸­ä¿å­˜ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">global</span>.users = []; <span class="comment">// è®°å½•ä¸‹ç™»å½•ç”¨æˆ·çš„tokenId, socketId</span></span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œ<code>client</code> ä¼šå‘ <code>server</code> å‘é€ <code>user_login</code> äº‹ä»¶ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°åä¼šåšå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">&#x27;user_login&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">info</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; tokenId, userId, socketId &#125; = info;</span><br><span class="line">    addSocketId(users, &#123; tokenId, socketId, userId &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>addSocketId()</code> ä¼šå‘ <code>users</code> æ•°ç»„ä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯ï¼Œä¸åŒç”¨æˆ·é€šè¿‡ tokenId è¿›è¡ŒåŒºåˆ†ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ª <code>socketIds</code> æ•°ç»„ï¼Œä¿å­˜å¯èƒ½å­˜åœ¨çš„å¤šä¸ª <code>socketId</code>ã€‚è¯¥å‡½æ•°çš„å…·ä½“ä»£ç å¯è§ <code>src/utils.js</code> æ–‡ä»¶ã€‚</p><p>åŒç†ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>deleteSocketId()</code> å‡½æ•°ç”¨äºåˆ é™¤ç”¨æˆ·ä¿¡æ¯ï¼Œä»£ç å¯è§åŒä¸€æ–‡ä»¶ã€‚</p><p>åœ¨è·å–äº†ç”¨æˆ·çš„ tokenId ä¹‹åï¼Œå°±éœ€è¦æ‰¾åˆ°å¯¹åº”çš„ socketIdï¼Œç„¶åå‘ç‰¹å®šç”¨æˆ·æ¨é€æ¶ˆæ¯ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªå‘ id = socketId çš„è¿™ä¸€è¿æ¥å‘é€æ¶ˆæ¯ </span></span><br><span class="line">io.sockets.to(socketId).emit(<span class="string">&#x27;receive_message&#x27;</span>, &#123;</span><br><span class="line">    entityType,</span><br><span class="line">    data</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨çš„æ€è·¯å¤§è‡´å¦‚æ­¤ï¼Œæ¥ä¸‹æ¥ä»‹ç»å®¢æˆ·ç«¯ä¸­æ˜¯å¦‚ä½•è¿›è¡Œç›¸åº”çš„å¤„ç†çš„ã€‚</p><h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><h3 id="Socket-io-çš„åˆå§‹åŒ–"><a href="#Socket-io-çš„åˆå§‹åŒ–" class="headerlink" title="Socket.io çš„åˆå§‹åŒ–"></a>Socket.io çš„åˆå§‹åŒ–</h3><p>é¦–å…ˆåœ¨ html æ–‡ä»¶ä¸­å¼•å…¥ Socket.io çš„ client ç«¯æ–‡ä»¶ï¼Œä¾‹å¦‚é€šè¿‡ CDN å¼•å…¥ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶å®ƒçš„å¼•å…¥æ–¹å¼:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/socket.io/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io-client&#x27;</span>);</span><br><span class="line"><span class="comment">// or with import syntax</span></span><br><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å¼•å…¥ Socket.io åå°±è·å¾—äº† <code>io</code> å‡½æ•°ï¼Œé€šè¿‡å®ƒæ¥ä¸æ¶ˆæ¯æ¨é€æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾ä½ å°† Node æœåŠ¡å™¨éƒ¨ç½²åçš„åœ°å€ä¸ºï¼šhttps://www.example.com/ws</span></span><br><span class="line"><span class="comment">// åˆ™ï¼š WS_HOST = &#x27;https://www.example.com&#x27;</span></span><br><span class="line"><span class="keyword">const</span> msgSocket = io(<span class="string">`<span class="subst">$&#123;WS_HOST&#125;</span>`</span>, &#123;</span><br><span class="line">    <span class="attr">secure</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/ws/socket.io&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¦‚æœç›‘å¬æœ¬åœ°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> msgSocket = io(<span class="string">&#x27;http://localhost:4001&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¦‚æœå†™æˆ <code>io(&#39;https://www.example.com/ws&#39;)</code> ä¼šå‡ºç°é”™è¯¯ï¼Œéœ€è¦å°† <code>/ws</code> å†™å…¥pathä¸­ã€‚</p><p>ä¸ºäº†èƒ½åœ¨å…¶å®ƒæ–‡ä»¶ä½¿ç”¨è¿™ä¸€å˜é‡ï¼Œå¯å°† <code>msgSocket</code> ä½œä¸ºä¸€ä¸ªå…¨å±€å˜é‡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.msgSocket = msgSocket;</span><br></pre></td></tr></table></figure><h3 id="ç”¨æˆ·å»ºç«‹è¿æ¥"><a href="#ç”¨æˆ·å»ºç«‹è¿æ¥" class="headerlink" title="ç”¨æˆ·å»ºç«‹è¿æ¥"></a>ç”¨æˆ·å»ºç«‹è¿æ¥</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨æˆ·ç™»å½•æ—¶ï¼Œå‘æœåŠ¡å™¨å‘é€ç”¨æˆ·çš„ä¿¡æ¯ã€‚æœåŠ¡å™¨ä¼šåœ¨æ”¶åˆ°ä¿¡æ¯åå»ºç«‹ socket ä¸ç”¨æˆ·çš„æ˜ å°„ã€‚</span></span><br><span class="line">msgSocket.emit(<span class="string">&#x27;user_login&#x27;</span>, &#123;</span><br><span class="line">    userId,</span><br><span class="line">    <span class="attr">socketId</span>: msgSocket.id,</span><br><span class="line">    tokenId</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="æ¥æ”¶åˆ°æ¨é€çš„æ¶ˆæ¯åçš„å¤„ç†"><a href="#æ¥æ”¶åˆ°æ¨é€çš„æ¶ˆæ¯åçš„å¤„ç†" class="headerlink" title="æ¥æ”¶åˆ°æ¨é€çš„æ¶ˆæ¯åçš„å¤„ç†"></a>æ¥æ”¶åˆ°æ¨é€çš„æ¶ˆæ¯åçš„å¤„ç†</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebSocket è¿æ¥å»ºç«‹åï¼Œç›‘å¬åä¸º receive_message çš„äº‹ä»¶ </span></span><br><span class="line">msgSocket.on(<span class="string">&#x27;receive_message&#x27;</span>, <span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">    store.dispatch(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;NEW_SOCKET_MSG&#x27;</span>,</span><br><span class="line">        <span class="attr">payload</span>: msg</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å½“ WebSocket æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€äº†æ¶ˆæ¯ä¹‹åï¼Œå®¢æˆ·ç«¯éœ€è¦ç›‘å¬ <code>receive_message</code> äº‹ä»¶ï¼Œæ¥æ”¶åˆ°çš„å‚æ•°ä¸­æœ‰ç›¸åº”å¾…å¤„ç†çš„ä¿¡æ¯ã€‚<br>ç”±äºä½¿ç”¨äº† Redux è¿›è¡Œæ•°æ®çš„å¤„ç†ï¼Œæ‰€ä»¥è¿™é‡Œ dispatch äº†ä¸€ä¸ª <code>NEW_SOCKET_MSG</code> actionï¼Œåç»­åˆ™æ˜¯å¸¸è§„çš„ redux å¤„ç†æµç¨‹äº†ã€‚</p><h2 id="é¡¹ç›®çš„ä½¿ç”¨"><a href="#é¡¹ç›®çš„ä½¿ç”¨" class="headerlink" title="é¡¹ç›®çš„ä½¿ç”¨"></a>é¡¹ç›®çš„ä½¿ç”¨</h2><p>GitHub ä¸Šçš„é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/noiron/socket-message-push">socket-message-push</a></p><pre><code>npm run dev</code></pre><p>å³å¯åœ¨ devlopment ç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼Œç°åœ¨ä½ å°±æœ‰äº†ä¸€ä¸ªè¿è¡Œåœ¨4001ç«¯å£çš„æ¶ˆæ¯æ¨é€æœåŠ¡å™¨äº†ã€‚</p><p>ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰åç«¯çš„æœåŠ¡å™¨æ¥å‘æˆ‘ä»¬å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åˆ©ç”¨ Postman æ¥æ¨¡æ‹Ÿå‘é€æ¶ˆæ¯ã€‚</p><p>ä¸ºäº†å±•ç¤ºç¨‹åºçš„åŠŸèƒ½ï¼Œåœ¨é¡¹ç›®çš„ client æ–‡ä»¶å¤¹ä¸‹æ”¾ç½®äº†ä¸€ä¸ª <code>index.html</code> æ–‡ä»¶ã€‚æ³¨æ„è¿™ä¸ªæ–‡ä»¶å¹¶ä¸èƒ½ç”¨åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œåªæ˜¯ç”¨æ¥æ˜¾ç¤ºæ¶ˆæ¯æ¨é€çš„æ•ˆæœè€Œå·²ã€‚</p><p>åœ¨å¼€å¯äº†æœåŠ¡å™¨ä¹‹åï¼Œæ‰“å¼€ <code>client/index.html</code>ï¼Œæ ¹æ®æç¤ºéšæ„è¾“å…¥ä¸€ä¸ª tokenId å³å¯ã€‚</p><p>ç°åœ¨åˆ©ç”¨ Postman å‘ <code>localhost:4001/api</code> post å¦‚ä¸‹çš„ä¸€æ¡ä¿¡æ¯ï¼š</p><pre><code>&#123;    // tokens æ•°ç»„è¡¨ç¤ºä½ æƒ³å‘å“ªä¸ªç”¨æˆ·æ¨é€æ¶ˆæ¯    &quot;tokens&quot;: [&quot;1&quot;, &quot;2&quot;],    &quot;data&quot;: &quot;You shall not pass!!!&quot;&#125;</code></pre><p><img src="/asset/images/2017-08-27-postman-post-msg.png" alt="postman-post-a-message"></p><p>è‡³æ­¤ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨ client çš„æ§åˆ¶å°ä¸­çœ‹åˆ°æ”¶åˆ°çš„æ¶ˆæ¯äº†ã€‚</p><p><img src="/asset/images/2017-08-27-client-receive-msg.png" alt="client-message"></p><p>ä½ å¯ä»¥æ‰“å¼€å¤šä¸ª client é¡µé¢ï¼Œè¾“å…¥ä¸åŒçš„ tokenIdï¼Œç„¶åæ£€æŸ¥æ¶ˆæ¯æ˜¯å¦å‘é€ç»™äº†æ­£ç¡®çš„ç”¨æˆ·ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote><p><a href="https://github.com/socketio/socket.io/tree/master/examples/chat">https://github.com/socketio/socket.io/tree/master/examples/chat</a><br><a href="https://socket.io/docs/">https://socket.io/docs/</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é¡¹ç›®èƒŒæ™¯ä»‹ç»&quot;&gt;&lt;a href=&quot;#é¡¹ç›®èƒŒæ™¯ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®èƒŒæ™¯ä»‹ç»&quot;&gt;&lt;/a&gt;é¡¹ç›®èƒŒæ™¯ä»‹ç»&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨å†™çš„é¡¹ç›®ä¸­å­˜åœ¨ç€ç¤¾äº¤æ¨¡å—ï¼Œéœ€è¦å®ç°è¿™æ ·çš„ä¸€ä¸ªåŠŸèƒ½ï¼šå½“å‘ç”Ÿäº†ç”¨æˆ·è¢«ç‚¹èµã€è¯„è®ºã€å…³æ³¨ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦ç”±æœåŠ¡å™¨å‘ç”¨æˆ·å®æ—¶åœ°æ¨é€ä¸€æ¡æ¶ˆæ¯ã€‚æœ€ç»ˆå®Œæˆçš„é¡¹ç›®åœ°å€ä¸ºï¼š&lt;a href=&quot;https://github.com/noiron/socket-message-push&quot;&gt;socket-message-push&lt;/a&gt;ï¼Œè¿™é‡Œå°†ä»‹ç»ä¸€ä¸‹å®ç°çš„æ€è·¯åŠéƒ¨åˆ†ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;é¡¹ç›®çš„æµç¨‹ä¸­å­˜åœ¨ç€è¿™æ ·çš„å‡ ä¸ªå¯¹è±¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨ Java å®ç°çš„åç«¯æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;ç”¨ Node.js å®ç°çš„æ¶ˆæ¯æ¨é€æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è¿›è¡Œæ“ä½œçš„å®¢æˆ·ç«¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äº‹ä»¶å¤„ç†çš„æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·è¿›è¡Œç‚¹èµæ“ä½œæ—¶ï¼Œåç«¯æœåŠ¡å™¨ä¼šè¿›è¡Œå¤„ç†ï¼Œå¹¶å‘ Node.js æ¶ˆæ¯æ¨é€æœåŠ¡å™¨å‘é€ä¸€æ¡æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;Node.js æ¶ˆæ¯æ¨é€æœåŠ¡å™¨æ¥æ”¶åˆ°åç«¯å‘é€çš„æ¶ˆæ¯åï¼Œå¤„ç†æ•°æ®ï¼Œå¹¶ç¡®å®šå‘å“ªä¸ªç”¨æˆ·è¿›è¡Œæ¨é€&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·çš„å®¢æˆ·ç«¯æ¥æ”¶åˆ°ç”± Node.js æœåŠ¡å™¨æ¨é€æ¥çš„æ¶ˆæ¯åï¼Œå³å¯è¿›è¡Œé€šçŸ¥çš„æ˜¾ç¤ºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸Šé¢çš„æµç¨‹ä¸­ï¼ŒJava åç«¯æœåŠ¡å™¨æ˜¯å¦‚ä½•å®ç°çš„ä¸åœ¨æ­¤ç¯‡æ–‡ç« çš„è®¨è®ºèŒƒå›´å†…ï¼Œæœ¬æ–‡å°†ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Node.js æ¥å®ç°è¿™ä¸ªæ¶ˆæ¯æ¨é€æœåŠ¡å™¨ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="socket.io" scheme="http://www.wukai.me/tags/socket-io/"/>
    
      <category term="node.js" scheme="http://www.wukai.me/tags/node-js/"/>
    
      <category term="express.js" scheme="http://www.wukai.me/tags/express-js/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ç”¨ html å’Œ css ç”»ä¸€æ‹³è¶…äºº</title>
    <link href="http://www.wukai.me/2017/04/16/draw-one-punch-man-with-html-and-css/"/>
    <id>http://www.wukai.me/2017/04/16/draw-one-punch-man-with-html-and-css/</id>
    <published>2017-04-15T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.545Z</updated>
    
    <content type="html"><![CDATA[<p>å†™è¿™ç¯‡åšå®¢çš„èµ·å› æ˜¯æˆ‘çœ‹äº†Mediumä¸Šçš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://blog.prototypr.io/how-i-started-drawing-css-images-3fd878675c89">How I started drawing CSS Images</a>ï¼Œç„¶åå“‡å“¦ğŸ˜¦ï¼ŒåŒæ ·æ˜¯å‰ç«¯å¼€å‘ï¼Œè¿™åŒºåˆ«æ€ä¹ˆè¿™ä¹ˆå¤§å‘¢ï¼Ÿè¿™ä½ä½œè€…å’Œæˆ‘å®Œå…¨ç‚¹äº†ä¸åŒçš„æŠ€èƒ½ç‚¹å•Šï¼</p><p>çœ‹äº†å‡ ä¸ªå¥¹åœ¨codepenä¸Šçš„ä½œå“ï¼Œæ¯”å¦‚è¿™ä¸ª<a href="http://codepen.io/sashatran/pen/VmwmJO">çš®å¡ä¸˜</a>ï¼Œå‘ç°ç”¨åˆ°çš„æŠ€æœ¯ä¹Ÿå¹¶ä¸å¤šï¼Œäºæ˜¯æˆ‘ä¹Ÿæƒ³è¯•è¯•ã€‚</p><p>ä¸è¿‡æœ‰å“ªä¸ªåŠ¨æ¼«ä¸­çš„äººç‰©è¶³å¤Ÿç®€å•ï¼Œèƒ½å¤Ÿç”¨å‡ ä¸ªåŸºæœ¬çš„å‡ ä½•å›¾å½¢å°±ç”»å‡ºæ¥å‘¢ï¼Ÿæˆ‘æƒ³åˆ°äº†ä¸€ä¸ªäººï¼Œäºæ˜¯æˆ‘å†³å®šç”»ä¸€ä¸ªã€Šä¸€æ‹³è¶…äººã€‹ä¸­çš„<del>å¤è›‹</del>ï¼Œä¸å¯¹ï¼Œæ˜¯<del>ç§ƒå¤´æŠ«é£ä¾ </del>â€”â€”ç¦ç‰è€å¸ˆã€‚</p><span id="more"></span><p>ç»“æœå±•ç¤ºï¼š</p><p><p data-height="450" data-theme-id="dark" data-slug-hash="oZKgMJ" data-default-tab="html,result" data-user="noiron" data-embed-version="2" data-pen-title="One punch man" class="codepen">See the Pen <a href="http://codepen.io/noiron/pen/oZKgMJ/">One punch man</a> by wu kai (<a href="http://codepen.io/noiron">@noiron</a>) on <a href="http://codepen.io">CodePen</a>.</p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><h2 id="æŠ€æœ¯æ¦‚è¿°"><a href="#æŠ€æœ¯æ¦‚è¿°" class="headerlink" title="æŠ€æœ¯æ¦‚è¿°"></a>æŠ€æœ¯æ¦‚è¿°</h2><p>ä»htmlæ–‡ä»¶ä¸­ä½ å¯ä»¥çœ‹åˆ°è¿™å¼ å›¾ç‰‡å®é™…ä¸Šå…¨éƒ¨æ˜¯ç”±<code>div</code>å…ƒç´ ç»„åˆè€Œæˆçš„ï¼Œä¸€å…±ç”¨åˆ°äº†15ä¸ªdivã€‚åœ¨ç»™ä¸€ä¸ªdivå…ƒç´ åŠ ä¸Šé€‚å½“çš„cssæ ·å¼åï¼Œå°±å½¢æˆäº†è„¸ä¸Šçš„ä¸€ä¸ªéƒ¨ä½ã€‚</p><p>åœ¨ç»˜åˆ¶ç¦ç‰çš„å¤´åƒæ—¶ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªcsså±æ€§å°±æ˜¯<code>border-radius</code>ï¼Œæˆ‘ä»¬ç”¨å®ƒå¯ä»¥ç”»å‡ºåœ†å½¢ã€æ¤­åœ†åŠå„ç§å˜ä½“ã€‚å›¾ä¸­çš„è„¸éƒ¨è½®å»“ã€çœ¼ç›ã€è€³æœµçš„å½¢çŠ¶éƒ½æ˜¯ç”±<code>border-radius</code>æ¥å®ç°çš„ï¼Œç¨åå°†ä»‹ç»å…¶ä½¿ç”¨æ–¹æ³•ã€‚</p><p>å¦ä¸€ä¸ªéœ€è¦è¯´æ˜çš„csså±æ€§æ˜¯<code>transform</code>ï¼Œå¯ä»¥å®ç°å¹³ç§»å’Œæ—‹è½¬ã€‚</p><h2 id="border-radius-ä»‹ç»"><a href="#border-radius-ä»‹ç»" class="headerlink" title="border-radius ä»‹ç»"></a>border-radius ä»‹ç»</h2><p>ä¹‹å‰æˆ‘å¯¹<code>border-radius</code>çš„è®¤è¯†åªå±€é™äºå¯ä»¥ç»™å…ƒç´ åŠ ä¸Šåœ†è§’ï¼Œä»¥åŠå°†å…¶å€¼è®¾ä¸º50%å¯ä»¥è®©çŸ©å½¢æ˜¾ç¤ºä¸ºåœ†å½¢ã€‚æŸ¥äº†äº›èµ„æ–™åï¼Œæ‰å‘ç°å¯ä»¥ç”¨å®ƒç”»å‡ºè®¸å¤šå›¾å½¢ã€‚</p><p><code>border-radius</code>æ˜¯ä»¥ä¸‹å››ä¸ªå±æ€§çš„ç®€å†™ï¼Œæ¯ä¸€ä¸ªå±æ€§ç”¨äºè®¾ç½®ä¸€ä¸ªè§’çš„å½¢çŠ¶ï¼š</p><pre><code>border-top-left-radiusborder-top-right-radiusborder-bottom-right-radiusborder-bottom-left-radius</code></pre><p><img src="https://developer.mozilla.org/files/3638/border-radius-sh.png" alt="border-radius"></p><p>å›¾ç‰‡æ¥è‡ª<a href="https://developer.mozilla.org/en/docs/Web/CSS/border-radius">MDN</a></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºå½“åªè®¾ç½®ä¸€ä¸ªå€¼æˆ–è®¾ç½®ä¸¤ä¸ªç›¸åŒçš„å€¼æ—¶ï¼Œæ˜¾ç¤ºä¸ºåœ†ï¼›è®¾ç½®ä¸¤ä¸ªä¸åŒçš„å€¼æ—¶ï¼Œæ˜¾ç¤ºä¸ºæ¤­åœ†ã€‚ä»¥<code>border-top-left-radius</code>ä¸ºä¾‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* the corner is a circle */</span></span><br><span class="line"><span class="comment">/* border-top-left-radius: radius */</span></span><br><span class="line"><span class="attribute">border-top-left-radius</span>: <span class="number">3px</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* the corner is an ellipsis */</span></span><br><span class="line"><span class="comment">/* border-top-left-radius: horizontal vertical */</span></span><br><span class="line"><span class="attribute">border-top-left-radius</span>: <span class="number">0.5em</span> <span class="number">1em</span>;</span><br></pre></td></tr></table></figure><p>è‹¥æ˜¯ç®€å†™å½¢å¼ï¼Œåˆ™å†™æˆå¦‚ä¸‹æ ¼å¼ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">border-radius</span>: <span class="number">48%</span> <span class="number">48%</span> <span class="number">50%</span> <span class="number">50%</span> / <span class="number">42%</span> <span class="number">42%</span> <span class="number">54%</span> <span class="number">54%</span>;</span><br></pre></td></tr></table></figure><p>â€˜/â€˜ä¹‹å‰çš„å››ä¸ªå€¼è¡¨ç¤ºæ°´å¹³è½´çš„é•¿åº¦ï¼Œâ€™/â€˜ä¹‹åçš„å››ä¸ªå€¼è¡¨ç¤ºå‚ç›´è½´çš„é•¿åº¦ï¼Œå½“æ°´å¹³è½´çš„é•¿åº¦å’Œå‚ç›´è½´çš„é•¿åº¦ç›¸ç­‰æ—¶ï¼Œå¯ä»¥çœç•¥â€™/â€˜åŠä¹‹åçš„è¿™ä¸€ç»„å€¼ã€‚</p><p>å¯¹äºåŒä¸€ç»„çš„å››ä¸ªæ•°å€¼ï¼Œä¹Ÿæœ‰ç®€å†™æ–¹å¼ã€‚æ–¹æ³•ä¸ padding å’Œ margin çš„ç®€å†™ç±»ä¼¼ï¼Œç¬¬ä¸€ä¸ªå€¼ä¸ç¬¬ä¸‰ä¸ªå€¼ç›¸åŒæˆ–ç¬¬äºŒä¸ªå€¼ä¸ç¬¬å››ä¸ªå€¼ç›¸åŒæ—¶ï¼Œå¯ä»¥åªå†™ä¸€éã€‚</p><p>åœ¨äº†è§£äº†<code>border-radius</code>çš„ç”¨æ³•åï¼Œé€šè¿‡ç»™<code>div</code>å…ƒç´ åˆé€‚çš„å®½é«˜æ¯”ï¼Œåœ¨è°ƒæ•´å››ä¸ªåœ†è§’çš„åŠå¾„ï¼Œå°±èƒ½å¤Ÿè·å¾—ä½ æƒ³è¦çš„å½¢çŠ¶äº†ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// ä»¥ä¸‹çš„æ ·å¼èƒ½å¤Ÿç”»å‡ºç¦ç‰çš„è„¸éƒ¨å½¢çŠ¶</span><br><span class="line">// åœ¨è°ƒæ•´<span class="attribute">width</span>, <span class="attribute">height</span>, <span class="attribute">border-radius</span> åï¼Œå¯ç”»å‡ºçœ¼ã€é¼»ã€å˜´çš„å½¢çŠ¶</span><br><span class="line"><span class="selector-id">#div1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">144px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="number">#000</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">48%</span> <span class="number">48%</span> <span class="number">50%</span> <span class="number">50%</span> / <span class="number">42%</span> <span class="number">42%</span> <span class="number">54%</span> <span class="number">54%</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="transform-ä»‹ç»"><a href="#transform-ä»‹ç»" class="headerlink" title="transform ä»‹ç»"></a>transform ä»‹ç»</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform">transformå±æ€§</a>ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å±æ€§ï¼Œèƒ½å¤Ÿå¯¹å…ƒç´ åšå„ç§å˜å½¢ã€‚ä¸è¿‡æˆ‘ä»¬è¿™é‡Œåªéœ€è¦ç”¨å®ƒæ¥è¿›è¡Œå¹³ç§»å’Œæ—‹è½¬çš„æ“ä½œã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å¯ä»¥ç”¨ translate æ¥å®ç°å¹³ç§»æ“ä½œ */</span></span><br><span class="line"><span class="comment">/* translate() çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºæ°´å¹³æ–¹å‘å’Œå‚ç›´æ–¹å‘çš„å¹³ç§»è·ç¦» */</span></span><br><span class="line"><span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">12px</span>, <span class="number">50%</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¸Šé¢è¿™ä¸€è¡Œä¸ä¸‹é¢çš„è¿™ä¸¤è¡Œæ˜¯ç­‰ä»·çš„ */</span></span><br><span class="line"><span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">12px</span>);</span><br><span class="line"><span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">50%</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* é¡ºæ—¶é’ˆæ—‹è½¬20åº¦ */</span></span><br><span class="line"><span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">20deg</span>);</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆå¾—åˆ°æœ€ç»ˆç»“æœ"><a href="#ç»„åˆå¾—åˆ°æœ€ç»ˆç»“æœ" class="headerlink" title="ç»„åˆå¾—åˆ°æœ€ç»ˆç»“æœ"></a>ç»„åˆå¾—åˆ°æœ€ç»ˆç»“æœ</h2><p>åœ¨ä½ å·²ç»å°†ç¦ç‰å¤´åƒè¿›è¡Œæ‹†è§£ï¼ŒæŠŠå„ä¸ªéƒ¨åˆ†éƒ½ç”¨ä¸€ä¸ª<code>div</code>æ¥è¡¨ç¤ºå¹¶åŠ ä¸Šäº†åˆé€‚çš„æ ·å¼åï¼Œå°±èƒ½å°†å®ƒä»¬ç»„åˆèµ·æ¥äº†ã€‚ä½ å¯ä»¥ç”¨<code>transform</code>æ¥è°ƒæ•´å®ƒä»¬çš„è·ç¦»ï¼Œæˆ–è€…ç›´æ¥ç”¨<code>absoulte</code>å®šä½ã€‚</p><p>æœ€åå°±å¾—åˆ°äº†ç¦ç‰çš„å¤´åƒï¼š</p><p><img src="/asset/images/2017-04-10-one-punch-man-not-completed.png" alt=""></p><p>é¢ï¼Œç§ƒå­ï¼Œä½ è°å•Šï¼ï¼Ÿ</p><p>çœ‹æ¥ä¸æ˜¯æ‰€æœ‰çš„å…‰å¤´éƒ½å«ç¦ç‰ï¼Œè¿˜éœ€è¦å¯¹ç»†èŠ‚è¿›è¡Œä¸€ç‚¹è°ƒæ•´ï¼š</p><p><img src="/asset/images/2017-04-10-one-punch-man.png" alt=""></p><p>OKï¼Œè¿™æ ·å°±æœ‰ç‚¹åƒç¦ç‰è€å¸ˆäº†ã€‚æœ€åï¼Œå¦‚æœä½ æ„¿æ„çš„è¯ï¼Œè¿˜å¯ä»¥ç”¨<code>transition</code>å±æ€§æ¥ç¨å¾®åŠ ä¸Šç‚¹åŠ¨ç”»æ•ˆæœã€‚</p><p>å†æ”¾ä¸€éä»£ç åœ°å€ï¼š</p><blockquote><p><a href="https://codepen.io/noiron/pen/oZKgMJ">Codepenä»£ç åŠå±•ç¤º</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å†™è¿™ç¯‡åšå®¢çš„èµ·å› æ˜¯æˆ‘çœ‹äº†Mediumä¸Šçš„è¿™ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;https://blog.prototypr.io/how-i-started-drawing-css-images-3fd878675c89&quot;&gt;How I started drawing CSS Images&lt;/a&gt;ï¼Œç„¶åå“‡å“¦ğŸ˜¦ï¼ŒåŒæ ·æ˜¯å‰ç«¯å¼€å‘ï¼Œè¿™åŒºåˆ«æ€ä¹ˆè¿™ä¹ˆå¤§å‘¢ï¼Ÿè¿™ä½ä½œè€…å’Œæˆ‘å®Œå…¨ç‚¹äº†ä¸åŒçš„æŠ€èƒ½ç‚¹å•Šï¼&lt;/p&gt;
&lt;p&gt;çœ‹äº†å‡ ä¸ªå¥¹åœ¨codepenä¸Šçš„ä½œå“ï¼Œæ¯”å¦‚è¿™ä¸ª&lt;a href=&quot;http://codepen.io/sashatran/pen/VmwmJO&quot;&gt;çš®å¡ä¸˜&lt;/a&gt;ï¼Œå‘ç°ç”¨åˆ°çš„æŠ€æœ¯ä¹Ÿå¹¶ä¸å¤šï¼Œäºæ˜¯æˆ‘ä¹Ÿæƒ³è¯•è¯•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æœ‰å“ªä¸ªåŠ¨æ¼«ä¸­çš„äººç‰©è¶³å¤Ÿç®€å•ï¼Œèƒ½å¤Ÿç”¨å‡ ä¸ªåŸºæœ¬çš„å‡ ä½•å›¾å½¢å°±ç”»å‡ºæ¥å‘¢ï¼Ÿæˆ‘æƒ³åˆ°äº†ä¸€ä¸ªäººï¼Œäºæ˜¯æˆ‘å†³å®šç”»ä¸€ä¸ªã€Šä¸€æ‹³è¶…äººã€‹ä¸­çš„&lt;del&gt;å¤è›‹&lt;/del&gt;ï¼Œä¸å¯¹ï¼Œæ˜¯&lt;del&gt;ç§ƒå¤´æŠ«é£ä¾ &lt;/del&gt;â€”â€”ç¦ç‰è€å¸ˆã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="html" scheme="http://www.wukai.me/tags/html/"/>
    
      <category term="css" scheme="http://www.wukai.me/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>è¯¾ç¨‹ç¬”è®°--Building a javascript development environment</title>
    <link href="http://www.wukai.me/2017/03/05/lesson-note-build-a-javascript-development-environment/"/>
    <id>http://www.wukai.me/2017/03/05/lesson-note-build-a-javascript-development-environment/</id>
    <published>2017-03-04T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.545Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢æ˜¯æˆ‘åœ¨å­¦ä¹  <a href="https://app.pluralsight.com/library/courses/javascript-development-environment/recommended-courses">Pluralsightä¸Šçš„è¯¾ç¨‹ï¼šBuilding a JavaScript Development Environment</a> æ—¶è®°ä¸‹çš„ç¬”è®°ï¼Œä»…ä½œä¸ªäººè®°å½•ä¹‹ç”¨ã€‚</p><p>è¿™é—¨è¯¾ç¨‹ç³»ç»Ÿåœ°ä»‹ç»äº†å‰ç«¯å¼€å‘ä¸­çš„è®¸å¤šå·¥å…·å’Œæœ¯è¯­ï¼Œä»ç¼–è¾‘å™¨çš„é€‰æ‹©åˆ°é¡¹ç›®çš„éƒ¨ç½²éƒ½è¿›è¡Œäº†ä»‹ç»ï¼Œæˆ‘åœ¨å­¦ä¹ äº†è¿™ä¸ªè¯¾ç¨‹åæ„Ÿè§‰å°†ä¹‹å‰é›¶æ•£å­¦ä¹ çš„å†…å®¹ä¸²äº†èµ·æ¥ã€‚</p><p>é¡ºä¾¿ä¸€è¯´ï¼ŒPluralsightç½‘ç«™ä¸Šé¢æœ‰è®¸å¤šä¸é”™çš„è¯¾ç¨‹ï¼Œä¸è¿‡ä»·æ ¼å¤ªè´µï¼Œéœ€æ¯æœˆä»˜29ç¾å…ƒğŸ˜¥ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ç”¨å¾®è½¯è´¦å·åŠ å…¥<a href="https://www.visualstudio.com/zh-hans/dev-essentials/">Visual Studio Dev Essentials è®¡åˆ’</a>ï¼Œè¿™æ ·å°±å¯ä»¥å…è´¹è·å¾—Pluralsight 3ä¸ªæœˆçš„è®¢é˜…äº†ğŸ˜€ã€‚</p><hr><h2 id="1-Course-Overview"><a href="#1-Course-Overview" class="headerlink" title="1. Course Overview"></a>1. Course Overview</h2><p>ç¼–ç¨‹çš„æ—¶å€™è¦åšè®¸å¤šé€‰æ‹©</p><ul><li>Editor</li><li>Module format</li><li>HTML generation</li><li>Transpiling</li><li>Bundler</li><li>Linting</li><li>Testing</li><li>â€¦</li></ul><p>è¿™é—¨è¯¾ç¨‹ä»‹ç»äº†å¦‚ä½•åœ¨è¿™äº›é€‰é¡¹ä¸­åšå‡ºé€‰æ‹©</p><span id="more"></span><h2 id="2-You-need-a-starter-kit"><a href="#2-You-need-a-starter-kit" class="headerlink" title="2. You need a starter kit"></a>2. You need a starter kit</h2><h3 id="You-need-a-starter-kit"><a href="#You-need-a-starter-kit" class="headerlink" title="You need a starter kit"></a>You need a starter kit</h3><p>åŸå› ï¼š</p><ul><li>Codifies<ul><li>å†³å®š</li><li>æœ€ä½³å®è·µ</li><li>æ•™è®­</li></ul></li><li>é¼“åŠ±ä¸€è‡´æ€§</li><li>é¿å…å¿˜è®°é‡è¦çš„ç»†èŠ‚</li><li>å¢åŠ è´¨é‡<ul><li>Doing the â€œrightâ€ thing is the easy thing</li></ul></li><li>é¿å…é‡å¤å·¥ä½œ</li></ul><h3 id="A-starter-kit-is-an-automated-checklist"><a href="#A-starter-kit-is-an-automated-checklist" class="headerlink" title="A starter kit is an automated checklist"></a>A starter kit is an automated checklist</h3><h3 id="Who-is-this-course-for"><a href="#Who-is-this-course-for" class="headerlink" title="Who is this course for?"></a>Who is this course for?</h3><p>Atwoodâ€™s Law </p><p>JavaScript is Everywhere</p><h3 id="What-Belongs-in-your-starter-kit"><a href="#What-Belongs-in-your-starter-kit" class="headerlink" title="What Belongs in your starter kit?"></a>What Belongs in your starter kit?</h3><ul><li>Package Management</li><li>Bundling</li><li>Minification</li><li>Sourcemaps</li><li>Transpiling</li><li>Dynamic HTML Generation</li><li>Centralized HTTP</li><li>Mock API framework</li><li>Component libraries</li><li>Development Webserver</li><li>Linting</li><li>Automated Testing</li><li>Continuous Integration</li><li>Automated deployment</li><li>Working example app</li></ul><h3 id="Agenda"><a href="#Agenda" class="headerlink" title="Agenda"></a>Agenda</h3><p>Rhythm</p><ol><li>Options</li><li>Recommendation</li><li>Implement</li></ol><hr><h2 id="3-Editors-and-Configuration"><a href="#3-Editors-and-Configuration" class="headerlink" title="3. Editors and Configuration"></a>3. Editors and Configuration</h2><h3 id="What-to-look-for-in-a-JavaScript-Editor"><a href="#What-to-look-for-in-a-JavaScript-Editor" class="headerlink" title="What to look for in a JavaScript Editor"></a>What to look for in a JavaScript Editor</h3><ul><li>Strong ES2015+ support</li><li>framework intelligence</li><li>Built-in terminal</li></ul><p>å¯é€‰ç¼–è¾‘å™¨ï¼š</p><ul><li>Atom</li><li>WebStorm</li><li>Brackets</li><li>VSCode</li></ul><h3 id="Editorconfig"><a href="#Editorconfig" class="headerlink" title="Editorconfig"></a>Editorconfig</h3><p>EditorConfig ä¿è¯å¤§å®¶çš„ç¼–è¾‘å™¨è®¾ç½®ä¸€æ ·ã€‚</p><h3 id="Demo-Editorconfig"><a href="#Demo-Editorconfig" class="headerlink" title="Demo: Editorconfig"></a>Demo: Editorconfig</h3><p>å¢åŠ  .editorconfig æ–‡ä»¶</p><hr><h2 id="4-Package-Management"><a href="#4-Package-Management" class="headerlink" title="4. Package Management"></a>4. Package Management</h2><h3 id="Package-Managers"><a href="#Package-Managers" class="headerlink" title="Package Managers"></a>Package Managers</h3><ul><li>Bower</li><li>npm</li><li>JSPM</li><li>â€¦</li></ul><h3 id="Demo-Install-Node-and-npm-Packages"><a href="#Demo-Install-Node-and-npm-Packages" class="headerlink" title="Demo: Install Node and npm Packages"></a>Demo: Install Node and npm Packages</h3><h3 id="Package-Security"><a href="#Package-Security" class="headerlink" title="Package Security"></a>Package Security</h3><p>ä½•æ—¶ Run Security Check ?</p><p>npm start </p><h3 id="Demo-Node-Security-Platform"><a href="#Demo-Node-Security-Platform" class="headerlink" title="Demo: Node Security Platform"></a>Demo: Node Security Platform</h3><p>å…¨å±€å®‰è£… nsp</p><pre><code>nsp install -g nspÎ» nsp check(+) No known vulnerabilities found</code></pre><hr><h2 id="5-Development-Web-Server"><a href="#5-Development-Web-Server" class="headerlink" title="5. Development Web Server"></a>5. Development Web Server</h2><h3 id="Development-Web-Servers"><a href="#Development-Web-Servers" class="headerlink" title="Development Web Servers"></a>Development Web Servers</h3><ul><li>http-server</li><li>live-server</li><li>Express</li><li>budo</li><li>Webpack dev server</li><li>Browsersync</li></ul><h3 id="Sharing-Work-in-progress"><a href="#Sharing-Work-in-progress" class="headerlink" title="Sharing Work-in-progress"></a>Sharing Work-in-progress</h3><h4 id="localtunnel"><a href="#localtunnel" class="headerlink" title="localtunnel"></a>localtunnel</h4><p>æ­¥éª¤ï¼š</p><pre><code>1. npm install localtunnel -g2. start app3. lt --port 3000</code></pre><h4 id="ngrok"><a href="#ngrok" class="headerlink" title="ngrok"></a>ngrok</h4><ol><li>æ³¨å†Œ</li><li>å®‰è£… ngrok</li><li>å®‰è£… authtoken</li><li>start app</li><li>./ngrok http 80</li></ol><h4 id="now"><a href="#now" class="headerlink" title="now"></a>now</h4><h4 id="surge"><a href="#surge" class="headerlink" title="surge"></a>surge</h4><p>å¿«é€Ÿå°†é™æ€æ–‡ä»¶éƒ¨ç½²åˆ°å…¬å¼€URLä¸Šå»ã€‚</p><ol><li>npm install -g surge</li><li>surge</li></ol><h2 id="6-Automation"><a href="#6-Automation" class="headerlink" title="6. Automation"></a>6. Automation</h2><h3 id="Automation-Options"><a href="#Automation-Options" class="headerlink" title="Automation Options"></a>Automation Options</h3><ul><li>Grunt</li><li>Gulp</li><li>npm scripts</li></ul><h3 id="Demo-Pre-Post-Hooks"><a href="#Demo-Pre-Post-Hooks" class="headerlink" title="Demo: Pre/Post Hooks"></a>Demo: Pre/Post Hooks</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scripts: &#123;</span><br><span class="line">    <span class="attr">&quot;prestart&quot;</span>: <span class="string">&quot;node buildScripts/startMessage.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;node buildScripts/srcServer.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;poststart&quot;</span>: <span class="string">&quot;...&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è¿è¡Œ <code>npm start</code> æ—¶ï¼Œ<code>prestart</code>å‘½ä»¤ä¸­çš„å†…å®¹ä¼šè‡ªåŠ¨åœ¨å…¶ä¹‹å‰è¿è¡Œã€‚</p><h3 id="Demo-Create-Security-Check-and-Share-Scripts"><a href="#Demo-Create-Security-Check-and-Share-Scripts" class="headerlink" title="Demo: Create Security Check and Share Scripts"></a>Demo: Create Security Check and Share Scripts</h3><p>åœ¨ scripts é¡¹ä¸­åŠ å…¥ï¼š</p><pre><code>&quot;security-check&quot;: &quot;nsp check&quot;</code></pre><h3 id="Demo-Concurrent-Tasks"><a href="#Demo-Concurrent-Tasks" class="headerlink" title="Demo: Concurrent Tasks"></a>Demo: Concurrent Tasks</h3><p>å‡è®¾åœ¨è¿è¡Œserverçš„åŒæ—¶ï¼Œè¿›è¡Œsecurity-checkï¼Œå¯¹startå‘½ä»¤è¿›è¡Œå¦‚ä¸‹çš„ä¿®æ”¹ï¼š</p><pre><code>&quot;start&quot;: &quot;npm-run-all --parallel security-check open:src&quot;,&quot;open:src&quot;: &quot;node buildScripts/srcServer.js&quot;,</code></pre><p>å…¶ä¸­ç”¨ npm-run-all æ¥ä»£æ›¿ã€‚</p><p>å¯ä»¥ç”¨ npm start -s å‡å°‘è¾“å‡ºä¸­çš„å™ªå£°ã€‚</p><h2 id="7-Transpiling"><a href="#7-Transpiling" class="headerlink" title="7. Transpiling"></a>7. Transpiling</h2><h3 id="JavaScript-Versions"><a href="#JavaScript-Versions" class="headerlink" title="JavaScript Versions"></a>JavaScript Versions</h3><h3 id="Transpilers"><a href="#Transpilers" class="headerlink" title="Transpilers"></a>Transpilers</h3><p>Popular transpilers:</p><ul><li>Babel</li><li>TypeScript</li><li>Elm</li></ul><p>Babelå¯ä»¥å°†æœ€æ–°ç‰ˆæœ¬çš„JavaScriptä»£ç å‘ä¸‹è½¬æ¢æˆES5ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„æ–°ç‰¹æ€§ã€‚ä¹Ÿæ˜¯æœ€æµè¡Œçš„ã€‚</p><p>TypeScriptæ˜¯JavaScriptçš„è¶…é›†ã€‚ </p><p>Elmä¸æ˜¯JavaScriptï¼Œå¯ä»¥ç¼–è¯‘æˆJSã€‚</p><p>Babelé…ç½®é£æ ¼ï¼š</p><ol><li><p>ä½¿ç”¨.babelrcæ–‡ä»¶ï¼šä¸æ­¢èƒ½ç”¨åœ¨npmä¸­ï¼Œç‹¬ç«‹æ–‡ä»¶æ˜“äºé˜…è¯»</p></li><li><p>package.jsonï¼šé¡¹ç›®ä¸­å°‘äº†ä¸€ä¸ªæ–‡ä»¶</p></li></ol><p>åœ¨æ–‡ä»¶ä¸­åŠ å…¥<code>babel</code>é¡¹å³å¯</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;my-package&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;babel&quot;</span>: &#123;</span><br><span class="line">        <span class="comment">// my babel config here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Transpiling-Build-Scripts"><a href="#Transpiling-Build-Scripts" class="headerlink" title="Transpiling Build Scripts"></a>Transpiling Build Scripts</h3><h3 id="Demo-Set-Up-Babel"><a href="#Demo-Set-Up-Babel" class="headerlink" title="Demo: Set Up Babel"></a>Demo: Set Up Babel</h3><p>åŠ å…¥ .babelrcæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    &quot;latest&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨presetå‘½ä»¤ä¸­ç”¨babel-nodeæ¥ä»£æ›¿nodeï¼Œæ¥ä½¿ç”¨es6è¯­æ³•ã€‚è¿™æ ·å¯ä»¥ä½¿ç”¨import, const ç­‰å…³é”®å­—ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;prestart&quot;</span>: <span class="string">&quot;babel-node buildScripts/startMessage.js&quot;</span>,</span><br></pre></td></tr></table></figure><hr><h2 id="8-Bundling"><a href="#8-Bundling" class="headerlink" title="8. Bundling"></a>8. Bundling</h2><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p>CommonJSä¸èƒ½åœ¨webæµè§ˆå™¨ä¸­å·¥ä½œï¼Œéœ€è¦å°†npm packageæ‰“åŒ…æˆæµè§ˆå™¨èƒ½å¤Ÿä½¿ç”¨çš„å½¢å¼ã€‚</p><h3 id="Module-Formats"><a href="#Module-Formats" class="headerlink" title="Module Formats"></a>Module Formats</h3><p>5ä¸­æ¨¡å—å½¢å¼ï¼š</p><ul><li>IIFE</li><li>AMD</li><li>CommonJS</li><li>UMD</li><li>ES6 Modules</li></ul><p>ç°åœ¨åº”ç»§ç»­ä½¿ç”¨çš„ä¸¤ç§æ¨¡å—ï¼š</p><ul><li><p>CommonJS: nodeä¸­ä½¿ç”¨</p><p>  var jquery = require(â€˜jqueryâ€™)</p></li><li><p>ES6 Module</p></li></ul><h3 id="Why-ES6-Modules"><a href="#Why-ES6-Modules" class="headerlink" title="Why ES6 Modules?"></a>Why ES6 Modules?</h3><p>åŸå› ï¼š</p><ul><li>Standardized</li><li>Statically analyzable<ul><li>Improved autocomplete</li><li>intelligent refactoring</li><li>Fails fast</li><li>Tree shaking</li></ul></li><li>Easy to read<ul><li>Named imports</li><li>Default exports</li></ul></li></ul><h3 id="Choosing-a-Bundler"><a href="#Choosing-a-Bundler" class="headerlink" title="Choosing a Bundler"></a>Choosing a Bundler</h3><ul><li>require.js: first popular bundler</li><li>Browserify: large plugin ecosystem</li><li>Webpack: bundles more than just JS</li><li>Rollup: tree shaking, fast loading production code, quite new â€¦</li><li>JSPM: load modules at runtime</li></ul><p>Why webpack?</p><ul><li>Much more than just js<ul><li>css</li><li>images</li><li>fonts</li><li>html</li></ul></li><li>Bundle splitting</li><li>Hot module reloading</li><li>Webpack2 offers tree shaking</li></ul><h3 id="Demo-Configuring-Webpack"><a href="#Demo-Configuring-Webpack" class="headerlink" title="Demo: Configuring Webpack"></a>Demo: Configuring Webpack</h3><p>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»º<code>webpack.config.dev.js</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">debug</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;inline-source-map&#x27;</span>,</span><br><span class="line">  <span class="attr">noInfo</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">entry</span>: [</span><br><span class="line">    path.resolve(__dirname, <span class="string">&#x27;src/index&#x27;</span>)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">target</span>: <span class="string">&#x27;web&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">loaders</span>: [</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/.js$/</span>, exclude: <span class="regexp">/node_modules/</span>, loaders: [<span class="string">&#x27;babel&#x27;</span>]&#125;,</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, loaders: [<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;css&#x27;</span>]&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Note: Webpack wonâ€™t actually generate any physical files for our development build. It will serve our build from memory.</p><h3 id="Demo-Configure-Webpack-with-Express"><a href="#Demo-Configure-Webpack-with-Express" class="headerlink" title="Demo: Configure Webpack with Express"></a>Demo: Configure Webpack with Express</h3><p>åœ¨ <code>buildScripts/srcServer.js</code>ä¸­æ·»åŠ ä¸‹åˆ—å†…å®¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> webpack <span class="keyword">from</span> <span class="string">&#x27;webpack&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">&#x27;../webpack.config.dev&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = webpack(config);</span><br><span class="line"></span><br><span class="line">app.use(<span class="built_in">require</span>(<span class="string">&#x27;webpack-dev-middleware&#x27;</span>)(compiler, &#123;</span><br><span class="line">  <span class="attr">noInfo</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">publicPath</span>: config.output.publicPath</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h3 id="Demo-Create-app-entry-point"><a href="#Demo-Create-app-entry-point" class="headerlink" title="Demo: Create app entry point"></a>Demo: Create app entry point</h3><p>æ·»åŠ <code>index.js</code>æ–‡ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"><span class="keyword">import</span> numeral <span class="keyword">from</span> <span class="string">&#x27;numeral&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> courseValue = numeral(<span class="number">1000</span>).format(<span class="string">&#x27;$0, 0.00&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`I would pay <span class="subst">$&#123;courseValue&#125;</span> for this awesome course!`</span>);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Demo-Handling-css-with-webpack"><a href="#Demo-Handling-css-with-webpack" class="headerlink" title="Demo: Handling css with webpack"></a>Demo: Handling css with webpack</h3><p>åœ¨æˆ‘ä»¬çš„webpacké…ç½®æ–‡ä»¶ä¸­å·²ç»åŠ å…¥äº†cssçš„loaderçš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦åœ¨index.jså¼•å…¥cssæ–‡ä»¶å³å¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="Sourcemaps"><a href="#Sourcemaps" class="headerlink" title="Sourcemaps"></a>Sourcemaps</h3><p>Why: Debug transpiled and bundled code.</p><p>Maps code back to original source</p><h3 id="Demo-Debugging-via-sourcemaps"><a href="#Demo-Debugging-via-sourcemaps" class="headerlink" title="Demo: Debugging via sourcemaps"></a>Demo: Debugging via sourcemaps</h3><h2 id="9-Linting"><a href="#9-Linting" class="headerlink" title="9. Linting"></a>9. Linting</h2><h3 id="Why-Lint"><a href="#Why-Lint" class="headerlink" title="Why Lint?"></a>Why Lint?</h3><ul><li>Enforce consistency</li><li>Avoid mistakes</li></ul><h3 id="Linters"><a href="#Linters" class="headerlink" title="Linters"></a>Linters</h3><p>Linteré€‰æ‹©:</p><ul><li>JSLint</li><li>JSHint</li><li><strong>ESLint</strong></li></ul><h3 id="ESLint-Configuration-Decisions-Overview"><a href="#ESLint-Configuration-Decisions-Overview" class="headerlink" title="ESLint Configuration Decisions Overview"></a>ESLint Configuration Decisions Overview</h3><ol><li>Config format?</li><li>Which built-in rules?</li><li>Warnings or errors?</li><li>Which plugins?</li><li>Use preset instead?</li></ol><h3 id="Decision-1-Configuration-File-Fomat"><a href="#Decision-1-Configuration-File-Fomat" class="headerlink" title="Decision 1: Configuration File Fomat"></a>Decision 1: Configuration File Fomat</h3><p>åˆ›å»ºESLinté…ç½®æ–‡ä»¶ï¼Œæˆ–åœ¨<code>package.json</code>æ–‡ä»¶ä¸­åŠ å…¥<code>eslintConfig</code>é¡¹ã€‚</p><h3 id="Decision-2-Which-rules"><a href="#Decision-2-Which-rules" class="headerlink" title="Decision 2: Which rules"></a>Decision 2: Which rules</h3><h3 id="Decision-3-Warnings-or-errors"><a href="#Decision-3-Warnings-or-errors" class="headerlink" title="Decision 3: Warnings or errors"></a>Decision 3: Warnings or errors</h3><ul><li><p>Warnings</p><ul><li>Can continnue development</li><li>Can be ignored</li></ul></li><li><p>Error</p><ul><li>Breaks the build</li><li>Cannot be ignored</li></ul></li></ul><h3 id="Decision-4-Which-plugins"><a href="#Decision-4-Which-plugins" class="headerlink" title="Decision 4: Which plugins"></a>Decision 4: Which plugins</h3><p>Reactå¼€å‘æ¨èï¼šeslint-plugin-react</p><p><a href="https://github.com/dustinspecker/awesome-eslint">Awesome ESLint</a></p><h3 id="Decision-5-Preset"><a href="#Decision-5-Preset" class="headerlink" title="Decision 5: Preset"></a>Decision 5: Preset</h3><ul><li>From scratch</li><li>Recommended</li><li>Presets</li></ul><h3 id="Watching-Files-with-ESLint"><a href="#Watching-Files-with-ESLint" class="headerlink" title="Watching Files with ESLint"></a>Watching Files with ESLint</h3><p>Issue: ESLint doesnâ€™t watch files</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>eslint-loader<ul><li>Re-lint all files upon save</li></ul></li><li>eslint-watch<ul><li>ESLint wrapper that adds file watch</li><li>Not tied to webpack</li><li>Better warning/error formatting</li><li>â€¦</li></ul></li></ul><h3 id="Linting-Experimental-Features"><a href="#Linting-Experimental-Features" class="headerlink" title="Linting Experimental Features"></a>Linting Experimental Features</h3><ul><li>Run ESLint directly<ul><li>Supports ES6 and ES7 natively</li></ul></li><li>Babel-eslint<ul><li>Also lints stage 0-4 features</li></ul></li></ul><p>Weâ€™ll use plain ESLint and run it via eslint-watch.</p><h3 id="Why-Lint-Via-an-antomated-Build"><a href="#Why-Lint-Via-an-antomated-Build" class="headerlink" title="Why Lint Via an antomated Build?"></a>Why Lint Via an antomated Build?</h3><ol><li>One place to check</li><li>Universal Configuration</li><li>Part of continuous integration</li></ol><h3 id="Demo-ESLint-Set-Up"><a href="#Demo-ESLint-Set-Up" class="headerlink" title="Demo: ESLint Set Up"></a>Demo: ESLint Set Up</h3><p>ESLintè®¾ç½®ï¼š</p><ul><li>ESLint Recommended</li><li>eslint-watch</li></ul><p>æ·»åŠ <code>.eslintrc.json</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><p><a href="https://gist.github.com/coryhouse/61f866c7174220777899bcfff03dab7f">GitHubGist</a></p><p>åˆ›å»ºè°ƒç”¨<code>eslint-watch</code>çš„ npm scriptï¼š</p><pre><code>&quot;lint&quot;: &quot;esw webpack.config.* src buildScripts --color&quot;,</code></pre><p>å¯ä»¥ä½¿ç”¨æ³¨é‡Šæ¥æ’é™¤æŸä¸€ä¸ªeslintçš„è§„åˆ™ï¼š</p><pre><code>/* eslint-disable no-console */// eslint-disable-line no-console</code></pre><h3 id="Demo-Watching-Files"><a href="#Demo-Watching-Files" class="headerlink" title="Demo: Watching Files"></a>Demo: Watching Files</h3><p>åœ¨ lint script ä¸‹åŠ ä¸€å¥ï¼š</p><pre><code>&quot;lint:watch&quot;: &quot;npm run lint -- --watch&quot;,</code></pre><p>åŠ å…¥ start script ä¸­ï¼š</p><pre><code>&quot;start&quot;: &quot;npm-run-all --parallel security-check open:src lint:watch&quot;,</code></pre><h2 id="10-Testing-and-Continuous-Integration"><a href="#10-Testing-and-Continuous-Integration" class="headerlink" title="10. Testing and Continuous Integration"></a>10. Testing and Continuous Integration</h2><h3 id="Test-Decisions-Overview"><a href="#Test-Decisions-Overview" class="headerlink" title="Test Decisions Overview"></a>Test Decisions Overview</h3><table><thead><tr><th>Style</th><th>Focus</th></tr></thead><tbody><tr><td>Unit</td><td>Single function or module</td></tr><tr><td>Integration</td><td>Interations between modules</td></tr><tr><td>UI</td><td>Automate interaations with UI</td></tr></tbody></table><h3 id="Decision-1-Testing-Framework"><a href="#Decision-1-Testing-Framework" class="headerlink" title="Decision 1: Testing Framework"></a>Decision 1: Testing Framework</h3><ul><li><strong>Mocha</strong></li><li>Jasmine</li><li>Tape</li><li>QUnit</li><li>AVA</li><li>Jest</li></ul><p>ä»¥ä¸Šä»»ä¸€çš†å¯ã€‚</p><h3 id="Decision-2-Assertion-Libries"><a href="#Decision-2-Assertion-Libries" class="headerlink" title="Decision 2: Assertion Libries"></a>Decision 2: Assertion Libries</h3><p>Jasmine and Jest have assertion libries built in.</p><p>Assertion: Declare what you expect</p><pre><code>eg. expect(2 + 2).to.equal(4)</code></pre><ul><li><strong>Chai</strong></li><li>Should.js</li><li>expect</li></ul><h3 id="Decision-3-Helper-Libraries"><a href="#Decision-3-Helper-Libraries" class="headerlink" title="Decision 3: Helper Libraries"></a>Decision 3: Helper Libraries</h3><ul><li><p>JSOM: Simulate the browserâ€™s DOM</p></li><li><p>Cheerio: jQuery for the server</p></li></ul><h3 id="Decision-4-Where-to-run-tests"><a href="#Decision-4-Where-to-run-tests" class="headerlink" title="Decision 4: Where to run tests"></a>Decision 4: Where to run tests</h3><ul><li>Browser: Karma, Testem</li><li>Headless Browser: PhantomJS</li><li>In-mermory DOM: <strong>JSDOM</strong></li></ul><h3 id="Decision-5-Where-do-test-files-belong"><a href="#Decision-5-Where-do-test-files-belong" class="headerlink" title="Decision 5: Where do test files belong"></a>Decision 5: Where do test files belong</h3><ul><li>Centralized: in a folder called â€˜testâ€™<ul><li>Less â€œnoiseâ€ in src folder</li><li>Deployment confusion</li><li>Inertia</li></ul></li><li>Alongside<ul><li>Easy imports</li><li>Clear visibility</li><li>Conventient to open</li><li>â€¦</li></ul></li></ul><h3 id="Decision-6-When-should-tests-run"><a href="#Decision-6-When-should-tests-run" class="headerlink" title="Decision 6: When should tests run?"></a>Decision 6: When should tests run?</h3><ul><li>Unit tests should run when you hit save<ul><li>Rapid feedback</li></ul></li><li>Interation tests often run on demand, or in QA</li></ul><h3 id="Demo-Testing-Setup"><a href="#Demo-Testing-Setup" class="headerlink" title="Demo: Testing Setup"></a>Demo: Testing Setup</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** buildScripts/testSetup.js */</span></span><br><span class="line"><span class="comment">// Register babel to transpile before our test run.</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;babel-register&#x27;</span>)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Disable webpack features that Mocha doesn&#x27;t understand.</span></span><br><span class="line"><span class="built_in">require</span>.extensions[<span class="string">&#x27;.css&#x27;</span>] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add &quot;test&quot; scripts in package.json</span></span><br><span class="line"><span class="string">&quot;test&quot;</span>: <span class="string">&quot;mocha --reporter progress buildScripts/testSetup.js \&quot;src/**/*.test.js\&quot; &quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/index.test.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; expect &#125; <span class="keyword">from</span> <span class="string">&#x27;chai&#x27;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;Our first test&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;should pass&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    expect(<span class="literal">true</span>).to.equal(<span class="literal">true</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Demo-DOM-Testing"><a href="#Demo-DOM-Testing" class="headerlink" title="Demo: DOM Testing"></a>Demo: DOM Testing</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsdom <span class="keyword">from</span> <span class="string">&#x27;jsdom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// other code</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;index.html&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;should say hello&#x27;</span>, <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> index = fs.readFileSync(<span class="string">&#x27;./src/index.html&#x27;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    jsdom.env(index, <span class="function"><span class="keyword">function</span>(<span class="params">err, <span class="built_in">window</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> h1 = <span class="built_in">window</span>.document.getElementsByTagName(<span class="string">&#x27;h1&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">      expect(h1.innerHTML).to.equal(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">      done();</span><br><span class="line">      <span class="built_in">window</span>.close();</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Demo-Watching-Tests"><a href="#Demo-Watching-Tests" class="headerlink" title="Demo: Watching Tests"></a>Demo: Watching Tests</h3><p>Add this script to <code>package.json</code>:</p><pre><code>&quot;test:watch&quot;: &quot;npm run test -- --watch&quot;</code></pre><p>Then add <code>test:watch</code> to the end of <code>start</code> script:</p><pre><code>&quot;start&quot;: &quot;npm-run-all --parallel security-check open:src lint:watch test:watch&quot;</code></pre><h3 id="Why-Continuous-Integration"><a href="#Why-Continuous-Integration" class="headerlink" title="Why Continuous Integration?"></a>Why Continuous Integration?</h3><p>When team commits code, confirm immediately that the commit works as expected when on another machine.</p><h3 id="What-Does-Continuous-Integration-Do"><a href="#What-Does-Continuous-Integration-Do" class="headerlink" title="What Does Continuous Integration Do?"></a>What Does Continuous Integration Do?</h3><ul><li>Run automated build</li><li>Run your tests</li><li>Check code coverage</li><li>Automate deployment</li></ul><h3 id="Choosing-a-CI-Server"><a href="#Choosing-a-CI-Server" class="headerlink" title="Choosing a CI Server"></a>Choosing a CI Server</h3><ul><li><strong>Travis</strong>: Linux based</li><li><strong>Appveyor</strong>: Windows based</li><li>Jenkins</li><li>CircleCI</li><li>Semaphore</li><li>SnapCI</li></ul><h3 id="Demo-Travis-CI"><a href="#Demo-Travis-CI" class="headerlink" title="Demo: Travis CI"></a>Demo: Travis CI</h3><p>ä½¿ç”¨GitHubè´¦å·ç™»å½•<a href="https://travis-ci.org/">Travis CI</a>ï¼Œå³å¯é€‰æ‹©ä½ åœ¨GitHubä¸Šçš„é¡¹ç›®è¿›è¡ŒæŒç»­é›†æˆã€‚</p><p>éœ€è¦åœ¨é¡¹ç›®ä¸­åŠ å…¥travisçš„é…ç½®æ–‡ä»¶<code>.travis.yml</code>ï¼š</p><pre><code>language: node_jsnode_js:  - &quot;6&quot;</code></pre><h3 id="Demo-Appveyor"><a href="#Demo-Appveyor" class="headerlink" title="Demo: Appveyor"></a>Demo: Appveyor</h3><h2 id="11-HTTP-Calls"><a href="#11-HTTP-Calls" class="headerlink" title="11. HTTP Calls"></a>11. HTTP Calls</h2><h3 id="HTTP-Call-Approaches"><a href="#HTTP-Call-Approaches" class="headerlink" title="HTTP Call Approaches"></a>HTTP Call Approaches</h3><ul><li>Node<ul><li>http</li><li>request</li></ul></li><li>Browser<ul><li>XMLHttpRequest</li><li>jQuery</li><li>Framework-based</li><li>Fetch</li></ul></li><li>Node &amp; Browser<ul><li>isomorphic-fetch</li><li>xhr</li><li>superagent</li><li>axios</li></ul></li></ul><h3 id="Centralizing-HTTP-Requests"><a href="#Centralizing-HTTP-Requests" class="headerlink" title="Centralizing HTTP Requests"></a>Centralizing HTTP Requests</h3><p>Why?</p><ul><li>Configure all calls</li><li>Handle preloader logic</li><li>Handle errors</li><li>Single seam for mocking</li></ul><h3 id="Demo-Fetch"><a href="#Demo-Fetch" class="headerlink" title="Demo: Fetch"></a>Demo: Fetch</h3><p>ä¿®æ”¹ <code>srcServer.js</code> æ–‡ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/users&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.json([</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>,<span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;Bob&quot;</span>,<span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Smith&quot;</span>,<span class="string">&quot;email&quot;</span>:<span class="string">&quot;bob@gmail.com&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>,<span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;Tammy&quot;</span>,<span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Norton&quot;</span>,<span class="string">&quot;email&quot;</span>:<span class="string">&quot;tnorton@yahoo.com&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">3</span>,<span class="string">&quot;firstName&quot;</span>:<span class="string">&quot;Tina&quot;</span>,<span class="string">&quot;lastName&quot;</span>:<span class="string">&quot;Lee&quot;</span>,<span class="string">&quot;email&quot;</span>:<span class="string">&quot;lee.tina@hotmail.com&quot;</span>&#125;</span><br><span class="line">  ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åŠ å…¥ userApi.js æ–‡ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;whatwg-fetch&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUsers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> get(<span class="string">&#x27;users&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(url).then(onSuccess, onError);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onSuccess</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> response.json();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error); <span class="comment">// eslint-disable-line no-console</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ‰“å¼€<code>localhost:3000/users</code>ï¼Œèƒ½æŸ¥çœ‹APIç»“æœã€‚</p><h3 id="Selective-Polyfilling"><a href="#Selective-Polyfilling" class="headerlink" title="Selective Polyfilling"></a>Selective Polyfilling</h3><p>Polyfill.io: Only send polyfill to those who need it</p><h3 id="Why-Mock-HTTP"><a href="#Why-Mock-HTTP" class="headerlink" title="Why Mock HTTP?"></a>Why Mock HTTP?</h3><ul><li>Unit Testing</li><li>Instant response</li><li>Keep working when services are down</li><li>Rapid prototyping</li><li>Avoid inter-team bottlenecks</li><li>Work offline</li></ul><h3 id="How-to-Mock-HTTP"><a href="#How-to-Mock-HTTP" class="headerlink" title="How to Mock HTTP"></a>How to Mock HTTP</h3><ul><li>Nock</li><li>Static JSON</li><li>Create development webserver<ul><li>api-mock</li><li>JSON server</li><li>JSON Schema faker</li><li>Browsersync</li><li>Express, etc</li></ul></li></ul><h3 id="Our-Plan-for-Mocking"><a href="#Our-Plan-for-Mocking" class="headerlink" title="Our Plan for Mocking"></a>Our Plan for Mocking</h3><ol><li>Declare our schema:<ul><li>JSON Schema Faker</li></ul></li><li>Generate Random Data:<ul><li>faker.js</li><li>chance.js</li><li>randexp.js</li></ul></li><li>Serve Data via API<ul><li>JSON Server</li></ul></li></ol><h3 id="Mocking-Libraries"><a href="#Mocking-Libraries" class="headerlink" title="Mocking Libraries"></a>Mocking Libraries</h3><p>JSON Schema Faker</p><p>JSON Server</p><h3 id="Demo-Creating-a-Mock-API-Data-Schema"><a href="#Demo-Creating-a-Mock-API-Data-Schema" class="headerlink" title="Demo: Creating a Mock API Data Schema"></a>Demo: Creating a Mock API Data Schema</h3><ul><li>Mock HTTP</li></ul><p>åˆ›å»ºæ–‡ä»¶ï¼š<code>buildScripts/mockDataSchema.js</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼šbit.ly/ps-mock-data-schema</p><h3 id="Demo-Generating-Mock-Data"><a href="#Demo-Generating-Mock-Data" class="headerlink" title="Demo: Generating Mock Data"></a>Demo: Generating Mock Data</h3><p>åœ¨<code>buildScripts</code>ä¸­æ–°å»ºæ–‡ä»¶<code>generateMockData.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// buildScripts/generateMockData.js</span></span><br><span class="line"><span class="keyword">import</span> jsf <span class="keyword">from</span> <span class="string">&#x27;json-schema-faker&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; schema &#125; <span class="keyword">from</span> <span class="string">&#x27;./mockDataSchema&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> chalk <span class="keyword">from</span> <span class="string">&#x27;chalk&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> json = <span class="built_in">JSON</span>.stringify(jsf(schema));</span><br><span class="line"></span><br><span class="line">fs.writeFile(<span class="string">&quot;./src/api/db.json&quot;</span>, json, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(chalk.red(err));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(chalk.green(<span class="string">&quot;Mock data generated&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åœ¨<code>package.json</code>ä¸­åŠ å…¥<code>generate-mock-data</code> script:</p><pre><code>&quot;generate-mock-data&quot;: &quot;babel-node buildScripts/generateMockData&quot;</code></pre><p>è¿è¡Œ<code>npm run generate-mock-data</code>ï¼Œä¼šç”Ÿæˆä¸€ä¸ª<code>db.json</code>æ–‡ä»¶ã€‚</p><h3 id="Demo-Serving-Mock-Data-via-JSON-Server"><a href="#Demo-Serving-Mock-Data-via-JSON-Server" class="headerlink" title="Demo: Serving Mock Data via JSON Server"></a>Demo: Serving Mock Data via JSON Server</h3><p>Add script:</p><pre><code>&quot;start-mockapi&quot;: &quot;json-server --watch src/api/db.json --port 3001&quot;</code></pre><p>json-server ä¼šå°†<code>db.json</code>ä¸­çš„å†…å®¹ç”Ÿæˆä¸€ä¸ªAPIï¼Œå¦‚ä¸‹ä¸ºè¿è¡Œåè¾“å‡ºå†…å®¹ã€‚</p><pre><code>Loading src/api/db.jsonDoneResourceshttp://localhost:3001/usersHomehttp://localhost:3001</code></pre><p>åœ¨å¼€å‘ç¯å¢ƒä¸­éœ€è¦å°†APIæ¢æˆ mock apiã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/api</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">getBaseUrl</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> inDevelopment = <span class="built_in">window</span>.location.hostname === <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> inDevelopment ? <span class="string">&#x27;http://localhost:3001/&#x27;</span> : <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// return fetch(url).then(onSuccess, onError);</span></span><br><span class="line">  <span class="keyword">return</span> fetch(baseUrl + url).then(onSuccess, onError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Demo-Manipulating-Data-via-JSON-Server"><a href="#Demo-Manipulating-Data-via-JSON-Server" class="headerlink" title="Demo: Manipulating Data via JSON Server"></a>Demo: Manipulating Data via JSON Server</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/api</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteUser</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> del(<span class="string">`users/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> request = <span class="keyword">new</span> Request(baseUrl + url, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;DELETE&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> fetch(request).then(onSuccess, onError);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="12-Project-Structure"><a href="#12-Project-Structure" class="headerlink" title="12. Project Structure"></a>12. Project Structure</h2><h3 id="Why-a-Demo-App"><a href="#Why-a-Demo-App" class="headerlink" title="Why a Demo App?"></a>Why a Demo App?</h3><p>Examples of:</p><ul><li>Directory structure and file naming</li><li>Framework usage</li><li>Testing</li><li>Mock API</li><li>Automated deployment</li></ul><h3 id="Tip-1-JS-Belongs-in-a-js-File"><a href="#Tip-1-JS-Belongs-in-a-js-File" class="headerlink" title="Tip 1: JS Belongs in a .js File"></a>Tip 1: JS Belongs in a .js File</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// dont&#x27;t put code here</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="Tip-2-Consider-Organizing-by-Feature"><a href="#Tip-2-Consider-Organizing-by-Feature" class="headerlink" title="Tip 2: Consider Organizing by Feature"></a>Tip 2: Consider Organizing by Feature</h3><h3 id="Tip-3-Extract-Logic-to-POJOs"><a href="#Tip-3-Extract-Logic-to-POJOs" class="headerlink" title="Tip 3: Extract Logic to POJOs"></a>Tip 3: Extract Logic to POJOs</h3><p>POJOs: Plain Old JavaScript Objects, Pure logic, No framework-specific code</p><h2 id="13-Production-Build"><a href="#13-Production-Build" class="headerlink" title="13. Production Build"></a>13. Production Build</h2><h3 id="Minification-and-Sourcemaps"><a href="#Minification-and-Sourcemaps" class="headerlink" title="Minification and Sourcemaps"></a>Minification and Sourcemaps</h3><h3 id="Demo-Production-Webpack-Configuration-with-Minification"><a href="#Demo-Production-Webpack-Configuration-with-Minification" class="headerlink" title="Demo: Production Webpack Configuration with Minification"></a>Demo: Production Webpack Configuration with Minification</h3><p>æ–°å»º<code>webpack.config.prod.js</code>ï¼Œç›¸æ¯”<code>webpack.config.dev.js</code>åŠ å…¥pluginï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="comment">// Eliminate duplicate packages when generating bundle</span></span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.DedupePlugin(),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Minify JS</span></span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin()</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p>æ–°å»º<code>buildScripts/build.js</code>æ–‡ä»¶ã€‚</p><h3 id="Demo-Configure-Local-dist-Server"><a href="#Demo-Configure-Local-dist-Server" class="headerlink" title="Demo: Configure Local/dist Server"></a>Demo: Configure Local/dist Server</h3><p>æ–°å»º<code>buildScripts/distServer.js</code>æ–‡ä»¶ï¼Œç”¨äº static filesã€‚</p><h3 id="Demo-Toggle-Mock-API"><a href="#Demo-Toggle-Mock-API" class="headerlink" title="Demo: Toggle Mock API"></a>Demo: Toggle Mock API</h3><h3 id="Demo-Production-Build-npm-Scripts"><a href="#Demo-Production-Build-npm-Scripts" class="headerlink" title="Demo: Production Build npm Scripts"></a>Demo: Production Build npm Scripts</h3><h3 id="Dynamic-HTML-Generation"><a href="#Dynamic-HTML-Generation" class="headerlink" title="Dynamic HTML Generation"></a>Dynamic HTML Generation</h3><h3 id="Bundle-Splitting"><a href="#Bundle-Splitting" class="headerlink" title="Bundle Splitting"></a>Bundle Splitting</h3><h3 id="Cache-Busting"><a href="#Cache-Busting" class="headerlink" title="Cache Busting"></a>Cache Busting</h3><h3 id="Demo-Extract-and-Minify-CSS"><a href="#Demo-Extract-and-Minify-CSS" class="headerlink" title="Demo: Extract and Minify CSS"></a>Demo: Extract and Minify CSS</h3><h3 id="Error-Logging"><a href="#Error-Logging" class="headerlink" title="Error Logging"></a>Error Logging</h3><h2 id="14-Production-Deploy"><a href="#14-Production-Deploy" class="headerlink" title="14. Production Deploy"></a>14. Production Deploy</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ç¯‡åšå®¢æ˜¯æˆ‘åœ¨å­¦ä¹  &lt;a href=&quot;https://app.pluralsight.com/library/courses/javascript-development-environment/recommended-courses&quot;&gt;Pluralsightä¸Šçš„è¯¾ç¨‹ï¼šBuilding a JavaScript Development Environment&lt;/a&gt; æ—¶è®°ä¸‹çš„ç¬”è®°ï¼Œä»…ä½œä¸ªäººè®°å½•ä¹‹ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é—¨è¯¾ç¨‹ç³»ç»Ÿåœ°ä»‹ç»äº†å‰ç«¯å¼€å‘ä¸­çš„è®¸å¤šå·¥å…·å’Œæœ¯è¯­ï¼Œä»ç¼–è¾‘å™¨çš„é€‰æ‹©åˆ°é¡¹ç›®çš„éƒ¨ç½²éƒ½è¿›è¡Œäº†ä»‹ç»ï¼Œæˆ‘åœ¨å­¦ä¹ äº†è¿™ä¸ªè¯¾ç¨‹åæ„Ÿè§‰å°†ä¹‹å‰é›¶æ•£å­¦ä¹ çš„å†…å®¹ä¸²äº†èµ·æ¥ã€‚&lt;/p&gt;
&lt;p&gt;é¡ºä¾¿ä¸€è¯´ï¼ŒPluralsightç½‘ç«™ä¸Šé¢æœ‰è®¸å¤šä¸é”™çš„è¯¾ç¨‹ï¼Œä¸è¿‡ä»·æ ¼å¤ªè´µï¼Œéœ€æ¯æœˆä»˜29ç¾å…ƒğŸ˜¥ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ç”¨å¾®è½¯è´¦å·åŠ å…¥&lt;a href=&quot;https://www.visualstudio.com/zh-hans/dev-essentials/&quot;&gt;Visual Studio Dev Essentials è®¡åˆ’&lt;/a&gt;ï¼Œè¿™æ ·å°±å¯ä»¥å…è´¹è·å¾—Pluralsight 3ä¸ªæœˆçš„è®¢é˜…äº†ğŸ˜€ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;1-Course-Overview&quot;&gt;&lt;a href=&quot;#1-Course-Overview&quot; class=&quot;headerlink&quot; title=&quot;1. Course Overview&quot;&gt;&lt;/a&gt;1. Course Overview&lt;/h2&gt;&lt;p&gt;ç¼–ç¨‹çš„æ—¶å€™è¦åšè®¸å¤šé€‰æ‹©&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Editor&lt;/li&gt;
&lt;li&gt;Module format&lt;/li&gt;
&lt;li&gt;HTML generation&lt;/li&gt;
&lt;li&gt;Transpiling&lt;/li&gt;
&lt;li&gt;Bundler&lt;/li&gt;
&lt;li&gt;Linting&lt;/li&gt;
&lt;li&gt;Testing&lt;/li&gt;
&lt;li&gt;â€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é—¨è¯¾ç¨‹ä»‹ç»äº†å¦‚ä½•åœ¨è¿™äº›é€‰é¡¹ä¸­åšå‡ºé€‰æ‹©&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.wukai.me/tags/javascript/"/>
    
      <category term="webpack" scheme="http://www.wukai.me/tags/webpack/"/>
    
      <category term="npm" scheme="http://www.wukai.me/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>ä»å¤´åˆ›å»ºä¸€ä¸ªåŸºäº React, webpack, babel çš„æ¨¡æ¿é¡¹ç›®</title>
    <link href="http://www.wukai.me/2016/09/14/create-a-react-webpack-es6-project/"/>
    <id>http://www.wukai.me/2016/09/14/create-a-react-webpack-es6-project/</id>
    <published>2016-09-13T16:00:00.000Z</published>
    <updated>2022-02-16T13:57:16.004Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚æœæ˜¯ä¸€ä¸ªåˆšæ¥è§¦ React çš„æ–°æ‰‹ï¼Œå½“å­¦å®Œäº† React çš„å„ç§åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•ä¹‹åï¼Œå‡†å¤‡å¼€å§‹å®é™…çš„å¼€å‘å·¥ä½œæ—¶ï¼Œä»–åˆä¼šç¢°åˆ°å„ç§æ–°é¢–çš„åè¯ï¼šnpm, webpack, babel, flux, es2015â€¦â€¦ å¦‚æœä»¥å‰æ¥è§¦è¿‡è¿™äº›å·¥å…·è¿˜å¥½ï¼Œå¦åˆ™ä¸ºäº†å»ºç«‹ä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œè¿˜éœ€è¦å­¦ä¹ è¿™ä¸€æ•´å¥—çš„æµç¨‹ï¼Œè€Œåœ¨è¿™ä¸­é—´åˆä¼šç¢°ä¸Šå„ç§å‘ï¼Œè¿™ä¸ªè¿‡ç¨‹å°†ä¼šéå¸¸ç—›è‹¦ã€‚ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å» GitHub ä¸Šå¯»æ‰¾å„ç§æ¨¡æ¿é¡¹ç›®ï¼Œç”¨ React + webpack + â€¦ ä½œä¸ºå…³é”®å­—æœç´¢å¯ä»¥å‘ç°è®¸å¤šåˆ«äººåˆ›å»ºçš„ç©ºé¡¹ç›®ï¼Œä½ å¯ä»¥åœ¨å…¶åŸºç¡€ä¸Šç¨ä½œä¿®æ”¹ç„¶åå¼€å§‹å¼€å‘ã€‚æˆ‘åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œä½†ä¹‹åå¯¹å…¶ä¸­çš„ä¸€äº›é…ç½®é¡¹ä»æ˜¯ä¸€çŸ¥åŠè§£ã€‚</p><p>æˆ‘åœ¨è¿™é‡Œä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ¨¡æ¿é¡¹ç›®ï¼Œå¹¶å°†è¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œä¸€æ–¹é¢å¸Œæœ›èƒ½ç»™çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„äººä»¥å¸®åŠ©ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯åŠ æ·±æˆ‘è‡ªå·±çš„ç†è§£ã€‚</p><p>æœ€åå®Œæˆçš„é¡¹ç›®è§è¿™ä¸ªé¡¹ç›®ï¼š<a href="https://github.com/noiron/react-webpack-babel-boilerplate">react-webpack-babel-boilerplate</a>ï¼Œåœ¨å»ºç«‹è¿™ä¸ªé¡¹ç›®è¿‡ç¨‹ä¸­çš„æ­¥éª¤å¯è§å¦ä¸€ä¸ªé¡¹ç›®ï¼š<a href="https://github.com/noiron/create-react-boilerplate-steps">create-react-boilerplate-steps</a>ï¼Œè¿‡ç¨‹è¢«åˆ†åˆ°äº†å¤šä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</p><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><p>åœ¨å¼€å§‹ä¹‹å‰å…ˆçœ‹çœ‹é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼š</p><pre><code>- src  - index.js  - App.js- .babelrc- index.html- package.json- server.js- webpack.config.js</code></pre><p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦çš„å…¨éƒ¨æ–‡ä»¶äº†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä¼šå°†è¿™ä¸ªé¡¹ç›®çš„æ„å»ºè¿‡ç¨‹åˆ†è§£æˆå‡ ä¸ªæ­¥éª¤ï¼Œä½ åªè¦æŒ‰ç…§è¿™äº›æ­¥éª¤ä¾æ¬¡è¿›è¡Œå³å¯ã€‚</p><span id="more"></span><h2 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h2><p>é¦–å…ˆæˆ‘ä»¬æ–°å»ºä¸€ä¸ªåä¸º react-webpack-boilerplate çš„æ–‡ä»¶å¤¹ï¼Œç„¶åéœ€è¦åœ¨å‘½ä»¤è¡Œä¸‹å¯¹é¡¹ç›®è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>ä½ éœ€è¦åˆ° Node.js çš„å®˜ç½‘ä¸Šä¸‹è½½ node.js å¹¶å®‰è£…ï¼Œå¦‚æœä½ å·²ç»å¯¹ NPM æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸‹è¿›å…¥é¡¹ç›®ç›®å½•è¿è¡Œï¼š</p><pre><code>npm init</code></pre><p>ä¹‹åä½ éœ€è¦æŒ‰ç…§æç¤ºè¾“å…¥ä½ çš„é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä¸€ç›´å›è½¦ï¼Œåˆ™é€‰æ‹©é»˜è®¤é€‰é¡¹ï¼Œæˆ–è€…è¿è¡Œï¼š</p><pre><code>npm init -y    // æ‰€æœ‰ä¿¡æ¯éƒ½æŒ‰ç…§é»˜è®¤è®¾ç½®</code></pre><p><code>npm init</code> å‘½ä»¤çš„ä½œç”¨å°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼Œä½ å¯ä»¥å‘ç°é¡¹ç›®æ–‡ä»¶å¤¹å†…å¤šå‡ºäº†ä¸€ä¸ª <code>package.json</code> æ–‡ä»¶ï¼Œå®ƒçš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‰ç…§é»˜è®¤è®¾ç½®ç”Ÿæˆçš„ package.json æ–‡ä»¶</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;react-webpack-boilerplate&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¡¹ç›®çš„è¿è¡Œéœ€è¦ä¾èµ–å„ç§ npm åŒ…ï¼Œéœ€è¦åœ¨æ–‡ä»¶çš„ â€œdependenciesâ€ æˆ– â€œdevDependenciesâ€ é¡¹ä¸‹å†™æ˜ npm åŒ…çš„åç§°åŠç‰ˆæœ¬ã€‚ç°åœ¨è¿™ä¸ªé¡¹ç›®è¿˜æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜æ²¡æœ‰è¿™ä¸¤é¡¹ã€‚</p><p>ç”±äºç›´æ¥ç”¨ npm å®‰è£…çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç”¨ cnpm install å‘½ä»¤æ¥ä»£æ›¿ npm install å‘½ä»¤ã€‚</p><p>CNPM æ˜¯æ·˜å®å»ºç«‹çš„ä¸€ä¸ª NPM é•œåƒï¼Œç”±äºæœåŠ¡å™¨åœ¨å›½å†…ï¼Œé€Ÿåº¦è‡ªç„¶ä¹Ÿå°±å¿«å¤šäº†ã€‚</p><pre><code>// å®‰è£… cnpm$ npm install -g cnpm --registry=https://registry.npm.taobao.org</code></pre><p>å®Œæˆåï¼Œä½ å°±å¯ä»¥ç”¨ cnpm install æ¥å®‰è£…æ‰€éœ€çš„ npm åŒ…äº†ã€‚</p><blockquote><p><a href="https://npm.taobao.org/">æ·˜å® NPM é•œåƒ</a></p></blockquote><h2 id="å®‰è£…åŠé…ç½®-webpack"><a href="#å®‰è£…åŠé…ç½®-webpack" class="headerlink" title="å®‰è£…åŠé…ç½® webpack"></a>å®‰è£…åŠé…ç½® webpack</h2><h3 id="webpack-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#webpack-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="webpack æ˜¯ä»€ä¹ˆï¼Ÿ"></a>webpack æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>webpack æ˜¯ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿå°†å„ç§èµ„æºå¦‚ jsã€cssã€å›¾ç‰‡ä½œä¸ºæ¨¡å—è½½å…¥å¹¶è¿›è¡Œæ‰“åŒ…ã€‚ä½ å¯ä»¥ä»<a href="https://github.com/petehunt/webpack-howto">GitHubä¸Šè¿™ä¸ªæ•™ç¨‹</a><br>å¼€å§‹å­¦ä¹  webpack çš„åŸºæœ¬ç”¨æ³•ã€‚</p><h3 id="webpack-çš„å®‰è£…"><a href="#webpack-çš„å®‰è£…" class="headerlink" title="webpack çš„å®‰è£…"></a>webpack çš„å®‰è£…</h3><p>åœ¨å‘½ä»¤è¡Œä¸‹é¢è¿è¡Œï¼š</p><pre><code>$ npm install webpack --save-dev</code></pre><p>è¿™ä¸€å¥çš„ä½œç”¨çš„æ˜¯ç»™é¡¹ç›®å®‰è£… webpackï¼Œç°åœ¨æŸ¥çœ‹é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œä¼šå‘ç°å¤šå‡ºäº†ä¸€ä¸ª <code>node_modules</code> æ–‡ä»¶å¤¹ï¼Œè¿™é‡Œå°±æ˜¯å­˜æ”¾é¡¹ç›®æ‰€ä¾èµ–çš„ npm åŒ…çš„åœ°æ–¹ã€‚</p><p>ä¸Šé¢çš„è¿™æ¡å‘½ä»¤åé¢è·Ÿç€çš„ <code>--save-dev</code>ï¼Œè¡¨ç¤ºå°†ä¼šæŠŠ webpack çš„åç§°å†™å…¥ <code>package.json</code> æ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬æ‰“å¼€ <code>package.json</code> æ–‡ä»¶ï¼Œå‘ç°æ–‡ä»¶ä¸­å¤šäº†ä¸€é¡¹ï¼š</p><pre><code>&quot;devDependencies&quot;: &#123;    &quot;webpack&quot;: &quot;^1.13.2&quot;&#125;</code></pre><p><code>--save-dev</code> è¡¨ç¤ºä¼šå†™å…¥ â€œdevDependenciesâ€ é¡¹ä¸­ï¼Œè€Œ <code>--save</code> å†™å…¥çš„æ˜¯ â€œdependenciesâ€ é¡¹ã€‚</p><h3 id="webpack-çš„æµ‹è¯•"><a href="#webpack-çš„æµ‹è¯•" class="headerlink" title="webpack çš„æµ‹è¯•"></a>webpack çš„æµ‹è¯•</h3><p>ä½ å¯ä»¥é€‰æ‹©å°† webpack å®‰è£…åœ¨å…¨å±€ä¸­ï¼Œæˆ–è€…å®‰è£…åœ¨è¿™ä¸€ä¸ªé¡¹ç›®ä¸­ã€‚å…¨å±€å®‰è£…æ—¶éœ€è¦åœ¨å‘½ä»¤åé¢åŠ ä¸Š <code>-global</code> æˆ– <code>-g</code> å‚æ•°ï¼Œè¿™æ ·ä½ å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ webpack å‘½ä»¤äº†ã€‚</p><p>é€‰æ‹©å…¨å±€å®‰è£…ï¼š</p><pre><code>$ cnpm install webpack -g </code></pre><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»å°† webpack å®‰è£…åœ¨äº†å…¨å±€ï¼Œé‚£å°±å…ˆåœ¨å‘½ä»¤è¡Œä¸‹æµ‹è¯•ä¸€ä¸‹å®ƒçš„æ‰“åŒ…åŠŸèƒ½ã€‚</p><p>æ–°å»º <code>index.js</code> æ–‡ä»¶ï¼Œé‡Œé¢åªæœ‰ä¸€è¡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;This is a javascript file for test.&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸ªæœ€ç®€å•çš„ webpack å‘½ä»¤ï¼š</p><pre><code>$ webpack index.js bundle.js</code></pre><p>å®ƒçš„æ„æ€æ˜¯å°† <code>index.js</code> æ–‡ä»¶æ‰“åŒ…æˆåä¸º <code>bundle.js</code> çš„æ–‡ä»¶ï¼Œåä¸€ä¸ªå‚æ•°æ˜¯ä½ æƒ³è¦ç”Ÿæˆçš„æ–‡ä»¶åç§°ã€‚</p><p>è¿è¡Œä¹‹åä¼šå‘ç°å¤šå‡ºäº†ä¸€ä¸ª <code>bundle.js</code> æ–‡ä»¶ï¼Œç”¨ node è¿è¡Œè¯¥æ–‡ä»¶æµ‹è¯•ä¸€ä¸‹ï¼š</p><pre><code>$ node bundle.jsThis is a javascript file for test.    // è¾“å‡ºäº†æ­£ç¡®çš„ç»“æœ</code></pre><p>å¯ä»¥æ–°å»ºä¸€ä¸ª html æ–‡ä»¶ï¼Œå¼•å…¥ <code>bundle.js</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>react webpack boilerplate<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€ <code>index.html</code>ï¼Œä½ å¯ä»¥åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­çœ‹åˆ°è¾“å‡ºç»“æœã€‚</p><h3 id="webpack-çš„é…ç½®æ–‡ä»¶"><a href="#webpack-çš„é…ç½®æ–‡ä»¶" class="headerlink" title="webpack çš„é…ç½®æ–‡ä»¶"></a>webpack çš„é…ç½®æ–‡ä»¶</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸‹å®Œæˆå„ç§å¤æ‚çš„ webpack æ“ä½œï¼Œä¸è¿‡æ›´æ–¹ä¾¿çš„æ–¹æ³•æ˜¯åˆ©ç”¨é…ç½®æ–‡ä»¶ã€‚</p><p>æ–°å»º <code>webpack.config.js</code> æ–‡ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€ä¸ªç®€å•çš„ webpack.config.js æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// webpack è¿›è¡Œæ‰“åŒ…çš„å…¥å£æ–‡ä»¶ï¼Œè¿™é‡Œ webpack ä»æ ¹ç›®å½•ä¸‹çš„ index.js å¼€å§‹è¿›è¡Œæ‰“åŒ…</span></span><br><span class="line">  <span class="attr">entry</span>: [</span><br><span class="line">    <span class="string">&#x27;./index&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// webpack æ‰“åŒ…åçš„è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.join(__dirname, <span class="string">&#x27;dist&#x27;</span>), <span class="comment">// æ–‡ä»¶æ”¾è‡³å½“å‰è·¯å¾„ä¸‹çš„ dist æ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,  <span class="comment">// å°†æ‰“åŒ…åçš„è¾“å‡ºæ–‡ä»¶å‘½åä¸º bundle.js</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>html æ–‡ä»¶çš„å¼•ç”¨è·¯å¾„ç›¸åº”åœ°æ”¹æˆï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./dist/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†å°† webpack å®‰è£…åœ¨æœ¬åœ°ï¼š</p><pre><code>$ npm install webpack --save-dev</code></pre><p>ç°åœ¨ä½ å¯ä»¥è¿è¡Œ <code>webpack</code> çœ‹çœ‹æ•ˆæœäº†ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„è¿‡ç¨‹è™½ç„¶ç§°ä¹‹ä¸ºæ‰“åŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬åªä¸è¿‡å°†ä¸€ä¸ª <code>index.js</code> æ–‡ä»¶å˜æˆäº† <code>bundle.js</code> æ–‡ä»¶ï¼Œæ–‡ä»¶çš„ä½“ç§¯ç”šè‡³è¿˜å˜å¤§äº†ã€‚é‚£çœ‹ä¸€ä¸‹å¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ª js æ–‡ä»¶æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚</p><p>æ–°å»º <code>a.js</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = a;</span><br></pre></td></tr></table></figure><p>åœ¨ index.js ä¸­åŠ å…¥ä¸‹åˆ—è¯­å¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a.js&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;a = &#x27;</span>, a);</span><br></pre></td></tr></table></figure><p>å†æ¬¡ç”¨ <code>webpack</code> å‘½ä»¤æ‰“åŒ…ï¼Œç”Ÿæˆäº†æ–°çš„ <code>bundle.js</code> æ–‡ä»¶ã€‚å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬ä¸éœ€è¦ç”¨ <code>script</code> æ ‡ç­¾åˆ†åˆ«æ¥å¼•å…¥ <code>index.js</code> å’Œ <code>a.js</code> ä¸¤ä¸ªæ–‡ä»¶äº†ï¼Œç›´æ¥å¼•å…¥ <code>bundle.js</code> è¿™ä¸€ä¸ªå°±è¡Œäº†ã€‚å¦‚æœæˆ‘ä»¬æœ‰è®¸å¤šå¼•ç”¨çš„èµ„æºï¼Œç»è¿‡è¿™æ ·çš„æ‰“åŒ…è¿‡ç¨‹ï¼Œè‡ªç„¶å°±æ–¹ä¾¿å¤šäº†ã€‚</p><p>ä»¥ä¸Šçš„æ­¥éª¤å¯ä»¥åœ¨ step1 æ–‡ä»¶å¤¹å†…æŸ¥çœ‹ã€‚</p><h3 id="å®‰è£…-web-dev-serverï¼Œå¹¶ç”¨å…¶å¼€å¯ä¸€ä¸ªæœåŠ¡å™¨"><a href="#å®‰è£…-web-dev-serverï¼Œå¹¶ç”¨å…¶å¼€å¯ä¸€ä¸ªæœåŠ¡å™¨" class="headerlink" title="å®‰è£… web-dev-serverï¼Œå¹¶ç”¨å…¶å¼€å¯ä¸€ä¸ªæœåŠ¡å™¨"></a>å®‰è£… web-dev-serverï¼Œå¹¶ç”¨å…¶å¼€å¯ä¸€ä¸ªæœåŠ¡å™¨</h3><p>é¦–å…ˆè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå®‰è£… web-dev-serverï¼š</p><pre><code>$ npm i webpack-dev-server --save-dev</code></pre><p>æ·»åŠ å¦‚ä¸‹çš„ server.js æ–‡ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> WebpackDevServer = <span class="built_in">require</span>(<span class="string">&#x27;webpack-dev-server&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = <span class="keyword">new</span> WebpackDevServer(webpack(config));</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&#x27;listening at locahost:3000...&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = <span class="keyword">new</span> WebpackDevServer(webpack(config));</span><br></pre></td></tr></table></figure><p>è¿™ä¸€å¥åˆ›å»ºäº†ä¸€ä¸ª webpack dev serverï¼Œè¿™æ˜¯ä¸€ä¸ª node.js express æœåŠ¡å™¨ï¼Œå…³äºå®ƒçš„ç”¨æ³•å¯ä»¥è§<a href="https://webpack.github.io/docs/webpack-dev-server.html">è¿™é‡Œçš„æ–‡æ¡£</a>ã€‚</p><p>åœ¨ webpack.config.js çš„ output è¿™ä¸€é¡¹ä¸­åŠ ä¸Šï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publicPath: <span class="string">&#x27;/static/&#x27;</span></span><br></pre></td></tr></table></figure><p>server.js ä¿®æ”¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = <span class="keyword">new</span> WebpackDevServer(webpack(config), &#123;</span><br><span class="line">  <span class="attr">publicPath</span>: config.output.publicPath</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œç°åœ¨ä½ å¯ä»¥è¿è¡Œï¼š</p><pre><code>$ node server.js</code></pre><p>ç„¶åæ‰“å¼€æµè§ˆå™¨è¿›å…¥ <a href="http://localhost:3000">http://localhost:3000</a> æŸ¥çœ‹æ•ˆæœäº†ï¼ˆå½“ç„¶ï¼Œç°åœ¨é™¤äº†åœ¨æ§åˆ¶å°è¾“å‡ºäº†ä¿¡æ¯ä¹‹å¤–ä»€ä¹ˆéƒ½æ²¡å¹²ï¼‰</p><p>åœ¨ <code>package.json</code> æ–‡ä»¶å†…åŠ ä¸Šè¿™ä¹ˆä¸€é¡¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;node server.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ç”¨ <code>npm start</code> æ¥ä»£æ›¿ä¸Šé¢çš„ <code>node server.js</code> äº†ï¼Œè¿™ä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚</p><p>ä¸Šè¿°æ­¥éª¤å¯ä»¥åˆ° step2 æ–‡ä»¶å¤¹ä¸­æŸ¥çœ‹ï¼Œè¿è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p><pre><code>$ npm i$ npm start</code></pre><blockquote><p>webpack çš„å‚è€ƒèµ„æ–™ï¼š<br><a href="https://webpack.github.io/docs/tutorials/getting-started/">https://webpack.github.io/docs/tutorials/getting-started/</a><br><a href="https://medium.com/@rajaraodv/webpack-the-confusing-parts-58712f8fcad9#.81jvwhvmo">https://medium.com/@rajaraodv/webpack-the-confusing-parts-58712f8fcad9#.81jvwhvmo</a><br><a href="http://www.cnblogs.com/skylar/p/webpack-module-bundler.html">http://www.cnblogs.com/skylar/p/webpack-module-bundler.html</a></p></blockquote><h2 id="å…³äº-Babel"><a href="#å…³äº-Babel" class="headerlink" title="å…³äº Babel"></a>å…³äº Babel</h2><h3 id="Babel-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Babel-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Babel æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Babel æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å› ä¸ºåœ¨ React çš„é¡¹ç›®ä¸­ä¼šç”¨åˆ° ES6(å³ES2015) çš„è¯­æ³•ï¼Œè€Œ ES6 è¿˜æ²¡æœ‰å¾—åˆ°å¹¿æ³›çš„æ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€Ÿç”¨ Babel è¿™ä¸ªå·¥å…·å°†æˆ‘ä»¬ä½¿ç”¨äº† ES6 è¯­æ³•çš„ä»£ç è½¬æ¢æˆ ES5 çš„è¯­æ³•ï¼Œä»è€Œå¯ä»¥åœ¨æ›´å¹¿æ³›çš„ç¯å¢ƒä¸‹è¿è¡Œã€‚</p><blockquote><p><a href="https://babeljs.io/">Babel çš„å®˜æ–¹ç½‘ç«™</a></p></blockquote><h3 id="æ€ä¹ˆå®‰è£…-Babelï¼Ÿ"><a href="#æ€ä¹ˆå®‰è£…-Babelï¼Ÿ" class="headerlink" title="æ€ä¹ˆå®‰è£… Babelï¼Ÿ"></a>æ€ä¹ˆå®‰è£… Babelï¼Ÿ</h3><p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦å®‰è£…è¿™æ ·çš„å‡ ä¸ª packageï¼š</p><pre><code>$ npm install --save-dev babel-loader babel-core</code></pre><p>åœ¨ Babel 6.x ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒBabel ä¼šæ‰§è¡Œä¸€äº›é»˜è®¤çš„è½¬æ¢è§„åˆ™ï¼Œè€Œåœ¨ 6.x ä¹‹åçš„ç‰ˆæœ¬ï¼Œä½ éœ€è¦æ˜¾ç¤ºåœ°å‘Šè¯‰ babel ä½ æƒ³æ‰§è¡Œä»€ä¹ˆè½¬æ¢ã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ presetï¼Œæ¯”å¦‚è¯´ ES2015 Presetã€‚</p><pre><code>$ npm install babel-preset-es2015 --save-dev</code></pre><blockquote><p>Presets are sharable .babelrc configs or simply an array of babel plugins.</p></blockquote><p>æˆ‘ä»¬è¿™é‡Œè¿˜éœ€è¦å¦ä¸€ä¸ªåä¸º stage-0 çš„ Presetï¼š</p><pre><code>$ npm install babel-preset-es2015 --save-dev</code></pre><blockquote><p>å‚è€ƒæ–‡æ¡£ï¼š<br><a href="https://babeljs.io/docs/setup/#installation">Babel çš„å®‰è£…</a><br><a href="https://babeljs.io/docs/plugins/#presets">Presets</a></p></blockquote><p>ç°åœ¨åªè¦æ·»åŠ ä¸€ä¸ª .babelrc æ–‡ä»¶å³å¯ï¼Œ<a href="https://babeljs.io/docs/usage/babelrc/">babelrc</a> æ˜¯ Babel çš„é…ç½®æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨<a href="http://babeljs.io/docs/usage/options/">è¿™ä¸ªé¡µé¢</a>æ‰¾åˆ°ä½ å¯ä»¥åŠ å…¥æ–‡ä»¶ä¸­çš„å„ç§é€‰é¡¹ã€‚</p><p>è¿™é‡Œåªéœ€åœ¨ .babelrc ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹å³å¯ï¼š</p><pre><code>&#123;  &quot;presets&quot;: [&quot;es2015&quot;, &quot;stage-0&quot;]&#125;</code></pre><p>å°† webpack.config.js æ–‡ä»¶åšå¦‚ä¸‹çš„ä¿®æ”¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  <span class="attr">loaders</span>: [&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    loaders: [<span class="string">&#x27;babel&#x27;</span>],</span><br><span class="line">    <span class="attr">include</span>: path.join(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="attr">stats</span>: <span class="string">&#x27;errors-only&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä½¿ç”¨ babel æ¥è¿›è¡Œè½¬ç äº†ã€‚</p><p>è¿™ä¸€æ­¥å¯åœ¨ step 3 ä¸­æŸ¥çœ‹ã€‚</p><h2 id="å®‰è£…-React"><a href="#å®‰è£…-React" class="headerlink" title="å®‰è£… React"></a>å®‰è£… React</h2><p>æ—¢ç„¶ä½ åœ¨çœ‹è¿™ç¯‡æ–‡ç« ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹ React æœ‰äº†ä¸€å®šçš„äº†è§£ï¼ŒReact æ˜¯åšä»€ä¹ˆçš„å°±ä¸ç”¨å†å¤šä»‹ç»äº†ã€‚</p><p>å®‰è£… React çš„ package ååˆ†ç®€å•ï¼š</p><pre><code>$ npm install react react-dom --save</code></pre><p>ä¸ºäº†èƒ½å¤Ÿè®© babel å¯¹ react è¿›è¡Œå¤„ç†ï¼Œå†å®‰è£…ä¸€ä¸ª babel-preset-react</p><pre><code>$ npm install babel-preset-react</code></pre><p>åŒæ—¶åœ¨ .babelrc æ–‡ä»¶ä¸­ä¹ŸåŠ å…¥è¿™ä¸€é¡¹ï¼š</p><pre><code>&quot;presets&quot;: [&quot;es2015&quot;, &quot;stage-0&quot;, &quot;react&quot;]</code></pre><p>æ–°å»ºä¸€ä¸ªåŸºæœ¬çš„ React ç»„ä»¶è¯•è¯•çœ‹ï¼š</p><p>é¦–å…ˆåœ¨ index.html ä¸­åŠ ä¸Šè¿™æ ·çš„ä¸€ä¸ªå…ƒç´ ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>React å…ƒç´ å°†åœ¨ä¸Šé¢æ¸²æŸ“ã€‚</p><p>åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶ App.js index.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./src/index.js</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">./src/App.js</span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;%c%s&#x27;</span>, <span class="string">&#x27;font-size:20px;color:red&#x27;</span>, <span class="string">&#x27;Something happened.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>This is a react boilerplate project with webpack and es6.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½ å¯ä»¥ npm start çœ‹çœ‹æ•ˆæœäº†ã€‚</p><p>ä»¥ä¸Šå†…å®¹å¯ä»¥åœ¨ step4 æ–‡ä»¶å¤¹ä¸­æŸ¥çœ‹ã€‚</p><h2 id="å®‰è£…-react-hot-loader"><a href="#å®‰è£…-react-hot-loader" class="headerlink" title="å®‰è£… react-hot-loader"></a>å®‰è£… react-hot-loader</h2><p>å…¶å®åˆ°ä¸Šä¸€æ­¥ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„ react æ¨¡æ¿é¡¹ç›®ï¼Œä¸è¿‡è¿˜ç¼ºä¸€ç‚¹ï¼Œå°±æ˜¯å½“æˆ‘ä»¬åœ¨ç¼–è¾‘å™¨ä¸­ä¿®æ”¹äº†æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦åœ¨æµè§ˆå™¨é‡Œæ‰‹åŠ¨åˆ·æ–°ï¼Œæ‰èƒ½çœ‹åˆ°ç»“æœã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€ä¸ªåä¸º react-hot-loader çš„å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬å®ç°æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°çš„æ•ˆæœã€‚</p><p>é¦–å…ˆå®‰è£… react-hot-loader:</p><pre><code>npm install react-hot-loader@^1.3.0 --save-dev</code></pre><p>è¿™é‡ŒåŠ ä¸Šäº†ç‰ˆæœ¬å·æ˜¯å› ä¸ºé»˜è®¤å®‰è£…æœ€æ–°çš„ react-hot-loader v3.0.0-beta ç‰ˆæœ¬ï¼Œè®¾ç½®ä¼šå’Œä¸‹é¢çš„æœ‰æ‰€åŒºåˆ«ã€‚</p><p>åœ¨ server.js ä¸­åŠ ä¸€è¡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = <span class="keyword">new</span> WebpackDevServer(webpack(config), &#123;</span><br><span class="line">  <span class="attr">stats</span>: config.devServer.stats,</span><br><span class="line">  <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">publicPath</span>: config.output.publicPath</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯¹ webpack.config.js åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">entry: [</span><br><span class="line">  <span class="string">&#x27;webpack-dev-server/client?http://localhost:3000&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;webpack/hot/only-dev-server&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;./src/index&#x27;</span></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="attr">loaders</span>: [&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  loaders: [<span class="string">&#x27;react-hot&#x27;</span>, <span class="string">&#x27;babel&#x27;</span>],</span><br><span class="line">  <span class="attr">include</span>: path.join(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><p>å¹¶åŠ å…¥ä¸€ä¸ªæ’ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">  <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥çš„å†…å®¹å¯ä»¥æŸ¥çœ‹ step5 æ–‡ä»¶å¤¹ã€‚</p><hr><p>åˆ°æ­¤æˆ‘ä»¬çš„è¿™ä¸ªæ¨¡æ¿é¡¹ç›®å°±å®Œæˆäº†ã€‚ä½ å¯ä»¥åœ¨<a href="https://github.com/noiron/react-webpack-babel-boilerplate">GitHubä¸Šçš„è¿™ä¸ªé¡¹ç›®ä¸­</a>çœ‹åˆ°å®Œæ•´çš„é¡¹ç›®ä»£ç ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚æœæ˜¯ä¸€ä¸ªåˆšæ¥è§¦ React çš„æ–°æ‰‹ï¼Œå½“å­¦å®Œäº† React çš„å„ç§åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•ä¹‹åï¼Œå‡†å¤‡å¼€å§‹å®é™…çš„å¼€å‘å·¥ä½œæ—¶ï¼Œä»–åˆä¼šç¢°åˆ°å„ç§æ–°é¢–çš„åè¯ï¼šnpm, webpack, babel, flux, es2015â€¦â€¦ å¦‚æœä»¥å‰æ¥è§¦è¿‡è¿™äº›å·¥å…·è¿˜å¥½ï¼Œå¦åˆ™ä¸ºäº†å»ºç«‹ä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œè¿˜éœ€è¦å­¦ä¹ è¿™ä¸€æ•´å¥—çš„æµç¨‹ï¼Œè€Œåœ¨è¿™ä¸­é—´åˆä¼šç¢°ä¸Šå„ç§å‘ï¼Œè¿™ä¸ªè¿‡ç¨‹å°†ä¼šéå¸¸ç—›è‹¦ã€‚ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å» GitHub ä¸Šå¯»æ‰¾å„ç§æ¨¡æ¿é¡¹ç›®ï¼Œç”¨ React + webpack + â€¦ ä½œä¸ºå…³é”®å­—æœç´¢å¯ä»¥å‘ç°è®¸å¤šåˆ«äººåˆ›å»ºçš„ç©ºé¡¹ç›®ï¼Œä½ å¯ä»¥åœ¨å…¶åŸºç¡€ä¸Šç¨ä½œä¿®æ”¹ç„¶åå¼€å§‹å¼€å‘ã€‚æˆ‘åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œä½†ä¹‹åå¯¹å…¶ä¸­çš„ä¸€äº›é…ç½®é¡¹ä»æ˜¯ä¸€çŸ¥åŠè§£ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨è¿™é‡Œä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ¨¡æ¿é¡¹ç›®ï¼Œå¹¶å°†è¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œä¸€æ–¹é¢å¸Œæœ›èƒ½ç»™çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„äººä»¥å¸®åŠ©ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯åŠ æ·±æˆ‘è‡ªå·±çš„ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åå®Œæˆçš„é¡¹ç›®è§è¿™ä¸ªé¡¹ç›®ï¼š&lt;a href=&quot;https://github.com/noiron/react-webpack-babel-boilerplate&quot;&gt;react-webpack-babel-boilerplate&lt;/a&gt;ï¼Œåœ¨å»ºç«‹è¿™ä¸ªé¡¹ç›®è¿‡ç¨‹ä¸­çš„æ­¥éª¤å¯è§å¦ä¸€ä¸ªé¡¹ç›®ï¼š&lt;a href=&quot;https://github.com/noiron/create-react-boilerplate-steps&quot;&gt;create-react-boilerplate-steps&lt;/a&gt;ï¼Œè¿‡ç¨‹è¢«åˆ†åˆ°äº†å¤šä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¡¹ç›®ç»“æ„&quot;&gt;&lt;a href=&quot;#é¡¹ç›®ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®ç»“æ„&quot;&gt;&lt;/a&gt;é¡¹ç›®ç»“æ„&lt;/h2&gt;&lt;p&gt;åœ¨å¼€å§‹ä¹‹å‰å…ˆçœ‹çœ‹é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- src
  - index.js
  - App.js
- .babelrc
- index.html
- package.json
- server.js
- webpack.config.js
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦çš„å…¨éƒ¨æ–‡ä»¶äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä¼šå°†è¿™ä¸ªé¡¹ç›®çš„æ„å»ºè¿‡ç¨‹åˆ†è§£æˆå‡ ä¸ªæ­¥éª¤ï¼Œä½ åªè¦æŒ‰ç…§è¿™äº›æ­¥éª¤ä¾æ¬¡è¿›è¡Œå³å¯ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="webpack" scheme="http://www.wukai.me/tags/webpack/"/>
    
      <category term="es6" scheme="http://www.wukai.me/tags/es6/"/>
    
      <category term="react" scheme="http://www.wukai.me/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ React.js å†™ä¸€ä¸ªæœ€ç®€å•çš„ To-do List åº”ç”¨</title>
    <link href="http://www.wukai.me/2016/06/19/write-a-simplest-todolist-with-reactjs/"/>
    <id>http://www.wukai.me/2016/06/19/write-a-simplest-todolist-with-reactjs/</id>
    <published>2016-06-18T16:00:00.000Z</published>
    <updated>2022-02-16T13:57:16.004Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´å¿™ç€æ‰¾å·¥ä½œå»äº†ï¼Œæœ‰æ®µæ—¶é—´æ²¡æœ‰å†™åšå®¢äº†ï¼Œä¸Šä¸€ç¯‡è¿˜æ˜¯ä¸‰æœˆä»½çš„ï¼Œä»Šå¤©æ¥æ›´æ–°ä¸€ç¯‡ã€‚</p><hr><p>æœ€è¿‘åœ¨å­¦ React.jsï¼Œä¹Ÿå†™äº†ä¸€äº›ç»ƒä¹ çš„é¡¹ç›®ï¼Œä¹‹å‰å‚è€ƒç½‘ä¸Šçš„ä¸€äº›ä»£ç å†™äº†ä¸€ä¸ªå¾ˆç®€å•çš„ to-do listã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œå†™ä¸ªåŸºæœ¬çš„ to-do list å¯¹äºç†è§£ React ä¸­çš„ä¸€äº›æ¦‚å¿µåŠè¯­æ³•å€’æ˜¯æŒºæœ‰å¸®åŠ©çš„ã€‚</p><p>ç°åœ¨å¾ˆå¤šçš„ React é¡¹ç›®ä¸­å·²ç»å¼€å§‹ä½¿ç”¨ ES6 æ¥å†™äº†ï¼Œä¸è¿‡å› ä¸ºæˆ‘åœ¨å­¦ä¹  React çš„æ—¶å€™çœ‹çš„æ•™ç¨‹å¤§å¤šéƒ½æ˜¯ç”¨ ES5 å†™çš„ï¼Œæˆ‘è¿™é‡Œè¿˜æ˜¯ç”¨çš„è¿˜æ˜¯æ›´ç†Ÿæ‚‰çš„ ES5 å†™æ³•ï¼Œè™½ç„¶æœ‰ç‚¹è½ä¼äº†ï¼Œä½†è‹¥æƒ³æ”¹æˆ ES6 ç‰ˆæœ¬å€’ä¹ŸæŒºæ–¹ä¾¿çš„ã€‚</p><blockquote><p><a href="https://github.com/noiron/simplest-react-todolist">GitHub ä¸Šçš„é¡¹ç›®åœ°å€</a><br><a href="http://www.wukai.me/simplest-react-todolist">åœ¨çº¿ demo</a></p></blockquote><span id="more"></span><h2 id="æ–‡ä»¶ç›®å½•"><a href="#æ–‡ä»¶ç›®å½•" class="headerlink" title="æ–‡ä»¶ç›®å½•"></a>æ–‡ä»¶ç›®å½•</h2><p>åœ¨æ­£å¼çš„ç”Ÿäº§é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ webpack å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹æˆ‘ä»¬çš„æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ï¼Œè¿™é‡Œå› ä¸ºç¨‹åºæ¯”è¾ƒç®€å•ï¼Œç›´æ¥ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾å°† React ç»„ä»¶å¼•å…¥äº†ã€‚</p><p>é¦–å…ˆæ–°å»ºä¸€ä¸ª <code>index.html</code> æ–‡ä»¶ï¼Œå¼•å…¥ç›¸å…³çš„èµ„æºæ–‡ä»¶ã€‚</p><p>å†æ–°å»ºä¸€ä¸ª <code>js</code> æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ React éœ€è¦è¿™æ ·çš„ä¸¤ä¸ªæ–‡ä»¶ï¼š <code>react.js</code> å’Œ <code>react-dom.js</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨ cdn å¼•å…¥ï¼Œè¿™é‡Œç›´æ¥å°†æ–‡ä»¶ä¸‹è½½æ”¾åœ¨äº† <code>js</code> æ–‡ä»¶å¤¹å†…ã€‚</p><p><code>js</code> æ–‡ä»¶å¤¹å†…è¿˜æœ‰ä¸€ä¸ª <code>script.jsx</code> æ–‡ä»¶ï¼Œæˆ‘ä»¬ç¨‹åºçš„ä¸»è¦å†…å®¹å°±æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚æ³¨æ„è¿™é‡Œçš„åç¼€åæ˜¯ <code>jsx</code>ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä½¿ç”¨ React çš„ <code>jsx</code> è¯­æ³•æ¥å†™çš„ï¼Œå¼•å…¥å®ƒçš„æ—¶å€™æŒ‰å¦‚ä¸‹å†™æ³•ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/script.jsx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶è¿˜éœ€è¦ä¸€ä¸ª <code>browser.js</code> æ–‡ä»¶ï¼Œå®ƒå¯ä»¥è®© <code>jsx</code> è¯­æ³•çš„æ–‡ä»¶åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚</p><p>æœ€åæˆ‘ä»¬å†å»ºç«‹ä¸€ä¸ª <code>css</code> æ–‡ä»¶å¤¹ï¼Œå­˜æ”¾æ ·å¼æ–‡ä»¶ï¼Œæˆ‘çš„é¡¹ç›®ä¸­ä½¿ç”¨äº† Bootstrap çš„æ ·å¼ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½ Bootstrap çš„æ ·å¼æ–‡ä»¶ã€‚</p><h2 id="ç¨‹åºåŠŸèƒ½"><a href="#ç¨‹åºåŠŸèƒ½" class="headerlink" title="ç¨‹åºåŠŸèƒ½"></a>ç¨‹åºåŠŸèƒ½</h2><p>ä½œä¸ºä¸€ä¸ªæœ€ç®€å•çš„ to-do listï¼Œè¿™ä¸ªç¨‹åºæ²¡æœ‰è¿‡å¤šçš„åŠŸèƒ½ã€‚å¯ä»¥ä» <a href="http://www.wukai.me/simplest-react-todolist/">demo</a> é‡Œçœ‹å‡ºï¼Œå®ƒçš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><ul><li><p>æ˜¾ç¤ºæ¯ä¸€ä¸ªä»»åŠ¡</p></li><li><p>å¯ä»¥å°†ä»»åŠ¡æ ‡è®°ä¸ºå·²å®Œæˆï¼Œä»¥åŒºåˆ†æœªå®Œæˆçš„ä»»åŠ¡</p></li><li><p>åŠ å…¥ä»»åŠ¡ / åˆ é™¤ä»»åŠ¡</p></li><li><p>ç»Ÿè®¡ä»»åŠ¡æ€»æ•°å’Œå®Œæˆçš„ä»»åŠ¡æ•°é‡</p></li></ul><p>ä½œä¸ºä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼Œä»¥ä¸Šå°±æ˜¯å®ƒçš„åŠŸèƒ½äº†ã€‚</p><h2 id="ç»„ä»¶ç»“æ„"><a href="#ç»„ä»¶ç»“æ„" class="headerlink" title="ç»„ä»¶ç»“æ„"></a>ç»„ä»¶ç»“æ„</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ React å¼€å‘å‡ºå„ç§ç»„ä»¶ï¼ˆcomponentï¼‰ï¼Œåˆ©ç”¨ä¸åŒç»„ä»¶çš„åŠŸèƒ½æ¥å®ç°ä¸€ä¸ªåº”ç”¨ã€‚æˆ‘ä»¬è¿™é‡Œåˆ›å»ºçš„ç»„ä»¶æœ‰:</p><pre><code>TodoBox    -TodoList        -TodoItem        -TodoFooter    -TodoForm</code></pre><ul><li><p>TodoBox æ˜¯æœ€å¤–å±‚çš„ç»„ä»¶ï¼Œå…¶ä½™çš„éƒ½æ˜¯å®ƒçš„å­ç»„ä»¶</p></li><li><p>TodoList æ˜¯å„ä¸ªå•ç‹¬çš„å¾…åŠä»»åŠ¡çš„é›†åˆ</p></li><li><p>TodoItem å³ä¸ºä¸€æ¡å•ç‹¬çš„å¾…åŠäº‹é¡¹</p></li><li><p>TodoFooter å¯¹ä¸Šè¿°çš„äº‹é¡¹è¿›è¡Œç»Ÿè®¡</p></li><li><p>TodoForm ç”¨äºåŠ å…¥æ–°çš„é¡¹ç›®</p></li></ul><h2 id="å±æ€§çš„ä¼ é€’"><a href="#å±æ€§çš„ä¼ é€’" class="headerlink" title="å±æ€§çš„ä¼ é€’"></a>å±æ€§çš„ä¼ é€’</h2><p>React çš„ç»„ä»¶æœ‰ä¸¤ç§ä¸åŒçš„å±æ€§ï¼Œ<code>state</code> å’Œ <code>props</code>ã€‚å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥åŒºåˆ†å®ƒä»¬ï¼šå¦‚æœè¿™ä¸ªå±æ€§æ˜¯å…¶çˆ¶ç»„ä»¶ä¼ ç»™å®ƒçš„ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>props</code>ï¼Œåä¹‹å¦‚æœä¸€ä¸ªå±æ€§æ˜¯ç»„ä»¶è‡ªå·±çš„ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>state</code>ã€‚</p><p>å…·ä½“ä»€ä¹ˆæ—¶å€™ç”¨ <code>state</code>ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ <code>props</code>ï¼Œå¯ä»¥å‚è€ƒè¿™å‡ æ¡ï¼š</p><blockquote><ul><li>Is it passed in from a parent via props? If so, it probably isnâ€™t state.</li></ul></blockquote><blockquote><ul><li>Does it change over time? If not, it probably isnâ€™t state.</li></ul></blockquote><blockquote><ul><li>Can you compute it based on any other state or props in your component? If so, itâ€™s not state.</li></ul></blockquote><blockquote><p><a href="https://facebook.github.io/react/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state">å‚è€ƒæ¥æºï¼šThinking in React</a></p></blockquote><p>è¿™é‡Œæˆ‘ä»¬ä»ä»£ç æ¥çœ‹çœ‹ï¼Œå±æ€§æ˜¯å¦‚ä½•ä»çˆ¶ç»„ä»¶ä¼ é€’åˆ°å­ç»„ä»¶çš„ã€‚</p><p>æ¯ä¸€æ¡å¾…åŠäº‹é¡¹æœ‰è¿™æ ·çš„å‡ ä¸ªå±æ€§:</p><ul><li>id: ä»»åŠ¡çš„ç¼–å·</li><li>task: ä»»åŠ¡çš„å…·ä½“å†…å®¹</li><li>complete: ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆ</li></ul><p>æˆ‘ä»¬çœ‹çœ‹å±æ€§çš„ä¼ é€’è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆåœ¨ <code>TodoBox</code> ç»„ä»¶çš„ <code>state</code> ä¸­æœ‰ä¸€ä¸ª <code>data</code> å¯¹è±¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data: [</span><br><span class="line">  &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;0001&quot;</span>, <span class="string">&quot;task&quot;</span>:<span class="string">&quot;åƒé¥­&quot;</span>, <span class="string">&quot;complete&quot;</span>: <span class="string">&quot;false&quot;</span>&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;0002&quot;</span>, <span class="string">&quot;task&quot;</span>:<span class="string">&quot;ç¡è§‰&quot;</span>, <span class="string">&quot;complete&quot;</span>: <span class="string">&quot;true&quot;</span>&#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>TodoBox</code> ç»„ä»¶çš„ render å‡½æ•°ä¸­ä¼šæœ‰ <code>TodoList</code> ç»„ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;TodoList data=&#123;<span class="built_in">this</span>.state.data&#125;</span><br><span class="line">  <span class="comment">// å…¶ä»–çš„å±æ€§åŠæ–¹æ³•å†™åœ¨è¿™é‡Œ</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ · <code>TodoBox</code> ç»„ä»¶çš„ <code>data</code> å±æ€§å°±ä¼ é€’ç»™äº†å­ç»„ä»¶ <code>TodoBox</code>ã€‚åœ¨ <code>TodoBox</code> ä¸­é€šè¿‡ <code>this.props</code> æ¥å¼•ç”¨è¿™ä¸€å±æ€§ï¼Œå³ <code>this.props.data</code>ã€‚</p><p><code>TodoBox</code> ç»„ä»¶è¿˜æœ‰å­ç»„ä»¶ <code>TodoItem</code>ï¼Œå¯ä»¥å°†å±æ€§ç»§ç»­ä¼ é€’ä¸‹å»ã€‚åœ¨ <code>TodoList</code> ç»„ä»¶çš„ <code>render</code> å‡½æ•°ä¸­è¿™æ ·å†™ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> taskList = <span class="built_in">this</span>.props.data.map(<span class="function"><span class="keyword">function</span>(<span class="params">listItem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">TodoItem</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">taskId</span>=<span class="string">&#123;listItem.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">key</span>=<span class="string">&#123;listItem.id&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">task</span>=<span class="string">&#123;listItem.task&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">complete</span>=<span class="string">&#123;listItem.complete&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        // å…¶ä»–çš„å±æ€§åŠæ–¹æ³•</span></span></span><br><span class="line"><span class="tag"><span class="xml">    )</span></span></span><br><span class="line"><span class="tag"><span class="xml">  &#125;, <span class="attr">this</span>);</span></span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>TodoItem</code> ç»„ä»¶ä¸­å°±å¯ä»¥ç”¨ <code>this.props.taskId</code> è·å¾—ä»»åŠ¡çš„ id äº†ã€‚</p><h2 id="å‡½æ•°çš„ä¼ é€’"><a href="#å‡½æ•°çš„ä¼ é€’" class="headerlink" title="å‡½æ•°çš„ä¼ é€’"></a>å‡½æ•°çš„ä¼ é€’</h2><p>æˆ‘ä»¬çš„ç¨‹åºä¸­éœ€è¦çš„å‡½æ•°æœ‰è¿™å‡ ä¸ªï¼š</p><ul><li>handleTaskDelete: æ ¹æ®idåˆ é™¤ä¸€é¡¹ä»»åŠ¡</li><li>handleToggleComplete: åˆ‡æ¢ä¸€é¡¹ä»»åŠ¡çš„å®ŒæˆçŠ¶æ€</li><li>handleSubmit: æ–°å¢ä¸€é¡¹ä»»åŠ¡</li><li>generateId: ç»™æ–°å¢çš„ä»»åŠ¡ä¸€ä¸ªéšæœºçš„id</li></ul><p>åœ¨ React çš„ç»„ä»¶ä¸­ä¼ é€’æ–¹æ³•ä¸ä¼ é€’å±æ€§ç±»ä¼¼ï¼Œç°åœ¨ <code>TodoBox</code> ç»„ä»¶ä¸­æœ‰ä¸€ä¸ª <code>handleToggleComplete</code> å‡½æ•°ï¼Œå°†å®ƒä¼ é€’ç»™ <code>TodoList</code> ç»„ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;TodoList toggleComplete=&#123;<span class="built_in">this</span>.handleToggleComplete&#125;</span><br><span class="line">  <span class="comment">// å…¶ä»–çš„å±æ€§åŠæ–¹æ³•å†™åœ¨è¿™é‡Œ</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä½ å°±å¯ä»¥åœ¨ <code>TodoList</code> ç»„ä»¶ä¸­é€šè¿‡ <code>this.props.toggleComplete</code> æ¥è°ƒç”¨è¿™ä¸€æ–¹æ³•äº†ï¼Œä½ ä¹Ÿå¯ä»¥å°†è¿™ä¸€æ–¹æ³•ç»§ç»­å‘ä¸‹ä¸€å±‚çš„ç»„ä»¶ä¼ é€’ã€‚</p><h2 id="ç¨‹åºçš„è¿è¡Œ"><a href="#ç¨‹åºçš„è¿è¡Œ" class="headerlink" title="ç¨‹åºçš„è¿è¡Œ"></a>ç¨‹åºçš„è¿è¡Œ</h2><p>ä½ å¯ä»¥ä¸‹è½½ <a href="https://github.com/noiron/simplest-react-todolist">GitHub ä¸Šçš„é¡¹ç›®æ–‡ä»¶</a>ï¼Œå†ç”¨ python å¼€å¯ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå°±å¯ä»¥æ‰“å¼€ <a href="http://localhost:8000/">http://localhost:8000/</a> æŸ¥çœ‹è¿è¡Œç»“æœäº†ã€‚</p><pre><code>git clone https://github.com/noiron/simplest-react-todolist.gitcd simplest-react-todolistpython -m SimpleHTTP server // open a server with python</code></pre><p>è¿™ç¯‡åšå®¢é‡Œæ²¡æœ‰å¯¹æ•´ä¸ªé¡¹ç›®æ‰€æœ‰çš„ä»£ç è¿›è¡Œåˆ†æï¼Œæ›´å¤šå†…å®¹è¿˜æ˜¯<a href="https://github.com/noiron/simplest-react-todolist">ç›´æ¥çœ‹ä»£ç </a>æ›´æ¸…æ¥šã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰æ®µæ—¶é—´å¿™ç€æ‰¾å·¥ä½œå»äº†ï¼Œæœ‰æ®µæ—¶é—´æ²¡æœ‰å†™åšå®¢äº†ï¼Œä¸Šä¸€ç¯‡è¿˜æ˜¯ä¸‰æœˆä»½çš„ï¼Œä»Šå¤©æ¥æ›´æ–°ä¸€ç¯‡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ€è¿‘åœ¨å­¦ React.jsï¼Œä¹Ÿå†™äº†ä¸€äº›ç»ƒä¹ çš„é¡¹ç›®ï¼Œä¹‹å‰å‚è€ƒç½‘ä¸Šçš„ä¸€äº›ä»£ç å†™äº†ä¸€ä¸ªå¾ˆç®€å•çš„ to-do listã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œå†™ä¸ªåŸºæœ¬çš„ to-do list å¯¹äºç†è§£ React ä¸­çš„ä¸€äº›æ¦‚å¿µåŠè¯­æ³•å€’æ˜¯æŒºæœ‰å¸®åŠ©çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å¾ˆå¤šçš„ React é¡¹ç›®ä¸­å·²ç»å¼€å§‹ä½¿ç”¨ ES6 æ¥å†™äº†ï¼Œä¸è¿‡å› ä¸ºæˆ‘åœ¨å­¦ä¹  React çš„æ—¶å€™çœ‹çš„æ•™ç¨‹å¤§å¤šéƒ½æ˜¯ç”¨ ES5 å†™çš„ï¼Œæˆ‘è¿™é‡Œè¿˜æ˜¯ç”¨çš„è¿˜æ˜¯æ›´ç†Ÿæ‚‰çš„ ES5 å†™æ³•ï¼Œè™½ç„¶æœ‰ç‚¹è½ä¼äº†ï¼Œä½†è‹¥æƒ³æ”¹æˆ ES6 ç‰ˆæœ¬å€’ä¹ŸæŒºæ–¹ä¾¿çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/noiron/simplest-react-todolist&quot;&gt;GitHub ä¸Šçš„é¡¹ç›®åœ°å€&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.wukai.me/simplest-react-todolist&quot;&gt;åœ¨çº¿ demo&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.wukai.me/tags/javascript/"/>
    
      <category term="react" scheme="http://www.wukai.me/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>å¼€å‘ä¸€ä¸ªç”¨äºå±è”½çŸ¥ä¹ç½‘å†…å®¹çš„Chromeæ‰©å±•</title>
    <link href="http://www.wukai.me/2016/03/25/chrome-extension-zhihufilter/"/>
    <id>http://www.wukai.me/2016/03/25/chrome-extension-zhihufilter/</id>
    <published>2016-03-24T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.544Z</updated>
    
    <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´ç”µå½±ã€Šç–¯ç‹‚åŠ¨ç‰©åŸã€‹ä¸Šæ˜ äº†ï¼Œç„¶åæˆ‘çš„çŸ¥ä¹é¦–é¡µå°±è¢«å®ƒåˆ·å±äº†ã€‚è™½ç„¶æˆ‘å¯¹è¿™éƒ¨ç”µå½±æ²¡æœ‰ä»»ä½•æ„è§ï¼Œä½†ä½œä¸ºä¸€ä¸ªè¿˜æ²¡å»ç”µå½±é™¢çœ‹è¿‡çš„äººæ¥è¯´ï¼Œæ¯çœ‹åˆ°ç›¸å…³é—®é¢˜ä¸€æ¬¡éƒ½æ˜¯æ— æƒ…çš„å‰§é€ï¼Œäºæ˜¯æˆ‘æ¯…ç„¶å±è”½äº†â€œç–¯ç‹‚åŠ¨ç‰©å›­â€è¿™ä¸ªè¯é¢˜ã€‚æœ¬ä»¥ä¸ºé—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯æ¥ä¸‹æ¥æˆ‘åˆè¢«è¿«çœ‹åˆ°è¿™ä¸ªé—®é¢˜ï¼š</p><p><img src="/asset/images/2016-03-25-zhihu-filter1.png" alt=""></p><p>é—®é¢˜ä¸Šæ·»åŠ çš„äº”ä¸ªè¯é¢˜æ— ä¸€å‘½ä¸­ï¼Œæˆ‘åˆè¢«å‰§é€äº†ä¸€è„¸ã€‚ç®—äº†ï¼Œæ—¢ç„¶çŸ¥ä¹çš„å±è”½è§„åˆ™é ä¸ä½ï¼Œé‚£å°±è‡ªå·±åŠ¨æ‰‹å§ã€‚è¿™æ ·æˆ‘çš„Chromeæµè§ˆå™¨æ‰©å±•â€”â€”ZhihuFilterå°±è¯ç”Ÿäº†ï¼Œ<a href="https://github.com/noiron/ZhihuFilter">ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹Githubä¸Šçš„é¡¹ç›®</a>ã€‚</p><h2 id="æ‰©å±•åŠŸèƒ½"><a href="#æ‰©å±•åŠŸèƒ½" class="headerlink" title="æ‰©å±•åŠŸèƒ½"></a>æ‰©å±•åŠŸèƒ½</h2><p>å…¶å®æ‰©å±•çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå½“æ‰“å¼€çŸ¥ä¹é¦–é¡µåï¼Œæ‰©å±•ä¼šä¾æ¬¡æ£€æŸ¥ä½ çš„å±è”½å…³é”®è¯åˆ—è¡¨æ˜¯å¦å‡ºç°åœ¨äº†æŸä¸€ä¸ªç­”æ¡ˆä¸­ï¼Œå¦‚æœå‡ºç°äº†ï¼Œå°±ä¼šæŠŠè¿™ä¸ªç­”æ¡ˆéšè—ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æç¤ºä¿¡æ¯å’Œä¸€ä¸ªå±•å¼€ç­”æ¡ˆçš„æŒ‰é’®ã€‚æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/asset/images/2016-03-25-zhihu-filter-demo1.png" alt=""></p><p>ä½ å¯ä»¥ç‚¹å‡»å›¾ä¸­çš„æŒ‰é’®æ¥æŸ¥çœ‹ç­”æ¡ˆï¼Œä¹‹åå¯ä»¥é€‰æ‹©å†æ¬¡éšè—æˆ–å±•å¼€ã€‚</p><span id="more"></span><p>å½“ä½ å®‰è£…äº†æ‰©å±•åï¼Œä¼šåœ¨åœ°å€æ çš„å³ä¾§æ˜¾ç¤ºå‡ºå›¾æ ‡</p><p><img src="/asset/images/2016-03-25-icon.png" alt="icon"></p><p>ç‚¹å‡»å›¾æ ‡åï¼Œå°†ä¼šå‡ºç°è®¾ç½®å±è”½è¯çš„ç•Œé¢</p><p><img src="/asset/images/2016-03-25-popup.png" alt="popupé¡µé¢"></p><p>ä½ å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢ä¸­è®¾ç½®ä½ æƒ³å±è”½çš„è¯è¯­ã€‚</p><h2 id="å…³äºChromeæ‰©å±•çš„å¼€å‘"><a href="#å…³äºChromeæ‰©å±•çš„å¼€å‘" class="headerlink" title="å…³äºChromeæ‰©å±•çš„å¼€å‘"></a>å…³äºChromeæ‰©å±•çš„å¼€å‘</h2><p>å…³äºChromeæ‰©å±•å¼€å‘çš„å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://developer.chrome.com/extensions/getstarted">Googleçš„å®˜æ–¹æ–‡æ¡£</a>æˆ–è€…æ˜¯<a href="http://www.ituring.com.cn/minibook/950">è¿™ä¸ªæ•™ç¨‹</a>ã€‚</p><blockquote><p>ä¸€ä¸ªåº”ç”¨ï¼ˆæ‰©å±•ï¼‰å…¶å®æ˜¯å‹ç¼©åœ¨ä¸€èµ·çš„ä¸€ç»„æ–‡ä»¶ï¼ŒåŒ…æ‹¬HTMLï¼ŒCSSï¼ŒJavascriptè„šæœ¬ï¼Œå›¾ç‰‡æ–‡ä»¶ï¼Œè¿˜æœ‰å…¶å®ƒä»»ä½•éœ€è¦çš„æ–‡ä»¶ã€‚</p></blockquote><p>å¼€å‘æ‰©å±•çš„æ—¶å€™ï¼Œå¿…ä¸å¯å°‘çš„æ˜¯ä¸€ä¸ª<code>manifest.json</code>æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¼šå‘Šè¯‰Chromeä½ çš„æ‰©å±•ä¸­åŒ…å«äº†å“ªäº›å†…å®¹ã€‚<code>manifest.json</code>ä¸­åŒ…å«æ‰©å±•çš„åå­—ã€ç‰ˆæœ¬åŠå„ç§èµ„æºæ–‡ä»¶ï¼ˆå¦‚å›¾æ ‡ã€æ˜¾ç¤ºé¡µé¢ç­‰ï¼‰çš„é“¾æ¥ã€‚</p><p><a href="https://github.com/noiron/ZhihuFilter/blob/master/manifest.json">æˆ‘çš„æ‰©å±•çš„manifest.jsonæ–‡ä»¶</a></p><h3 id="Browser-action-å’Œ-page-action"><a href="#Browser-action-å’Œ-page-action" class="headerlink" title="Browser_action å’Œ page_action"></a>Browser_action å’Œ page_action</h3><p><code>Browser_action</code>å’Œ<code>page_action</code>æ˜¯æ‰©å±•çš„ä¸¤ç§ç±»å‹ï¼Œå®ƒä»¬å¾ˆç›¸ä¼¼ï¼Œä¸»è¦çš„åŒºåˆ«åœ¨äº<code>browser_action</code>å¯ä»¥åº”ç”¨äºæ‰€æœ‰çš„é¡µé¢ï¼Œè€Œ<code>page_action</code>åªèƒ½åœ¨ä½ è®¾å®šçš„å‡ ä¸ªç‰¹å®šç½‘ç«™å†…ä½¿ç”¨ã€‚æˆ‘çš„æ‰©å±•æ˜¯ä¸“é—¨ç”¨äºçŸ¥ä¹ç½‘ç«™çš„ï¼Œå› æ­¤é€‰æ‹©äº†<code>page_action</code>æ¥å¤„ç†ã€‚</p><p>æŒ‰ç…§Googleçš„æ–‡æ¡£æè¿°ï¼Œä¸¤è€…è¿˜æœ‰ä¸€ä¸ªåŒºåˆ«ï¼š<code>browser_action</code>çš„å›¾æ ‡æ˜¾ç¤ºåœ¨åœ°å€æ çš„å¤–éƒ¨ï¼Œ<code>page_action</code>çš„å›¾æ ‡æ˜¾ç¤ºåœ¨åœ°å€æ å†…éƒ¨ã€‚ä½†æ˜¯ï¼Œåœ¨<a href="https://groups.google.com/a/chromium.org/forum/#!searchin/chromium-extensions/upcoming/chromium-extensions/7As9MKhav5E/dNiZDoSCCQAJ">è¿™é‡Œçš„è®¨è®º</a>ä¸­ï¼Œä¼¼ä¹æ–°ç‰ˆæœ¬çš„Chromeæµè§ˆå™¨ä¸­å·²ç»å°†ä¸¤è€…éƒ½æ˜¾ç¤ºåœ¨äº†åœ°å€æ çš„å¤–ä¾§ï¼Œä¸è¿‡<code>page_action</code>çš„å›¾æ ‡åªæœ‰åœ¨æ‰“å¼€ç‰¹å®šçš„ç½‘ç«™æ—¶æ‰ä¸ä¼šæ˜¾ç¤ºä¸ºç°è‰²ã€‚</p><p>åœ¨<code>manifest.json</code>æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š</p><pre><code>&quot;page_action&quot;: &#123;  &quot;default_icon&quot;: &quot;images/icon.png&quot;,  &quot;default_title&quot;: &quot;çŸ¥ä¹å±è”½æ‰©å±•&quot;&#125;,</code></pre><h3 id="background-js"><a href="#background-js" class="headerlink" title="background.js"></a>background.js</h3><blockquote><p>åœ¨Manifestä¸­æŒ‡å®šbackgroundåŸŸå¯ä»¥ä½¿æ‰©å±•å¸¸é©»åå°ã€‚backgroundå¯ä»¥åŒ…å«ä¸‰ç§å±æ€§ï¼Œåˆ†åˆ«æ˜¯<code>scripts</code>ã€<code>page</code>å’Œ<code>persistent</code>ã€‚</p></blockquote><p>æˆ‘åœ¨æ‰©å±•ä¸­åªç”¨åˆ°äº†<code>scripts</code>ï¼š</p><pre><code>&quot;background&quot;: &#123;  &quot;scripts&quot;: [&quot;js/jquery-2.2.1.js&quot;,&quot;js/background.js&quot;]&#125;,</code></pre><p>è¿™æ ·å°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒ…å«äº†åˆ—å‡ºçš„è„šæœ¬æ–‡ä»¶çš„åå°é¡µé¢ã€‚</p><p>åœ¨æˆ‘çš„<code>background.js</code>æ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“ç½‘å€æ”¹å˜çš„æ—¶å€™ï¼Œåˆ¤æ–­å½“å‰çš„é¡µé¢æ˜¯å¦æ˜¯çŸ¥ä¹</span></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯çš„è¯ï¼Œå°±æ˜¾ç¤ºå‡ºå›¾æ ‡ï¼Œå¹¶è®¾ç½®å®ƒçš„å¼¹å‡ºé¡µé¢</span></span><br><span class="line">chrome.tabs.onUpdated.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">id, info, tab</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tab.url.toLowerCase().indexOf(<span class="string">&quot;zhihu.com&quot;</span>) &gt; -<span class="number">1</span>)&#123;</span><br><span class="line">        chrome.pageAction.show(id);</span><br><span class="line">        chrome.pageAction.setPopup(&#123;</span><br><span class="line">            <span class="attr">tabId</span>: id,</span><br><span class="line">            <span class="attr">popup</span>: <span class="string">&#x27;popup.html&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>background.js</code>æ–‡ä»¶ä¸­è¿˜æœ‰ä¸€ä¸ªç”¨äºå’Œ<code>content_script</code>è¿›è¡Œé€šä¿¡çš„ç›‘å¬å™¨ã€‚</p><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://developer.chrome.com/extensions/background_pages">Googleçš„Backgorund Pagesæ–‡æ¡£</a><br><a href="http://www.ituring.com.cn/article/60242">å¦ä¸€ä¸ªæ•™ç¨‹</a></p></blockquote><h3 id="Content-Scripts"><a href="#Content-Scripts" class="headerlink" title="Content Scripts"></a>Content Scripts</h3><blockquote><p>Content scriptsæ˜¯åœ¨Webé¡µé¢å†…è¿è¡Œçš„javascriptè„šæœ¬ã€‚é€šè¿‡ä½¿ç”¨æ ‡å‡†çš„DOMï¼Œå®ƒä»¬å¯ä»¥è·å–æµè§ˆå™¨æ‰€è®¿é—®é¡µé¢çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å¯ä»¥ä¿®æ”¹è¿™äº›ä¿¡æ¯ã€‚</p></blockquote><p>åœ¨<code>manifest.json</code>æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ï¼š</p><pre><code>&quot;content_scripts&quot;: [&#123;  &quot;matches&quot;: [&quot;*://*.zhihu.com/*&quot;],  &quot;js&quot;: [&quot;js/jquery-2.2.1.js&quot;, &quot;js/content_script.js&quot;]&#125;</code></pre><p>åœ¨æ‰“å¼€åŒ¹é…çš„ç½‘ç«™æ—¶ï¼Œåˆ—å‡ºçš„jsæ–‡ä»¶ä¼šè¢«æ³¨å…¥é¡µé¢ï¼Œè¿™æ ·å°±å¯ä»¥è·å¾—æµè§ˆå™¨æ‰€è®¿é—®çš„webé¡µé¢çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å¯ä»¥å¯¹é¡µé¢åšå‡ºä¿®æ”¹ã€‚è™½ç„¶content scriptå’Œé¡µé¢å…±äº«äº†DOMç»“æ„ï¼Œä½†ä¸èƒ½è®¿é—®è¯¥é¡µé¢æˆ–å…¶å®ƒcontent scriptä¸­å®šä¹‰çš„å‡½æ•°å’Œå˜é‡ï¼Œè¿™æ ·å°±é¿å…äº†ç›¸åŒçš„å‡½æ•°æˆ–å˜é‡åç§°çš„å¹²æ‰°ã€‚</p><p>æˆ‘çš„æ‰©å±•çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯åœ¨<code>content_script.js</code>ä¸­å®Œæˆçš„ï¼Œåœ¨è¯¥è„šæœ¬ä¸­é€šè¿‡å¯¹é¡µé¢çš„DOMè¿›è¡Œæ“ä½œæ¥å®ç°åŠŸèƒ½ã€‚</p><h2 id="æ‰©å±•åŠŸèƒ½çš„å®ç°"><a href="#æ‰©å±•åŠŸèƒ½çš„å®ç°" class="headerlink" title="æ‰©å±•åŠŸèƒ½çš„å®ç°"></a>æ‰©å±•åŠŸèƒ½çš„å®ç°</h2><h3 id="å¯¹çŸ¥ä¹é¦–é¡µè¿›è¡Œåˆ†æ"><a href="#å¯¹çŸ¥ä¹é¦–é¡µè¿›è¡Œåˆ†æ" class="headerlink" title="å¯¹çŸ¥ä¹é¦–é¡µè¿›è¡Œåˆ†æ"></a>å¯¹çŸ¥ä¹é¦–é¡µè¿›è¡Œåˆ†æ</h3><p>æŸ¥çœ‹ä¸€ä¸‹çŸ¥ä¹é¦–é¡µçš„æºä»£ç ï¼Œæ‰€æœ‰çš„ç­”æ¡ˆå†…å®¹æ˜¯æ”¾åœ¨ä¸€ä¸ª<code>id=js-home-feed-list</code>çš„divä¸­çš„ï¼Œç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--è¿™é‡Œçœç•¥äº†å¾ˆå¤šå†…å®¹ï¼Œåªæ˜¯ä¸€ä¸ªå¤§è‡´ç¤ºæ„--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;js-home-feed-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;feed-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è¿™é‡Œçœç•¥ä¸€äº›é¢˜ç›®çš„idï¼Œurlç­‰ä¿¡æ¯--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;avatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  <span class="comment">&lt;!--å¤´åƒ--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;feed-main&quot;</span>&gt;</span>  <span class="comment">&lt;!--é™¤äº†å¤´åƒå¤–çš„å…¶å®ƒéƒ¨åˆ†--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;source&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--ç­”æ¡ˆå†…å®¹åŠæŒ‰é’®ç­‰éƒ¨åˆ†--&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;feed-item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;feed-item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è€Œåœ¨ç­”æ¡ˆéƒ¨åˆ†ä¸­ï¼Œåˆåˆ†ä¸ºæ‘˜è¦å’Œå®Œæ•´çš„ç­”æ¡ˆã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;zm-item-answer-detail&quot;</span>&gt;</span></span><br><span class="line">    â€¦</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;zm-item-rich-text&quot;</span>&gt;</span>   <span class="comment">&lt;!--å†…å®¹éƒ¨åˆ†--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;zm-editable-content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>   <span class="comment">&lt;!--ç‚¹å‡»æ˜¾ç¤ºå…¨éƒ¨åï¼Œè¿™ä¸€éƒ¨åˆ†æ‰æ˜¾ç¤º--&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;content hidden&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>   <span class="comment">&lt;!--åŒ…æ‹¬äº†å…¨éƒ¨ç­”æ¡ˆå†…å®¹ä½†ä¸æ˜¾ç¤º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;zh-summary summary clearfix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!--æ˜¾ç¤ºæ‘˜è¦--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è·å–ä¸Šé¢çš„èŠ‚ç‚¹å†…å®¹ï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦å±è”½è¿™ä¸ªç­”æ¡ˆã€‚æœ€ç®€å•çš„å®ç°æ–¹æ³•å°±æ˜¯æŸ¥æ‰¾å…³é”®è¯æ˜¯å¦åœ¨èŠ‚ç‚¹çš„<code>outerHTML</code>ä¸­å‡ºç°ï¼Œå¦‚æœå‡ºç°äº†å°±ç»™<code>.feed-main</code>åŠ ä¸Šä¸€ä¸ªåä¸º<code>hidden</code>çš„classã€‚</p><h3 id="ç”¨äºæ›¿æ¢çš„å†…å®¹"><a href="#ç”¨äºæ›¿æ¢çš„å†…å®¹" class="headerlink" title="ç”¨äºæ›¿æ¢çš„å†…å®¹"></a>ç”¨äºæ›¿æ¢çš„å†…å®¹</h3><p>åŸæ¥çš„ç­”æ¡ˆè¢«éšè—äº†ä¹‹åï¼Œéœ€è¦åœ¨è¿™ä¸ªåœ°æ–¹æ¢ä¸Šç‚¹æ–°çš„å†…å®¹ï¼Œæˆ‘åœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªdivï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªpå…ƒç´ ç”¨äºæ˜¾ç¤ºä¿¡æ¯ï¼ŒåŠä¸€ä¸ªbuttonç”¨äºåˆ‡æ¢ç­”æ¡ˆçš„çŠ¶æ€ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç”¨äºæ›¿æ¢çš„div</span></span><br><span class="line"><span class="keyword">var</span> $div = $(<span class="string">&#x27;&lt;div class=&quot;block-info&quot;&gt;&lt;/div&gt;&#x27;</span>);</span><br><span class="line">$div.append($(<span class="string">&#x27;&lt;p&gt;è¿™é‡Œæœ‰ä¸€ä¸ªè¢«å±è”½çš„ç­”æ¡ˆ&lt;span&gt;&lt;/span&gt;&lt;/p&gt;&#x27;</span>));</span><br><span class="line">$div.append($(<span class="string">&#x27;&lt;button class=&quot;block-btn&quot;&gt;æ‰‹è´±ä¸€ä¸‹&lt;/button&gt;&#x27;</span>));</span><br></pre></td></tr></table></figure><p>è¿˜éœ€è¦åœ¨æŒ‰é’®ä¸Šç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œpå…ƒç´ å†…æ˜¾ç¤ºçš„ä¿¡æ¯ä¹Ÿä¼šæ ¹æ®å®é™…è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="å…³é”®è¯çš„å­˜å‚¨"><a href="#å…³é”®è¯çš„å­˜å‚¨" class="headerlink" title="å…³é”®è¯çš„å­˜å‚¨"></a>å…³é”®è¯çš„å­˜å‚¨</h3><p>åœ¨æˆ‘çš„æ‰©å±•ä¸­ï¼Œæˆ‘æ˜¯å°†éœ€è¦å±è”½çš„å…³é”®è¯å­˜æ”¾åœ¨äº†<code>localStorage</code>ä¸­ã€‚å…³é”®è¯ä¿å­˜åœ¨localStorageä¸­çš„<code>keywords</code>é”®ä¸‹ï¼Œæ˜¯ä¸€ä¸ªç®€å•çš„ç”±é€—å·åˆ†éš”å¼€çš„å­—ç¬¦ä¸²ã€‚</p><blockquote><p>è¦è®¿é—®åŒä¸€ä¸ªlocalStorageå¯¹è±¡ï¼Œé¡µé¢å¿…é¡»æ¥è‡ªåŒä¸€ä¸ªåŸŸåï¼ˆå­åŸŸåæ— æ•ˆï¼‰ï¼Œä½¿ç”¨åŒä¸€ç§åè®®ï¼Œåœ¨åŒä¸€ä¸ªç«¯å£ä¸Šã€‚</p></blockquote><p>ç”±äºcontent scriptæ³¨å…¥åˆ°äº†çŸ¥ä¹é¡µé¢ï¼Œè€ŒlocalStorageå­˜æ”¾åœ¨æ‰©å±•çš„åŸŸä¸‹ï¼Œè¦åœ¨content scriptä¸­è·å¾—å…³é”®è¯çš„å€¼ï¼Œå°±å¿…é¡»ç”¨åˆ°é¡µé¢ä¸­çš„é€šä¿¡ã€‚</p><p>Chromeæä¾›äº†4ä¸ªæœ‰å…³æ‰©å±•é¡µé¢é—´ç›¸äº’é€šä¿¡çš„æ¥å£ï¼Œåˆ†åˆ«æ˜¯<code>runtime.sendMessage</code>ã€<code>runtime.onMessage</code>ã€<code>runtime.connect</code>å’Œ<code>runtime.onConnect</code>ï¼Œ<br>è¿™é‡Œç”¨åˆ°äº†å‰ä¸¤ä¸ªã€‚</p><p>content_script.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»æ‰©å±•çš„localStorageä¸­è·å¾—å­˜å‚¨çš„å…³é”®è¯</span></span><br><span class="line">chrome.runtime.sendMessage(&#123;<span class="attr">method</span>: <span class="string">&quot;getKeywords&quot;</span>&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    str = response.keywords;</span><br><span class="line">    keywords = str !== <span class="string">&#x27;&#x27;</span> ? str.split(<span class="string">&#x27;,&#x27;</span>) : [];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„background.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (request.method == <span class="string">&quot;getKeywords&quot;</span>)</span><br><span class="line">        sendResponse(&#123;<span class="attr">keywords</span>: <span class="built_in">localStorage</span>[<span class="string">&#x27;keywords&#x27;</span>]&#125;);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        sendResponse(&#123;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥åœ¨content scriptä¸­ä½¿ç”¨localStorageçš„å€¼äº†ã€‚</p><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<a href="http://www.ituring.com.cn/article/60272">æ‰©å±•é¡µé¢ä¸­çš„é€šä¿¡</a></p></blockquote><h3 id="æ£€æµ‹é¡µé¢åŠ è½½äº†æ›´å¤šå†…å®¹"><a href="#æ£€æµ‹é¡µé¢åŠ è½½äº†æ›´å¤šå†…å®¹" class="headerlink" title="æ£€æµ‹é¡µé¢åŠ è½½äº†æ›´å¤šå†…å®¹"></a>æ£€æµ‹é¡µé¢åŠ è½½äº†æ›´å¤šå†…å®¹</h3><p>æ¯å½“å½“çŸ¥ä¹é¡µé¢åŠ è½½äº†æ›´å¤šçš„ç­”æ¡ˆæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å†è¿›è¡Œå¤„ç†ã€‚é‚£ä¹ˆå¦‚ä½•æ£€æµ‹é¡µé¢ä¸­åŠ è½½äº†æ›´å¤šå†…å®¹ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°<code>MutationObserver</code>å¯¹è±¡ã€‚<code>MutationObserver</code>æä¾›äº†æ£€æµ‹é¡µé¢ä¸­çš„DOMå˜åŒ–çš„æ–¹æ³•ã€‚</p><p><code>MutationObserver</code>çš„ä½¿ç”¨æ–¹æ³•ï¼š</p><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªmutationObserverçš„å®ä¾‹</p><pre><code>var observer = new MutationObserver(callback)</code></pre><p>è¿™é‡Œéœ€è¦ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºæ„é€ å™¨çš„å‚æ•°ã€‚</p><p>callbackå‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œæ‰€æœ‰è¢«è®°å½•åˆ°çš„DOMå˜åŒ–å°†ä¼šç»„åˆæˆä¸€ä¸ªæ•°ç»„ï¼Œä½œä¸ºå‚æ•°ä¼ ç»™å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†ã€‚</p><p>mutationObserverå¯¹è±¡æœ‰å‡ ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œåªç”¨åˆ°observeæ–¹æ³•ã€‚</p><p>observeæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> observe(</span><br><span class="line">  Node target,</span><br><span class="line">  MutationObserverInit options</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡çš„æ˜¯ä½ è¦è§‚å¯Ÿå“ªä¸€ä¸ªèŠ‚ç‚¹çš„DOMå˜åŒ–ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé€‰é¡¹å‚æ•°ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> option = &#123;</span><br><span class="line">    <span class="string">&#x27;childList&#x27;</span>: <span class="literal">true</span>,    <span class="comment">// è§‚å¯Ÿå­å…ƒç´ </span></span><br><span class="line">    <span class="string">&#x27;subtree&#x27;</span>: <span class="literal">true</span>,      <span class="comment">// è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹çš„åä»£å…ƒç´ </span></span><br><span class="line">    <span class="string">&#x27;attributes&#x27;</span>: <span class="literal">false</span>   <span class="comment">// ä¸è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹å±æ€§çš„å˜åŒ–</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªè®¾ç½®äº†ä¸‰ä¸ªé€‰é¡¹ï¼Œå…¶ä½™å±æ€§å¯ä»¥çœ‹<a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver#MutationObserverInit">MDNæ–‡æ¡£</a>ã€‚</p><p>è§‚å¯Ÿåˆ°çš„æ¯ä¸€ä¸ªå˜åŒ–éƒ½æ˜¯ä¸€ä¸ªMutationRecordå¯¹è±¡ï¼Œå®ƒæœ‰è®¸å¤šå±æ€§ï¼Œæ¯”å¦‚ï¼š</p><ul><li>typeï¼Œè®°å½•å˜åŒ–çš„ç±»å‹</li><li>addedNodesï¼Œç”±å¢åŠ çš„èŠ‚ç‚¹ç»„æˆçš„NodeList</li><li>removeNodesï¼Œç”±åˆ é™¤çš„èŠ‚ç‚¹ç»„æˆçš„NodeList</li></ul><p>å› ä¸ºaddedNodesæ˜¯ä¸€ä¸ªNodeListï¼Œæ‰€ä»¥å¯ä»¥åœ¨å®ƒä¸Šé¢åº”ç”¨jQueryçš„$(), <code>$(mutation.addedNodes)</code>ã€‚</p><p>å…¶å®ƒçš„å±æ€§å¯ä»¥è§<a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationRecord">MDNæ–‡æ¡£</a>ã€‚</p><p>æ‰€æœ‰çš„MutationRecordä¼šè¢«æ”¾è¿›ä¸€ä¸ªlistä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ ç»™ä¸Šé¢çš„callbackå‡½æ•°ã€‚é€šè¿‡å¯¹MutationRecordå¯¹è±¡çš„å±æ€§è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœæ–°å¢çš„èŠ‚ç‚¹é‡Œå‡ºç°äº†<code>class=feed-main</code>çš„å…ƒç´ ï¼Œåˆ™ä»£è¡¨åŠ è½½äº†æ–°çš„ç­”æ¡ˆï¼Œéœ€è¦å†ä¸€æ¬¡è¿è¡Œç¨‹åºã€‚</p><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<br><a href="https://dev.opera.com/articles/mutation-observers-tutorial/">Getting to Know Mutation Observers</a><br><a href="http://javascript.ruanyifeng.com/dom/mutationobserver.html">Mutation Observer</a></p></blockquote><h2 id="æ‰©å±•çš„ä½¿ç”¨"><a href="#æ‰©å±•çš„ä½¿ç”¨" class="headerlink" title="æ‰©å±•çš„ä½¿ç”¨"></a>æ‰©å±•çš„ä½¿ç”¨</h2><p>åœ¨æˆ‘çš„è®¾æƒ³ä¸­ï¼Œæ‰©å±•å¯ä»¥æä¾›ä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼çš„æ”¯æŒï¼Œå†æ¯”å¦‚é™¤äº†é¦–é¡µå¤–ï¼Œåœ¨ç­”æ¡ˆé¡µé¢æ˜¯å¦ä¹Ÿéœ€è¦æä¾›å±è”½åŠŸèƒ½ã€‚è¿™äº›é€‰é¡¹ä¼šåœ¨ä¹‹åé€æ­¥åŠ å…¥ã€‚</p><p>ç”±äºChromeçš„è®¾ç½®ï¼Œä¸èƒ½å¤Ÿå®‰è£…Web Storeä¸­æ²¡æœ‰çš„ç¨‹åºã€‚è€Œå‘å¸ƒæ‰©å±•éœ€è¦å…ˆä»˜$5ï¼Œæˆ‘æ²¡æœ‰ä¿¡ç”¨å¡ï¼Œä¹Ÿå°±æš‚æ—¶æ²¡æœ‰å‘å¸ƒæ‰©å±•ã€‚å¦‚æœæƒ³å°è¯•ä¸€ä¸‹æ‰©å±•çš„è¯ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½<a href="https://github.com/noiron/ZhihuFilter">Githubä¸­çš„ä»£ç </a>åˆ°æœ¬åœ°ã€‚åœ¨Chromeæµè§ˆå™¨çš„èœå•ä¸­é€‰æ‹© More tools -&gt; Extensionsï¼Œè¿›å…¥æ‰©å±•é¡µé¢åï¼Œå‹¾é€‰å³ä¸Šè§’çš„Developer modeï¼Œé€‰æ‹©Load unpacked extensionï¼Œé€‰æ‹©æ‰©å±•æ–‡ä»¶å¤¹å³å¯ã€‚</p><p>æ¬¢è¿ä½¿ç”¨åæå‡ºå»ºè®®ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰æ®µæ—¶é—´ç”µå½±ã€Šç–¯ç‹‚åŠ¨ç‰©åŸã€‹ä¸Šæ˜ äº†ï¼Œç„¶åæˆ‘çš„çŸ¥ä¹é¦–é¡µå°±è¢«å®ƒåˆ·å±äº†ã€‚è™½ç„¶æˆ‘å¯¹è¿™éƒ¨ç”µå½±æ²¡æœ‰ä»»ä½•æ„è§ï¼Œä½†ä½œä¸ºä¸€ä¸ªè¿˜æ²¡å»ç”µå½±é™¢çœ‹è¿‡çš„äººæ¥è¯´ï¼Œæ¯çœ‹åˆ°ç›¸å…³é—®é¢˜ä¸€æ¬¡éƒ½æ˜¯æ— æƒ…çš„å‰§é€ï¼Œäºæ˜¯æˆ‘æ¯…ç„¶å±è”½äº†â€œç–¯ç‹‚åŠ¨ç‰©å›­â€è¿™ä¸ªè¯é¢˜ã€‚æœ¬ä»¥ä¸ºé—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯æ¥ä¸‹æ¥æˆ‘åˆè¢«è¿«çœ‹åˆ°è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/asset/images/2016-03-25-zhihu-filter1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;é—®é¢˜ä¸Šæ·»åŠ çš„äº”ä¸ªè¯é¢˜æ— ä¸€å‘½ä¸­ï¼Œæˆ‘åˆè¢«å‰§é€äº†ä¸€è„¸ã€‚ç®—äº†ï¼Œæ—¢ç„¶çŸ¥ä¹çš„å±è”½è§„åˆ™é ä¸ä½ï¼Œé‚£å°±è‡ªå·±åŠ¨æ‰‹å§ã€‚è¿™æ ·æˆ‘çš„Chromeæµè§ˆå™¨æ‰©å±•â€”â€”ZhihuFilterå°±è¯ç”Ÿäº†ï¼Œ&lt;a href=&quot;https://github.com/noiron/ZhihuFilter&quot;&gt;ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹Githubä¸Šçš„é¡¹ç›®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ‰©å±•åŠŸèƒ½&quot;&gt;&lt;a href=&quot;#æ‰©å±•åŠŸèƒ½&quot; class=&quot;headerlink&quot; title=&quot;æ‰©å±•åŠŸèƒ½&quot;&gt;&lt;/a&gt;æ‰©å±•åŠŸèƒ½&lt;/h2&gt;&lt;p&gt;å…¶å®æ‰©å±•çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå½“æ‰“å¼€çŸ¥ä¹é¦–é¡µåï¼Œæ‰©å±•ä¼šä¾æ¬¡æ£€æŸ¥ä½ çš„å±è”½å…³é”®è¯åˆ—è¡¨æ˜¯å¦å‡ºç°åœ¨äº†æŸä¸€ä¸ªç­”æ¡ˆä¸­ï¼Œå¦‚æœå‡ºç°äº†ï¼Œå°±ä¼šæŠŠè¿™ä¸ªç­”æ¡ˆéšè—ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æç¤ºä¿¡æ¯å’Œä¸€ä¸ªå±•å¼€ç­”æ¡ˆçš„æŒ‰é’®ã€‚æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/asset/images/2016-03-25-zhihu-filter-demo1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ç‚¹å‡»å›¾ä¸­çš„æŒ‰é’®æ¥æŸ¥çœ‹ç­”æ¡ˆï¼Œä¹‹åå¯ä»¥é€‰æ‹©å†æ¬¡éšè—æˆ–å±•å¼€ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.wukai.me/tags/javascript/"/>
    
      <category term="chromeæ‰©å±•" scheme="http://www.wukai.me/tags/chrome%E6%89%A9%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>(è¯‘)ç”¨ç¥ç»ç½‘ç»œå®ç°èƒ½å¤Ÿè‡ªä¸»é¿è®©éšœç¢çš„ç”Ÿç‰©</title>
    <link href="http://www.wukai.me/2016/03/01/creatures-avoiding-planks/"/>
    <id>http://www.wukai.me/2016/03/01/creatures-avoiding-planks/</id>
    <published>2016-02-29T16:00:00.000Z</published>
    <updated>2021-12-21T13:55:03.544Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å»å¹´çœ‹åˆ°çš„ä¸€ä¸ªå¾ˆæœ‰è¶£çš„é¡¹ç›®ï¼Œè¿˜è¯•ç€æ¨¡ä»¿å®ƒçš„ä»£ç å†™ä¸€ä¸ªç±»ä¼¼çš„é¡¹ç›®å‡ºæ¥ï¼Œä¸è¿‡ä¸€ç›´æ²¡æœ‰å®Œæˆã€‚è¿™é‡ŒæŠŠåŸä½œè€…çš„ä¸€ç¯‡ç›¸å…³åšå®¢ç¿»è¯‘è¿‡æ¥ï¼Œè¯´ä¸å®šæœ‰æ›´å¤šçš„äººå¯¹æ­¤æ„Ÿå…´è¶£ã€‚</p><ul><li>é¡¹ç›®æ¼”ç¤ºï¼š<a href="http://otoro.net/planks/">åŸä½œè€…ç”¨JavaScriptå®ç°çš„demo</a></li><li>åŸæ–‡åœ°å€ï¼š<a href="http://blog.otoro.net/2015/05/07/creatures-avoiding-planks/">creatures avoiding planks</a></li><li>åŸä½œè€…çš„twitteråœ°å€ï¼š<a href="https://twitter.com/hardmaru">hardmaruâ€™s twitter</a></li><li>åŸä½œè€…çš„å¦ä¸€ä¸ªå®éªŒï¼š<a href="http://otoro.net/kanji/">ç”Ÿæˆä¼ªæ±‰å­—çš„å®éªŒ</a></li><li>è¯‘æ–‡åœ°å€ï¼š<a href="http://noiron.github.io/2016/03/01/creatures-avoiding-planks/">ç”¨ç¥ç»ç½‘ç»œå®ç°èƒ½å¤Ÿè‡ªä¸»é¿è®©éšœç¢çš„ç”Ÿç‰©</a></li><li>ç¿»è¯‘ï¼šå´é”´ï¼ˆnoironï¼‰</li></ul><p><strong>æ³¨æ„ï¼šåŸæ–‡ä¸­å¼•ç”¨äº†ä¸€äº›å¢™å¤–é“¾æ¥ï¼Œè¯·é…åˆæ¢¯å­é£Ÿç”¨</strong></p><p>ä»¥ä¸‹ä¸ºè¯‘æ–‡å†…å®¹ï¼š</p><hr><p><img src="/asset/images/2016-03-01-planks_blog.png" alt=""><br><strong>å…·æœ‰ç¥ç»ç½‘ç»œå¤§è„‘çš„agentä¸ºäº†ç”Ÿå­˜è€Œè¿›åŒ–</strong></p><p><a href="http://otoro.net/planks/">è¿™é‡Œæ˜¯javascriptçš„æ¼”ç¤º</a></p><p>æœ€è¿‘æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæ¨¡æ‹Ÿ<a href="https://www.youtube.com/watch?v=fmSTNu0Zjh8">è§†é¢‘</a>ï¼Œå±•ç¤ºäº†ä½¿ç”¨è¿›åŒ–æŠ€æœ¯æ¥è®­ç»ƒagentï¼Œè®©å®ƒä»¬èƒ½å¤Ÿé¿å¼€ç§»åŠ¨çš„éšœç¢ç‰©ã€‚<a href="https://www.reddit.com/r/gamedev/comments/31idqb/im_building_evolution_based_ai_toolkit_to/">è¿™é‡Œä½¿ç”¨çš„æ–¹æ³•</a>ä¼¼ä¹æ˜¯<a href="http://www.cs.ucf.edu/~kstanley/neat.html">NEAT</a>ç®—æ³•çš„å˜ç§ã€‚NEATç®—æ³•ç”¨äºç¥ç»ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„è¿›åŒ–ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£ç¡®å®Œæˆç‰¹å®šçš„ä»»åŠ¡ã€‚å®ƒæ˜¯ä¸ºäº†<a href="http://en.wikipedia.org/wiki/Unity_(game_engine">Unity 5</a>æ¸¸æˆå¼•æ“è€Œå†™çš„ï¼Œæƒ³è¢«æ•´åˆè¿›ç»¼åˆçš„æ¸¸æˆAIä¸­ï¼Œè¿™å¼•èµ·äº†æˆ‘çš„å…´è¶£ã€‚</p><p>è¿™ä¸ªç»“æœå¾ˆé…·è€Œä¸”åŠ¨èµ·æ¥ä¼¼ä¹å¾ˆä¼˜é›…ï¼Œæ‰€ä»¥æˆ‘æƒ³è¯•ç€ç”¨javascriptå®ç°ä¸€ä¸ªç±»ä¼¼çš„demoï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œäº†ã€‚åœ¨ç©äº†ä¸€ä¸‹åŸºæœ¬çš„å®ç°åï¼Œæˆ‘å‘ç°å¯¹äºéšœç¢èº²é¿é—®é¢˜ï¼Œä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œå°±å¯ä»¥é«˜æ•ˆçš„å®Œæˆäº†ï¼Œç”šè‡³äºä¸€ä¸ªå®Œå…¨è¿æ¥çš„ç¥ç»ç½‘ç»œéƒ½ç®—æ˜¯æ€é¸¡ç”¨ç‰›åˆ€äº†ã€‚æœ€åæˆ‘ä¹Ÿæ„è¯†åˆ°å°±ç®—æ˜¯ä¸€ä¸ªç®€å•çš„ç±»<a href="http://upload.wikimedia.org/wikipedia/commons/3/31/Perceptron.svg">æ„ŸçŸ¥å™¨ï¼ˆperceptronï¼‰</a>ç½‘ç»œéƒ½èƒ½å¤Ÿå¾ˆå¥½åœ°å®Œæˆä»»åŠ¡ï¼Œè€Œåœ¨ä¹‹å‰æåˆ°çš„éšœç¢èº²é¿demoä¸­ï¼Œéšè—å•å…ƒä¹Ÿå¹¶ä¸èƒ½å¤Ÿå¢åŠ å¤šå°‘å¥½å¤„ã€‚</p><p><img src="/asset/images/2016-03-01-perceptron.png" alt="perceptron"><br><strong>ç®€å•çš„æ„ŸçŸ¥å™¨å›¾è§£ï¼ˆç»´åŸºç™¾ç§‘ï¼‰</strong></p><p>å› ä¸ºagentå¯ä»¥åœ¨æ¢æµ‹åˆ°éšœç¢ç‰©çš„ç¬é—´è‡ªç”±åœ°å‘ä»»æ„æ–¹å‘ç§»åŠ¨ï¼Œè€Œä¸”agentä¹‹é—´ä¸ä¼šäº§ç”Ÿç›¸äº’ä½œç”¨ï¼Œå› æ­¤è¿™ä¸ªä»»åŠ¡å˜å¾—å¤ªç®€å•äº†ï¼Œä½¿ç”¨NEATç®—æ³•çš„æ€ä¼¤åŠ›è¿‡å¤§äº†ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ç±»æ„ŸçŸ¥å™¨ç½‘ç»œï¼ˆå³å•ç¥ç»å…ƒç½‘ç»œï¼‰ï¼Œå°±èƒ½è®©agentæœ‰æ•ˆåœ°å®Œæˆèº²é¿éšœç¢çš„ä»»åŠ¡äº†ã€‚</p><span id="more"></span><h2 id="è®©agentçš„ç”Ÿæ´»å˜å¾—è‰°éš¾ï¼Œå› ä¸ºç”Ÿæ´»æ˜¯è‰°éš¾çš„"><a href="#è®©agentçš„ç”Ÿæ´»å˜å¾—è‰°éš¾ï¼Œå› ä¸ºç”Ÿæ´»æ˜¯è‰°éš¾çš„" class="headerlink" title="è®©agentçš„ç”Ÿæ´»å˜å¾—è‰°éš¾ï¼Œå› ä¸ºç”Ÿæ´»æ˜¯è‰°éš¾çš„"></a>è®©agentçš„ç”Ÿæ´»å˜å¾—è‰°éš¾ï¼Œå› ä¸ºç”Ÿæ´»æ˜¯è‰°éš¾çš„</h2><p>æˆ‘æƒ³è®©äº‹æƒ…æœ‰è¶£ç‚¹ï¼Œæ‰€ä»¥åŠ äº†å‡ ä¸ªé¢å¤–çš„æ¡ä»¶è®©ä»»åŠ¡æ›´å›°éš¾ã€‚</p><ol><li><p>è¿åŠ¨è¢«é™åˆ¶åœ¨ä¸¥æ ¼ç‰ˆæœ¬çš„<a href="http://www.red3d.com/cwr/steer/">Reynoldsè½¬å‘</a>ä¸‹ï¼Œå¦‚<a href="http://www.cs.uu.nl/docs/vakken/mcrs/papers/8.pdf">è¿™ç¯‡è®ºæ–‡</a>ä¸­æ¦‚è¿°çš„åˆ›å»ºé€¼çœŸçš„æ¨¡æ‹Ÿè¡Œä¸ºè¿™æ ·ï¼Œä¸ä¹‹ç›¸å¯¹åº”çš„æ˜¯å¯ä»¥å‘ä»»æ„æ–¹å‘è‡ªç”±ç§»åŠ¨ã€‚</p></li><li><p>Agentå¯ä»¥é€‰æ‹©å‘å·¦æˆ–å‘å³è½¬å‘ï¼Œä½†ä¸èƒ½å¤Ÿç›´è¡Œã€‚å°±åƒä¸€è¾†æ²¡æœ‰åŠ¨åŠ›çš„è½¦è½¬å¼¯ä¸€æ ·ï¼Œå®ƒä¹Ÿå¿…é¡»åœ¨è½¬å¼¯æ—¶æœç€æ‰€è½¬çš„æ–¹å‘å‰è¿›ã€‚æˆ‘æƒ³çœ‹çœ‹agentèƒ½å¦å‘å±•å‡ºè¿™æ ·ä¸€ç§è½¬å‘æ¨¡å¼ï¼Œå³é€šè¿‡å¿«é€Ÿåœ°åœ¨å·¦è½¬å’Œå³è½¬ä¹‹é—´åˆ‡æ¢ä»è€Œå‘å‰ç§»åŠ¨ã€‚è¿™æ ·äº‹æƒ…å˜å¾—æ›´åŠ å›°éš¾äº†ï¼Œä½ å¯ä»¥æƒ³è±¡é©¾é©¶ä¸€è¾†æ±½è½¦æ—¶ï¼Œä¸ºäº†èƒ½å‘å‰ç›´è¡Œï¼Œåªèƒ½ä¸æ–­åœ°å‘å·¦æˆ–å‘å³æ‰“æ­»æ–¹å‘ç›˜ã€‚</p></li><li><p>Agentä¹‹é—´ä¼šäº’ç›¸ç¢°æ’ï¼Œå¦‚æœé€‚åº”åº¦å‡½æ•°æ˜¯æŒ‰è¿™ç§æ–¹å¼è®¾ç½®çš„è¯ï¼Œå®ƒä»¬ä¹Ÿè®¸éœ€è¦å‘å±•å‡ºä¸€ç§ç­–ç•¥æ¥é¿å¼€å¯¹æ–¹ï¼Œè¦ä¸ç„¶æˆ‘å†…å¿ƒçš„é‚ªæ¶é¢ä¼šå¸Œæœ›å®ƒä»¬ä¸€èµ·è·‘å‘æœ¨æ¿ã€‚</p></li></ol><p>æˆ‘å‘ç°æœ‰äº†è¿™äº›é™åˆ¶ï¼Œagentå°±ä¸èƒ½ä¾é ä¸€ä¸ªç®€å•çš„å•ç¥ç»å…ƒå®Œæˆè¿™ä¸€ä»»åŠ¡äº†ã€‚æˆ‘ä»ç„¶è®¤ä¸ºè¿™ä¸€ä»»åŠ¡ä¸åº”å½“ä¾é ç±»ä¼¼ESPæˆ–NEATç­‰é«˜çº§çš„æ–¹æ³•ï¼Œæˆ‘æƒ³ç”¨ç°æˆçš„<a href="http://cs.stanford.edu/people/karpathy/convnetjs/">convnet.js</a>åº“æ¥ç”Ÿæˆç¥ç»ç½‘ç»œï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†åœ¨<a href="http://blog.otoro.net/2015/03/28/neural-slime-volleyball/">neural slime volleyball</a>é¡¹ç›®ä¸­ä½¿ç”¨è¿‡çš„åŒæ ·è¶…çº§ç®€å•çš„ç¥ç»ç½‘ç»œç»“æ„ã€‚ä¸‹é¢æ˜¯æˆ‘çš„ç¬¬ä¸€æ¬¡å°è¯•ï¼š</p><iframe src="https://instagram.com/p/1qJiRMwiaw/embed/captioned/?v=4" width="80%"></iframe><p>æ¯ä¸€ä¸ªagentçš„å¤§è„‘ç”±åä¸ªç¥ç»å…ƒç»„æˆï¼Œæ¯ä¸ªç¥ç»å…ƒéƒ½å’Œæ‰€æœ‰çš„è¾“å…¥åŠå…¶ä½™çš„ç¥ç»å…ƒç›¸è¿æ¥ï¼Œä¹Ÿè®¸å°±åƒçœŸå®å¤§è„‘çš„ä¸­ä¸€ä¸ªå°åŒºåŸŸçš„åˆ‡ç‰‡ä¸€æ ·ã€‚ä¸‹é¢æ˜¯å¤§è„‘çš„åŸç†å›¾ï¼š</p><p><img src="/asset/images/2016-03-01-planks_net_8_recurrent.png" alt="basic diagram of the neural network"><br><strong>ç¥ç»ç½‘ç»œçš„åŸºæœ¬å›¾è§£â€”â€”æ¯ä¸ªå¤§è„‘æœ‰269ä¸ªæƒé‡å€¼</strong></p><p>è¿™ç§ç½‘ç»œç»“æ„è¢«ç§°ä½œ<a href="http://en.wikipedia.org/wiki/Recurrent_neural_network#Fully_recurrent_network">å…¨è¿æ¥çš„é€’å½’ç½‘ç»œï¼ˆfully connected recurrent networkï¼‰</a>ã€‚æ¯ä¸€ä¸ªagentéƒ½æœ‰ä¸€ç»„å°†é€å…¥é€’å½’ç½‘ç»œä¸­çš„æ„ŸçŸ¥è¾“å…¥ã€‚10ä¸ªç¥ç»å…ƒä¸­çš„2ä¸ªå°†æ§åˆ¶agentçš„åŠ¨ä½œï¼Œå…¶å®ƒçš„æ˜¯ç”¨äºè®¡ç®—å’Œæ€è€ƒçš„â€œéšè—ç¥ç»å…ƒå•å…ƒâ€ã€‚æ‰€æœ‰çš„ç¥ç»å…ƒè¾“å‡ºä¿¡å·åˆå°†é€å›è¾“å…¥å±‚ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½ä¸å…¶å®ƒçš„ç¥ç»å…ƒå®Œå…¨è¿æ¥èµ·æ¥äº†ï¼Œè¿™ä¸­é—´ä¼šæœ‰ä¸€å¸§ï¼ˆ~1/30sï¼‰çš„æ—¶é—´å»¶è¿Ÿã€‚</p><p>è¾“å‡ºå±‚çš„ç¬¬ä¸€ä¸ªç¥ç»å…ƒç”¨äºæ§åˆ¶agentæ˜¯å‘å·¦è¿˜æ˜¯å‘å³è½¬ï¼Œå–å†³äºè¾“å‡ºçš„ä¿¡å·ã€‚æˆ‘ä»¬ä½¿ç”¨<a href="http://mathworld.wolfram.com/HyperbolicTangent.html">åŒæ›²æ­£åˆ‡</a>å‡½æ•°æ¥å¯åŠ¨ç¥ç»å…ƒï¼Œå› ä¸ºç¥ç»å…ƒçš„è¾“å‡ºå€¼åœ¨-1è‡³1ä¹‹é—´ï¼Œæ‰€ä»¥åšè¿™æ ·çš„ä¸€ä¸ªäºŒå…ƒé€‰æ‹©ï¼ˆå·¦/å³ï¼‰æ˜¯å¾ˆè‡ªç„¶çš„ã€‚ç¬¬äºŒä¸ªç¥ç»å…ƒæ§åˆ¶agentæ˜¯ç§»åŠ¨è¿˜æ˜¯ä¿æŒé™æ­¢ï¼Œä¹Ÿå–å†³äºè¾“å‡ºä¿¡å·ã€‚</p><h2 id="è®­ç»ƒç½‘ç»œ"><a href="#è®­ç»ƒç½‘ç»œ" class="headerlink" title="è®­ç»ƒç½‘ç»œ"></a>è®­ç»ƒç½‘ç»œ</h2><p>100ä¸ªåˆå§‹åŒ–ä¸ºéšæœºæƒé‡å€¼çš„agentè¢«ç”¨äºè®­ç»ƒï¼Œå®ƒä»¬ä¼šåœ¨æ¨¡æ‹Ÿä¸­å››å¤„è·‘åŠ¨ç›´åˆ°å®ƒä»¬è¢«ä¸€å—æœ¨æ¿æ€æ­»ã€‚åœ¨æ¨¡æ‹Ÿçš„æœ€åæ‰€æœ‰äººéƒ½æ­»äº†ï¼Œè¿™ç§æ„Ÿè§‰å¾ˆç³Ÿç³•ï¼Œä½†æ˜¯äººå›ºæœ‰ä¸€æ­»â€¦â€¦</p><p>å½“æ‰€æœ‰çš„agentåœ¨ä¸€æ¬¡æ¨¡æ‹Ÿä¸­å…¨éƒ½æ­»äº¡äº†ä¹‹åï¼Œæˆ‘ä»¬ä¿ç•™åœ¨æ¨¡æ‹Ÿä¸­å­˜æ´»äº†æœ€é•¿æ—¶é—´çš„30ä¸ªagentçš„åŸºå› ç”¨äºä¸‹ä¸€ä»£ï¼Œä¸¢å¼ƒå…¶ä½™çš„70ä¸ªagentã€‚æœ€å¥½çš„30ä¸ªåŸºå› ï¼Œå³ç¥ç»è¿æ¥çš„æƒå€¼å’Œåç½®ï¼ˆbiasï¼‰çš„å‘é‡ï¼Œå°†ä¼šè¿›è¡Œäº¤å‰å˜å¼‚ä»¥ä¼ é€’ç»™ä¸‹ä¸€ä»£ä¸­æ–°äº§ç”Ÿçš„70ä¸ªagentã€‚è¿™ä¸ªè¿‡ç¨‹ï¼ˆå°†åœ¨ä¸‹é¢çš„ç¹æ®–éƒ¨åˆ†è§£é‡Šï¼‰å°†ä¼šæŒç»­è¿›è¡Œï¼Œç›´åˆ°æœ€å¥½çš„agentèƒ½å¤Ÿç†Ÿç»ƒåœ°èº²å¼€æœ¨æ¿å¹¶å­˜æ´»äº”åˆ†é’Ÿä»¥ä¸Šã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªè¿è¡Œä¸­çš„è¿›åŒ–æ¨¡æ‹Ÿ<a href="http://otoro.net/planks/training.html">demo</a>ï¼Œå®ƒçš„ç¬¬ä¸€ä»£æ˜¯å®Œå…¨éšæœºçš„ç½‘ç»œï¼ˆæˆ‘å°†è¿™ä¸ªdemoç¼©å‡ä¸º50ä¸ªagentè€Œä¸æ˜¯100ä¸ªï¼Œè¿™æ ·åœ¨å¤§éƒ¨åˆ†ç”µè„‘ç”šè‡³æ˜¯æ™ºèƒ½æ‰‹æœºä¸Šéƒ½èƒ½å¤Ÿè¿è¡Œï¼‰ã€‚èµ·åˆï¼Œå¤§éƒ¨åˆ†çš„agentéƒ½ä¸ä¼šè¯•å›¾å­˜æ´»ä¸‹å»ï¼ˆæˆ–è€…ç›´æ¥æ”¾å¼ƒäº†ï¼ï¼‰ï¼Œä½†æ˜¯ä¹Ÿè®¸ä¸€ä¸ªæˆ–ä¸¤ä¸ªçŸ¥é“è¯¥å¹²äº›ä»€ä¹ˆå¹¶ä¸”åšçš„å¥½äº†äº›ï¼Œæ‰€ä»¥å®ƒä»¬èƒ½å¤Ÿè¿›å…¥ä¸‹ä¸€ä»£å¹¶ä¸”è¿›è¡Œç¹æ®–ã€‚åœ¨å‡ ä»£è¿‡åï¼Œä½ ä¼šçœ‹åˆ°ç§ç¾¤çš„èƒ½åŠ›å¢åŠ äº†ï¼Œå®ƒä»¬å…¨éƒ½å¼€å§‹èº²é¿ç§»åŠ¨çš„æœ¨æ¿äº†ã€‚æˆ‘æƒŠè®¶åœ°å‘ç°ï¼Œåœ¨30ä»£åç»“æœå°±ä¸é”™äº†ã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ª<a href="http://otoro.net/planks/training.html">è®­ç»ƒdemo</a>ä¸­å®ƒä»¬æ˜¯å¦‚ä½•ä»å¼€å§‹æ—¶å®Œå…¨ä¸çŸ¥é“å¦‚ä½•ç”Ÿå­˜è¿›åŒ–åˆ°è¿™ä¸€æ­¥çš„ã€‚æ³¨æ„è¿™äº›ç»“æœæ˜¯æ¯åä»£æ›´æ–°ä¸€æ¬¡çš„ã€‚å› ä¸ºæˆ‘å¸Œæœ›å®ƒä»¬å°½å¯èƒ½å¿«çš„è¿›åŒ–ï¼Œè€Œä¸æ˜¯å°†è¿›åŒ–é™åˆ¶åœ¨æ¯ç§’30å¸§ï¼Œæ‰€ä»¥æŠŠæ¨¡æ‹Ÿè¿è¡Œåˆ°ç”µè„‘èƒ½å…è®¸çš„æœ€å¿«é€Ÿåº¦ï¼Œè€Œæ¯éš”åä»£è¿è¡Œä¸€æ¬¡ä½œä¸ºå±•ç¤ºçš„æ¨¡æ‹Ÿï¼Œå› æ­¤ä½ å¯ä»¥å“è¯„å®æ—¶çš„è¿›åº¦â€”â€”è€Œå®é™…çš„è¿›åŒ–æ˜¯åœ¨å±å¹•ä¹‹åä»¥å…‰é€Ÿè¿›è¡Œçš„ã€‚</p><p><img src="/asset/images/2016-03-01-planks_training-1024x1022.png" alt=""><br><strong>è®­ç»ƒçš„è‰å›¾â€”â€”è§‚çœ‹agentå¦‚ä½•ä»ä¸€æ— æ‰€çŸ¥è¿›åŒ–è€Œæ¥</strong></p><p>Agentå‘¨å›´çš„çº¿æ¡æ˜¯å®ƒçš„çŸ¥è§‰ä¼ æ„Ÿå™¨ï¼Œå°±åƒè§†è§‰è¾“å…¥ä¸€æ ·ï¼Œå®ƒä»¬ç»™æ¯ä¸€ä¸ªagentæä¾›äº†å‘¨å›´ä¸–ç•Œçš„æ„ŸçŸ¥èƒ½åŠ›ã€‚Agentæ„ŸçŸ¥åˆ°çš„ç‰©ä½“è¶Šè¿‘åˆ™çº¿æ¡çš„å¼ºåº¦è¶Šå¤§ã€‚æ¯ä¸ªagentèƒ½å¤Ÿçœ‹åˆ°å‘¨å›´çš„8ä¸ªæ–¹å‘ï¼Œæ¢æµ‹è·ç¦»æœ€å¤§ä¸ºå…¶èº«ä½“åŠå¾„çš„12å€ã€‚æˆ‘æ˜¯è¿™æ ·å†³å®šä¿¡å·å€¼çš„ï¼Œagentæ¢æµ‹åˆ°çš„ç‰©ä½“è¶Šè¿‘ï¼Œä¿¡å·è¶Šæ¥è¿‘ä¸€ï¼Œåä¹‹ï¼Œè‹¥æ²¡æœ‰æ¢æµ‹åˆ°ç‰©ä½“ï¼Œä¿¡å·ä¸ºé›¶ã€‚å¦‚æœagentçœ‹åˆ°çš„ç‰©ä½“è·ç¦»ä¸º6å€åŠå¾„ï¼Œåˆ™ä¿¡å·ä¸º0.25è€Œä¸æ˜¯0.5ï¼Œè¿™é‡Œæˆ‘ä¸ºäº†æ¨¡ä»¿<a href="http://en.wikipedia.org/wiki/Inverse-square_law">å…‰ç…§å¯†åº¦æ¨¡å‹</a>å°†ç»“æœè¿›è¡Œäº†å¹³æ–¹ã€‚</p><h2 id="å¦‚æœWayne-Gretzkyåœ¨æœ‰å­©å­ä¹‹å‰å°±é­é‡äº†è½¦ç¥¸ä¼šå¦‚ä½•ï¼Ÿ"><a href="#å¦‚æœWayne-Gretzkyåœ¨æœ‰å­©å­ä¹‹å‰å°±é­é‡äº†è½¦ç¥¸ä¼šå¦‚ä½•ï¼Ÿ" class="headerlink" title="å¦‚æœWayne Gretzkyåœ¨æœ‰å­©å­ä¹‹å‰å°±é­é‡äº†è½¦ç¥¸ä¼šå¦‚ä½•ï¼Ÿ"></a>å¦‚æœWayne Gretzkyåœ¨æœ‰å­©å­ä¹‹å‰å°±é­é‡äº†è½¦ç¥¸ä¼šå¦‚ä½•ï¼Ÿ</h2><p><em>[è¯‘è€…æ³¨]ï¼šWayne Gretzkyæ˜¯è‘—åçš„åŠ æ‹¿å¤§å†°çƒè¿åŠ¨å‘˜</em></p><p>æˆ‘ä¹Ÿç»™ä¸Šé¢æåˆ°çš„è®­ç»ƒç®—æ³•è¿›è¡Œäº†ä¸€ç‚¹å¾®è°ƒã€‚</p><p>ç°åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ä¸€äº›è¡¨ç°æœ€å¥½çš„agentå¯èƒ½ä¼šæ„å¤–æ­»äº¡ï¼Œå³ä½¿å®ƒä»¬å¾ˆå‰å®³ï¼Œä½†å› ä¸ºæ¨¡æ‹Ÿä¸­agentä¹‹é—´å¤ªæ‹¥æŒ¤äº†ï¼Œå®ƒä¹Ÿä¼šå› ä¸ºçº¯ç²¹è¿æ°”ä¸å¥½è€Œæ­»æ‰ã€‚ä¸Šä¸€ä»£çš„ä¸€ä¸ªé¡¶å°–çš„èº²é¿å¢™çš„agentï¼Œèµ·å§‹ä½ç½®å¯èƒ½æ˜¯åœ¨äººç¾¤çš„è¾¹ç¼˜ï¼Œåœ¨æ¨¡æ‹Ÿå¼€å§‹æ—¶å°±ä¼šè¢«å…¶å®ƒçš„å‡ ä¸ªagentæ„å¤–çš„æ¨åˆ°æœ¨æ¿ä¸Šé¢ï¼Œè¿™å°±ä¸èƒ½æŠŠå®ƒçš„å¥½åŸºå› ä¼ ç»™ä¸‹ä¸€ä»£äº†ã€‚</p><p>æˆ‘æƒ³äº†ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œæƒ³å‡ºäº†ä¸€ä¸ªä¸»æ„ï¼Œåœ¨è¿›åŒ–ç®—æ³•ä¸­åŠ å…¥ä¸€ä¸ªâ€œåäººå ‚â€éƒ¨åˆ†ï¼Œè¿™å°†ä¼šè®°ä¸‹é‚£äº›è¾¾åˆ°äº†æœ€ä½³è®°å½•åˆ†æ•°çš„agentçš„åŸºå› ã€‚æˆ‘ä¹Ÿä¿®æ”¹äº†æˆ‘çš„<a href="https://github.com/hardmaru/convnetjs/tree/master/neuroevolution">è¿›åŒ–åº“</a>æ¥åŠ å…¥è¿™ä¸ªåäººå ‚ç‰¹æ€§ï¼Œä»¥ä¿ç•™å†æ¥çš„åä½³å† å†›ã€‚å¯¹äºæ¯ä¸€æ¬¡æ¨¡æ‹Ÿï¼Œåäººå ‚éƒ½ä¼šåŠ å…¥è¢«åŠ å…¥åˆ°å½“å‰çš„è¿™ä¸€ä»£ã€‚ä»è¿™å±‚æ„ä¹‰ä¸Šæ¥è¯´ï¼Œæ¯ä¸€ä»£çš„agentéƒ½å¿…é¡»å’Œå†æ¥æœ€å¥½çš„agentç«äº‰ã€‚æƒ³è±¡ä¸€ä¸‹èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªå†°çƒèµ›å­£éƒ½å’ŒWayne Gretzkey, Doug GilmouråŠTim Hortonä¸€èµ·è®­ç»ƒï¼</p><p>è¿™ä¸ªæŠ€æœ¯ç»å¯¹æå¤§æå‡äº†è¿›åŒ–çš„ç»“æœï¼Œå› ä¸ºæœ€å¥½çš„åŸºå› éƒ½è¢«å¼ºåˆ¶åŠ å…¥åˆ°äº†ç§ç¾¤ä¸­ã€‚å¦‚æœè¿™å‘ç”Ÿåœ¨ç°å®ç”Ÿæ´»ä¸­ä¼šå¾ˆææ€–çš„ï¼ˆè™½ç„¶æˆ‘ä»¬å¯èƒ½å¾ˆå¿«å°±å°†è¾¾åˆ°è¿™ä¸€æ­¥äº†â€¦â€¦ï¼‰ã€‚æˆ‘è®¤ä¸ºæˆ‘åœ¨è¿›åŒ–è®¡ç®—çš„ä¸–ç•Œé‡Œå‘ç°äº†ä¸€ä¸ªä¼Ÿå¤§çš„æ–°æŠ€æœ¯ï¼Œè¿™æ˜¯ä¸€ä¸ªçªç ´ï¼ç„¶è€Œï¼Œæˆ‘å‘ç°åäººå ‚æŠ€æœ¯<a href="http://www.cs.utexas.edu/users/nn/pages/research/ne-applications.html">å·²ç»åœ¨å›´æ£‹é¢†åŸŸä¸­è¢«ç”¨äº</a>ç¥ç»è¿›åŒ–äº†ã€‚å¥½å§ï¼Œè¿™å¯¹æˆ‘ä¸æ˜¯å¥½æ¶ˆæ¯ã€‚</p><p>æˆ‘æƒ³çœ‹çœ‹å¦‚æœæˆ‘é‡æ–°è¿›åŒ–ä¸€éï¼Œagentæ˜¯å¦ä¼šè¡¨ç°åœ°å®Œå…¨ä¸åŒï¼Œäºæ˜¯æˆ‘èŠ±äº†å‡ å¤©è®­ç»ƒäº†ä¸åŒçš„å‡ ç»„agentï¼Œæ¯ä¸€ç»„éƒ½æœ‰ä¸€åƒä»£å·¦å³ã€‚äº‹å®è¯æ˜å¤§éƒ¨åˆ†çš„agentæœ€ç»ˆéƒ½æœ‰ç›¸ä¼¼çš„æƒå€¼æ¨¡å¼ã€‚ä¸ºäº†çŸ¥é“æ¯ä¸ªagentçš„å¤§è„‘çœ‹èµ·æ¥æœ‰ä½•ä¸åŒï¼Œæˆ‘å°†è¡¨ç°æœ€å¥½çš„agentçš„â€œåŸºå› ä»£ç â€ç”»æˆäº†å›¾ï¼Œä¸ºäº†å›¾ä¸­çš„æ•ˆæœæˆ‘å°†å››ä¸ªæƒå€¼ä½œä¸ºä¸€ç»„åˆæˆäº†ä¸€ä¸ªé¢œè‰²ï¼ˆRGBAçš„å››ä¸ªé€šé“ï¼‰ã€‚</p><p><img src="/asset/images/2016-03-01-plank_boid_genes-1024x1024.png" alt=""><br><strong>æ¯ä¸€è¡Œä»£è¡¨è¿›åŒ–æœ€æˆåŠŸçš„ç¥ç»ç½‘ç»œçš„æƒå€¼</strong></p><p>å¯ä»¥çœ‹å‡ºè¡¨ç°æœ€å¥½çš„agenté™¤äº†äº›è®¸å·®åˆ«å¤–ä¼¼ä¹éƒ½å·®ä¸å¤šã€‚ç„¶è€Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå³å®ƒä»¬å¯èƒ½éƒ½è¢«é™åˆ¶åœ¨ä¸€ä¸ªå±€éƒ¨ä¼˜åŒ–çŠ¶æ€ã€‚æˆ‘å¯ä»¥æƒ³è±¡åœ¨æŸäº›æƒ…å¢ƒä¸­ï¼Œagentä¸ºäº†é¿å¼€æœ¨æ¿è€Œè¶‹å‘äºå‘å±•å‡ºç›¸åŒçš„æ¬¡æœ€ä¼˜ç­–ç•¥ï¼Œè€Œç”±äºä»»åŠ¡çš„éš¾åº¦çš„é™åˆ¶å°±ä¸ä¼šæœ‰æ–°çš„è¿›å±•äº†ã€‚å¦‚æœä½¿ç”¨æ›´é«˜çº§çš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œä½†æ˜¯æˆ‘å¯¹ç°åœ¨ç”¨ç®€å•çš„<a href="http://blog.otoro.net/2015/02/06/conventional-neuroevolution-cne-trainer-part-ii/">å·ç§¯ç¥ç»è¿›åŒ–</a>ç”Ÿæˆçš„é€’å½’ç½‘ç»œå·²ç»å¾ˆæ»¡æ„äº†ã€‚æˆ‘åœ¨demoä¸­ä½¿ç”¨äº†æœ€å¥½çš„23ä¸ªåŸºå› ã€‚æœ€ç»ˆçš„æ¨¡æ‹Ÿå°†ä¼šåˆ©ç”¨ä»è¿™ä¸ªè®­ç»ƒå®Œæˆçš„ç»„ä¸­éšæœºæŒ‘é€‰å‡ºçš„åäººå ‚æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚</p><h2 id="ç»“æœåˆ†æ"><a href="#ç»“æœåˆ†æ" class="headerlink" title="ç»“æœåˆ†æ"></a>ç»“æœåˆ†æ</h2><p>åœ¨ç»è¿‡çº¦ä¸€åƒä»£çš„è®­ç»ƒåï¼Œagentå·²ç»èƒ½ä¸é”™åœ°èº²é¿éšœç¢äº†ã€‚è¯·çœ‹è¿™ä¸ª<a href="http://otoro.net/planks">demo</a>ä¸­çš„æœ€ç»ˆç»“æœã€‚Agentè¿˜è¿œä¸å¤Ÿå®Œç¾ï¼Œä½†æ˜¯å®ƒä»¬å±•ç¤ºå‡ºçš„åƒæ˜†è™«èˆ¬çš„è¡Œä¸ºè®©æˆ‘è§‰å¾—å¾ˆæœ‰è¶£ã€‚æˆ‘å¾ˆæƒŠè®¶ï¼Œå³ä½¿å®ƒä»¬è¢«é™åˆ¶æˆåªèƒ½å…¨åŠ›å·¦è½¬æˆ–å³è½¬ï¼Œå®ƒä»¬ä»ç„¶èƒ½å¤Ÿå®Œæˆèº²é¿æœ¨æ¿çš„ä»»åŠ¡ã€‚åœ¨demoä¸­ï¼Œæ¯ä¸ªagentæœ‰ä¸€åªæ‰‹ï¼Œç”¨äºæ˜¾ç¤ºå®ƒä»¬è½¬çš„æ–¹å‘ã€‚æ²¡æœ‰æ‰‹åˆ™è¡¨ç¤ºä¿æŒé™æ­¢ã€‚æˆ‘ä¹Ÿå¾ˆé«˜å…´çš„çœ‹åˆ°å½“agentæƒ³æœä¸€ä¸ªæ–¹å‘å‰è¿›æ—¶ï¼Œå®ƒèƒ½åœ¨ç©ºç™½åŒºåŸŸæ‘‡æ‘†å‘å‰ï¼Œçœ‹æ¥å®ƒä»¬é€šè¿‡å·¦è½¬å’Œå³è½¬é—´çš„åˆ‡æ¢å‘å±•å‡ºäº†æŸç§æ¨¡å¼ã€‚</p><p><img src="/asset/images/2016-03-01-planks_final_result1-1024x576.png" alt=""><br><strong>æœ€ç»ˆæ¨¡æ‹Ÿâ€”â€”otoro.net/planks</strong></p><p>æˆ‘ä¹Ÿæ³¨æ„åˆ°å®ƒä»¬å€¾å‘äºå’Œå…¶å®ƒagentèšåœ¨ä¸€èµ·å¹¶åŠªåŠ›å¾…åœ¨ä¸­é—´ï¼Œæˆ‘ä¸ç¡®å®šåŸå› ã€‚ä¹Ÿè®¸æ˜¯å› ä¸ºåœ¨äººç¾¤çš„ä¸­é—´ï¼Œå®ƒå¯ä»¥ç­‰å¾…å…¶å®ƒagentæ­»å»ä»è€Œå¢åŠ è‡ªå·±å­˜æ´»çš„å‡ ç‡ã€‚æˆ‘ä¹Ÿè€ƒè™‘è¿‡åœ¨é€‚åº”åº¦å‡½æ•°ä¸­ä½¿ç”¨ä¸ç§ç¾¤å¹³å‡å€¼æœ‰å…³çš„<em>ç›¸å¯¹ç”Ÿå‘½é•¿åº¦</em>ï¼Œè€Œä¸æ˜¯ç»å¯¹ç”Ÿå‘½é•¿åº¦ã€‚ä¹Ÿè®¸åœ¨ä¸€ä¸ªæ›´å¤æ‚çš„ç½‘ç»œä¸­ï¼Œè¿™èƒ½å¤Ÿè¯±ä½¿agentå˜å¾—é‚ªæ¶ä¸”ä¼šè®¡åˆ’æ€æ­»å…¶ä»–agentã€‚</p><h2 id="ç¹æ®–"><a href="#ç¹æ®–" class="headerlink" title="ç¹æ®–"></a>ç¹æ®–</h2><p><img src="/asset/images/2016-03-01-planks_mating.png" alt=""><br><strong>å¸¦æœ‰çˆ¶æ¯åŒæ–¹åŸºå› çš„åä»£</strong></p><p>ä¸å…¶æ¯ä¸€æ¬¡éƒ½ç­‰ç€æ‰€æœ‰çš„agentæ­»äº¡ç„¶ååˆ›é€ ä¸‹ä¸€ä»£ï¼Œä¸å¦‚è®©demoæ›´æœ‰è¶£äº›ï¼Œäºæ˜¯æˆ‘ç»™agentæ·»åŠ äº†é…å¯¹å’Œäº§ç”Ÿåä»£çš„èƒ½åŠ›ï¼åœ¨ä»¥åè¿™å¯èƒ½ä¼šå½¢æˆä¸€ä¸ªå¯ä¾›é€‰æ‹©çš„è®©agentè¿›åŒ–çš„ä»£å†…æ–¹æ³•ï¼Œè€Œä¸æ˜¯å°†æ¯ä¸€ä»£çš„ç§ç¾¤æ•°é‡å›ºå®šä¸ºå¸¸æ•°ã€‚</p><p>å®ƒå·¥ä½œçš„åŸç†æ˜¯å¯¹äºæ¯ä¸ªagentï¼Œå¦‚æœå®ƒä»¬èƒ½å¤Ÿç”Ÿå­˜æŸä¸€ä¸ªéšæœºçš„æ—¶é—´ï¼ˆä¸€èˆ¬ä¸º30è‡³60ç§’ï¼‰ï¼Œå®ƒä»¬å°†å…·æœ‰ç¹æ®–çš„èƒ½åŠ›ã€‚å¦‚æœè¿™æ ·çš„ä¸¤ä¸ªagentç›¸é‡äº†ï¼Œå°±ä¼šäº§ç”Ÿä¸¤ä¸ªåä»£ã€‚åä»£åˆå§‹æ—¶ä½“ç§¯ä¼šå°ä¸€ç‚¹ï¼Œåœ¨çº¦30-60ç§’åä¼šé•¿åˆ°æˆå¹´å¤§å°ã€‚çˆ¶ä»£agentçš„â€œæ¿€åŠ±æ—¶é’Ÿâ€é‡ç½®ä¸ºé›¶ï¼Œå¿…é¡»å†ç­‰30-60ç§’æ‰èƒ½äº§ç”Ÿä¸‹ä¸€ä»£â€¦â€¦</p><p><img src="/asset/images/2016-03-01-planks_crossover-1024x440.png" alt=""><br><strong>äº¤å‰ç®—æ³•ï¼ˆç»´åŸºç™¾ç§‘ï¼‰</strong></p><p>ä¸¤ä¸ªåä»£å°†ä¼šç»§æ‰¿çˆ¶æ¯åŒæ–¹çš„åŸºå› ï¼Œè¿™æ˜¯é€šè¿‡å¾ˆç®€å•çš„ä¸€ç‚¹<a href="http://en.wikipedia.org/wiki/Crossover_%28genetic_algorithm%29">äº¤å‰æ–¹æ³•</a>ã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªå­©å­å°†ä¼šä»ç¬¬ä¸€ä¸ªçˆ¶ä»£é‚£é‡Œç»§æ‰¿ç¬¬ä¸€æ®µç¥ç»ç½‘ç»œçš„æƒå€¼ï¼Œå‰©ä¸‹çš„æ¥è‡ªç¬¬äºŒä¸ªçˆ¶ä»£ã€‚å¦‚ä¸Šå›¾ä¸­æè¿°çš„ä¸€æ ·ï¼Œæˆªæ–­ç‚¹æ˜¯éšæœºçš„ã€‚æˆ‘è¿˜é¢å¤–åœ°ç»™æ¯ä¸€ä¸ªå­©å­å¢åŠ äº†éšæœºå˜å¼‚ï¼Œæ‰€ä»¥å®ƒä»¬å°†å…·æœ‰ç‹¬ç‰¹æ€§ã€‚è¿™ä¸ªéšæœºçš„å˜å¼‚å¯¹äºé¼“åŠ±åˆ›æ–°å’Œç»™ç§ç¾¤çš„åŸºå› åº“æ·»åŠ æ–°å…ƒç´ æ˜¯å¾ˆé‡è¦çš„ã€‚</p><p>ä»åŸç†ä¸Šè¯´è¡¨ç°è¶Šå¥½çš„agentæœ‰è¶Šé«˜çš„ç”Ÿå­˜å‡ ç‡ï¼Œå› æ­¤å®ƒä»¬æœ‰æ›´é«˜çš„å‡ ç‡äº§ç”Ÿæºå¸¦å…¶åŸºå› çš„åä»£ï¼Œåä¹‹è¾ƒå¼±çš„ä¸ªä½“ä¼šåœ¨æ‹¥æœ‰å­©å­ä¹‹å‰æ­»å»ã€‚è™½ç„¶æœ‰æ—¶å¾ˆå¥½çš„ä¸ªä½“ä¼šå› ä¸ºä¸èµ°è¿è€Œæ­»çš„å¤ªæ—©ï¼Œè¿™å¯¹äºå®ƒä»¬ç¡®å®ä¸å¤ªå¥½â€”â€”è¿™å°±æ˜¯ç”Ÿæ´»â€”â€”ç”Ÿæ´»æ˜¯ä¸å…¬å¹³çš„ï¼Œè€Œä¸”ç”Ÿæ´»å¾ˆè‰°éš¾ï¼</p><h2 id="ä¸agentäº’åŠ¨â€”â€”æ‰®æ¼”ä¸Šå¸"><a href="#ä¸agentäº’åŠ¨â€”â€”æ‰®æ¼”ä¸Šå¸" class="headerlink" title="ä¸agentäº’åŠ¨â€”â€”æ‰®æ¼”ä¸Šå¸"></a>ä¸agentäº’åŠ¨â€”â€”æ‰®æ¼”ä¸Šå¸</h2><p>å½“ä½¿ç”¨demoæ—¶ï¼Œä½ å¯ä»¥ç‚¹å‡»å±å¹•çš„ç©ºç™½éƒ¨åˆ†æ¥åˆ›å»ºæ–°çš„agentåŠ å…¥æ¨¡æ‹Ÿã€‚ä¸€ä¸ªæ–°çš„agentçš„åˆå§‹åŸºå› æ˜¯ä»æœ€è¿‘çš„å‡ ä¸ªè¯•å›¾äº§ç”Ÿåä»£çš„agentä¸­éšæœºé€‰æ‹©å‡ºçš„ï¼Œå¦‚æœæ‰€æœ‰çš„agentéƒ½æœªç¹æ®–è¿‡ï¼Œé‚£å°±ä»åäººå ‚æœ€åˆçš„ä¸€ç»„ä¸­é€‰æ‹©ã€‚</p><p>å¦‚æœä½ ç‚¹å‡»åˆ°äº†æœ¨æ¿ä¸Šï¼Œå°†ä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªè§†è§‰æ¨¡å¼ï¼Œä¾‹å¦‚ï¼ŒXå°„çº¿æ¨¡å¼ï¼Œæ— è¾¹æ¡†æ¨¡å¼ï¼Œæ²¡æœ‰æ‰‹çš„çº¯ç²¹ç”Ÿç‰©æ¨¡å¼ç­‰ç­‰ã€‚æˆ‘ç”¨è¿™äº›æ¨¡å¼æ¥è¯„ä¼°ä¸åŒçš„è®¾è®¡å’Œæ€»ä½“çš„ç¾æ„Ÿã€‚æˆ‘è®¤ä¸ºXå°„çº¿æ¨¡å¼çœ‹èµ·æ¥å¾ˆé…·ï¼Œè€Œä¸”åœ¨è¾ƒæ…¢çš„æœºå™¨ä¸Šä¹Ÿèƒ½è¿è¡Œçš„æ›´å¿«ã€‚</p><p><img src="/asset/images/2016-03-01-planks_xray-300x300.png" alt=""><br><strong>Xå°„çº¿æ¨¡å¼</strong></p><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç‚¹å‡»agentæ¥ç»™å®ƒä»¬æ–½åŠ ä¸€ä¸ªå¼ºå¤§çš„æ¨åŠ›ã€‚è¿™æ¨¡æ‹Ÿäº†ä¸€ä¸ªæš‚æ—¶çš„é£åŠ›æ•ˆæœï¼Œå°†å®ƒä»¬ä»è¢«ç‚¹å‡»çš„åœ°æ–¹æ¨å¼€ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥åœ¨å±å¹•ä¸Šæ‹–åŠ¨ç”»çº¿æ¥åˆ›å»ºä¸€å—æ–°çš„æœ¨æ¿ã€‚ä¾æ®æ‰€ç”»çš„æ–¹å‘ï¼Œæœ¨æ¿ä¼šæ²¿ç€å…¶å‚ç›´æ–¹å‘å‘å·¦æˆ–å‘å³ç§»åŠ¨ã€‚ä½ å¯ä»¥çœ‹åˆ°åœ¨ä½ é‡Šæ”¾äº†ä¸€äº›æœ¨æ¿å»æ‘§æ¯å®ƒä»¬çš„æ–‡æ˜æ—¶ï¼Œagentæ˜¯å¦‚ä½•ååº”çš„ã€‚è¯·å–„ç”¨è¿™ä¸ªæ–°èƒ½åŠ›ï¼Œæˆ‘æ³¨æ„åˆ°åœ¨æ²¡æœ‰è¿™ä¸ªç‰¹æ€§ä¹‹å‰ï¼Œç”¨æˆ·ä¼šç»™å°å®¶ä¼™ä»¬åŠ æ²¹ï¼Œä½†æ˜¯çŸ¥é“äº†è¿™ä¸ªåŠŸèƒ½åï¼Œä»–ä»¬å¼€å§‹å‡†å¤‡ç§æ—ç­ç»äº†ï¼</p><h2 id="è®¾è®¡å’Œå¼€å‘çš„è€ƒè™‘"><a href="#è®¾è®¡å’Œå¼€å‘çš„è€ƒè™‘" class="headerlink" title="è®¾è®¡å’Œå¼€å‘çš„è€ƒè™‘"></a>è®¾è®¡å’Œå¼€å‘çš„è€ƒè™‘</h2><p>ï¼ˆè¿™ä¸€éƒ¨åˆ†æš‚æœªç¿»è¯‘ï¼‰</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å»å¹´çœ‹åˆ°çš„ä¸€ä¸ªå¾ˆæœ‰è¶£çš„é¡¹ç›®ï¼Œè¿˜è¯•ç€æ¨¡ä»¿å®ƒçš„ä»£ç å†™ä¸€ä¸ªç±»ä¼¼çš„é¡¹ç›®å‡ºæ¥ï¼Œä¸è¿‡ä¸€ç›´æ²¡æœ‰å®Œæˆã€‚è¿™é‡ŒæŠŠåŸä½œè€…çš„ä¸€ç¯‡ç›¸å…³åšå®¢ç¿»è¯‘è¿‡æ¥ï¼Œè¯´ä¸å®šæœ‰æ›´å¤šçš„äººå¯¹æ­¤æ„Ÿå…´è¶£ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¡¹ç›®æ¼”ç¤ºï¼š&lt;a href=&quot;http://otoro.net/planks/&quot;&gt;åŸä½œè€…ç”¨JavaScriptå®ç°çš„demo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&quot;http://blog.otoro.net/2015/05/07/creatures-avoiding-planks/&quot;&gt;creatures avoiding planks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸä½œè€…çš„twitteråœ°å€ï¼š&lt;a href=&quot;https://twitter.com/hardmaru&quot;&gt;hardmaruâ€™s twitter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸä½œè€…çš„å¦ä¸€ä¸ªå®éªŒï¼š&lt;a href=&quot;http://otoro.net/kanji/&quot;&gt;ç”Ÿæˆä¼ªæ±‰å­—çš„å®éªŒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è¯‘æ–‡åœ°å€ï¼š&lt;a href=&quot;http://noiron.github.io/2016/03/01/creatures-avoiding-planks/&quot;&gt;ç”¨ç¥ç»ç½‘ç»œå®ç°èƒ½å¤Ÿè‡ªä¸»é¿è®©éšœç¢çš„ç”Ÿç‰©&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ç¿»è¯‘ï¼šå´é”´ï¼ˆnoironï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šåŸæ–‡ä¸­å¼•ç”¨äº†ä¸€äº›å¢™å¤–é“¾æ¥ï¼Œè¯·é…åˆæ¢¯å­é£Ÿç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ä¸ºè¯‘æ–‡å†…å®¹ï¼š&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;img src=&quot;/asset/images/2016-03-01-planks_blog.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;strong&gt;å…·æœ‰ç¥ç»ç½‘ç»œå¤§è„‘çš„agentä¸ºäº†ç”Ÿå­˜è€Œè¿›åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://otoro.net/planks/&quot;&gt;è¿™é‡Œæ˜¯javascriptçš„æ¼”ç¤º&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæ¨¡æ‹Ÿ&lt;a href=&quot;https://www.youtube.com/watch?v=fmSTNu0Zjh8&quot;&gt;è§†é¢‘&lt;/a&gt;ï¼Œå±•ç¤ºäº†ä½¿ç”¨è¿›åŒ–æŠ€æœ¯æ¥è®­ç»ƒagentï¼Œè®©å®ƒä»¬èƒ½å¤Ÿé¿å¼€ç§»åŠ¨çš„éšœç¢ç‰©ã€‚&lt;a href=&quot;https://www.reddit.com/r/gamedev/comments/31idqb/im_building_evolution_based_ai_toolkit_to/&quot;&gt;è¿™é‡Œä½¿ç”¨çš„æ–¹æ³•&lt;/a&gt;ä¼¼ä¹æ˜¯&lt;a href=&quot;http://www.cs.ucf.edu/~kstanley/neat.html&quot;&gt;NEAT&lt;/a&gt;ç®—æ³•çš„å˜ç§ã€‚NEATç®—æ³•ç”¨äºç¥ç»ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„è¿›åŒ–ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£ç¡®å®Œæˆç‰¹å®šçš„ä»»åŠ¡ã€‚å®ƒæ˜¯ä¸ºäº†&lt;a href=&quot;http://en.wikipedia.org/wiki/Unity_(game_engine&quot;&gt;Unity 5&lt;/a&gt;æ¸¸æˆå¼•æ“è€Œå†™çš„ï¼Œæƒ³è¢«æ•´åˆè¿›ç»¼åˆçš„æ¸¸æˆAIä¸­ï¼Œè¿™å¼•èµ·äº†æˆ‘çš„å…´è¶£ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç»“æœå¾ˆé…·è€Œä¸”åŠ¨èµ·æ¥ä¼¼ä¹å¾ˆä¼˜é›…ï¼Œæ‰€ä»¥æˆ‘æƒ³è¯•ç€ç”¨javascriptå®ç°ä¸€ä¸ªç±»ä¼¼çš„demoï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œäº†ã€‚åœ¨ç©äº†ä¸€ä¸‹åŸºæœ¬çš„å®ç°åï¼Œæˆ‘å‘ç°å¯¹äºéšœç¢èº²é¿é—®é¢˜ï¼Œä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œå°±å¯ä»¥é«˜æ•ˆçš„å®Œæˆäº†ï¼Œç”šè‡³äºä¸€ä¸ªå®Œå…¨è¿æ¥çš„ç¥ç»ç½‘ç»œéƒ½ç®—æ˜¯æ€é¸¡ç”¨ç‰›åˆ€äº†ã€‚æœ€åæˆ‘ä¹Ÿæ„è¯†åˆ°å°±ç®—æ˜¯ä¸€ä¸ªç®€å•çš„ç±»&lt;a href=&quot;http://upload.wikimedia.org/wikipedia/commons/3/31/Perceptron.svg&quot;&gt;æ„ŸçŸ¥å™¨ï¼ˆperceptronï¼‰&lt;/a&gt;ç½‘ç»œéƒ½èƒ½å¤Ÿå¾ˆå¥½åœ°å®Œæˆä»»åŠ¡ï¼Œè€Œåœ¨ä¹‹å‰æåˆ°çš„éšœç¢èº²é¿demoä¸­ï¼Œéšè—å•å…ƒä¹Ÿå¹¶ä¸èƒ½å¤Ÿå¢åŠ å¤šå°‘å¥½å¤„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/asset/images/2016-03-01-perceptron.png&quot; alt=&quot;perceptron&quot;&gt;&lt;br&gt;&lt;strong&gt;ç®€å•çš„æ„ŸçŸ¥å™¨å›¾è§£ï¼ˆç»´åŸºç™¾ç§‘ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºagentå¯ä»¥åœ¨æ¢æµ‹åˆ°éšœç¢ç‰©çš„ç¬é—´è‡ªç”±åœ°å‘ä»»æ„æ–¹å‘ç§»åŠ¨ï¼Œè€Œä¸”agentä¹‹é—´ä¸ä¼šäº§ç”Ÿç›¸äº’ä½œç”¨ï¼Œå› æ­¤è¿™ä¸ªä»»åŠ¡å˜å¾—å¤ªç®€å•äº†ï¼Œä½¿ç”¨NEATç®—æ³•çš„æ€ä¼¤åŠ›è¿‡å¤§äº†ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ç±»æ„ŸçŸ¥å™¨ç½‘ç»œï¼ˆå³å•ç¥ç»å…ƒç½‘ç»œï¼‰ï¼Œå°±èƒ½è®©agentæœ‰æ•ˆåœ°å®Œæˆèº²é¿éšœç¢çš„ä»»åŠ¡äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="javascript" scheme="http://www.wukai.me/tags/javascript/"/>
    
      <category term="ç¥ç»ç½‘ç»œ" scheme="http://www.wukai.me/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
</feed>
